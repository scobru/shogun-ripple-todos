(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var Xi=2,db=4,Eo=8,Yn=16,hb=32,gb=64,pb=128,qs=1024,Mi=2048,ac=4096,rh=8192,So=16384,vf=65536,nh=1<<17,tu=Symbol();const xb=Symbol();var Ef=Object.getOwnPropertyDescriptor,cc=Array.from,ih=Array.isArray,bb=Object.defineProperty;structuredClone;function yb(){var r=document.createTextNode("");return r.__t="",r}var sh,oh,ah;function wb(){var r=Node.prototype,e=Element.prototype,t=EventTarget.prototype;ah=/Firefox/.test(navigator.userAgent),sh=Ef(r,"firstChild").get,oh=Ef(r,"nextSibling").get,e.__click=void 0,e.__className="",e.__attributes=null,e.__styles=null,e.__e=void 0,t.__root=void 0}function Be(r){return sh.call(r)}function fa(r){var e=Be(r);return e.nodeType===8&&e.data===""?Pe(e):e}function Pe(r){return oh.call(r)}const mb=["touchstart","touchmove"];function Ab(r){return mb.includes(r)}let Se=null,_e=null,Fs=null,bt=null;var $i=new Map;let Zs=!1,vb=0,uc=[],la=[],Sf=0,pt=null,We=!1,Ui=!1;function ch(){return++vb}function Ri(r){Se=r}function Ys(r){_e=r}function Xs(r){We=r}function uh(r){var e=r.t;if(e!==null){var t=Se,n=_e,i=We,s=Ui;try{Se=null,_e=null,We=!1,Ui=!0,e.call(null)}finally{Se=t,_e=n,We=i,Ui=s}}}function fh(r){var e=r.v;(e===tu||lh(r.d))&&(e=Sb(r),e!==r.v&&(r.v=e,r.c=ch()))}function Eb(r){var e=r.blocks;if(e!==null){r.blocks=null;for(var t=0;t<e.length;t++)Wt(e[t])}}function Sb(r){var e=Se,t=_e,n=We,i=pt,s=bt;try{Se=r.b,_e=r,We=!0,pt=null,bt=r.co,Eb(r);var o=r.fn();return r.d=pt,o}finally{Se=e,_e=t,We=n,pt=i,bt=s}}function fc(r,e){for(var t=e;t!==null;){var n=t.s;if((t.f&gb)!==0&&n.c!==null){n.c(r);return}t=t.p}throw r}function lc(r){var e=Se,t=_e,n=We,i=pt,s=bt;try{Se=r,_e=r,bt=r.co,Vb(r),uh(r),We=(r.f&(Xi|Yn))===0,pt=null;var o=r.fn();if(typeof o=="function"){r.t=o;let a=r;for(;a!==null&&(a.f&Mi)===0;)a.f^=Mi,a=a.p}r.d=pt}catch(a){fc(a,r)}finally{Se=e,_e=t,We=n,pt=i,bt=s}}function Cb(r,e){return{b:e,c:0,f:rh,v:r}}function Ib(r,e){return{b:e,blocks:null,c:0,co:bt,d:null,f:rh|So,fn:r,v:tu}}function Cf(r){var e=_e,t=e.d;return t!==null?(e.d=t.n,t.c=r.c,t.t=r,t.n=null,t):{c:r.c,t:r,n:null}}function lh(r){if(r===null)return!1;for(;r!==null;){var e=r.t;if((e.f&So)!==0&&fh(e),e.c>r.c)return!0;r=r.n}return!1}function If(r){var e=r.f;return(e&(Xi|Yn))!==0?!1:(e&ac)===0?(r.f^=ac,!0):lh(r.d)}function kb(r){for(var e=r,t=null,n=[];e!==null;){var i=e.f;if((i&qs)!==0&&(e.f^=qs,t=e),(i&vf)===0&&t!==null){if((i&Eo)!==0)n.push(e);else try{If(e)&&lc(e)}catch(l){fc(l,e)}var s=e.first;if(s!==null){e=s;continue}}var o=e.p;for(e=e.next;e===null&&o!==null;)o===t&&(t=null),e=o.next,o=o.p}for(var a=n.length,c=0;c<a;c++){var u=n[c],i=u.f;try{(i&(vf|nh))===0&&If(u)&&lc(u)}catch(f){fc(f,u)}}}function Tb(r){for(let e=0;e<r.length;e++)kb(r[e])}function Pb(){if(Zs=!1,la.length>0){var r=la;la=[];for(var e=0;e<r.length;e++)r[e]()}if(!(Sf>1001)){var t=uc;uc=[],Tb(t),Zs||(Sf=0),$i.clear()}}function Nb(r){Zs||(Zs=!0,queueMicrotask(Pb))}function dh(r){Nb();let e=r;for(;e!==null;){var t=e.f;if((t&qs)!==0)return;if(e.f^=qs,(t&Xi)!==0)break;e=e.p}uc.push(e)}function hh(r){var e=pt;if(e===null)e=Cf(r),pt=e;else{for(var t=e;t!==null;){if(t.t===r){t.c=r.c;return}var n=t.n;if(n===null)break;t=n}e=Cf(r),t.n=e}}function Ob(r){return fh(r),We&&hh(r),r.v}function ne(r){return(r.f&So)!==0?Ob(r):Ub(r)}function Ub(r){var e=r.v;return We&&hh(r),Ui&&$i.has(r)?$i.get(r):e}function W(r,e,t){var n=r.v;if(e!==n){var i=r.b;(t.f&Mi)!==0&&(Ui?$i.set(r,e):$i.set(r,n)),r.v=e,r.c=ch(),dh(i)}}function Rb(r){var e=We,t=pt;We=!1,pt=null;try{return r()}finally{We=e,pt=t}}function we(r,e){var t=Fs;try{return Fs=r,e()}finally{Fs=t}}function gh(){return Fs}function Bb(){var r={c:null,e:null,m:!1,p:bt};bt=r}function _b(){var r=bt;r.m=!0;var e=r.e;if(e!==null)for(var t=e.length,n=0;n<t;n++){var{b:i,fn:s,r:o}=e[n],a=Se,c=_e;try{Se=i,_e=o,Kb(s)}finally{Se=a,_e=c}}bt=r.p}var ph=new Set,dc=new Set;function hc(r){var e=this,t=e.ownerDocument,n=r.type,i=r.composedPath?.()||[],s=i[0]||r.target,o=0,a=r.__root;if(a){var c=i.indexOf(a);if(c!==-1&&(e===document||e===window)){r.__root=e;return}var u=i.indexOf(e);if(u===-1)return;c<=u&&(o=c)}if(s=i[o]||r.target,s!==e){bb(r,"currentTarget",{configurable:!0,get(){return s||t}});var l=Se,f=_e,d=We;Ri(null),Ys(null),Xs(!1);try{for(var p,h=[];s!==null;){var x=s.assignedSlot||s.parentNode||s.host||null;try{var b=s["__"+n];if(b!==void 0&&!s.disabled)if(ih(b)){var[w,m,...g]=b;w.apply(s,[r,...g,m])}else b.call(s,r)}catch(A){p?h.push(A):p=A}if(r.cancelBubble||x===e||x===null)break;s=x}if(p){for(let A of h)queueMicrotask(()=>{throw A});throw p}}finally{Ri(l),r.__root=e,delete r.currentTarget,Ri(l),Ys(f),Xs(d)}}}function Lb(r,e,t,n={}){function i(s){var o=Se,a=_e,c=We;try{if(Ri(null),Ys(null),Xs(!1),n.capture||hc.call(e,s),!s.cancelBubble)return t?.call(this,s)}finally{Ri(o),Ys(a),Xs(c)}}return e.addEventListener(r,i,n),i}function Db(r,e,t,n,i){var s={capture:n,passive:i};Lb(r,e,t,s)}function Mb(r){for(var e=0;e<r.length;e++)ph.add(r[e]);for(var t of dc)t(r)}function $b(r){var e=new Set,t=n=>{for(var i=0;i<n.length;i++){var s=n[i];if(!e.has(s)){e.add(s);var o=Ab(s);r.addEventListener(s,hc,{passive:o})}}};return t(cc(ph)),dc.add(t),()=>{for(var n of e)r.removeEventListener(n,hc);dc.delete(t)}}function Or(r,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(r.__t??=r.nodeValue)&&(r.__t=t,r.nodeValue=t+"")}function Fb(r,e){return(r??"")+""}function Gb(r,e,t){var n=r.__className,i=Fb(e);n!==i&&(e==null?r.removeAttribute("class"):r.className=i,r.__className=i)}function ds(r,e){var t=r.__attributes??={};t.value===(t.value=e??void 0)||r.value===e&&(e!==0||r.nodeName!=="PROGRESS")||(r.value=e??"")}function Hb(r,e){var t=r.__attributes??={};t.checked!==(t.checked=e??void 0)&&(r.checked=e)}function kf(r){if(Se===null)throw new Error("effect() must be called within an active context, such as a component or effect");var e=bt;if(e!==null&&!e.m){var t=e.e??=[];t.push({b:Se,fn:r,r:_e});return}return es(Eo,r)}function Kb(r){return es(Eo,r)}function on(r,e=0){return es(db|e,r)}function xh(r,e=0){return es(Yn|e,r)}function jb(r){return es(Xi,r)}function zb(r,e){var t=e.last;t===null?e.last=e.first=r:(t.next=r,r.prev=t,e.last=r)}function es(r,e,t=null){var n={co:bt,d:null,first:null,f:r,fn:e,last:null,next:null,p:Se,prev:null,s:t,t:null};return _e!==null&&(_e.f&So)!==0&&(_e.blocks??=[]).push(n),Se!==null&&zb(n,Se),(r&Eo)!==0?dh(n):(lc(n),n.f^=ac),n}function bh(r,e=!1){var t=r.first;if(r.first=r.last=null,(r.f&Mi)!==0)for(;t!==null;){var n=t.next;Wt(t,e),t=n}}function Vb(r,e=!1){var t=r.first;if((r.f&Mi)===0&&r.first!==null&&(r.first.f&Yn)===0)r.first=r.last=null;else for(;t!==null;){var n=t.next;(t.f&Yn)===0&&Wt(t,e),t=n}}function Wb(r){var e=r.p,t=r.prev,n=r.next;t!==null&&(t.next=n),n!==null&&(n.prev=t),e!==null&&(e.first===r&&(e.first=n),e.last===r&&(e.last=t))}function Wt(r,e=!0){r.f^=nh;var t=!1;if(e&&(r.f&(Yn|Xi))!==0){for(var n=r.s.start,i=r.s.end;n!==null;){var s=n===i?null:Pe(n);n.remove(),n=s}t=!0}bh(r,e&&!t),uh(r);var o=r.p;o!==null&&o.first!==null&&Wb(r),r.fn=r.s=r.d=r.p=null}const Jb=1,Qb=2,qb=4;function hs(r,e,t){var n=xh(()=>{t(r,e)});return n}function Zb(r,e){var t=r.s.start,n=r.s.end;if(t===n){e.before(t);return}for(;t!==n;){var i=get_next_sibling(t);e.before(t),t=i}}function Yb(r,e,t,n){var i=(n&qb)!==0,s=r;on(()=>{var o=Se,a=e(),c=ih(a)?a:a==null?[]:cc(a);xb in c&&(c=cc(c)),Rb(()=>yh(s,o,c,t,i))},hb)}function Xb(r,e,t){var n=e.s,i=r.parentNode;i.textContent="",bh(e),i.append(r),n.array=t,n.blocks=[]}function yh(r,e,t,n,i){var s=e.s;s===null&&(s=e.s={array:[],blocks:[]});var o=s.array,a=o.length,c=t.length,u=0,l=Array(c);if(a===0){for(;u<c;u++)l[u]=hs(r,t[u],n);s.array=t,s.blocks=l;return}var f=s.blocks,d=o[u],p=t[u],h=a-1,x=c-1;e:{for(;d===p;){if(o[u]=p,l[u]=f[u],++u,u>h||u>x)break e;d=o[u],p=t[u]}for(d=o[h],p=t[x];d===p;){if(o[h]=p,l[x]=f[h],h--,x--,u>h||u>x)break e;d=o[h],p=t[x]}}if(u>h){if(u<=x)for(;u<=x;){p=t[u];var b=u>=a?r:f[u].s.start;l[u++]=hs(b,p,n)}}else if(u>x)for(;u<=h;)Wt(f[u++]);else{var w=u,m=u,g=h-u+1,A=x-u+1,v=i,T=new Int32Array(A+1),P=!1,I=0,S=0,N=0;if(c<4||(g|A)<32)for(N=w;N<=h;++N)if(d=o[N],S<A){for(u=m;u<=x;u++)if(p=t[u],d===p){T[u-m]=N+1,v&&(v=!1),I>u?P=!0:I=u,l[u]=f[N],++S;break}!v&&u>x&&Wt(f[N])}else v||Wt(f[N]);else{var O=new Map;for(N=m;N<=x;++N)O.set(t[N],N);for(N=w;N<=h;++N)d=o[N],S<A?(u=O.get(d),u!==void 0?(v&&(v=!1),T[u-m]=N+1,I>u?P=!0:I=u,p=t[u],l[u]=f[N],++S):v||Wt(f[N])):v||Wt(f[N])}}if(v){Xb(r,e,[]),yh(r,e,t,n,i);return}else if(P){var E=0,y=ey(T);for(u=y.length-1,N=A-1;N>=0;N--)if(T[N]===0){I=N+m,p=t[I],E=I+1;var b=E<c?l[E].s.start:r;l[I]=hs(b,p,n)}else if(u<0||N!==y[u]){I=N+m,p=t[I],E=I+1;var b=E<c?l[E].s.start:r;Zb(l[I],b)}else u--}else if(S!==A){for(N=A-1;N>=0;N--)if(T[N]===0){I=N+m,p=t[I],E=I+1;var b=E<c?l[E].s.start:r;l[I]=hs(b,p,n)}}s.array=t,s.blocks=l}let rr,gs,Tf=0;function ey(r){let e=0,t=0,n=0,i=0,s=0,o=0,a=0;var c=r.length;for(c>Tf&&(Tf=c,rr=new Int32Array(c),gs=new Int32Array(c));t<c;++t)if(e=r[t],e!==0){if(n=rr[i],r[n]<e){gs[t]=n,rr[++i]=t;continue}for(s=0,o=i;s<o;)a=s+o>>1,r[rr[a]]<e?s=a+1:o=a;e<r[rr[s]]&&(s>0&&(gs[t]=rr[s-1]),rr[s]=t)}s=i+1;var u=new Int32Array(s);for(o=rr[s-1];s-- >0;)u[s]=o,o=gs[o],rr[s]=0;return u}function ty(r,e){wb();const t=e.props||{},n=e.target,i=yb();n.append(i);const s=$b(n),o=jb(()=>{r(i,t,Se)});return()=>{s(),Wt(o)}}function kt(r,e){return typeof r=="function"?Ib(r,e):Cb(r,e)}function tn(r,e){var t=r,n=!1,i=tu,s=null,o=(c,u=!0)=>{n=!0,a(u,c)},a=(c,u)=>{i!==(i=c)&&(s!==null&&(Wt(s),s=null),u!==null&&(s=xh(()=>u(t))))};on(()=>{n=!1,e(o),n||a(null,null)},pb)}function Pf(r,e){var t=Se;t.s===null&&(t.s={start:r,end:e})}function ry(r){var e=document.createElement("template");return e.innerHTML=r,e.content}function tr(r,e){var t=(e&Jb)!==0,n=(e&Qb)!==0,i,s=!r.startsWith("<!>");return()=>{i===void 0&&(i=ry(s?r:"<!>"+r),t||(i=Be(i)));var o=n||ah?document.importNode(i,!0):i.cloneNode(!0);if(t){var a=Be(o),c=o.lastChild;Pf(a,c)}else Pf(o,o);return o}}function $t(r,e){r.before(e)}var Y;(function(r){r.AUTHENTICATION="AuthenticationError",r.AUTHORIZATION="AuthorizationError",r.VALIDATION="ValidationError",r.NETWORK="NetworkError",r.DATABASE="DatabaseError",r.WALLET="WalletError",r.STORAGE="StorageError",r.ENCRYPTION="EncryptionError",r.SIGNATURE="SignatureError",r.ENVIRONMENT="EnvironmentError",r.SECURITY="SecurityError",r.GUN="GunError",r.STEALTH="StealthError",r.WEBAUTHN="WebAuthnError",r.PLUGIN="PluginError",r.UNKNOWN="UnknownError",r.CONNECTOR="ConnectorError",r.GENERAL="GeneralError",r.CONTRACT="ContractError",r.BIP32="BIP32Error",r.ETHEREUM="EthereumError",r.BITCOIN="BitcoinError"})(Y||(Y={}));function Ae(r,e,t,n){return{type:r,code:e,message:t,originalError:n,timestamp:Date.now()}}class Le{static errors=[];static maxErrors=100;static listeners=[];static externalLogger=null;static setExternalLogger(e){this.externalLogger=e}static handleError(e){if((e.type===Y.AUTHENTICATION||e.type===Y.AUTHORIZATION||e.type===Y.SECURITY)&&typeof console<"u"&&console.error&&console.error(`[${e.type}] ${e.code}: ${e.message}`),this.errors.push(e),this.errors.length>this.maxErrors&&(this.errors=this.errors.slice(-this.maxErrors)),this.externalLogger)try{this.externalLogger(e)}catch(t){console.error("Failed to send error to external logger:",t)}this.listeners.forEach(t=>{try{t(e)}catch{}})}static handle(e,t,n,i,s="error"){const o=n;switch(s){case"debug":console.log(`[${e}] ${t}: ${o}`);break;case"warn":console.log(`[${e}] ${t}: ${o}`);break;case"info":console.log(`[${e}] ${t}: ${o}`);break;case"error":default:console.log(`[${e}] ${t}: ${o}`);break}const a=Ae(e,t,o,i);return this.handleError(a),a}static handleAndThrow(e,t,n,i){throw this.handle(e,t,n,i)}static getRecentErrors(e=10){return this.errors.slice(-Math.min(e,this.errors.length))}static addListener(e){this.listeners.push(e)}static removeListener(e){const t=this.listeners.indexOf(e);t!==-1&&this.listeners.splice(t,1)}static notifyListeners(e){for(const t of this.listeners)try{t(e)}catch(n){console.error(`Error in error listener: ${n}`)}}static formatError(e){if(!e)return"Unknown error";if(e instanceof Error)return`${e.name}: ${e.message}`;if(typeof e=="string")return e;if(typeof e=="object")try{return JSON.stringify(e)}catch{return`Object: ${Object.prototype.toString.call(e)}`}return String(e)}static async withRetry(e,t,n,i=3,s=1e3){let o;for(let a=1;a<=i;a++)try{return await e()}catch(c){o=c;const u=s*a;a<i&&(console.log(`Retrying operation after ${u}ms (attempt ${a}/${i})`),await new Promise(l=>setTimeout(l,u)))}throw this.handle(t,n,`Operation failed after ${i} attempts`,o),o instanceof Error?new Error(o.message):new Error(this.formatError(o))}static clearErrors(){this.errors=[]}}class ny{plugins=new Map;core;constructor(e){this.core=e}register(e){try{if(!e.name){typeof console<"u"&&console.error&&console.error("Plugin registration failed: Plugin must have a name");return}if(this.plugins.has(e.name)){typeof console<"u"&&console.warn&&console.warn(`Plugin "${e.name}" is already registered. Skipping.`);return}e.initialize(this.core),this.plugins.set(e.name,e),this.core.emit("plugin:registered",{name:e.name,version:e.version||"unknown",category:e._category||"unknown"})}catch(t){typeof console<"u"&&console.error&&console.error(`Error registering plugin "${e.name}":`,t)}}unregister(e){try{const t=this.plugins.get(e);if(!t)return typeof console<"u"&&console.warn&&console.warn(`Plugin "${e}" not found for unregistration`),!1;if(typeof t.destroy=="function")try{t.destroy()}catch(n){typeof console<"u"&&console.error&&console.error(`Error destroying plugin "${e}":`,n)}return this.plugins.delete(e),this.core.emit("plugin:unregistered",{name:t.name}),!0}catch(t){return typeof console<"u"&&console.error&&console.error(`Error unregistering plugin "${e}":`,t),!1}}getPlugin(e){if(!e||typeof e!="string"){typeof console<"u"&&console.warn&&console.warn("Invalid plugin name provided to getPlugin");return}const t=this.plugins.get(e);if(!t){typeof console<"u"&&console.warn&&console.warn(`Plugin "${e}" not found`);return}return t}getPluginsInfo(){const e=[];return this.plugins.forEach(t=>{e.push({name:t.name,version:t.version||"unknown",category:t._category,description:t.description})}),e}getPluginCount(){return this.plugins.size}getPluginsInitializationStatus(){const e={};return this.plugins.forEach((t,n)=>{try{typeof t.assertInitialized=="function"?(t.assertInitialized(),e[n]={initialized:!0}):e[n]={initialized:!!t.core,error:t.core?void 0:"No core reference found"}}catch(i){e[n]={initialized:!1,error:i instanceof Error?i.message:String(i)}}}),e}validatePluginSystem(){const e=this.getPluginsInitializationStatus(),t=Object.keys(e).length,n=Object.values(e).filter(o=>o.initialized).length,i=Object.entries(e).filter(([o,a])=>!a.initialized).map(([o,a])=>o),s=[];return t===0&&s.push("No plugins registered"),i.length>0&&s.push(`Failed plugins: ${i.join(", ")}`),{totalPlugins:t,initializedPlugins:n,failedPlugins:i,warnings:s}}reinitializeFailedPlugins(){const e=this.getPluginsInitializationStatus(),t=Object.entries(e).filter(([s,o])=>!o.initialized).map(([s,o])=>s),n=[],i=[];return t.forEach(s=>{try{const o=this.plugins.get(s);if(!o){i.push({name:s,error:"Plugin not found"});return}o.initialize(this.core),n.push(s)}catch(o){const a=o instanceof Error?o.message:String(o);i.push({name:s,error:a}),typeof console<"u"&&console.error&&console.error(`[PluginManager] Failed to reinitialize plugin ${s}:`,o)}}),{success:n,failed:i}}checkPluginCompatibility(){const e=[],t=[],n=[];return this.plugins.forEach(i=>{const s={name:i.name,version:i.version||"unknown"};if(typeof i.getCompatibilityInfo=="function")try{const o=i.getCompatibilityInfo();o&&o.compatible?e.push(s):t.push({...s,reason:o?.reason||"Unknown compatibility issue"})}catch{n.push(s)}else n.push(s)}),{compatible:e,incompatible:t,unknown:n}}getPluginSystemDebugInfo(){const e=this.getPluginsInfo(),t=this.getPluginsInitializationStatus(),n=e.map(i=>({...i,initialized:t[i.name]?.initialized||!1,error:t[i.name]?.error}));return{shogunCoreVersion:"^1.6.6",totalPlugins:this.getPluginCount(),plugins:n,initializationStatus:t,validation:this.validatePluginSystem(),compatibility:this.checkPluginCompatibility()}}hasPlugin(e){return this.plugins.has(e)}getPluginsByCategory(e){const t=[];return this.plugins.forEach(n=>{n._category===e&&t.push(n)}),t}}class iy{core;currentAuthMethod;constructor(e){this.core=e}isLoggedIn(){return this.core.db.isLoggedIn()}logout(){try{if(!this.isLoggedIn())return;this.core.db.logout(),this.core.emit("auth:logout")}catch(e){Le.handle(Y.AUTHENTICATION,"LOGOUT_FAILED",e instanceof Error?e.message:"Error during logout",e)}}async login(e,t,n){try{this.currentAuthMethod||(this.currentAuthMethod="password");const i=await this.core.db.login(e,t,n);if(i.success){const s=this.core.user?._?.sea;s&&(i.sea=s),this.core.emit("auth:login",{userPub:i.userPub??"",method:this.currentAuthMethod==="pair"?"password":this.currentAuthMethod||"password"})}else i.error=i.error||"Wrong user or password";return i}catch(i){return Le.handle(Y.AUTHENTICATION,"LOGIN_FAILED",i.message??"Unknown error during login",i),{success:!1,error:i.message??"Unknown error during login"}}}async loginWithPair(e){try{if(!e||!e.pub||!e.priv||!e.epub||!e.epriv)return{success:!1,error:"Invalid pair structure - missing required keys"};const t=await this.core.db.login("","",e);if(t.success){const n=this.core.user?._?.sea;n&&(t.sea=n),this.currentAuthMethod="pair",this.core.emit("auth:login",{userPub:t.userPub??"",method:"password"})}else t.error=t.error||"Authentication failed with provided pair";return t}catch(t){return Le.handle(Y.AUTHENTICATION,"PAIR_LOGIN_FAILED",t.message??"Unknown error during pair login",t),{success:!1,error:t.message??"Unknown error during pair login"}}}async signUp(e,t,n){try{if(!this.core.db)throw new Error("Database not initialized");if(!n&&(!t||t.trim()===""))throw new Error("Password is required for password-based signup");const i=await this.core.db.signUp(e,t||"",n);return i.success?(this.currentAuthMethod=n?"web3":"password",this.core.emit("auth:signup",{userPub:i.userPub,username:e,method:this.currentAuthMethod}),this.core.emit("debug",{action:"signup_success",userPub:i.userPub,method:this.currentAuthMethod})):this.core.emit("debug",{action:"signup_failed",error:i.error,username:e}),i}catch(i){return typeof console<"u"&&console.error&&console.error(`Error during registration for user ${e}:`,i),this.core.emit("debug",{action:"signup_error",error:i instanceof Error?i.message:String(i),username:e}),{success:!1,error:`Registration failed: ${i instanceof Error?i.message:String(i)}`}}}setAuthMethod(e){this.currentAuthMethod=e}getAuthMethod(){return this.currentAuthMethod}getAuthenticationMethod(e){switch(e){case"webauthn":return this.core.getPlugin("webauthn");case"web3":return this.core.getPlugin("web3");case"nostr":return this.core.getPlugin("nostr");case"oauth":return this.core.getPlugin("oauth");case"password":default:return{login:async(t,n)=>await this.login(t,n),signUp:async(t,n,i)=>{if(i&&n!==i)throw new Error("Password and confirm password do not match");return await this.signUp(t,n)}}}}}class Cn{events;constructor(){this.events=new Map}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e)?.push(t)}emit(e,t){return this.events.has(e)?((this.events.get(e)||[]).forEach(i=>{try{i(t)}catch(s){const o=s instanceof Error?s:new Error(String(s));console.error(`Error in event listener for ${String(e)}:`,o)}}),!0):!1}off(e,t){if(!this.events.has(e))return;const n=this.events.get(e)||[],i=n.indexOf(t);i!==-1&&(n.splice(i,1),n.length===0?this.events.delete(e):this.events.set(e,n))}once(e,t){const n=i=>{t(i),this.off(e,n)};this.on(e,n)}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}}class sy extends Cn{emit(e,t){return super.emit(e,t)}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}}class oy{eventEmitter;constructor(){this.eventEmitter=new sy}emit(e,t){return this.eventEmitter.emit(e,t)}on(e,t){return this.eventEmitter.on(e,t),this}once(e,t){return this.eventEmitter.once(e,t),this}off(e,t){return this.eventEmitter.off(e,t),this}removeAllListeners(e){return this.eventEmitter.removeAllListeners(e),this}getEventEmitter(){return this.eventEmitter}}class wh{store;isTestMode;useLocalStorage;constructor(){if(this.store=new Map,this.isTestMode=!1,this.useLocalStorage=!1,console.log("ShogunStorage: NODE_ENV =","production"),console.log("ShogunStorage: isTestMode =",this.isTestMode),this.isTestMode){this.useLocalStorage=!1,console.log("ShogunStorage: Test mode detected, localStorage disabled");return}if(typeof localStorage<"u"){console.log("ShogunStorage: localStorage is defined");try{const e="_shogun_test";localStorage.setItem(e,e),localStorage.removeItem(e),this.useLocalStorage=!0,console.log("ShogunStorage: localStorage enabled");const t=localStorage.getItem("shogun_keypair");t&&this.store.set("keypair",JSON.parse(t))}catch(e){this.useLocalStorage=!1,console.log("ShogunStorage: localStorage error:",e.message)}}else console.log("ShogunStorage: localStorage is undefined")}async getPair(){return this.getPairSync()}getPairSync(){return this.store.get("keypair")||null}async setPair(e){if(this.store.set("keypair",e),this.useLocalStorage)try{localStorage.setItem("shogun_keypair",JSON.stringify(e))}catch(t){this.isTestMode||console.error("Error saving data to localStorage:",t)}}clearAll(){if(this.store.clear(),this.useLocalStorage)try{localStorage.removeItem("shogun_keypair")}catch(e){this.isTestMode||console.error("Error removing data from localStorage:",e)}}getItem(e){const t=this.store.get(e);return t===void 0?null:t}setItem(e,t){if(this.store.set(e,t),this.useLocalStorage)try{localStorage.setItem(e,typeof t=="string"?t:JSON.stringify(t))}catch(n){this.isTestMode||console.error(`Error saving ${e} to localStorage:`,n)}}removeItem(e){if(this.store.delete(e),this.useLocalStorage)try{localStorage.removeItem(e)}catch(t){this.isTestMode||console.error(`Error removing ${e} from localStorage:`,t)}}}class Co extends Cn{description;_category;core=null;initialize(e){this.core=e}destroy(){try{this.emit("destroyed",{name:this.name,version:this.version}),this.core=null}catch(e){console.error(`[${this.name}] Error during plugin destruction:`,e)}}assertInitialized(){if(!this.core)throw new Error(`Plugin ${this.name} not initialized`);return this.core}}const mh="6.15.0";function ay(r,e,t){const n=e.split("|").map(s=>s.trim());for(let s=0;s<n.length;s++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof r===e)return}const i=new Error(`invalid value for type ${e}`);throw i.code="INVALID_ARGUMENT",i.argument=`value.${t}`,i.value=r,i}async function Ze(r){const e=Object.keys(r);return(await Promise.all(e.map(n=>Promise.resolve(r[n])))).reduce((n,i,s)=>(n[e[s]]=i,n),{})}function q(r,e,t){for(let n in e){let i=e[n];const s=t?t[n]:null;s&&ay(i,s,n),Object.defineProperty(r,n,{enumerable:!0,value:i,writable:!1})}}function Gn(r,e){if(r==null)return"null";if(e==null&&(e=new Set),typeof r=="object"){if(e.has(r))return"[Circular]";e.add(r)}if(Array.isArray(r))return"[ "+r.map(t=>Gn(t,e)).join(", ")+" ]";if(r instanceof Uint8Array){const t="0123456789abcdef";let n="0x";for(let i=0;i<r.length;i++)n+=t[r[i]>>4],n+=t[r[i]&15];return n}if(typeof r=="object"&&typeof r.toJSON=="function")return Gn(r.toJSON(),e);switch(typeof r){case"boolean":case"number":case"symbol":return r.toString();case"bigint":return BigInt(r).toString();case"string":return JSON.stringify(r);case"object":{const t=Object.keys(r);return t.sort(),"{ "+t.map(n=>`${Gn(n,e)}: ${Gn(r[n],e)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function ze(r,e){return r&&r.code===e}function ru(r){return ze(r,"CALL_EXCEPTION")}function me(r,e,t){let n=r;{const s=[];if(t){if("message"in t||"code"in t||"name"in t)throw new Error(`value will overwrite populated values: ${Gn(t)}`);for(const o in t){if(o==="shortMessage")continue;const a=t[o];s.push(o+"="+Gn(a))}}s.push(`code=${e}`),s.push(`version=${mh}`),s.length&&(r+=" ("+s.join(", ")+")")}let i;switch(e){case"INVALID_ARGUMENT":i=new TypeError(r);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":i=new RangeError(r);break;default:i=new Error(r)}return q(i,{code:e}),t&&Object.assign(i,t),i.shortMessage==null&&q(i,{shortMessage:n}),i}function F(r,e,t,n){if(!r)throw me(e,t,n)}function _(r,e,t,n){F(r,e,"INVALID_ARGUMENT",{argument:t,value:n})}function Ah(r,e,t){t==null&&(t=""),t&&(t=": "+t),F(r>=e,"missing argument"+t,"MISSING_ARGUMENT",{count:r,expectedCount:e}),F(r<=e,"too many arguments"+t,"UNEXPECTED_ARGUMENT",{count:r,expectedCount:e})}const cy=["NFD","NFC","NFKD","NFKC"].reduce((r,e)=>{try{if("test".normalize(e)!=="test")throw new Error("bad");if(e==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");r.push(e)}catch{}return r},[]);function vh(r){F(cy.indexOf(r)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:r}})}function In(r,e,t){if(t==null&&(t=""),r!==e){let n=t,i="new";t&&(n+=".",i+=" "+t),F(!1,`private constructor; use ${n}from* methods`,"UNSUPPORTED_OPERATION",{operation:i})}}function Eh(r,e,t){if(r instanceof Uint8Array)return t?new Uint8Array(r):r;if(typeof r=="string"&&r.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const n=new Uint8Array((r.length-2)/2);let i=2;for(let s=0;s<n.length;s++)n[s]=parseInt(r.substring(i,i+2),16),i+=2;return n}_(!1,"invalid BytesLike value",e||"value",r)}function K(r,e){return Eh(r,e,!1)}function Ve(r,e){return Eh(r,e,!0)}function xe(r,e){return!(typeof r!="string"||!r.match(/^0x[0-9A-Fa-f]*$/)||typeof e=="number"&&r.length!==2+2*e||e===!0&&r.length%2!==0)}function Io(r){return xe(r,!0)||r instanceof Uint8Array}const Nf="0123456789abcdef";function G(r){const e=K(r);let t="0x";for(let n=0;n<e.length;n++){const i=e[n];t+=Nf[(i&240)>>4]+Nf[i&15]}return t}function he(r){return"0x"+r.map(e=>G(e).substring(2)).join("")}function zn(r){return xe(r,!0)?(r.length-2)/2:K(r).length}function be(r,e,t){const n=K(r);return t!=null&&t>n.length&&F(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:t}),G(n.slice(e??0,t??n.length))}function Sh(r,e,t){const n=K(r);F(e>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:e,offset:e+1});const i=new Uint8Array(e);return i.fill(0),t?i.set(n,e-n.length):i.set(n,0),G(i)}function yr(r,e){return Sh(r,e,!0)}function uy(r,e){return Sh(r,e,!1)}const ko=BigInt(0),Bt=BigInt(1),Hn=9007199254740991;function fy(r,e){const t=To(r,"value"),n=BigInt(ee(e,"width"));if(F(t>>n===ko,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:r}),t>>n-Bt){const i=(Bt<<n)-Bt;return-((~t&i)+Bt)}return t}function Ch(r,e){let t=z(r,"value");const n=BigInt(ee(e,"width")),i=Bt<<n-Bt;if(t<ko){t=-t,F(t<=i,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});const s=(Bt<<n)-Bt;return(~t&s)+Bt}else F(t<i,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});return t}function Ii(r,e){const t=To(r,"value"),n=BigInt(ee(e,"bits"));return t&(Bt<<n)-Bt}function z(r,e){switch(typeof r){case"bigint":return r;case"number":return _(Number.isInteger(r),"underflow",e||"value",r),_(r>=-Hn&&r<=Hn,"overflow",e||"value",r),BigInt(r);case"string":try{if(r==="")throw new Error("empty string");return r[0]==="-"&&r[1]!=="-"?-BigInt(r.substring(1)):BigInt(r)}catch(t){_(!1,`invalid BigNumberish string: ${t.message}`,e||"value",r)}}_(!1,"invalid BigNumberish value",e||"value",r)}function To(r,e){const t=z(r,e);return F(t>=ko,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:r}),t}const Of="0123456789abcdef";function Po(r){if(r instanceof Uint8Array){let e="0x0";for(const t of r)e+=Of[t>>4],e+=Of[t&15];return BigInt(e)}return z(r)}function ee(r,e){switch(typeof r){case"bigint":return _(r>=-Hn&&r<=Hn,"overflow",e||"value",r),Number(r);case"number":return _(Number.isInteger(r),"underflow",e||"value",r),_(r>=-Hn&&r<=Hn,"overflow",e||"value",r),r;case"string":try{if(r==="")throw new Error("empty string");return ee(BigInt(r),e)}catch(t){_(!1,`invalid numeric string: ${t.message}`,e||"value",r)}}_(!1,"invalid numeric value",e||"value",r)}function ly(r){return ee(Po(r))}function wr(r,e){let n=To(r,"value").toString(16);if(e==null)n.length%2&&(n="0"+n);else{const i=ee(e,"width");for(F(i*2>=n.length,`value exceeds width (${i} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:r});n.length<i*2;)n="0"+n}return"0x"+n}function ke(r){const e=To(r,"value");if(e===ko)return new Uint8Array([]);let t=e.toString(16);t.length%2&&(t="0"+t);const n=new Uint8Array(t.length/2);for(let i=0;i<n.length;i++){const s=i*2;n[i]=parseInt(t.substring(s,s+2),16)}return n}function Rt(r){let e=G(Io(r)?r:ke(r)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return e===""&&(e="0"),"0x"+e}const eo="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let ps=null;function dy(r){if(ps==null){ps={};for(let t=0;t<eo.length;t++)ps[eo[t]]=BigInt(t)}const e=ps[r];return _(e!=null,"invalid base58 value","letter",r),e}const hy=BigInt(0),gc=BigInt(58);function Ih(r){const e=K(r);let t=Po(e),n="";for(;t;)n=eo[Number(t%gc)]+n,t/=gc;for(let i=0;i<e.length&&!e[i];i++)n=eo[0]+n;return n}function gy(r){let e=hy;for(let t=0;t<r.length;t++)e*=gc,e+=dy(r[t]);return e}function py(r){r=atob(r);const e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return K(e)}function xy(r){const e=K(r);let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}class kh{filter;emitter;#e;constructor(e,t,n){this.#e=t,q(this,{emitter:e,filter:n})}async removeListener(){this.#e!=null&&await this.emitter.off(this.filter,this.#e)}}function by(r,e,t,n,i){_(!1,`invalid codepoint at offset ${e}; ${r}`,"bytes",t)}function Th(r,e,t,n,i){if(r==="BAD_PREFIX"||r==="UNEXPECTED_CONTINUE"){let s=0;for(let o=e+1;o<t.length&&t[o]>>6===2;o++)s++;return s}return r==="OVERRUN"?t.length-e-1:0}function yy(r,e,t,n,i){return r==="OVERLONG"?(_(typeof i=="number","invalid bad code point for replacement","badCodepoint",i),n.push(i),0):(n.push(65533),Th(r,e,t))}const wy=Object.freeze({error:by,ignore:Th,replace:yy});function my(r,e){e==null&&(e=wy.error);const t=K(r,"bytes"),n=[];let i=0;for(;i<t.length;){const s=t[i++];if(s>>7===0){n.push(s);continue}let o=null,a=null;if((s&224)===192)o=1,a=127;else if((s&240)===224)o=2,a=2047;else if((s&248)===240)o=3,a=65535;else{(s&192)===128?i+=e("UNEXPECTED_CONTINUE",i-1,t,n):i+=e("BAD_PREFIX",i-1,t,n);continue}if(i-1+o>=t.length){i+=e("OVERRUN",i-1,t,n);continue}let c=s&(1<<8-o-1)-1;for(let u=0;u<o;u++){let l=t[i];if((l&192)!=128){i+=e("MISSING_CONTINUE",i,t,n),c=null;break}c=c<<6|l&63,i++}if(c!==null){if(c>1114111){i+=e("OUT_OF_RANGE",i-1-o,t,n,c);continue}if(c>=55296&&c<=57343){i+=e("UTF16_SURROGATE",i-1-o,t,n,c);continue}if(c<=a){i+=e("OVERLONG",i-1-o,t,n,c);continue}n.push(c)}}return n}function de(r,e){_(typeof r=="string","invalid string value","str",r),e!=null&&(vh(e),r=r.normalize(e));let t=[];for(let n=0;n<r.length;n++){const i=r.charCodeAt(n);if(i<128)t.push(i);else if(i<2048)t.push(i>>6|192),t.push(i&63|128);else if((i&64512)==55296){n++;const s=r.charCodeAt(n);_(n<r.length&&(s&64512)===56320,"invalid surrogate pair","str",r);const o=65536+((i&1023)<<10)+(s&1023);t.push(o>>18|240),t.push(o>>12&63|128),t.push(o>>6&63|128),t.push(o&63|128)}else t.push(i>>12|224),t.push(i>>6&63|128),t.push(i&63|128)}return new Uint8Array(t)}function Ay(r){return r.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function to(r,e){return Ay(my(r,e))}function Ph(r){async function e(t,n){F(n==null||!n.cancelled,"request cancelled before sending","CANCELLED");const i=t.url.split(":")[0].toLowerCase();F(i==="http"||i==="https",`unsupported protocol ${i}`,"UNSUPPORTED_OPERATION",{info:{protocol:i},operation:"request"}),F(i==="https"||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let s=null;const o=new AbortController,a=setTimeout(()=>{s=me("request timeout","TIMEOUT"),o.abort()},t.timeout);n&&n.addListener(()=>{s=me("request cancelled","CANCELLED"),o.abort()});const c=Object.assign({},r,{method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:o.signal});let u;try{u=await fetch(t.url,c)}catch(p){throw clearTimeout(a),s||p}clearTimeout(a);const l={};u.headers.forEach((p,h)=>{l[h.toLowerCase()]=p});const f=await u.arrayBuffer(),d=f==null?null:new Uint8Array(f);return{statusCode:u.status,statusMessage:u.statusText,headers:l,body:d}}return e}const vy=12,Ey=250;let Uf=Ph();const Sy=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),Cy=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let da=!1;async function Nh(r,e){try{const t=r.match(Sy);if(!t)throw new Error("invalid data");return new Wr(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?py(t[3]):ky(t[3]))}catch{return new Wr(599,"BAD REQUEST (invalid data: URI)",{},null,new Xt(r))}}function Oh(r){async function e(t,n){try{const i=t.match(Cy);if(!i)throw new Error("invalid link");return new Xt(`${r}${i[2]}`)}catch{return new Wr(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Xt(t))}}return e}const xs={data:Nh,ipfs:Oh("https://gateway.ipfs.io/ipfs/")},Uh=new WeakMap;class Iy{#e;#t;constructor(e){this.#e=[],this.#t=!1,Uh.set(e,()=>{if(!this.#t){this.#t=!0;for(const t of this.#e)setTimeout(()=>{t()},0);this.#e=[]}})}addListener(e){F(!this.#t,"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),this.#e.push(e)}get cancelled(){return this.#t}checkSignal(){F(!this.cancelled,"cancelled","CANCELLED",{})}}function bs(r){if(r==null)throw new Error("missing signal; should not happen");return r.checkSignal(),r}class Xt{#e;#t;#r;#n;#i;#o;#s;#a;#h;#u;#g;#p;#c;#f;#l;get url(){return this.#o}set url(e){this.#o=String(e)}get body(){return this.#s==null?null:new Uint8Array(this.#s)}set body(e){if(e==null)this.#s=void 0,this.#a=void 0;else if(typeof e=="string")this.#s=de(e),this.#a="text/plain";else if(e instanceof Uint8Array)this.#s=e,this.#a="application/octet-stream";else if(typeof e=="object")this.#s=de(JSON.stringify(e)),this.#a="application/json";else throw new Error("invalid body")}hasBody(){return this.#s!=null}get method(){return this.#n?this.#n:this.hasBody()?"POST":"GET"}set method(e){e==null&&(e=""),this.#n=String(e).toUpperCase()}get headers(){const e=Object.assign({},this.#r);return this.#h&&(e.authorization=`Basic ${xy(de(this.#h))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),e["content-type"]==null&&this.#a&&(e["content-type"]=this.#a),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,t){this.#r[String(e).toLowerCase()]=String(t)}clearHeaders(){this.#r={}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const i=t[n++];return{value:[i,e[i]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return this.#h||null}setCredentials(e,t){_(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),this.#h=`${e}:${t}`}get allowGzip(){return this.#t}set allowGzip(e){this.#t=!!e}get allowInsecureAuthentication(){return!!this.#e}set allowInsecureAuthentication(e){this.#e=!!e}get timeout(){return this.#i}set timeout(e){_(e>=0,"timeout must be non-zero","timeout",e),this.#i=e}get preflightFunc(){return this.#u||null}set preflightFunc(e){this.#u=e}get processFunc(){return this.#g||null}set processFunc(e){this.#g=e}get retryFunc(){return this.#p||null}set retryFunc(e){this.#p=e}get getUrlFunc(){return this.#l||Uf}set getUrlFunc(e){this.#l=e}constructor(e){this.#o=String(e),this.#e=!1,this.#t=!0,this.#r={},this.#n="",this.#i=3e5,this.#f={slotInterval:Ey,maxAttempts:vy},this.#l=null}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${this.#s?G(this.#s):"null"}>`}setThrottleParams(e){e.slotInterval!=null&&(this.#f.slotInterval=e.slotInterval),e.maxAttempts!=null&&(this.#f.maxAttempts=e.maxAttempts)}async#d(e,t,n,i,s){if(e>=this.#f.maxAttempts)return s.makeServerError("exceeded maximum retry limit");F(Rf()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:i}),n>0&&await Ty(n);let o=this.clone();const a=(o.url.split(":")[0]||"").toLowerCase();if(a in xs){const l=await xs[a](o.url,bs(i.#c));if(l instanceof Wr){let f=l;if(this.processFunc){bs(i.#c);try{f=await this.processFunc(o,f)}catch(d){(d.throttle==null||typeof d.stall!="number")&&f.makeServerError("error in post-processing function",d).assertOk()}}return f}o=l}this.preflightFunc&&(o=await this.preflightFunc(o));const c=await this.getUrlFunc(o,bs(i.#c));let u=new Wr(c.statusCode,c.statusMessage,c.headers,c.body,i);if(u.statusCode===301||u.statusCode===302){try{const l=u.headers.location||"";return o.redirect(l).#d(e+1,t,0,i,u)}catch{}return u}else if(u.statusCode===429&&(this.retryFunc==null||await this.retryFunc(o,u,e))){const l=u.headers["retry-after"];let f=this.#f.slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return typeof l=="string"&&l.match(/^[1-9][0-9]*$/)&&(f=parseInt(l)),o.clone().#d(e+1,t,f,i,u)}if(this.processFunc){bs(i.#c);try{u=await this.processFunc(o,u)}catch(l){(l.throttle==null||typeof l.stall!="number")&&u.makeServerError("error in post-processing function",l).assertOk();let f=this.#f.slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return l.stall>=0&&(f=l.stall),o.clone().#d(e+1,t,f,i,u)}}return u}send(){return F(this.#c==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),this.#c=new Iy(this),this.#d(0,Rf()+this.timeout,0,this,new Wr(0,"",{},null,this))}cancel(){F(this.#c!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const e=Uh.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){const t=this.url.split(":")[0].toLowerCase(),n=e.split(":")[0].toLowerCase();F(this.method==="GET"&&(t!=="https"||n!=="http")&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});const i=new Xt(e);return i.method="GET",i.allowGzip=this.allowGzip,i.timeout=this.timeout,i.#r=Object.assign({},this.#r),this.#s&&(i.#s=new Uint8Array(this.#s)),i.#a=this.#a,i}clone(){const e=new Xt(this.url);return e.#n=this.#n,this.#s&&(e.#s=this.#s),e.#a=this.#a,e.#r=Object.assign({},this.#r),e.#h=this.#h,this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),e.#u=this.#u,e.#g=this.#g,e.#p=this.#p,e.#f=Object.assign({},this.#f),e.#l=this.#l,e}static lockConfig(){da=!0}static getGateway(e){return xs[e.toLowerCase()]||null}static registerGateway(e,t){if(e=e.toLowerCase(),e==="http"||e==="https")throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(da)throw new Error("gateways locked");xs[e]=t}static registerGetUrl(e){if(da)throw new Error("gateways locked");Uf=e}static createGetUrlFunc(e){return Ph(e)}static createDataGateway(){return Nh}static createIpfsGatewayFunc(e){return Oh(e)}}class Wr{#e;#t;#r;#n;#i;#o;toString(){return`<FetchResponse status=${this.statusCode} body=${this.#n?G(this.#n):"null"}>`}get statusCode(){return this.#e}get statusMessage(){return this.#t}get headers(){return Object.assign({},this.#r)}get body(){return this.#n==null?null:new Uint8Array(this.#n)}get bodyText(){try{return this.#n==null?"":to(this.#n)}catch{F(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{F(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const i=t[n++];return{value:[i,e[i]],done:!1}}return{value:void 0,done:!0}}}}constructor(e,t,n,i,s){this.#e=e,this.#t=t,this.#r=Object.keys(n).reduce((o,a)=>(o[a.toLowerCase()]=String(n[a]),o),{}),this.#n=i==null?null:new Uint8Array(i),this.#i=s||null,this.#o={message:""}}makeServerError(e,t){let n;e?n=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:(e=`${this.statusCode} ${this.statusMessage}`,n=`CLIENT ESCALATED SERVER ERROR (${e})`);const i=new Wr(599,n,this.headers,this.body,this.#i||void 0);return i.#o={message:e,error:t},i}throwThrottleError(e,t){t==null?t=-1:_(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const n=new Error(e||"throttling requests");throw q(n,{stall:t,throttle:!0}),n}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return this.#n!=null}get request(){return this.#i}ok(){return this.#o.message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:t}=this.#o;e===""&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let n=null;this.request&&(n=this.request.url);let i=null;try{this.#n&&(i=to(this.#n))}catch{}F(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:n,responseBody:i,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}}function Rf(){return new Date().getTime()}function ky(r){return de(r.replace(/%([0-9a-f][0-9a-f])/gi,(e,t)=>String.fromCharCode(parseInt(t,16))))}function Ty(r){return new Promise(e=>setTimeout(e,r))}function Py(r){let e=r.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function Bf(r,e,t){let n=0;for(let i=0;i<t;i++)n=n*256+r[e+i];return n}function _f(r,e,t,n){const i=[];for(;t<e+1+n;){const s=Rh(r,t);i.push(s.result),t+=s.consumed,F(t<=e+1+n,"child data too short","BUFFER_OVERRUN",{buffer:r,length:n,offset:e})}return{consumed:1+n,result:i}}function Rh(r,e){F(r.length!==0,"data too short","BUFFER_OVERRUN",{buffer:r,length:0,offset:1});const t=n=>{F(n<=r.length,"data short segment too short","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n})};if(r[e]>=248){const n=r[e]-247;t(e+1+n);const i=Bf(r,e+1,n);return t(e+1+n+i),_f(r,e,e+1+n,n+i)}else if(r[e]>=192){const n=r[e]-192;return t(e+1+n),_f(r,e,e+1,n)}else if(r[e]>=184){const n=r[e]-183;t(e+1+n);const i=Bf(r,e+1,n);t(e+1+n+i);const s=G(r.slice(e+1+n,e+1+n+i));return{consumed:1+n+i,result:s}}else if(r[e]>=128){const n=r[e]-128;t(e+1+n);const i=G(r.slice(e+1,e+1+n));return{consumed:1+n,result:i}}return{consumed:1,result:Py(r[e])}}function ts(r){const e=K(r,"data"),t=Rh(e,0);return _(t.consumed===e.length,"unexpected junk after rlp payload","data",r),t.result}function Lf(r){const e=[];for(;r;)e.unshift(r&255),r>>=8;return e}function Bh(r){if(Array.isArray(r)){let n=[];if(r.forEach(function(s){n=n.concat(Bh(s))}),n.length<=55)return n.unshift(192+n.length),n;const i=Lf(n.length);return i.unshift(247+i.length),i.concat(n)}const e=Array.prototype.slice.call(K(r,"object"));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=Lf(e.length);return t.unshift(183+t.length),t.concat(e)}const Df="0123456789abcdef";function mr(r){let e="0x";for(const t of Bh(r))e+=Df[t>>4],e+=Df[t&15];return e}function Ny(r){const e=K(r,"randomBytes");e[6]=e[6]&15|64,e[8]=e[8]&63|128;const t=G(e);return[t.substring(2,10),t.substring(10,14),t.substring(14,18),t.substring(18,22),t.substring(22,34)].join("-")}const rt=32,pc=new Uint8Array(rt),Oy=["then"],ys={},_h=new WeakMap;function an(r){return _h.get(r)}function Mf(r,e){_h.set(r,e)}function mi(r,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${r}`);throw t.error=e,t}function xc(r,e,t){return r.indexOf(null)>=0?e.map((n,i)=>n instanceof lr?xc(an(n),n,t):n):r.reduce((n,i,s)=>{let o=e.getValue(i);return i in n||(t&&o instanceof lr&&(o=xc(an(o),o,t)),n[i]=o),n},{})}class lr extends Array{#e;constructor(...e){const t=e[0];let n=e[1],i=(e[2]||[]).slice(),s=!0;t!==ys&&(n=e,i=[],s=!1),super(n.length),n.forEach((c,u)=>{this[u]=c});const o=i.reduce((c,u)=>(typeof u=="string"&&c.set(u,(c.get(u)||0)+1),c),new Map);if(Mf(this,Object.freeze(n.map((c,u)=>{const l=i[u];return l!=null&&o.get(l)===1?l:null}))),this.#e=[],this.#e==null&&this.#e,!s)return;Object.freeze(this);const a=new Proxy(this,{get:(c,u,l)=>{if(typeof u=="string"){if(u.match(/^[0-9]+$/)){const d=ee(u,"%index");if(d<0||d>=this.length)throw new RangeError("out of result range");const p=c[d];return p instanceof Error&&mi(`index ${d}`,p),p}if(Oy.indexOf(u)>=0)return Reflect.get(c,u,l);const f=c[u];if(f instanceof Function)return function(...d){return f.apply(this===l?c:this,d)};if(!(u in c))return c.getValue.apply(this===l?c:this,[u])}return Reflect.get(c,u,l)}});return Mf(a,an(this)),a}toArray(e){const t=[];return this.forEach((n,i)=>{n instanceof Error&&mi(`index ${i}`,n),e&&n instanceof lr&&(n=n.toArray(e)),t.push(n)}),t}toObject(e){const t=an(this);return t.reduce((n,i,s)=>(F(i!=null,`value at index ${s} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),xc(t,this,e)),{})}slice(e,t){e==null&&(e=0),e<0&&(e+=this.length,e<0&&(e=0)),t==null&&(t=this.length),t<0&&(t+=this.length,t<0&&(t=0)),t>this.length&&(t=this.length);const n=an(this),i=[],s=[];for(let o=e;o<t;o++)i.push(this[o]),s.push(n[o]);return new lr(ys,i,s)}filter(e,t){const n=an(this),i=[],s=[];for(let o=0;o<this.length;o++){const a=this[o];a instanceof Error&&mi(`index ${o}`,a),e.call(t,a,o,this)&&(i.push(a),s.push(n[o]))}return new lr(ys,i,s)}map(e,t){const n=[];for(let i=0;i<this.length;i++){const s=this[i];s instanceof Error&&mi(`index ${i}`,s),n.push(e.call(t,s,i,this))}return n}getValue(e){const t=an(this).indexOf(e);if(t===-1)return;const n=this[t];return n instanceof Error&&mi(`property ${JSON.stringify(e)}`,n.error),n}static fromItems(e,t){return new lr(ys,e,t)}}function $f(r){let e=ke(r);return F(e.length<=rt,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:rt,offset:e.length}),e.length!==rt&&(e=Ve(he([pc.slice(e.length%rt),e]))),e}class Cr{name;type;localName;dynamic;constructor(e,t,n,i){q(this,{name:e,type:t,localName:n,dynamic:i},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,t){_(!1,e,this.localName,t)}}class bc{#e;#t;constructor(){this.#e=[],this.#t=0}get data(){return he(this.#e)}get length(){return this.#t}#r(e){return this.#e.push(e),this.#t+=e.length,e.length}appendWriter(e){return this.#r(Ve(e.data))}writeBytes(e){let t=Ve(e);const n=t.length%rt;return n&&(t=Ve(he([t,pc.slice(n)]))),this.#r(t)}writeValue(e){return this.#r($f(e))}writeUpdatableValue(){const e=this.#e.length;return this.#e.push(pc),this.#t+=rt,t=>{this.#e[e]=$f(t)}}}class nu{allowLoose;#e;#t;#r;#n;#i;constructor(e,t,n){q(this,{allowLoose:!!t}),this.#e=Ve(e),this.#r=0,this.#n=null,this.#i=n??1024,this.#t=0}get data(){return G(this.#e)}get dataLength(){return this.#e.length}get consumed(){return this.#t}get bytes(){return new Uint8Array(this.#e)}#o(e){if(this.#n)return this.#n.#o(e);this.#r+=e,F(this.#i<1||this.#r<=this.#i*this.dataLength,`compressed ABI data exceeds inflation ratio of ${this.#i} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:Ve(this.#e),offset:this.#t,length:e,info:{bytesRead:this.#r,dataLength:this.dataLength}})}#s(e,t,n){let i=Math.ceil(t/rt)*rt;return this.#t+i>this.#e.length&&(this.allowLoose&&n&&this.#t+t<=this.#e.length?i=t:F(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Ve(this.#e),length:this.#e.length,offset:this.#t+i})),this.#e.slice(this.#t,this.#t+i)}subReader(e){const t=new nu(this.#e.slice(this.#t+e),this.allowLoose,this.#i);return t.#n=this,t}readBytes(e,t){let n=this.#s(0,e,!!t);return this.#o(e),this.#t+=n.length,n.slice(0,e)}readValue(){return Po(this.readBytes(rt))}readIndex(){return ly(this.readBytes(rt))}}function gt(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function iu(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function Lh(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");gt(r.outputLen),gt(r.blockLen)}function Xn(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Dh(r,e){iu(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Uy=r=>r instanceof Uint8Array,Gs=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Hs=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ft=(r,e)=>r<<32-e|r>>>e,Ry=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ry)throw new Error("Non little-endian hardware is not supported");const By=async()=>{};async function Ff(r,e,t){let n=Date.now();for(let i=0;i<r;i++){t(i);const s=Date.now()-n;s>=0&&s<e||(await By(),n+=s)}}function _y(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function ei(r){if(typeof r=="string"&&(r=_y(r)),!Uy(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}let su=class{clone(){return this._cloneInto()}};const Ly={}.toString;function Mh(r,e){if(e!==void 0&&Ly.call(e)!=="[object Object]")throw new Error("Options should be object or undefined");return Object.assign(r,e)}function No(r){const e=n=>r().update(ei(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}let $h=class extends su{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Lh(e);const n=ei(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return Xn(this),this.iHash.update(e),this}digestInto(e){Xn(this),iu(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const ou=(r,e,t)=>new $h(r,e).update(t).digest();ou.create=(r,e)=>new $h(r,e);function Dy(r,e,t,n){Lh(r);const i=Mh({dkLen:32,asyncTick:10},n),{c:s,dkLen:o,asyncTick:a}=i;if(gt(s),gt(o),gt(a),s<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const c=ei(e),u=ei(t),l=new Uint8Array(o),f=ou.create(r,c),d=f._cloneInto().update(u);return{c:s,dkLen:o,asyncTick:a,DK:l,PRF:f,PRFSalt:d}}function My(r,e,t,n,i){return r.destroy(),e.destroy(),n&&n.destroy(),i.fill(0),t}function au(r,e,t,n){const{c:i,dkLen:s,DK:o,PRF:a,PRFSalt:c}=Dy(r,e,t,n);let u;const l=new Uint8Array(4),f=Hs(l),d=new Uint8Array(a.outputLen);for(let p=1,h=0;h<s;p++,h+=a.outputLen){const x=o.subarray(h,h+a.outputLen);f.setInt32(0,p,!1),(u=c._cloneInto(u)).update(l).digestInto(d),x.set(d.subarray(0,x.length));for(let b=1;b<i;b++){a._cloneInto(u).update(d).digestInto(d);for(let w=0;w<x.length;w++)x[w]^=d[w]}}return My(a,c,o,u,d)}function $y(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,u=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+u,a,n)}let cu=class extends su{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Hs(this.buffer)}update(e){Xn(this);const{view:t,buffer:n,blockLen:i}=this;e=ei(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Hs(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Xn(this),Dh(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)t[f]=0;$y(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Hs(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const Fy=(r,e,t)=>r&e^~r&t,Gy=(r,e,t)=>r&e^r&t^e&t,Hy=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ur=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Rr=new Uint32Array(64);let Ky=class extends cu{constructor(){super(64,32,8,!1),this.A=Ur[0]|0,this.B=Ur[1]|0,this.C=Ur[2]|0,this.D=Ur[3]|0,this.E=Ur[4]|0,this.F=Ur[5]|0,this.G=Ur[6]|0,this.H=Ur[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)Rr[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const d=Rr[f-15],p=Rr[f-2],h=Ft(d,7)^Ft(d,18)^d>>>3,x=Ft(p,17)^Ft(p,19)^p>>>10;Rr[f]=x+Rr[f-7]+h+Rr[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const d=Ft(a,6)^Ft(a,11)^Ft(a,25),p=l+d+Fy(a,c,u)+Hy[f]+Rr[f]|0,x=(Ft(n,2)^Ft(n,13)^Ft(n,22))+Gy(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+x|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Rr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const rs=No(()=>new Ky),ws=BigInt(2**32-1),yc=BigInt(32);function Fh(r,e=!1){return e?{h:Number(r&ws),l:Number(r>>yc&ws)}:{h:Number(r>>yc&ws)|0,l:Number(r&ws)|0}}function Gh(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let i=0;i<r.length;i++){const{h:s,l:o}=Fh(r[i],e);[t[i],n[i]]=[s,o]}return[t,n]}const jy=(r,e)=>BigInt(r>>>0)<<yc|BigInt(e>>>0),zy=(r,e,t)=>r>>>t,Vy=(r,e,t)=>r<<32-t|e>>>t,Wy=(r,e,t)=>r>>>t|e<<32-t,Jy=(r,e,t)=>r<<32-t|e>>>t,Qy=(r,e,t)=>r<<64-t|e>>>t-32,qy=(r,e,t)=>r>>>t-32|e<<64-t,Zy=(r,e)=>e,Yy=(r,e)=>r,Hh=(r,e,t)=>r<<t|e>>>32-t,Kh=(r,e,t)=>e<<t|r>>>32-t,jh=(r,e,t)=>e<<t-32|r>>>64-t,zh=(r,e,t)=>r<<t-32|e>>>64-t;function Xy(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const ew=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),tw=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,rw=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),nw=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,iw=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),sw=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,X={fromBig:Fh,split:Gh,toBig:jy,shrSH:zy,shrSL:Vy,rotrSH:Wy,rotrSL:Jy,rotrBH:Qy,rotrBL:qy,rotr32H:Zy,rotr32L:Yy,rotlSH:Hh,rotlSL:Kh,rotlBH:jh,rotlBL:zh,add:Xy,add3L:ew,add3H:tw,add4L:rw,add4H:nw,add5H:sw,add5L:iw},[ow,aw]=X.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Br=new Uint32Array(80),_r=new Uint32Array(80);let cw=class extends cu{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:d,Gh:p,Gl:h,Hh:x,Hl:b}=this;return[e,t,n,i,s,o,a,c,u,l,f,d,p,h,x,b]}set(e,t,n,i,s,o,a,c,u,l,f,d,p,h,x,b){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=d|0,this.Gh=p|0,this.Gl=h|0,this.Hh=x|0,this.Hl=b|0}process(e,t){for(let g=0;g<16;g++,t+=4)Br[g]=e.getUint32(t),_r[g]=e.getUint32(t+=4);for(let g=16;g<80;g++){const A=Br[g-15]|0,v=_r[g-15]|0,T=X.rotrSH(A,v,1)^X.rotrSH(A,v,8)^X.shrSH(A,v,7),P=X.rotrSL(A,v,1)^X.rotrSL(A,v,8)^X.shrSL(A,v,7),I=Br[g-2]|0,S=_r[g-2]|0,N=X.rotrSH(I,S,19)^X.rotrBH(I,S,61)^X.shrSH(I,S,6),O=X.rotrSL(I,S,19)^X.rotrBL(I,S,61)^X.shrSL(I,S,6),E=X.add4L(P,O,_r[g-7],_r[g-16]),y=X.add4H(E,T,N,Br[g-7],Br[g-16]);Br[g]=y|0,_r[g]=E|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:d,Fh:p,Fl:h,Gh:x,Gl:b,Hh:w,Hl:m}=this;for(let g=0;g<80;g++){const A=X.rotrSH(f,d,14)^X.rotrSH(f,d,18)^X.rotrBH(f,d,41),v=X.rotrSL(f,d,14)^X.rotrSL(f,d,18)^X.rotrBL(f,d,41),T=f&p^~f&x,P=d&h^~d&b,I=X.add5L(m,v,P,aw[g],_r[g]),S=X.add5H(I,w,A,T,ow[g],Br[g]),N=I|0,O=X.rotrSH(n,i,28)^X.rotrBH(n,i,34)^X.rotrBH(n,i,39),E=X.rotrSL(n,i,28)^X.rotrBL(n,i,34)^X.rotrBL(n,i,39),y=n&s^n&a^s&a,k=i&o^i&c^o&c;w=x|0,m=b|0,x=p|0,b=h|0,p=f|0,h=d|0,{h:f,l:d}=X.add(u|0,l|0,S|0,N|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const C=X.add3L(N,E,k);n=X.add3H(C,S,O,y),i=C|0}({h:n,l:i}=X.add(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=X.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=X.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=X.add(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:d}=X.add(this.Eh|0,this.El|0,f|0,d|0),{h:p,l:h}=X.add(this.Fh|0,this.Fl|0,p|0,h|0),{h:x,l:b}=X.add(this.Gh|0,this.Gl|0,x|0,b|0),{h:w,l:m}=X.add(this.Hh|0,this.Hl|0,w|0,m|0),this.set(n,i,s,o,a,c,u,l,f,d,p,h,x,b,w,m)}roundClean(){Br.fill(0),_r.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const uu=No(()=>new cw);function uw(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const Gf=uw(),Hf=Gf.crypto||Gf.msCrypto;function fw(r){switch(r){case"sha256":return rs.create();case"sha512":return uu.create()}_(!1,"invalid hashing algorithm name","algorithm",r)}function lw(r,e){const t={sha256:rs,sha512:uu}[r];return _(t!=null,"invalid hmac algorithm","algorithm",r),ou.create(t,e)}function dw(r,e,t,n,i){const s={sha256:rs,sha512:uu}[i];return _(s!=null,"invalid pbkdf2 algorithm","algorithm",i),au(s,r,e,{c:t,dkLen:n})}function hw(r){F(Hf!=null,"platform does not support secure random numbers","UNSUPPORTED_OPERATION",{operation:"randomBytes"}),_(Number.isInteger(r)&&r>0&&r<=1024,"invalid length","length",r);const e=new Uint8Array(r);return Hf.getRandomValues(e),e}let Vh=!1;const Wh=function(r,e,t){return lw(r,e).update(t).digest()};let Jh=Wh;function di(r,e,t){const n=K(e,"key"),i=K(t,"data");return G(Jh(r,n,i))}di._=Wh;di.lock=function(){Vh=!0};di.register=function(r){if(Vh)throw new Error("computeHmac is locked");Jh=r};Object.freeze(di);const[Qh,qh,Zh]=[[],[],[]],gw=BigInt(0),Ai=BigInt(1),pw=BigInt(2),xw=BigInt(7),bw=BigInt(256),yw=BigInt(113);for(let r=0,e=Ai,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],Qh.push(2*(5*n+t)),qh.push((r+1)*(r+2)/2%64);let i=gw;for(let s=0;s<7;s++)e=(e<<Ai^(e>>xw)*yw)%bw,e&pw&&(i^=Ai<<(Ai<<BigInt(s))-Ai);Zh.push(i)}const[ww,mw]=Gh(Zh,!0),Kf=(r,e,t)=>t>32?jh(r,e,t):Hh(r,e,t),jf=(r,e,t)=>t>32?zh(r,e,t):Kh(r,e,t);function Aw(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=t[c],l=t[c+1],f=Kf(u,l,1)^t[a],d=jf(u,l,1)^t[a+1];for(let p=0;p<50;p+=10)r[o+p]^=f,r[o+p+1]^=d}let i=r[2],s=r[3];for(let o=0;o<24;o++){const a=qh[o],c=Kf(i,s,a),u=jf(i,s,a),l=Qh[o];i=r[l],s=r[l+1],r[l]=c,r[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=ww[n],r[1]^=mw[n]}t.fill(0)}let vw=class Yh extends su{constructor(e,t,n,i=!1,s=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=i,this.rounds=s,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,gt(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Gs(this.state)}keccak(){Aw(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){Xn(this);const{blockLen:t,state:n}=this;e=ei(e);const i=e.length;for(let s=0;s<i;){const o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:i}=this;e[n]^=t,(t&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Xn(this,!1),iu(e),this.finish();const t=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return gt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Dh(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Yh(t,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Ew=(r,e,t)=>No(()=>new vw(e,r,t)),Sw=Ew(1,136,256/8);let Xh=!1;const e0=function(r){return Sw(r)};let t0=e0;function ie(r){const e=K(r,"data");return G(t0(e))}ie._=e0;ie.lock=function(){Xh=!0};ie.register=function(r){if(Xh)throw new TypeError("keccak256 is locked");t0=r};Object.freeze(ie);const Cw=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),r0=Uint8Array.from({length:16},(r,e)=>e),Iw=r0.map(r=>(9*r+5)%16);let fu=[r0],lu=[Iw];for(let r=0;r<4;r++)for(let e of[fu,lu])e.push(e[r].map(t=>Cw[t]));const n0=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(r=>new Uint8Array(r)),kw=fu.map((r,e)=>r.map(t=>n0[e][t])),Tw=lu.map((r,e)=>r.map(t=>n0[e][t])),Pw=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),Nw=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),ms=(r,e)=>r<<e|r>>>32-e;function zf(r,e,t,n){return r===0?e^t^n:r===1?e&t|~e&n:r===2?(e|~t)^n:r===3?e&n|t&~n:e^(t|~n)}const As=new Uint32Array(16);let Ow=class extends cu{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:n,h3:i,h4:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.h0=e|0,this.h1=t|0,this.h2=n|0,this.h3=i|0,this.h4=s|0}process(e,t){for(let p=0;p<16;p++,t+=4)As[p]=e.getUint32(t,!0);let n=this.h0|0,i=n,s=this.h1|0,o=s,a=this.h2|0,c=a,u=this.h3|0,l=u,f=this.h4|0,d=f;for(let p=0;p<5;p++){const h=4-p,x=Pw[p],b=Nw[p],w=fu[p],m=lu[p],g=kw[p],A=Tw[p];for(let v=0;v<16;v++){const T=ms(n+zf(p,s,a,u)+As[w[v]]+x,g[v])+f|0;n=f,f=u,u=ms(a,10)|0,a=s,s=T}for(let v=0;v<16;v++){const T=ms(i+zf(h,o,c,l)+As[m[v]]+b,A[v])+d|0;i=d,d=l,l=ms(c,10)|0,c=o,o=T}}this.set(this.h1+a+l|0,this.h2+u+d|0,this.h3+f+i|0,this.h4+n+o|0,this.h0+s+c|0)}roundClean(){As.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}};const Uw=No(()=>new Ow);let i0=!1;const s0=function(r){return Uw(r)};let o0=s0;function hi(r){const e=K(r,"data");return G(o0(e))}hi._=s0;hi.lock=function(){i0=!0};hi.register=function(r){if(i0)throw new TypeError("ripemd160 is locked");o0=r};Object.freeze(hi);let a0=!1;const c0=function(r,e,t,n,i){return dw(r,e,t,n,i)};let u0=c0;function Zr(r,e,t,n,i){const s=K(r,"password"),o=K(e,"salt");return G(u0(s,o,t,n,i))}Zr._=c0;Zr.lock=function(){a0=!0};Zr.register=function(r){if(a0)throw new Error("pbkdf2 is locked");u0=r};Object.freeze(Zr);let f0=!1;const l0=function(r){return new Uint8Array(hw(r))};let d0=l0;function xr(r){return d0(r)}xr._=l0;xr.lock=function(){f0=!0};xr.register=function(r){if(f0)throw new Error("randomBytes is locked");d0=r};Object.freeze(xr);const ue=(r,e)=>r<<e|r>>>32-e;function Vf(r,e,t,n,i,s){let o=r[e++]^t[n++],a=r[e++]^t[n++],c=r[e++]^t[n++],u=r[e++]^t[n++],l=r[e++]^t[n++],f=r[e++]^t[n++],d=r[e++]^t[n++],p=r[e++]^t[n++],h=r[e++]^t[n++],x=r[e++]^t[n++],b=r[e++]^t[n++],w=r[e++]^t[n++],m=r[e++]^t[n++],g=r[e++]^t[n++],A=r[e++]^t[n++],v=r[e++]^t[n++],T=o,P=a,I=c,S=u,N=l,O=f,E=d,y=p,k=h,C=x,U=b,R=w,B=m,L=g,D=A,M=v;for(let $=0;$<8;$+=2)N^=ue(T+B|0,7),k^=ue(N+T|0,9),B^=ue(k+N|0,13),T^=ue(B+k|0,18),C^=ue(O+P|0,7),L^=ue(C+O|0,9),P^=ue(L+C|0,13),O^=ue(P+L|0,18),D^=ue(U+E|0,7),I^=ue(D+U|0,9),E^=ue(I+D|0,13),U^=ue(E+I|0,18),S^=ue(M+R|0,7),y^=ue(S+M|0,9),R^=ue(y+S|0,13),M^=ue(R+y|0,18),P^=ue(T+S|0,7),I^=ue(P+T|0,9),S^=ue(I+P|0,13),T^=ue(S+I|0,18),E^=ue(O+N|0,7),y^=ue(E+O|0,9),N^=ue(y+E|0,13),O^=ue(N+y|0,18),R^=ue(U+C|0,7),k^=ue(R+U|0,9),C^=ue(k+R|0,13),U^=ue(C+k|0,18),B^=ue(M+D|0,7),L^=ue(B+M|0,9),D^=ue(L+B|0,13),M^=ue(D+L|0,18);i[s++]=o+T|0,i[s++]=a+P|0,i[s++]=c+I|0,i[s++]=u+S|0,i[s++]=l+N|0,i[s++]=f+O|0,i[s++]=d+E|0,i[s++]=p+y|0,i[s++]=h+k|0,i[s++]=x+C|0,i[s++]=b+U|0,i[s++]=w+R|0,i[s++]=m+B|0,i[s++]=g+L|0,i[s++]=A+D|0,i[s++]=v+M|0}function Vn(r,e,t,n,i){let s=n+0,o=n+16*i;for(let a=0;a<16;a++)t[o+a]=r[e+(2*i-1)*16+a];for(let a=0;a<i;a++,s+=16,e+=16)Vf(t,o,r,e,t,s),a>0&&(o+=16),Vf(t,s,r,e+=16,t,o)}function h0(r,e,t){const n=Mh({dkLen:32,asyncTick:10,maxmem:1073742848},t),{N:i,r:s,p:o,dkLen:a,asyncTick:c,maxmem:u,onProgress:l}=n;if(gt(i),gt(s),gt(o),gt(a),gt(c),gt(u),l!==void 0&&typeof l!="function")throw new Error("progressCb should be function");const f=128*s,d=f/4;if(i<=1||(i&i-1)!==0||i>=2**(f/8)||i>2**32)throw new Error("Scrypt: N must be larger than 1, a power of 2, less than 2^(128 * r / 8) and less than 2^32");if(o<0||o>(2**32-1)*32/f)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(a<0||a>(2**32-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");const p=f*(i+o);if(p>u)throw new Error(`Scrypt: parameters too large, ${p} (128 * r * (N + p)) > ${u} (maxmem)`);const h=au(rs,r,e,{c:1,dkLen:f*o}),x=Gs(h),b=Gs(new Uint8Array(f*i)),w=Gs(new Uint8Array(f));let m=()=>{};if(l){const g=2*i*o,A=Math.max(Math.floor(g/1e4),1);let v=0;m=()=>{v++,l&&(!(v%A)||v===g)&&l(v/g)}}return{N:i,r:s,p:o,dkLen:a,blockSize32:d,V:b,B32:x,B:h,tmp:w,blockMixCb:m,asyncTick:c}}function g0(r,e,t,n,i){const s=au(rs,r,t,{c:1,dkLen:e});return t.fill(0),n.fill(0),i.fill(0),s}function Rw(r,e,t){const{N:n,r:i,p:s,dkLen:o,blockSize32:a,V:c,B32:u,B:l,tmp:f,blockMixCb:d}=h0(r,e,t);for(let p=0;p<s;p++){const h=a*p;for(let x=0;x<a;x++)c[x]=u[h+x];for(let x=0,b=0;x<n-1;x++)Vn(c,b,c,b+=a,i),d();Vn(c,(n-1)*a,u,h,i),d();for(let x=0;x<n;x++){const b=u[h+a-16]%n;for(let w=0;w<a;w++)f[w]=u[h+w]^c[b*a+w];Vn(f,0,u,h,i),d()}}return g0(r,o,l,c,f)}async function Bw(r,e,t){const{N:n,r:i,p:s,dkLen:o,blockSize32:a,V:c,B32:u,B:l,tmp:f,blockMixCb:d,asyncTick:p}=h0(r,e,t);for(let h=0;h<s;h++){const x=a*h;for(let w=0;w<a;w++)c[w]=u[x+w];let b=0;await Ff(n-1,p,()=>{Vn(c,b,c,b+=a,i),d()}),Vn(c,(n-1)*a,u,x,i),d(),await Ff(n,p,()=>{const w=u[x+a-16]%n;for(let m=0;m<a;m++)f[m]=u[x+m]^c[w*a+m];Vn(f,0,u,x,i),d()})}return g0(r,o,l,c,f)}let p0=!1,x0=!1;const b0=async function(r,e,t,n,i,s,o){return await Bw(r,e,{N:t,r:n,p:i,dkLen:s,onProgress:o})},y0=function(r,e,t,n,i,s){return Rw(r,e,{N:t,r:n,p:i,dkLen:s})};let w0=b0,m0=y0;async function gi(r,e,t,n,i,s,o){const a=K(r,"passwd"),c=K(e,"salt");return G(await w0(a,c,t,n,i,s,o))}gi._=b0;gi.lock=function(){x0=!0};gi.register=function(r){if(x0)throw new Error("scrypt is locked");w0=r};Object.freeze(gi);function pi(r,e,t,n,i,s){const o=K(r,"passwd"),a=K(e,"salt");return G(m0(o,a,t,n,i,s))}pi._=y0;pi.lock=function(){p0=!0};pi.register=function(r){if(p0)throw new Error("scryptSync is locked");m0=r};Object.freeze(pi);const A0=function(r){return fw("sha256").update(r).digest()};let v0=A0,E0=!1;function st(r){const e=K(r,"data");return G(v0(e))}st._=A0;st.lock=function(){E0=!0};st.register=function(r){if(E0)throw new Error("sha256 is locked");v0=r};Object.freeze(st);Object.freeze(st);function Wf(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function S0(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function _w(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Wf(r.outputLen),Wf(r.blockLen)}function ro(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Lw(r,e){S0(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const ha=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const C0=r=>r instanceof Uint8Array,ga=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Gt=(r,e)=>r<<32-e|r>>>e,Dw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Dw)throw new Error("Non little-endian hardware is not supported");function Mw(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function du(r){if(typeof r=="string"&&(r=Mw(r)),!C0(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function $w(...r){const e=new Uint8Array(r.reduce((n,i)=>n+i.length,0));let t=0;return r.forEach(n=>{if(!C0(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}let I0=class{clone(){return this._cloneInto()}};function Fw(r){const e=n=>r().update(du(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function k0(r=32){if(ha&&typeof ha.getRandomValues=="function")return ha.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function Gw(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,u=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+u,a,n)}let Hw=class extends I0{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=ga(this.buffer)}update(e){ro(this);const{view:t,buffer:n,blockLen:i}=this;e=du(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=ga(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ro(this),Lw(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)t[f]=0;Gw(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=ga(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}};const Kw=(r,e,t)=>r&e^~r&t,jw=(r,e,t)=>r&e^r&t^e&t,zw=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Lr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Dr=new Uint32Array(64);let Vw=class extends Hw{constructor(){super(64,32,8,!1),this.A=Lr[0]|0,this.B=Lr[1]|0,this.C=Lr[2]|0,this.D=Lr[3]|0,this.E=Lr[4]|0,this.F=Lr[5]|0,this.G=Lr[6]|0,this.H=Lr[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)Dr[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const d=Dr[f-15],p=Dr[f-2],h=Gt(d,7)^Gt(d,18)^d>>>3,x=Gt(p,17)^Gt(p,19)^p>>>10;Dr[f]=x+Dr[f-7]+h+Dr[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const d=Gt(a,6)^Gt(a,11)^Gt(a,25),p=l+d+Kw(a,c,u)+zw[f]+Dr[f]|0,x=(Gt(n,2)^Gt(n,13)^Gt(n,22))+jw(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+x|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Dr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const wc=Fw(()=>new Vw);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const T0=BigInt(0),Oo=BigInt(1),Ww=BigInt(2),Uo=r=>r instanceof Uint8Array,Jw=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function ti(r){if(!Uo(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=Jw[r[t]];return e}function P0(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function hu(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function ri(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let n=0;n<t.length;n++){const i=n*2,s=r.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function ft(r){return hu(ti(r))}function gu(r){if(!Uo(r))throw new Error("Uint8Array expected");return hu(ti(Uint8Array.from(r).reverse()))}function qr(r,e){return ri(r.toString(16).padStart(e*2,"0"))}function pu(r,e){return qr(r,e).reverse()}function Qw(r){return ri(P0(r))}function Ye(r,e,t){let n;if(typeof e=="string")try{n=ri(e)}catch(s){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Uo(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(`${r} expected ${t} bytes, got ${i}`);return n}function yn(...r){const e=new Uint8Array(r.reduce((n,i)=>n+i.length,0));let t=0;return r.forEach(n=>{if(!Uo(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}function qw(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Zw(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Yw(r){let e;for(e=0;r>T0;r>>=Oo,e+=1);return e}function Xw(r,e){return r>>BigInt(e)&Oo}const em=(r,e,t)=>r|(t?Oo:T0)<<BigInt(e),xu=r=>(Ww<<BigInt(r-1))-Oo,pa=r=>new Uint8Array(r),Jf=r=>Uint8Array.from(r);function N0(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=pa(r),i=pa(r),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...f)=>t(i,n,...f),c=(f=pa())=>{i=a(Jf([0]),f),n=a(),f.length!==0&&(i=a(Jf([1]),f),n=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){n=a();const p=n.slice();d.push(p),f+=n.length}return yn(...d)};return(f,d)=>{o(),c(f);let p;for(;!(p=d(u()));)c();return o(),p}}const tm={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function ns(r,e,t={}){const n=(i,s,o)=>{const a=tm[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=r[i];if(!(o&&c===void 0)&&!a(c,r))throw new Error(`Invalid param ${String(i)}=${c} (${typeof c}), expected ${s}`)};for(const[i,s]of Object.entries(e))n(i,s,!1);for(const[i,s]of Object.entries(t))n(i,s,!0);return r}const rm=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Xw,bitLen:Yw,bitMask:xu,bitSet:em,bytesToHex:ti,bytesToNumberBE:ft,bytesToNumberLE:gu,concatBytes:yn,createHmacDrbg:N0,ensureBytes:Ye,equalBytes:qw,hexToBytes:ri,hexToNumber:hu,numberToBytesBE:qr,numberToBytesLE:pu,numberToHexUnpadded:P0,numberToVarBytesBE:Qw,utf8ToBytes:Zw,validateObject:ns},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Me=BigInt(0),Ue=BigInt(1),cn=BigInt(2),nm=BigInt(3),mc=BigInt(4),Qf=BigInt(5),qf=BigInt(8);BigInt(9);BigInt(16);function Ke(r,e){const t=r%e;return t>=Me?t:e+t}function im(r,e,t){if(t<=Me||e<Me)throw new Error("Expected power/modulo > 0");if(t===Ue)return Me;let n=Ue;for(;e>Me;)e&Ue&&(n=n*r%t),r=r*r%t,e>>=Ue;return n}function yt(r,e,t){let n=r;for(;e-- >Me;)n*=n,n%=t;return n}function Ac(r,e){if(r===Me||e<=Me)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=Ke(r,e),n=e,i=Me,s=Ue;for(;t!==Me;){const a=n/t,c=n%t,u=i-s*a;n=t,t=c,i=s,s=u}if(n!==Ue)throw new Error("invert: does not exist");return Ke(i,e)}function sm(r){const e=(r-Ue)/cn;let t,n,i;for(t=r-Ue,n=0;t%cn===Me;t/=cn,n++);for(i=cn;i<r&&im(i,e,r)!==r-Ue;i++);if(n===1){const o=(r+Ue)/mc;return function(c,u){const l=c.pow(u,o);if(!c.eql(c.sqr(l),u))throw new Error("Cannot find square root");return l}}const s=(t+Ue)/cn;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=n,l=a.pow(a.mul(a.ONE,i),t),f=a.pow(c,s),d=a.pow(c,t);for(;!a.eql(d,a.ONE);){if(a.eql(d,a.ZERO))return a.ZERO;let p=1;for(let x=a.sqr(d);p<u&&!a.eql(x,a.ONE);p++)x=a.sqr(x);const h=a.pow(l,Ue<<BigInt(u-p-1));l=a.sqr(h),f=a.mul(f,h),d=a.mul(d,l),u=p}return f}}function om(r){if(r%mc===nm){const e=(r+Ue)/mc;return function(n,i){const s=n.pow(i,e);if(!n.eql(n.sqr(s),i))throw new Error("Cannot find square root");return s}}if(r%qf===Qf){const e=(r-Qf)/qf;return function(n,i){const s=n.mul(i,cn),o=n.pow(s,e),a=n.mul(i,o),c=n.mul(n.mul(a,cn),o),u=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(u),i))throw new Error("Cannot find square root");return u}}return sm(r)}const am=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cm(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=am.reduce((n,i)=>(n[i]="function",n),e);return ns(r,t)}function um(r,e,t){if(t<Me)throw new Error("Expected power > 0");if(t===Me)return r.ONE;if(t===Ue)return e;let n=r.ONE,i=e;for(;t>Me;)t&Ue&&(n=r.mul(n,i)),i=r.sqr(i),t>>=Ue;return n}function fm(r,e){const t=new Array(e.length),n=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),i=r.inv(n);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),i),t}function O0(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function lm(r,e,t=!1,n={}){if(r<=Me)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:i,nByteLength:s}=O0(r,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=om(r),a=Object.freeze({ORDER:r,BITS:i,BYTES:s,MASK:xu(i),ZERO:Me,ONE:Ue,create:c=>Ke(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return Me<=c&&c<r},is0:c=>c===Me,isOdd:c=>(c&Ue)===Ue,neg:c=>Ke(-c,r),eql:(c,u)=>c===u,sqr:c=>Ke(c*c,r),add:(c,u)=>Ke(c+u,r),sub:(c,u)=>Ke(c-u,r),mul:(c,u)=>Ke(c*u,r),pow:(c,u)=>um(a,c,u),div:(c,u)=>Ke(c*Ac(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Ac(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>fm(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>t?pu(c,s):qr(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return t?gu(c):ft(c)}});return Object.freeze(a)}function U0(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function R0(r){const e=U0(r);return e+Math.ceil(e/2)}function dm(r,e,t=!1){const n=r.length,i=U0(e),s=R0(e);if(n<16||n<s||n>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${n}`);const o=t?ft(r):gu(r),a=Ke(o,e-Ue)+Ue;return t?pu(a,i):qr(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const hm=BigInt(0),xa=BigInt(1);function gm(r,e){const t=(i,s)=>{const o=s.negate();return i?o:s},n=i=>{const s=Math.ceil(e/i)+1,o=2**(i-1);return{windows:s,windowSize:o}};return{constTimeNegate:t,unsafeLadder(i,s){let o=r.ZERO,a=i;for(;s>hm;)s&xa&&(o=o.add(a)),a=a.double(),s>>=xa;return o},precomputeWindow(i,s){const{windows:o,windowSize:a}=n(s),c=[];let u=i,l=u;for(let f=0;f<o;f++){l=u,c.push(l);for(let d=1;d<a;d++)l=l.add(u),c.push(l);u=l.double()}return c},wNAF(i,s,o){const{windows:a,windowSize:c}=n(i);let u=r.ZERO,l=r.BASE;const f=BigInt(2**i-1),d=2**i,p=BigInt(i);for(let h=0;h<a;h++){const x=h*c;let b=Number(o&f);o>>=p,b>c&&(b-=d,o+=xa);const w=x,m=x+Math.abs(b)-1,g=h%2!==0,A=b<0;b===0?l=l.add(t(g,s[w])):u=u.add(t(A,s[m]))}return{p:u,f:l}},wNAFCached(i,s,o,a){const c=i._WINDOW_SIZE||1;let u=s.get(i);return u||(u=this.precomputeWindow(i,c),c!==1&&s.set(i,a(u))),this.wNAF(c,u,o)}}}function B0(r){return cm(r.Fp),ns(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...O0(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function pm(r){const e=B0(r);ns(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:i}=e;if(t){if(!n.eql(i,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:xm,hexToBytes:bm}=rm,fn={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(r){const{Err:e}=fn;if(r.length<2||r[0]!==2)throw new e("Invalid signature integer tag");const t=r[1],n=r.subarray(2,t+2);if(!t||n.length!==t)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:xm(n),l:r.subarray(t+2)}},toSig(r){const{Err:e}=fn,t=typeof r=="string"?bm(r):r;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let n=t.length;if(n<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:i,l:s}=fn._parseInt(t.subarray(2)),{d:o,l:a}=fn._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(r){const e=u=>Number.parseInt(u[0],16)&8?"00"+u:u,t=u=>{const l=u.toString(16);return l.length&1?`0${l}`:l},n=e(t(r.s)),i=e(t(r.r)),s=n.length/2,o=i.length/2,a=t(s),c=t(o);return`30${t(o+s+4)}02${c}${i}02${a}${n}`}},ur=BigInt(0),St=BigInt(1);BigInt(2);const Zf=BigInt(3);BigInt(4);function ym(r){const e=pm(r),{Fp:t}=e,n=e.toBytes||((h,x,b)=>{const w=x.toAffine();return yn(Uint8Array.from([4]),t.toBytes(w.x),t.toBytes(w.y))}),i=e.fromBytes||(h=>{const x=h.subarray(1),b=t.fromBytes(x.subarray(0,t.BYTES)),w=t.fromBytes(x.subarray(t.BYTES,2*t.BYTES));return{x:b,y:w}});function s(h){const{a:x,b}=e,w=t.sqr(h),m=t.mul(w,h);return t.add(t.add(m,t.mul(h,x)),b)}if(!t.eql(t.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function o(h){return typeof h=="bigint"&&ur<h&&h<e.n}function a(h){if(!o(h))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(h){const{allowedPrivateKeyLengths:x,nByteLength:b,wrapPrivateKey:w,n:m}=e;if(x&&typeof h!="bigint"){if(h instanceof Uint8Array&&(h=ti(h)),typeof h!="string"||!x.includes(h.length))throw new Error("Invalid key");h=h.padStart(b*2,"0")}let g;try{g=typeof h=="bigint"?h:ft(Ye("private key",h,b))}catch{throw new Error(`private key must be ${b} bytes, hex or bigint, not ${typeof h}`)}return w&&(g=Ke(g,m)),a(g),g}const u=new Map;function l(h){if(!(h instanceof f))throw new Error("ProjectivePoint expected")}class f{constructor(x,b,w){if(this.px=x,this.py=b,this.pz=w,x==null||!t.isValid(x))throw new Error("x required");if(b==null||!t.isValid(b))throw new Error("y required");if(w==null||!t.isValid(w))throw new Error("z required")}static fromAffine(x){const{x:b,y:w}=x||{};if(!x||!t.isValid(b)||!t.isValid(w))throw new Error("invalid affine point");if(x instanceof f)throw new Error("projective point not allowed");const m=g=>t.eql(g,t.ZERO);return m(b)&&m(w)?f.ZERO:new f(b,w,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const b=t.invertBatch(x.map(w=>w.pz));return x.map((w,m)=>w.toAffine(b[m])).map(f.fromAffine)}static fromHex(x){const b=f.fromAffine(i(Ye("pointHex",x)));return b.assertValidity(),b}static fromPrivateKey(x){return f.BASE.multiply(c(x))}_setWindowSize(x){this._WINDOW_SIZE=x,u.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x,y:b}=this.toAffine();if(!t.isValid(x)||!t.isValid(b))throw new Error("bad point: x or y not FE");const w=t.sqr(b),m=s(x);if(!t.eql(w,m))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:x}=this.toAffine();if(t.isOdd)return!t.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){l(x);const{px:b,py:w,pz:m}=this,{px:g,py:A,pz:v}=x,T=t.eql(t.mul(b,v),t.mul(g,m)),P=t.eql(t.mul(w,v),t.mul(A,m));return T&&P}negate(){return new f(this.px,t.neg(this.py),this.pz)}double(){const{a:x,b}=e,w=t.mul(b,Zf),{px:m,py:g,pz:A}=this;let v=t.ZERO,T=t.ZERO,P=t.ZERO,I=t.mul(m,m),S=t.mul(g,g),N=t.mul(A,A),O=t.mul(m,g);return O=t.add(O,O),P=t.mul(m,A),P=t.add(P,P),v=t.mul(x,P),T=t.mul(w,N),T=t.add(v,T),v=t.sub(S,T),T=t.add(S,T),T=t.mul(v,T),v=t.mul(O,v),P=t.mul(w,P),N=t.mul(x,N),O=t.sub(I,N),O=t.mul(x,O),O=t.add(O,P),P=t.add(I,I),I=t.add(P,I),I=t.add(I,N),I=t.mul(I,O),T=t.add(T,I),N=t.mul(g,A),N=t.add(N,N),I=t.mul(N,O),v=t.sub(v,I),P=t.mul(N,S),P=t.add(P,P),P=t.add(P,P),new f(v,T,P)}add(x){l(x);const{px:b,py:w,pz:m}=this,{px:g,py:A,pz:v}=x;let T=t.ZERO,P=t.ZERO,I=t.ZERO;const S=e.a,N=t.mul(e.b,Zf);let O=t.mul(b,g),E=t.mul(w,A),y=t.mul(m,v),k=t.add(b,w),C=t.add(g,A);k=t.mul(k,C),C=t.add(O,E),k=t.sub(k,C),C=t.add(b,m);let U=t.add(g,v);return C=t.mul(C,U),U=t.add(O,y),C=t.sub(C,U),U=t.add(w,m),T=t.add(A,v),U=t.mul(U,T),T=t.add(E,y),U=t.sub(U,T),I=t.mul(S,C),T=t.mul(N,y),I=t.add(T,I),T=t.sub(E,I),I=t.add(E,I),P=t.mul(T,I),E=t.add(O,O),E=t.add(E,O),y=t.mul(S,y),C=t.mul(N,C),E=t.add(E,y),y=t.sub(O,y),y=t.mul(S,y),C=t.add(C,y),O=t.mul(E,C),P=t.add(P,O),O=t.mul(U,C),T=t.mul(k,T),T=t.sub(T,O),O=t.mul(k,E),I=t.mul(U,I),I=t.add(I,O),new f(T,P,I)}subtract(x){return this.add(x.negate())}is0(){return this.equals(f.ZERO)}wNAF(x){return p.wNAFCached(this,u,x,b=>{const w=t.invertBatch(b.map(m=>m.pz));return b.map((m,g)=>m.toAffine(w[g])).map(f.fromAffine)})}multiplyUnsafe(x){const b=f.ZERO;if(x===ur)return b;if(a(x),x===St)return this;const{endo:w}=e;if(!w)return p.unsafeLadder(this,x);let{k1neg:m,k1:g,k2neg:A,k2:v}=w.splitScalar(x),T=b,P=b,I=this;for(;g>ur||v>ur;)g&St&&(T=T.add(I)),v&St&&(P=P.add(I)),I=I.double(),g>>=St,v>>=St;return m&&(T=T.negate()),A&&(P=P.negate()),P=new f(t.mul(P.px,w.beta),P.py,P.pz),T.add(P)}multiply(x){a(x);let b=x,w,m;const{endo:g}=e;if(g){const{k1neg:A,k1:v,k2neg:T,k2:P}=g.splitScalar(b);let{p:I,f:S}=this.wNAF(v),{p:N,f:O}=this.wNAF(P);I=p.constTimeNegate(A,I),N=p.constTimeNegate(T,N),N=new f(t.mul(N.px,g.beta),N.py,N.pz),w=I.add(N),m=S.add(O)}else{const{p:A,f:v}=this.wNAF(b);w=A,m=v}return f.normalizeZ([w,m])[0]}multiplyAndAddUnsafe(x,b,w){const m=f.BASE,g=(v,T)=>T===ur||T===St||!v.equals(m)?v.multiplyUnsafe(T):v.multiply(T),A=g(this,b).add(g(x,w));return A.is0()?void 0:A}toAffine(x){const{px:b,py:w,pz:m}=this,g=this.is0();x==null&&(x=g?t.ONE:t.inv(m));const A=t.mul(b,x),v=t.mul(w,x),T=t.mul(m,x);if(g)return{x:t.ZERO,y:t.ZERO};if(!t.eql(T,t.ONE))throw new Error("invZ was invalid");return{x:A,y:v}}isTorsionFree(){const{h:x,isTorsionFree:b}=e;if(x===St)return!0;if(b)return b(f,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:b}=e;return x===St?this:b?b(f,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return this.assertValidity(),n(f,this,x)}toHex(x=!0){return ti(this.toRawBytes(x))}}f.BASE=new f(e.Gx,e.Gy,t.ONE),f.ZERO=new f(t.ZERO,t.ONE,t.ZERO);const d=e.nBitLength,p=gm(f,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:f,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}function wm(r){const e=B0(r);return ns(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function mm(r){const e=wm(r),{Fp:t,n}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(C){return ur<C&&C<t.ORDER}function a(C){return Ke(C,n)}function c(C){return Ac(C,n)}const{ProjectivePoint:u,normPrivateKeyToScalar:l,weierstrassEquation:f,isWithinCurveOrder:d}=ym({...e,toBytes(C,U,R){const B=U.toAffine(),L=t.toBytes(B.x),D=yn;return R?D(Uint8Array.from([U.hasEvenY()?2:3]),L):D(Uint8Array.from([4]),L,t.toBytes(B.y))},fromBytes(C){const U=C.length,R=C[0],B=C.subarray(1);if(U===i&&(R===2||R===3)){const L=ft(B);if(!o(L))throw new Error("Point is not on curve");const D=f(L);let M=t.sqrt(D);const $=(M&St)===St;return(R&1)===1!==$&&(M=t.neg(M)),{x:L,y:M}}else if(U===s&&R===4){const L=t.fromBytes(B.subarray(0,t.BYTES)),D=t.fromBytes(B.subarray(t.BYTES,2*t.BYTES));return{x:L,y:D}}else throw new Error(`Point of length ${U} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}}),p=C=>ti(qr(C,e.nByteLength));function h(C){const U=n>>St;return C>U}function x(C){return h(C)?a(-C):C}const b=(C,U,R)=>ft(C.slice(U,R));class w{constructor(U,R,B){this.r=U,this.s=R,this.recovery=B,this.assertValidity()}static fromCompact(U){const R=e.nByteLength;return U=Ye("compactSignature",U,R*2),new w(b(U,0,R),b(U,R,2*R))}static fromDER(U){const{r:R,s:B}=fn.toSig(Ye("DER",U));return new w(R,B)}assertValidity(){if(!d(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!d(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(U){return new w(this.r,this.s,U)}recoverPublicKey(U){const{r:R,s:B,recovery:L}=this,D=P(Ye("msgHash",U));if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");const M=L===2||L===3?R+e.n:R;if(M>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const $=(L&1)===0?"02":"03",j=u.fromHex($+p(M)),J=c(M),H=a(-D*J),Q=a(B*J),Z=u.BASE.multiplyAndAddUnsafe(j,H,Q);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return ri(this.toDERHex())}toDERHex(){return fn.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ri(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const m={isValidPrivateKey(C){try{return l(C),!0}catch{return!1}},normPrivateKeyToScalar:l,randomPrivateKey:()=>{const C=R0(e.n);return dm(e.randomBytes(C),e.n)},precompute(C=8,U=u.BASE){return U._setWindowSize(C),U.multiply(BigInt(3)),U}};function g(C,U=!0){return u.fromPrivateKey(C).toRawBytes(U)}function A(C){const U=C instanceof Uint8Array,R=typeof C=="string",B=(U||R)&&C.length;return U?B===i||B===s:R?B===2*i||B===2*s:C instanceof u}function v(C,U,R=!0){if(A(C))throw new Error("first arg must be private key");if(!A(U))throw new Error("second arg must be public key");return u.fromHex(U).multiply(l(C)).toRawBytes(R)}const T=e.bits2int||function(C){const U=ft(C),R=C.length*8-e.nBitLength;return R>0?U>>BigInt(R):U},P=e.bits2int_modN||function(C){return a(T(C))},I=xu(e.nBitLength);function S(C){if(typeof C!="bigint")throw new Error("bigint expected");if(!(ur<=C&&C<I))throw new Error(`bigint expected < 2^${e.nBitLength}`);return qr(C,e.nByteLength)}function N(C,U,R=O){if(["recovered","canonical"].some(re=>re in R))throw new Error("sign() legacy options not supported");const{hash:B,randomBytes:L}=e;let{lowS:D,prehash:M,extraEntropy:$}=R;D==null&&(D=!0),C=Ye("msgHash",C),M&&(C=Ye("prehashed msgHash",B(C)));const j=P(C),J=l(U),H=[S(J),S(j)];if($!=null){const re=$===!0?L(t.BYTES):$;H.push(Ye("extraEntropy",re))}const Q=yn(...H),Z=j;function se(re){const ce=T(re);if(!d(ce))return;const Te=c(ce),ye=u.BASE.multiply(ce).toAffine(),Je=a(ye.x);if(Je===ur)return;const Pt=a(Te*a(Z+Je*J));if(Pt===ur)return;let On=(ye.x===Je?0:2)|Number(ye.y&St),Nr=Pt;return D&&h(Pt)&&(Nr=x(Pt),On^=1),new w(Je,Nr,On)}return{seed:Q,k2sig:se}}const O={lowS:e.lowS,prehash:!1},E={lowS:e.lowS,prehash:!1};function y(C,U,R=O){const{seed:B,k2sig:L}=N(C,U,R),D=e;return N0(D.hash.outputLen,D.nByteLength,D.hmac)(B,L)}u.BASE._setWindowSize(8);function k(C,U,R,B=E){const L=C;if(U=Ye("msgHash",U),R=Ye("publicKey",R),"strict"in B)throw new Error("options.strict was renamed to lowS");const{lowS:D,prehash:M}=B;let $,j;try{if(typeof L=="string"||L instanceof Uint8Array)try{$=w.fromDER(L)}catch(ye){if(!(ye instanceof fn.Err))throw ye;$=w.fromCompact(L)}else if(typeof L=="object"&&typeof L.r=="bigint"&&typeof L.s=="bigint"){const{r:ye,s:Je}=L;$=new w(ye,Je)}else throw new Error("PARSE");j=u.fromHex(R)}catch(ye){if(ye.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(D&&$.hasHighS())return!1;M&&(U=e.hash(U));const{r:J,s:H}=$,Q=P(U),Z=c(H),se=a(Q*Z),re=a(J*Z),ce=u.BASE.multiplyAndAddUnsafe(j,se,re)?.toAffine();return ce?a(ce.x)===J:!1}return{CURVE:e,getPublicKey:g,getSharedSecret:v,sign:y,verify:k,ProjectivePoint:u,Signature:w,utils:m}}let _0=class extends I0{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,_w(e);const n=du(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return ro(this),this.iHash.update(e),this}digestInto(e){ro(this),S0(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const L0=(r,e,t)=>new _0(r,e).update(t).digest();L0.create=(r,e)=>new _0(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Am(r){return{hash:r,hmac:(e,...t)=>L0(r,e,$w(...t)),randomBytes:k0}}function vm(r,e){const t=n=>mm({...r,...Am(n)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ro=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),no=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),D0=BigInt(1),io=BigInt(2),Yf=(r,e)=>(r+e/io)/e;function M0(r){const e=Ro,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=r*r*r%e,l=u*u*r%e,f=yt(l,t,e)*l%e,d=yt(f,t,e)*l%e,p=yt(d,io,e)*u%e,h=yt(p,i,e)*p%e,x=yt(h,s,e)*h%e,b=yt(x,a,e)*x%e,w=yt(b,c,e)*b%e,m=yt(w,a,e)*x%e,g=yt(m,t,e)*l%e,A=yt(g,o,e)*h%e,v=yt(A,n,e)*u%e,T=yt(v,io,e);if(!vc.eql(vc.sqr(T),r))throw new Error("Cannot find square root");return T}const vc=lm(Ro,void 0,void 0,{sqrt:M0}),ht=vm({a:BigInt(0),b:BigInt(7),Fp:vc,n:no,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=no,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-D0*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=Yf(s*r,e),c=Yf(-n*r,e);let u=Ke(r-a*t-c*i,e),l=Ke(-a*n-c*s,e);const f=u>o,d=l>o;if(f&&(u=e-u),d&&(l=e-l),u>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:f,k1:u,k2neg:d,k2:l}}}},wc),Bo=BigInt(0),$0=r=>typeof r=="bigint"&&Bo<r&&r<Ro,Em=r=>typeof r=="bigint"&&Bo<r&&r<no,Xf={};function so(r,...e){let t=Xf[r];if(t===void 0){const n=wc(Uint8Array.from(r,i=>i.charCodeAt(0)));t=yn(n,n),Xf[r]=t}return wc(yn(t,...e))}const bu=r=>r.toRawBytes(!0).slice(1),Ec=r=>qr(r,32),ba=r=>Ke(r,Ro),Fi=r=>Ke(r,no),yu=ht.ProjectivePoint,Sm=(r,e,t)=>yu.BASE.multiplyAndAddUnsafe(r,e,t);function Sc(r){let e=ht.utils.normPrivateKeyToScalar(r),t=yu.fromPrivateKey(e);return{scalar:t.hasEvenY()?e:Fi(-e),bytes:bu(t)}}function F0(r){if(!$0(r))throw new Error("bad x: need 0 < x < p");const e=ba(r*r),t=ba(e*r+BigInt(7));let n=M0(t);n%io!==Bo&&(n=ba(-n));const i=new yu(r,n,D0);return i.assertValidity(),i}function G0(...r){return Fi(ft(so("BIP0340/challenge",...r)))}function Cm(r){return Sc(r).bytes}function Im(r,e,t=k0(32)){const n=Ye("message",r),{bytes:i,scalar:s}=Sc(e),o=Ye("auxRand",t,32),a=Ec(s^ft(so("BIP0340/aux",o))),c=so("BIP0340/nonce",a,i,n),u=Fi(ft(c));if(u===Bo)throw new Error("sign failed: k is zero");const{bytes:l,scalar:f}=Sc(u),d=G0(l,i,n),p=new Uint8Array(64);if(p.set(l,0),p.set(Ec(Fi(f+d*s)),32),!H0(p,n,i))throw new Error("sign: Invalid signature produced");return p}function H0(r,e,t){const n=Ye("signature",r,64),i=Ye("message",e),s=Ye("publicKey",t,32);try{const o=F0(ft(s)),a=ft(n.subarray(0,32));if(!$0(a))return!1;const c=ft(n.subarray(32,64));if(!Em(c))return!1;const u=G0(Ec(a),bu(o),i),l=Sm(o,c,Fi(-u));return!(!l||!l.hasEvenY()||l.toAffine().x!==a)}catch{return!1}}const vi={getPublicKey:Cm,sign:Im,verify:H0,utils:{randomPrivateKey:ht.utils.randomPrivateKey,lift_x:F0,pointToBytes:bu,numberToBytesBE:qr,bytesToNumberBE:ft,taggedHash:so,mod:Ke}},Gi="0x0000000000000000000000000000000000000000",el="0x0000000000000000000000000000000000000000000000000000000000000000",km=`Ethereum Signed Message:
`,tl=BigInt(0),rl=BigInt(1),nl=BigInt(2),il=BigInt(27),sl=BigInt(28),vs=BigInt(35),Un={};function ol(r){return yr(ke(r),32)}class Ce{#e;#t;#r;#n;get r(){return this.#e}set r(e){_(zn(e)===32,"invalid r","value",e),this.#e=G(e)}get s(){return _(parseInt(this.#t.substring(0,3))<8,"non-canonical s; use ._s","s",this.#t),this.#t}set s(e){_(zn(e)===32,"invalid s","value",e),this.#t=G(e)}get _s(){return this.#t}isValid(){return parseInt(this.#t.substring(0,3))<8}get v(){return this.#r}set v(e){const t=ee(e,"value");_(t===27||t===28,"invalid v","v",e),this.#r=t}get networkV(){return this.#n}get legacyChainId(){const e=this.networkV;return e==null?null:Ce.getChainId(e)}get yParity(){return this.v===27?0:1}get yParityAndS(){const e=K(this.s);return this.yParity&&(e[0]|=128),G(e)}get compactSerialized(){return he([this.r,this.yParityAndS])}get serialized(){return he([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(e,t,n,i){In(e,Un,"Signature"),this.#e=t,this.#t=n,this.#r=i,this.#n=null}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const e=new Ce(Un,this.r,this._s,this.v);return this.networkV&&(e.#n=this.networkV),e}toJSON(){const e=this.networkV;return{_type:"signature",networkV:e!=null?e.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(e){const t=z(e,"v");return t==il||t==sl?tl:(_(t>=vs,"invalid EIP-155 v","v",e),(t-vs)/nl)}static getChainIdV(e,t){return z(e)*nl+BigInt(35+t-27)}static getNormalizedV(e){const t=z(e);return t===tl||t===il?27:t===rl||t===sl?28:(_(t>=vs,"invalid v","v",e),t&rl?27:28)}static from(e){function t(u,l){_(u,l,"signature",e)}if(e==null)return new Ce(Un,el,el,27);if(typeof e=="string"){const u=K(e,"signature");if(u.length===64){const l=G(u.slice(0,32)),f=u.slice(32,64),d=f[0]&128?28:27;return f[0]&=127,new Ce(Un,l,G(f),d)}if(u.length===65){const l=G(u.slice(0,32)),f=G(u.slice(32,64)),d=Ce.getNormalizedV(u[64]);return new Ce(Un,l,f,d)}t(!1,"invalid raw signature length")}if(e instanceof Ce)return e.clone();const n=e.r;t(n!=null,"missing r");const i=ol(n),s=(function(u,l){if(u!=null)return ol(u);if(l!=null){t(xe(l,32),"invalid yParityAndS");const f=K(l);return f[0]&=127,G(f)}t(!1,"missing s")})(e.s,e.yParityAndS),{networkV:o,v:a}=(function(u,l,f){if(u!=null){const d=z(u);return{networkV:d>=vs?d:void 0,v:Ce.getNormalizedV(d)}}if(l!=null)return t(xe(l,32),"invalid yParityAndS"),{v:K(l)[0]&128?28:27};if(f!=null){switch(ee(f,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")})(e.v,e.yParityAndS,e.yParity),c=new Ce(Un,i,s,a);return o&&(c.#n=o),t(e.yParity==null||ee(e.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),t(e.yParityAndS==null||e.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}}class ct{#e;constructor(e){_(zn(e)===32,"invalid private key","privateKey","[REDACTED]"),this.#e=G(e)}get privateKey(){return this.#e}get publicKey(){return ct.computePublicKey(this.#e)}get compressedPublicKey(){return ct.computePublicKey(this.#e,!0)}sign(e){_(zn(e)===32,"invalid digest length","digest",e);const t=ht.sign(Ve(e),Ve(this.#e),{lowS:!0});return Ce.from({r:wr(t.r,32),s:wr(t.s,32),v:t.recovery?28:27})}computeSharedSecret(e){const t=ct.computePublicKey(e);return G(ht.getSharedSecret(Ve(this.#e),K(t),!1))}static computePublicKey(e,t){let n=K(e,"key");if(n.length===32){const s=ht.getPublicKey(n,!!t);return G(s)}if(n.length===64){const s=new Uint8Array(65);s[0]=4,s.set(n,1),n=s}const i=ht.ProjectivePoint.fromHex(n);return G(i.toRawBytes(t))}static recoverPublicKey(e,t){_(zn(e)===32,"invalid digest length","digest",e);const n=Ce.from(t);let i=ht.Signature.fromCompact(Ve(he([n.r,n.s])));i=i.addRecoveryBit(n.yParity);const s=i.recoverPublicKey(Ve(e));return _(s!=null,"invalid signature for digest","signature",t),"0x"+s.toHex(!1)}static addPoints(e,t,n){const i=ht.ProjectivePoint.fromHex(ct.computePublicKey(e).substring(2)),s=ht.ProjectivePoint.fromHex(ct.computePublicKey(t).substring(2));return"0x"+i.add(s).toHex(!!n)}}const Tm=BigInt(0),Pm=BigInt(36);function al(r){r=r.toLowerCase();const e=r.substring(2).split(""),t=new Uint8Array(40);for(let i=0;i<40;i++)t[i]=e[i].charCodeAt(0);const n=K(ie(t));for(let i=0;i<40;i+=2)n[i>>1]>>4>=8&&(e[i]=e[i].toUpperCase()),(n[i>>1]&15)>=8&&(e[i+1]=e[i+1].toUpperCase());return"0x"+e.join("")}const wu={};for(let r=0;r<10;r++)wu[String(r)]=String(r);for(let r=0;r<26;r++)wu[String.fromCharCode(65+r)]=String(10+r);const cl=15;function Nm(r){r=r.toUpperCase(),r=r.substring(4)+r.substring(0,2)+"00";let e=r.split("").map(n=>wu[n]).join("");for(;e.length>=cl;){let n=e.substring(0,cl);e=parseInt(n,10)%97+e.substring(n.length)}let t=String(98-parseInt(e,10)%97);for(;t.length<2;)t="0"+t;return t}const Om=(function(){const r={};for(let e=0;e<36;e++){const t="0123456789abcdefghijklmnopqrstuvwxyz"[e];r[t]=BigInt(e)}return r})();function Um(r){r=r.toLowerCase();let e=Tm;for(let t=0;t<r.length;t++)e=e*Pm+Om[r[t]];return e}function te(r){if(_(typeof r=="string","invalid address","address",r),r.match(/^(0x)?[0-9a-fA-F]{40}$/)){r.startsWith("0x")||(r="0x"+r);const e=al(r);return _(!r.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===r,"bad address checksum","address",r),e}if(r.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){_(r.substring(2,4)===Nm(r),"bad icap checksum","address",r);let e=Um(r.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return al("0x"+e)}_(!1,"invalid address","address",r)}function Rm(r){const e=te(r.from);let n=z(r.nonce,"tx.nonce").toString(16);return n==="0"?n="0x":n.length%2?n="0x0"+n:n="0x"+n,te(be(ie(mr([e,n])),12))}function K0(r){return r&&typeof r.getAddress=="function"}function Bm(r){try{return te(r),!0}catch{}return!1}async function ya(r,e){const t=await e;return(t==null||t==="0x0000000000000000000000000000000000000000")&&(F(typeof r!="string","unconfigured name","UNCONFIGURED_NAME",{value:r}),_(!1,"invalid AddressLike value; did not resolve to a value address","target",r)),te(t)}function $e(r,e){if(typeof r=="string")return r.match(/^0x[0-9a-f]{40}$/i)?te(r):(F(e!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),ya(r,e.resolveName(r)));if(K0(r))return ya(r,r.getAddress());if(r&&typeof r.then=="function")return ya(r,r);_(!1,"unsupported addressable value","target",r)}const or={};function V(r,e){let t=!1;return e<0&&(t=!0,e*=-1),new Ie(or,`${t?"":"u"}int${e}`,r,{signed:t,width:e})}function fe(r,e){return new Ie(or,`bytes${e||""}`,r,{size:e})}const ul=Symbol.for("_ethers_typed");class Ie{type;value;#e;_typedSymbol;constructor(e,t,n,i){i==null&&(i=null),In(or,e,"Typed"),q(this,{_typedSymbol:ul,type:t,value:n}),this.#e=i,this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return this.#e}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return this.#e===!0?-1:this.#e===!1?this.value.length:null}static from(e,t){return new Ie(or,e,t)}static uint8(e){return V(e,8)}static uint16(e){return V(e,16)}static uint24(e){return V(e,24)}static uint32(e){return V(e,32)}static uint40(e){return V(e,40)}static uint48(e){return V(e,48)}static uint56(e){return V(e,56)}static uint64(e){return V(e,64)}static uint72(e){return V(e,72)}static uint80(e){return V(e,80)}static uint88(e){return V(e,88)}static uint96(e){return V(e,96)}static uint104(e){return V(e,104)}static uint112(e){return V(e,112)}static uint120(e){return V(e,120)}static uint128(e){return V(e,128)}static uint136(e){return V(e,136)}static uint144(e){return V(e,144)}static uint152(e){return V(e,152)}static uint160(e){return V(e,160)}static uint168(e){return V(e,168)}static uint176(e){return V(e,176)}static uint184(e){return V(e,184)}static uint192(e){return V(e,192)}static uint200(e){return V(e,200)}static uint208(e){return V(e,208)}static uint216(e){return V(e,216)}static uint224(e){return V(e,224)}static uint232(e){return V(e,232)}static uint240(e){return V(e,240)}static uint248(e){return V(e,248)}static uint256(e){return V(e,256)}static uint(e){return V(e,256)}static int8(e){return V(e,-8)}static int16(e){return V(e,-16)}static int24(e){return V(e,-24)}static int32(e){return V(e,-32)}static int40(e){return V(e,-40)}static int48(e){return V(e,-48)}static int56(e){return V(e,-56)}static int64(e){return V(e,-64)}static int72(e){return V(e,-72)}static int80(e){return V(e,-80)}static int88(e){return V(e,-88)}static int96(e){return V(e,-96)}static int104(e){return V(e,-104)}static int112(e){return V(e,-112)}static int120(e){return V(e,-120)}static int128(e){return V(e,-128)}static int136(e){return V(e,-136)}static int144(e){return V(e,-144)}static int152(e){return V(e,-152)}static int160(e){return V(e,-160)}static int168(e){return V(e,-168)}static int176(e){return V(e,-176)}static int184(e){return V(e,-184)}static int192(e){return V(e,-192)}static int200(e){return V(e,-200)}static int208(e){return V(e,-208)}static int216(e){return V(e,-216)}static int224(e){return V(e,-224)}static int232(e){return V(e,-232)}static int240(e){return V(e,-240)}static int248(e){return V(e,-248)}static int256(e){return V(e,-256)}static int(e){return V(e,-256)}static bytes1(e){return fe(e,1)}static bytes2(e){return fe(e,2)}static bytes3(e){return fe(e,3)}static bytes4(e){return fe(e,4)}static bytes5(e){return fe(e,5)}static bytes6(e){return fe(e,6)}static bytes7(e){return fe(e,7)}static bytes8(e){return fe(e,8)}static bytes9(e){return fe(e,9)}static bytes10(e){return fe(e,10)}static bytes11(e){return fe(e,11)}static bytes12(e){return fe(e,12)}static bytes13(e){return fe(e,13)}static bytes14(e){return fe(e,14)}static bytes15(e){return fe(e,15)}static bytes16(e){return fe(e,16)}static bytes17(e){return fe(e,17)}static bytes18(e){return fe(e,18)}static bytes19(e){return fe(e,19)}static bytes20(e){return fe(e,20)}static bytes21(e){return fe(e,21)}static bytes22(e){return fe(e,22)}static bytes23(e){return fe(e,23)}static bytes24(e){return fe(e,24)}static bytes25(e){return fe(e,25)}static bytes26(e){return fe(e,26)}static bytes27(e){return fe(e,27)}static bytes28(e){return fe(e,28)}static bytes29(e){return fe(e,29)}static bytes30(e){return fe(e,30)}static bytes31(e){return fe(e,31)}static bytes32(e){return fe(e,32)}static address(e){return new Ie(or,"address",e)}static bool(e){return new Ie(or,"bool",!!e)}static bytes(e){return new Ie(or,"bytes",e)}static string(e){return new Ie(or,"string",e)}static array(e,t){throw new Error("not implemented yet")}static tuple(e,t){throw new Error("not implemented yet")}static overrides(e){return new Ie(or,"overrides",Object.assign({},e))}static isTyped(e){return e&&typeof e=="object"&&"_typedSymbol"in e&&e._typedSymbol===ul}static dereference(e,t){if(Ie.isTyped(e)){if(e.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${e.type}`);return e.value}return e}}class _m extends Cr{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){let n=Ie.dereference(t,"string");try{n=te(n)}catch(i){return this._throwError(i.message,t)}return e.writeValue(n)}decode(e){return te(wr(e.readValue(),20))}}class Lm extends Cr{coder;constructor(e){super(e.name,e.type,"_",e.dynamic),this.coder=e}defaultValue(){return this.coder.defaultValue()}encode(e,t){return this.coder.encode(e,t)}decode(e){return this.coder.decode(e)}}function j0(r,e,t){let n=[];if(Array.isArray(t))n=t;else if(t&&typeof t=="object"){let c={};n=e.map(u=>{const l=u.localName;return F(l,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:u},value:t}),F(!c[l],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:u},value:t}),c[l]=!0,t[l]})}else _(!1,"invalid tuple value","tuple",t);_(e.length===n.length,"types/value length mismatch","tuple",t);let i=new bc,s=new bc,o=[];e.forEach((c,u)=>{let l=n[u];if(c.dynamic){let f=s.length;c.encode(s,l);let d=i.writeUpdatableValue();o.push(p=>{d(p+f)})}else c.encode(i,l)}),o.forEach(c=>{c(i.length)});let a=r.appendWriter(i);return a+=r.appendWriter(s),a}function z0(r,e){let t=[],n=[],i=r.subReader(0);return e.forEach(s=>{let o=null;if(s.dynamic){let a=r.readIndex(),c=i.subReader(a);try{o=s.decode(c)}catch(u){if(ze(u,"BUFFER_OVERRUN"))throw u;o=u,o.baseType=s.name,o.name=s.localName,o.type=s.type}}else try{o=s.decode(r)}catch(a){if(ze(a,"BUFFER_OVERRUN"))throw a;o=a,o.baseType=s.name,o.name=s.localName,o.type=s.type}if(o==null)throw new Error("investigate");t.push(o),n.push(s.localName||null)}),lr.fromItems(t,n)}class Dm extends Cr{coder;length;constructor(e,t,n){const i=e.type+"["+(t>=0?t:"")+"]",s=t===-1||e.dynamic;super("array",i,n,s),q(this,{coder:e,length:t})}defaultValue(){const e=this.coder.defaultValue(),t=[];for(let n=0;n<this.length;n++)t.push(e);return t}encode(e,t){const n=Ie.dereference(t,"array");Array.isArray(n)||this._throwError("expected array value",n);let i=this.length;i===-1&&(i=n.length,e.writeValue(n.length)),Ah(n.length,i,"coder array"+(this.localName?" "+this.localName:""));let s=[];for(let o=0;o<n.length;o++)s.push(this.coder);return j0(e,s,n)}decode(e){let t=this.length;t===-1&&(t=e.readIndex(),F(t*rt<=e.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:e.bytes,offset:t*rt,length:e.dataLength}));let n=[];for(let i=0;i<t;i++)n.push(new Lm(this.coder));return z0(e,n)}}class Mm extends Cr{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){const n=Ie.dereference(t,"bool");return e.writeValue(n?1:0)}decode(e){return!!e.readValue()}}class V0 extends Cr{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=Ve(t);let n=e.writeValue(t.length);return n+=e.writeBytes(t),n}decode(e){return e.readBytes(e.readIndex(),!0)}}class $m extends V0{constructor(e){super("bytes",e)}decode(e){return G(super.decode(e))}}class Fm extends Cr{size;constructor(e,t){let n="bytes"+String(e);super(n,n,t,!1),q(this,{size:e},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(e,t){let n=Ve(Ie.dereference(t,this.type));return n.length!==this.size&&this._throwError("incorrect data length",t),e.writeBytes(n)}decode(e){return G(e.readBytes(this.size))}}const Gm=new Uint8Array([]);class Hm extends Cr{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return t!=null&&this._throwError("not null",t),e.writeBytes(Gm)}decode(e){return e.readBytes(0),null}}const Km=BigInt(0),jm=BigInt(1),zm=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class Vm extends Cr{size;signed;constructor(e,t,n){const i=(t?"int":"uint")+e*8;super(i,i,n,!1),q(this,{size:e,signed:t},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(e,t){let n=z(Ie.dereference(t,this.type)),i=Ii(zm,rt*8);if(this.signed){let s=Ii(i,this.size*8-1);(n>s||n<-(s+jm))&&this._throwError("value out-of-bounds",t),n=Ch(n,8*rt)}else(n<Km||n>Ii(i,this.size*8))&&this._throwError("value out-of-bounds",t);return e.writeValue(n)}decode(e){let t=Ii(e.readValue(),this.size*8);return this.signed&&(t=fy(t,this.size*8)),t}}class Wm extends V0{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,de(Ie.dereference(t,"string")))}decode(e){return to(super.decode(e))}}class Es extends Cr{coders;constructor(e,t){let n=!1;const i=[];e.forEach(o=>{o.dynamic&&(n=!0),i.push(o.type)});const s="tuple("+i.join(",")+")";super("tuple",s,t,n),q(this,{coders:Object.freeze(e.slice())})}defaultValue(){const e=[];this.coders.forEach(n=>{e.push(n.defaultValue())});const t=this.coders.reduce((n,i)=>{const s=i.localName;return s&&(n[s]||(n[s]=0),n[s]++),n},{});return this.coders.forEach((n,i)=>{let s=n.localName;!s||t[s]!==1||(s==="length"&&(s="_length"),e[s]==null&&(e[s]=e[i]))}),Object.freeze(e)}encode(e,t){const n=Ie.dereference(t,"tuple");return j0(e,this.coders,n)}decode(e){return z0(e,this.coders)}}function wa(r,e){return{address:te(r),storageKeys:e.map((t,n)=>(_(xe(t,32),"invalid slot",`storageKeys[${n}]`,t),t.toLowerCase()))}}function kn(r){if(Array.isArray(r))return r.map((t,n)=>Array.isArray(t)?(_(t.length===2,"invalid slot set",`value[${n}]`,t),wa(t[0],t[1])):(_(t!=null&&typeof t=="object","invalid address-slot set","value",r),wa(t.address,t.storageKeys)));_(r!=null&&typeof r=="object","invalid access list","value",r);const e=Object.keys(r).map(t=>{const n=r[t].reduce((i,s)=>(i[s]=!0,i),{});return wa(t,Object.keys(n).sort())});return e.sort((t,n)=>t.address.localeCompare(n.address)),e}function W0(r){return{address:te(r.address),nonce:z(r.nonce!=null?r.nonce:0),chainId:z(r.chainId!=null?r.chainId:0),signature:Ce.from(r.signature)}}function is(r){let e;return typeof r=="string"?e=ct.computePublicKey(r,!1):e=r.publicKey,te(ie("0x"+e.substring(4)).substring(26))}function J0(r,e){return is(ct.recoverPublicKey(r,e))}const De=BigInt(0),Jm=BigInt(2),Qm=BigInt(27),qm=BigInt(28),Zm=BigInt(35),Ym=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),ma=4096*32;function Xm(r){return{blobToKzgCommitment:n=>{if("computeBlobProof"in r){if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return K(r.blobToKzgCommitment(G(n)))}else if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return K(r.blobToKzgCommitment(n));if("blobToKZGCommitment"in r&&typeof r.blobToKZGCommitment=="function")return K(r.blobToKZGCommitment(G(n)));_(!1,"unsupported KZG library","kzg",r)},computeBlobKzgProof:(n,i)=>{if("computeBlobProof"in r&&typeof r.computeBlobProof=="function")return K(r.computeBlobProof(G(n),G(i)));if("computeBlobKzgProof"in r&&typeof r.computeBlobKzgProof=="function")return r.computeBlobKzgProof(n,i);if("computeBlobKZGProof"in r&&typeof r.computeBlobKZGProof=="function")return K(r.computeBlobKZGProof(G(n),G(i)));_(!1,"unsupported KZG library","kzg",r)}}}function fl(r,e){let t=r.toString(16);for(;t.length<2;)t="0"+t;return t+=st(e).substring(4),"0x"+t}function xi(r){return r==="0x"?null:te(r)}function _o(r,e){try{return kn(r)}catch(t){_(!1,t.message,e,r)}}function e1(r,e){try{if(!Array.isArray(r))throw new Error("authorizationList: invalid array");const t=[];for(let n=0;n<r.length;n++){const i=r[n];if(!Array.isArray(i))throw new Error(`authorization[${n}]: invalid array`);if(i.length!==6)throw new Error(`authorization[${n}]: wrong length`);if(!i[1])throw new Error(`authorization[${n}]: null address`);t.push({address:xi(i[1]),nonce:ge(i[2],"nonce"),chainId:ge(i[0],"chainId"),signature:Ce.from({yParity:Tn(i[3],"yParity"),r:yr(i[4],32),s:yr(i[5],32)})})}return t}catch(t){_(!1,t.message,e,r)}}function Tn(r,e){return r==="0x"?0:ee(r,e)}function ge(r,e){if(r==="0x")return De;const t=z(r,e);return _(t<=Ym,"value exceeds uint size",e,t),t}function ae(r,e){const t=z(r,"value"),n=ke(t);return _(n.length<=32,"value too large",`tx.${e}`,t),n}function Lo(r){return kn(r).map(e=>[e.address,e.storageKeys])}function t1(r){return r.map(e=>[ae(e.chainId,"chainId"),e.address,ae(e.nonce,"nonce"),ae(e.signature.yParity,"yParity"),ke(e.signature.r),ke(e.signature.s)])}function r1(r,e){_(Array.isArray(r),`invalid ${e}`,"value",r);for(let t=0;t<r.length;t++)_(xe(r[t],32),"invalid ${ param } hash",`value[${t}]`,r[t]);return r}function n1(r){const e=ts(r);_(Array.isArray(e)&&(e.length===9||e.length===6),"invalid field count for legacy transaction","data",r);const t={type:0,nonce:Tn(e[0],"nonce"),gasPrice:ge(e[1],"gasPrice"),gasLimit:ge(e[2],"gasLimit"),to:xi(e[3]),value:ge(e[4],"value"),data:G(e[5]),chainId:De};if(e.length===6)return t;const n=ge(e[6],"v"),i=ge(e[7],"r"),s=ge(e[8],"s");if(i===De&&s===De)t.chainId=n;else{let o=(n-Zm)/Jm;o<De&&(o=De),t.chainId=o,_(o!==De||n===Qm||n===qm,"non-canonical legacy v","v",e[6]),t.signature=Ce.from({r:yr(e[7],32),s:yr(e[8],32),v:n})}return t}function i1(r,e){const t=[ae(r.nonce,"nonce"),ae(r.gasPrice||0,"gasPrice"),ae(r.gasLimit,"gasLimit"),r.to||"0x",ae(r.value,"value"),r.data];let n=De;if(r.chainId!=De)n=z(r.chainId,"tx.chainId"),_(!e||e.networkV==null||e.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",e);else if(r.signature){const s=r.signature.legacyChainId;s!=null&&(n=s)}if(!e)return n!==De&&(t.push(ke(n)),t.push("0x"),t.push("0x")),mr(t);let i=BigInt(27+e.yParity);return n!==De?i=Ce.getChainIdV(n,e.v):BigInt(e.v)!==i&&_(!1,"tx.chainId/sig.v mismatch","sig",e),t.push(ke(i)),t.push(ke(e.r)),t.push(ke(e.s)),mr(t)}function Do(r,e){let t;try{if(t=Tn(e[0],"yParity"),t!==0&&t!==1)throw new Error("bad yParity")}catch{_(!1,"invalid yParity","yParity",e[0])}const n=yr(e[1],32),i=yr(e[2],32),s=Ce.from({r:n,s:i,yParity:t});r.signature=s}function s1(r){const e=ts(K(r).slice(1));_(Array.isArray(e)&&(e.length===9||e.length===12),"invalid field count for transaction type: 2","data",G(r));const t={type:2,chainId:ge(e[0],"chainId"),nonce:Tn(e[1],"nonce"),maxPriorityFeePerGas:ge(e[2],"maxPriorityFeePerGas"),maxFeePerGas:ge(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:ge(e[4],"gasLimit"),to:xi(e[5]),value:ge(e[6],"value"),data:G(e[7]),accessList:_o(e[8],"accessList")};return e.length===9||Do(t,e.slice(9)),t}function o1(r,e){const t=[ae(r.chainId,"chainId"),ae(r.nonce,"nonce"),ae(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ae(r.maxFeePerGas||0,"maxFeePerGas"),ae(r.gasLimit,"gasLimit"),r.to||"0x",ae(r.value,"value"),r.data,Lo(r.accessList||[])];return e&&(t.push(ae(e.yParity,"yParity")),t.push(ke(e.r)),t.push(ke(e.s))),he(["0x02",mr(t)])}function a1(r){const e=ts(K(r).slice(1));_(Array.isArray(e)&&(e.length===8||e.length===11),"invalid field count for transaction type: 1","data",G(r));const t={type:1,chainId:ge(e[0],"chainId"),nonce:Tn(e[1],"nonce"),gasPrice:ge(e[2],"gasPrice"),gasLimit:ge(e[3],"gasLimit"),to:xi(e[4]),value:ge(e[5],"value"),data:G(e[6]),accessList:_o(e[7],"accessList")};return e.length===8||Do(t,e.slice(8)),t}function c1(r,e){const t=[ae(r.chainId,"chainId"),ae(r.nonce,"nonce"),ae(r.gasPrice||0,"gasPrice"),ae(r.gasLimit,"gasLimit"),r.to||"0x",ae(r.value,"value"),r.data,Lo(r.accessList||[])];return e&&(t.push(ae(e.yParity,"recoveryParam")),t.push(ke(e.r)),t.push(ke(e.s))),he(["0x01",mr(t)])}function u1(r){let e=ts(K(r).slice(1)),t="3",n=null;if(e.length===4&&Array.isArray(e[0])){t="3 (network format)";const s=e[1],o=e[2],a=e[3];_(Array.isArray(s),"invalid network format: blobs not an array","fields[1]",s),_(Array.isArray(o),"invalid network format: commitments not an array","fields[2]",o),_(Array.isArray(a),"invalid network format: proofs not an array","fields[3]",a),_(s.length===o.length,"invalid network format: blobs/commitments length mismatch","fields",e),_(s.length===a.length,"invalid network format: blobs/proofs length mismatch","fields",e),n=[];for(let c=0;c<e[1].length;c++)n.push({data:s[c],commitment:o[c],proof:a[c]});e=e[0]}_(Array.isArray(e)&&(e.length===11||e.length===14),`invalid field count for transaction type: ${t}`,"data",G(r));const i={type:3,chainId:ge(e[0],"chainId"),nonce:Tn(e[1],"nonce"),maxPriorityFeePerGas:ge(e[2],"maxPriorityFeePerGas"),maxFeePerGas:ge(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:ge(e[4],"gasLimit"),to:xi(e[5]),value:ge(e[6],"value"),data:G(e[7]),accessList:_o(e[8],"accessList"),maxFeePerBlobGas:ge(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};n&&(i.blobs=n),_(i.to!=null,`invalid address for transaction type: ${t}`,"data",r),_(Array.isArray(i.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",r);for(let s=0;s<i.blobVersionedHashes.length;s++)_(xe(i.blobVersionedHashes[s],32),`invalid blobVersionedHash at index ${s}: must be length 32`,"data",r);return e.length===11||Do(i,e.slice(11)),i}function f1(r,e,t){const n=[ae(r.chainId,"chainId"),ae(r.nonce,"nonce"),ae(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ae(r.maxFeePerGas||0,"maxFeePerGas"),ae(r.gasLimit,"gasLimit"),r.to||Gi,ae(r.value,"value"),r.data,Lo(r.accessList||[]),ae(r.maxFeePerBlobGas||0,"maxFeePerBlobGas"),r1(r.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(n.push(ae(e.yParity,"yParity")),n.push(ke(e.r)),n.push(ke(e.s)),t)?he(["0x03",mr([n,t.map(i=>i.data),t.map(i=>i.commitment),t.map(i=>i.proof)])]):he(["0x03",mr(n)])}function l1(r){const e=ts(K(r).slice(1));_(Array.isArray(e)&&(e.length===10||e.length===13),"invalid field count for transaction type: 4","data",G(r));const t={type:4,chainId:ge(e[0],"chainId"),nonce:Tn(e[1],"nonce"),maxPriorityFeePerGas:ge(e[2],"maxPriorityFeePerGas"),maxFeePerGas:ge(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:ge(e[4],"gasLimit"),to:xi(e[5]),value:ge(e[6],"value"),data:G(e[7]),accessList:_o(e[8],"accessList"),authorizationList:e1(e[9],"authorizationList")};return e.length===10||Do(t,e.slice(10)),t}function d1(r,e){const t=[ae(r.chainId,"chainId"),ae(r.nonce,"nonce"),ae(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ae(r.maxFeePerGas||0,"maxFeePerGas"),ae(r.gasLimit,"gasLimit"),r.to||"0x",ae(r.value,"value"),r.data,Lo(r.accessList||[]),t1(r.authorizationList||[])];return e&&(t.push(ae(e.yParity,"yParity")),t.push(ke(e.r)),t.push(ke(e.s))),he(["0x04",mr(t)])}class Ct{#e;#t;#r;#n;#i;#o;#s;#a;#h;#u;#g;#p;#c;#f;#l;#d;#b;get type(){return this.#e}set type(e){switch(e){case null:this.#e=null;break;case 0:case"legacy":this.#e=0;break;case 1:case"berlin":case"eip-2930":this.#e=1;break;case 2:case"london":case"eip-1559":this.#e=2;break;case 3:case"cancun":case"eip-4844":this.#e=3;break;case 4:case"pectra":case"eip-7702":this.#e=4;break;default:_(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const e=this.#t;return e==null&&this.type===3?Gi:e}set to(e){this.#t=e==null?null:te(e)}get nonce(){return this.#n}set nonce(e){this.#n=ee(e,"value")}get gasLimit(){return this.#i}set gasLimit(e){this.#i=z(e)}get gasPrice(){const e=this.#o;return e==null&&(this.type===0||this.type===1)?De:e}set gasPrice(e){this.#o=e==null?null:z(e,"gasPrice")}get maxPriorityFeePerGas(){const e=this.#s;return e??(this.type===2||this.type===3?De:null)}set maxPriorityFeePerGas(e){this.#s=e==null?null:z(e,"maxPriorityFeePerGas")}get maxFeePerGas(){const e=this.#a;return e??(this.type===2||this.type===3?De:null)}set maxFeePerGas(e){this.#a=e==null?null:z(e,"maxFeePerGas")}get data(){return this.#r}set data(e){this.#r=G(e)}get value(){return this.#h}set value(e){this.#h=z(e,"value")}get chainId(){return this.#u}set chainId(e){this.#u=z(e)}get signature(){return this.#g||null}set signature(e){this.#g=e==null?null:Ce.from(e)}get accessList(){const e=this.#p||null;return e??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(e){this.#p=e==null?null:kn(e)}get authorizationList(){const e=this.#b||null;return e==null&&this.type===4?[]:e}set authorizationList(e){this.#b=e==null?null:e.map(t=>W0(t))}get maxFeePerBlobGas(){const e=this.#c;return e==null&&this.type===3?De:e}set maxFeePerBlobGas(e){this.#c=e==null?null:z(e,"maxFeePerBlobGas")}get blobVersionedHashes(){let e=this.#f;return e==null&&this.type===3?[]:e}set blobVersionedHashes(e){if(e!=null){_(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let t=0;t<e.length;t++)_(xe(e[t],32),"invalid blobVersionedHash",`value[${t}]`,e[t])}this.#f=e}get blobs(){return this.#d==null?null:this.#d.map(e=>Object.assign({},e))}set blobs(e){if(e==null){this.#d=null;return}const t=[],n=[];for(let i=0;i<e.length;i++){const s=e[i];if(Io(s)){F(this.#l,"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let o=K(s);if(_(o.length<=ma,"blob is too large",`blobs[${i}]`,s),o.length!==ma){const u=new Uint8Array(ma);u.set(o),o=u}const a=this.#l.blobToKzgCommitment(o),c=G(this.#l.computeBlobKzgProof(o,a));t.push({data:G(o),commitment:G(a),proof:c}),n.push(fl(1,a))}else{const o=G(s.commitment);t.push({data:G(s.data),commitment:o,proof:G(s.proof)}),n.push(fl(1,o))}}this.#d=t,this.#f=n}get kzg(){return this.#l}set kzg(e){e==null?this.#l=null:this.#l=Xm(e)}constructor(){this.#e=null,this.#t=null,this.#n=0,this.#i=De,this.#o=null,this.#s=null,this.#a=null,this.#r="0x",this.#h=De,this.#u=De,this.#g=null,this.#p=null,this.#c=null,this.#f=null,this.#l=null,this.#d=null,this.#b=null}get hash(){return this.signature==null?null:ie(this.#x(!0,!1))}get unsignedHash(){return ie(this.unsignedSerialized)}get from(){return this.signature==null?null:J0(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:ct.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}#x(e,t){F(!e||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const n=e?this.signature:null;switch(this.inferType()){case 0:return i1(this,n);case 1:return c1(this,n);case 2:return o1(this,n);case 3:return f1(this,n,t?this.blobs:null);case 4:return d1(this,n)}F(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}get serialized(){return this.#x(!0,!0)}get unsignedSerialized(){return this.#x(!1,!1)}inferType(){const e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){const e=this.gasPrice!=null,t=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,n=this.accessList!=null,i=this.#c!=null||this.#f;this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&F(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),F(!t||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),F(this.type!==0||!n,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const s=[];return this.type!=null?s.push(this.type):this.authorizationList&&this.authorizationList.length?s.push(4):t?s.push(2):e?(s.push(1),n||s.push(0)):n?(s.push(1),s.push(2)):(i&&this.to||(s.push(0),s.push(1),s.push(2)),s.push(3)),s.sort(),s}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return Ct.from(this)}toJSON(){const e=t=>t==null?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(e){if(e==null)return new Ct;if(typeof e=="string"){const n=K(e);if(n[0]>=127)return Ct.from(n1(n));switch(n[0]){case 1:return Ct.from(a1(n));case 2:return Ct.from(s1(n));case 3:return Ct.from(u1(n));case 4:return Ct.from(l1(n))}F(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new Ct;return e.type!=null&&(t.type=e.type),e.to!=null&&(t.to=e.to),e.nonce!=null&&(t.nonce=e.nonce),e.gasLimit!=null&&(t.gasLimit=e.gasLimit),e.gasPrice!=null&&(t.gasPrice=e.gasPrice),e.maxPriorityFeePerGas!=null&&(t.maxPriorityFeePerGas=e.maxPriorityFeePerGas),e.maxFeePerGas!=null&&(t.maxFeePerGas=e.maxFeePerGas),e.maxFeePerBlobGas!=null&&(t.maxFeePerBlobGas=e.maxFeePerBlobGas),e.data!=null&&(t.data=e.data),e.value!=null&&(t.value=e.value),e.chainId!=null&&(t.chainId=e.chainId),e.signature!=null&&(t.signature=Ce.from(e.signature)),e.accessList!=null&&(t.accessList=e.accessList),e.authorizationList!=null&&(t.authorizationList=e.authorizationList),e.blobVersionedHashes!=null&&(t.blobVersionedHashes=e.blobVersionedHashes),e.kzg!=null&&(t.kzg=e.kzg),e.blobs!=null&&(t.blobs=e.blobs),e.hash!=null&&(_(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),_(t.hash===e.hash,"hash mismatch","tx",e)),e.from!=null&&(_(t.isSigned(),"unsigned transaction cannot define '.from'","tx",e),_(t.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),t}}function h1(r){return _(typeof r.address=="string","invalid address for hashAuthorization","auth.address",r),ie(he(["0x05",mr([r.chainId!=null?ke(r.chainId):"0x",te(r.address),r.nonce!=null?ke(r.nonce):"0x"])]))}function Ar(r){return ie(de(r))}var g1="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const ll=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),dl=4;function p1(r){let e=0;function t(){return r[e++]<<8|r[e++]}let n=t(),i=1,s=[0,1];for(let v=1;v<n;v++)s.push(i+=t());let o=t(),a=e;e+=o;let c=0,u=0;function l(){return c==0&&(u=u<<8|r[e++],c=8),u>>--c&1}const f=31,d=2**f,p=d>>>1,h=p>>1,x=d-1;let b=0;for(let v=0;v<f;v++)b=b<<1|l();let w=[],m=0,g=d;for(;;){let v=Math.floor(((b-m+1)*i-1)/g),T=0,P=n;for(;P-T>1;){let N=T+P>>>1;v<s[N]?P=N:T=N}if(T==0)break;w.push(T);let I=m+Math.floor(g*s[T]/i),S=m+Math.floor(g*s[T+1]/i)-1;for(;((I^S)&p)==0;)b=b<<1&x|l(),I=I<<1&x,S=S<<1&x|1;for(;I&~S&h;)b=b&p|b<<1&x>>>1|l(),I=I<<1^p,S=(S^p)<<1|p|1;m=I,g=1+S-I}let A=n-4;return w.map(v=>{switch(v-A){case 3:return A+65792+(r[a++]<<16|r[a++]<<8|r[a++]);case 2:return A+256+(r[a++]<<8|r[a++]);case 1:return A+r[a++];default:return v-1}})}function x1(r){let e=0;return()=>r[e++]}function Q0(r){return x1(p1(b1(r)))}function b1(r){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((i,s)=>e[i.charCodeAt(0)]=s);let t=r.length,n=new Uint8Array(6*t>>3);for(let i=0,s=0,o=0,a=0;i<t;i++)a=a<<6|e[r.charCodeAt(i)],o+=6,o>=8&&(n[s++]=a>>(o-=8));return n}function y1(r){return r&1?~r>>1:r>>1}function w1(r,e){let t=Array(r);for(let n=0,i=0;n<r;n++)t[n]=i+=y1(e());return t}function Hi(r,e=0){let t=[];for(;;){let n=r(),i=r();if(!i)break;e+=n;for(let s=0;s<i;s++)t.push(e+s);e+=i+1}return t}function q0(r){return Ki(()=>{let e=Hi(r);if(e.length)return e})}function Z0(r){let e=[];for(;;){let t=r();if(t==0)break;e.push(m1(t,r))}for(;;){let t=r()-1;if(t<0)break;e.push(A1(t,r))}return e.flat()}function Ki(r){let e=[];for(;;){let t=r(e.length);if(!t)break;e.push(t)}return e}function Y0(r,e,t){let n=Array(r).fill().map(()=>[]);for(let i=0;i<e;i++)w1(r,t).forEach((s,o)=>n[o].push(s));return n}function m1(r,e){let t=1+e(),n=e(),i=Ki(e);return Y0(i.length,1+r,e).flatMap((o,a)=>{let[c,...u]=o;return Array(i[a]).fill().map((l,f)=>{let d=f*n;return[c+f*t,u.map(p=>p+d)]})})}function A1(r,e){let t=1+e();return Y0(t,1+r,e).map(i=>[i[0],i.slice(1)])}function v1(r){let e=[],t=Hi(r);return i(n([]),[]),e;function n(s){let o=r(),a=Ki(()=>{let c=Hi(r).map(u=>t[u]);if(c.length)return n(c)});return{S:o,B:a,Q:s}}function i({S:s,B:o},a,c){if(!(s&4&&c===a[a.length-1])){s&2&&(c=a[a.length-1]),s&1&&e.push(a);for(let u of o)for(let l of u.Q)i(u,[...a,l],c)}}}function E1(r){return r.toString(16).toUpperCase().padStart(2,"0")}function X0(r){return`{${E1(r)}}`}function S1(r){let e=[];for(let t=0,n=r.length;t<n;){let i=r.codePointAt(t);t+=i<65536?1:2,e.push(i)}return e}function ni(r){let t=r.length;if(t<4096)return String.fromCodePoint(...r);let n=[];for(let i=0;i<t;)n.push(String.fromCodePoint(...r.slice(i,i+=4096)));return n.join("")}function C1(r,e){let t=r.length,n=t-e.length;for(let i=0;n==0&&i<t;i++)n=r[i]-e[i];return n}var I1="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const ji=44032,oo=4352,ao=4449,co=4519,eg=19,tg=21,ii=28,uo=tg*ii,k1=eg*uo,T1=ji+k1,P1=oo+eg,N1=ao+tg,O1=co+ii;function ki(r){return r>>24&255}function rg(r){return r&16777215}let Cc,hl,Ic,Ks;function U1(){let r=Q0(I1);Cc=new Map(q0(r).flatMap((e,t)=>e.map(n=>[n,t+1<<24]))),hl=new Set(Hi(r)),Ic=new Map,Ks=new Map;for(let[e,t]of Z0(r)){if(!hl.has(e)&&t.length==2){let[n,i]=t,s=Ks.get(n);s||(s=new Map,Ks.set(n,s)),s.set(i,e)}Ic.set(e,t.reverse())}}function ng(r){return r>=ji&&r<T1}function R1(r,e){if(r>=oo&&r<P1&&e>=ao&&e<N1)return ji+(r-oo)*uo+(e-ao)*ii;if(ng(r)&&e>co&&e<O1&&(r-ji)%ii==0)return r+(e-co);{let t=Ks.get(r);return t&&(t=t.get(e),t)?t:-1}}function ig(r){Cc||U1();let e=[],t=[],n=!1;function i(s){let o=Cc.get(s);o&&(n=!0,s|=o),e.push(s)}for(let s of r)for(;;){if(s<128)e.push(s);else if(ng(s)){let o=s-ji,a=o/uo|0,c=o%uo/ii|0,u=o%ii;i(oo+a),i(ao+c),u>0&&i(co+u)}else{let o=Ic.get(s);o?t.push(...o):i(s)}if(!t.length)break;s=t.pop()}if(n&&e.length>1){let s=ki(e[0]);for(let o=1;o<e.length;o++){let a=ki(e[o]);if(a==0||s<=a){s=a;continue}let c=o-1;for(;;){let u=e[c+1];if(e[c+1]=e[c],e[c]=u,!c||(s=ki(e[--c]),s<=a))break}s=ki(e[o])}}return e}function B1(r){let e=[],t=[],n=-1,i=0;for(let s of r){let o=ki(s),a=rg(s);if(n==-1)o==0?n=a:e.push(a);else if(i>0&&i>=o)o==0?(e.push(n,...t),t.length=0,n=a):t.push(a),i=o;else{let c=R1(n,a);c>=0?n=c:i==0&&o==0?(e.push(n),n=a):(t.push(a),i=o)}}return n>=0&&e.push(n,...t),e}function sg(r){return ig(r).map(rg)}function _1(r){return B1(ig(r))}const gl=45,og=".",ag=65039,cg=1,fo=r=>Array.from(r);function zi(r,e){return r.P.has(e)||r.Q.has(e)}class L1 extends Array{get is_emoji(){return!0}}let kc,ug,ln,Tc,fg,Wn,Aa,Fn,nn,pl,Pc;function mu(){if(kc)return;let r=Q0(g1);const e=()=>Hi(r),t=()=>new Set(e()),n=(l,f)=>f.forEach(d=>l.add(d));kc=new Map(Z0(r)),ug=t(),ln=e(),Tc=new Set(e().map(l=>ln[l])),ln=new Set(ln),fg=t(),t();let i=q0(r),s=r();const o=()=>{let l=new Set;return e().forEach(f=>n(l,i[f])),n(l,e()),l};Wn=Ki(l=>{let f=Ki(r).map(d=>d+96);if(f.length){let d=l>=s;f[0]-=32,f=ni(f),d&&(f=`Restricted[${f}]`);let p=o(),h=o(),x=!r();return{N:f,P:p,Q:h,M:x,R:d}}}),Aa=t(),Fn=new Map;let a=e().concat(fo(Aa)).sort((l,f)=>l-f);a.forEach((l,f)=>{let d=r(),p=a[f]=d?a[f-d]:{V:[],M:new Map};p.V.push(l),Aa.has(l)||Fn.set(l,p)});for(let{V:l,M:f}of new Set(Fn.values())){let d=[];for(let h of l){let x=Wn.filter(w=>zi(w,h)),b=d.find(({G:w})=>x.some(m=>w.has(m)));b||(b={G:new Set,V:[]},d.push(b)),b.V.push(h),n(b.G,x)}let p=d.flatMap(h=>fo(h.G));for(let{G:h,V:x}of d){let b=new Set(p.filter(w=>!h.has(w)));for(let w of x)f.set(w,b)}}nn=new Set;let c=new Set;const u=l=>nn.has(l)?c.add(l):nn.add(l);for(let l of Wn){for(let f of l.P)u(f);for(let f of l.Q)u(f)}for(let l of nn)!Fn.has(l)&&!c.has(l)&&Fn.set(l,cg);n(nn,sg(nn)),pl=v1(r).map(l=>L1.from(l)).sort(C1),Pc=new Map;for(let l of pl){let f=[Pc];for(let d of l){let p=f.map(h=>{let x=h.get(d);return x||(x=new Map,h.set(d,x)),x});d===ag?f.push(...p):f=p}for(let d of f)d.V=l}}function Au(r){return(lg(r)?"":`${vu(Mo([r]))} `)+X0(r)}function vu(r){return`"${r}"‎`}function D1(r){if(r.length>=4&&r[2]==gl&&r[3]==gl)throw new Error(`invalid label extension: "${ni(r.slice(0,4))}"`)}function M1(r){for(let t=r.lastIndexOf(95);t>0;)if(r[--t]!==95)throw new Error("underscore allowed only at start")}function $1(r){let e=r[0],t=ll.get(e);if(t)throw Bi(`leading ${t}`);let n=r.length,i=-1;for(let s=1;s<n;s++){e=r[s];let o=ll.get(e);if(o){if(i==s)throw Bi(`${t} + ${o}`);i=s+1,t=o}}if(i==n)throw Bi(`trailing ${t}`)}function Mo(r,e=1/0,t=X0){let n=[];F1(r[0])&&n.push("◌"),r.length>e&&(e>>=1,r=[...r.slice(0,e),8230,...r.slice(-e)]);let i=0,s=r.length;for(let o=0;o<s;o++){let a=r[o];lg(a)&&(n.push(ni(r.slice(i,o))),n.push(t(a)),i=o+1)}return n.push(ni(r.slice(i,s))),n.join("")}function F1(r){return mu(),ln.has(r)}function lg(r){return mu(),fg.has(r)}function G1(r){return z1(H1(r,_1,J1))}function H1(r,e,t){if(!r)return[];mu();let n=0;return r.split(og).map(i=>{let s=S1(i),o={input:s,offset:n};n+=s.length+1;try{let a=o.tokens=W1(s,e,t),c=a.length,u;if(!c)throw new Error("empty label");let l=o.output=a.flat();if(M1(l),!(o.emoji=c>1||a[0].is_emoji)&&l.every(d=>d<128))D1(l),u="ASCII";else{let d=a.flatMap(p=>p.is_emoji?[]:p);if(!d.length)u="Emoji";else{if(ln.has(l[0]))throw Bi("leading combining mark");for(let x=1;x<c;x++){let b=a[x];if(!b.is_emoji&&ln.has(b[0]))throw Bi(`emoji + combining mark: "${ni(a[x-1])} + ${Mo([b[0]])}"`)}$1(l);let p=fo(new Set(d)),[h]=j1(p);V1(h,d),K1(h,p),u=h.N}}o.type=u}catch(a){o.error=a}return o})}function K1(r,e){let t,n=[];for(let i of e){let s=Fn.get(i);if(s===cg)return;if(s){let o=s.M.get(i);if(t=t?t.filter(a=>o.has(a)):fo(o),!t.length)return}else n.push(i)}if(t){for(let i of t)if(n.every(s=>zi(i,s)))throw new Error(`whole-script confusable: ${r.N}/${i.N}`)}}function j1(r){let e=Wn;for(let t of r){let n=e.filter(i=>zi(i,t));if(!n.length)throw Wn.some(i=>zi(i,t))?hg(e[0],t):dg(t);if(e=n,n.length==1)break}return e}function z1(r){return r.map(({input:e,error:t,output:n})=>{if(t){let i=t.message;throw new Error(r.length==1?i:`Invalid label ${vu(Mo(e,63))}: ${i}`)}return ni(n)}).join(og)}function dg(r){return new Error(`disallowed character: ${Au(r)}`)}function hg(r,e){let t=Au(e),n=Wn.find(i=>i.P.has(e));return n&&(t=`${n.N} ${t}`),new Error(`illegal mixture: ${r.N} + ${t}`)}function Bi(r){return new Error(`illegal placement: ${r}`)}function V1(r,e){for(let t of e)if(!zi(r,t))throw hg(r,t);if(r.M){let t=sg(e);for(let n=1,i=t.length;n<i;n++)if(Tc.has(t[n])){let s=n+1;for(let o;s<i&&Tc.has(o=t[s]);s++)for(let a=n;a<s;a++)if(t[a]==o)throw new Error(`duplicate non-spacing marks: ${Au(o)}`);if(s-n>dl)throw new Error(`excessive non-spacing marks: ${vu(Mo(t.slice(n-1,s)))} (${s-n}/${dl})`);n=s}}}function W1(r,e,t){let n=[],i=[];for(r=r.slice().reverse();r.length;){let s=Q1(r);if(s)i.length&&(n.push(e(i)),i=[]),n.push(t(s));else{let o=r.pop();if(nn.has(o))i.push(o);else{let a=kc.get(o);if(a)i.push(...a);else if(!ug.has(o))throw dg(o)}}}return i.length&&n.push(e(i)),n}function J1(r){return r.filter(e=>e!=ag)}function Q1(r,e){let t=Pc,n,i=r.length;for(;i&&(t=t.get(r[--i]),!!t);){let{V:s}=t;s&&(n=s,r.length=i)}return n}const gg=new Uint8Array(32);gg.fill(0);function xl(r){return _(r.length!==0,"invalid ENS name; empty component","comp",r),r}function pg(r){const e=de(q1(r)),t=[];if(r.length===0)return t;let n=0;for(let i=0;i<e.length;i++)e[i]===46&&(t.push(xl(e.slice(n,i))),n=i+1);return _(n<e.length,"invalid ENS name; empty component","name",r),t.push(xl(e.slice(n))),t}function q1(r){try{if(r.length===0)throw new Error("empty label");return G1(r)}catch(e){_(!1,`invalid ENS name (${e.message})`,"name",r)}}function Nc(r){_(typeof r=="string","invalid ENS name; not a string","name",r),_(r.length,"invalid ENS name (empty label)","name",r);let e=gg;const t=pg(r);for(;t.length;)e=ie(he([e,ie(t.pop())]));return G(e)}function Z1(r,e){const t=e;return _(t<=255,"DNS encoded label cannot exceed 255","length",t),G(he(pg(r).map(n=>{_(n.length<=t,`label ${JSON.stringify(r)} exceeds ${t} bytes`,"name",r);const i=new Uint8Array(n.length+1);return i.set(n,1),i[0]=i.length-1,i})))+"00"}function xg(r){return typeof r=="string"&&(r=de(r)),ie(he([de(km),de(String(r.length)),r]))}function Y1(r,e){const t=xg(r);return J0(t,e)}const bg=new Uint8Array(32);bg.fill(0);const X1=BigInt(-1),yg=BigInt(0),wg=BigInt(1),e2=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function t2(r){const e=K(r),t=e.length%32;return t?he([e,bg.slice(t)]):G(e)}const r2=wr(wg,32),n2=wr(yg,32),bl={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},va=["name","version","chainId","verifyingContract","salt"];function yl(r){return function(e){return _(typeof e=="string",`invalid domain value for ${JSON.stringify(r)}`,`domain.${r}`,e),e}}const i2={name:yl("name"),version:yl("version"),chainId:function(r){const e=z(r,"domain.chainId");return _(e>=0,"invalid chain ID","domain.chainId",r),Number.isSafeInteger(e)?Number(e):Rt(e)},verifyingContract:function(r){try{return te(r).toLowerCase()}catch{}_(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",r)},salt:function(r){const e=K(r,"domain.salt");return _(e.length===32,'invalid domain value "salt"',"domain.salt",r),G(e)}};function Ea(r){{const e=r.match(/^(u?)int(\d+)$/);if(e){const t=e[1]==="",n=parseInt(e[2]);_(n%8===0&&n!==0&&n<=256&&e[2]===String(n),"invalid numeric width","type",r);const i=Ii(e2,t?n-1:n),s=t?(i+wg)*X1:yg;return function(o){const a=z(o,"value");return _(a>=s&&a<=i,`value out-of-bounds for ${r}`,"value",a),wr(t?Ch(a,256):a,32)}}}{const e=r.match(/^bytes(\d+)$/);if(e){const t=parseInt(e[1]);return _(t!==0&&t<=32&&e[1]===String(t),"invalid bytes width","type",r),function(n){const i=K(n);return _(i.length===t,`invalid length for ${r}`,"value",n),t2(n)}}}switch(r){case"address":return function(e){return yr(te(e),32)};case"bool":return function(e){return e?r2:n2};case"bytes":return function(e){return ie(e)};case"string":return function(e){return Ar(e)}}return null}function wl(r,e){return`${r}(${e.map(({name:t,type:n})=>n+" "+t).join(",")})`}function Ss(r){const e=r.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:r}}class tt{primaryType;#e;get types(){return JSON.parse(this.#e)}#t;#r;constructor(e){this.#t=new Map,this.#r=new Map;const t=new Map,n=new Map,i=new Map,s={};Object.keys(e).forEach(c=>{s[c]=e[c].map(({name:u,type:l})=>{let{base:f,index:d}=Ss(l);return f==="int"&&!e.int&&(f="int256"),f==="uint"&&!e.uint&&(f="uint256"),{name:u,type:f+(d||"")}}),t.set(c,new Set),n.set(c,[]),i.set(c,new Set)}),this.#e=JSON.stringify(s);for(const c in s){const u=new Set;for(const l of s[c]){_(!u.has(l.name),`duplicate variable name ${JSON.stringify(l.name)} in ${JSON.stringify(c)}`,"types",e),u.add(l.name);const f=Ss(l.type).base;_(f!==c,`circular type reference to ${JSON.stringify(f)}`,"types",e),!Ea(f)&&(_(n.has(f),`unknown type ${JSON.stringify(f)}`,"types",e),n.get(f).push(c),t.get(c).add(f))}}const o=Array.from(n.keys()).filter(c=>n.get(c).length===0);_(o.length!==0,"missing primary type","types",e),_(o.length===1,`ambiguous primary types or unused types: ${o.map(c=>JSON.stringify(c)).join(", ")}`,"types",e),q(this,{primaryType:o[0]});function a(c,u){_(!u.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",e),u.add(c);for(const l of t.get(c))if(n.has(l)){a(l,u);for(const f of u)i.get(f).add(l)}u.delete(c)}a(this.primaryType,new Set);for(const[c,u]of i){const l=Array.from(u);l.sort(),this.#t.set(c,wl(c,s[c])+l.map(f=>wl(f,s[f])).join(""))}}getEncoder(e){let t=this.#r.get(e);return t||(t=this.#n(e),this.#r.set(e,t)),t}#n(e){{const i=Ea(e);if(i)return i}const t=Ss(e).array;if(t){const i=t.prefix,s=this.getEncoder(i);return o=>{_(t.count===-1||t.count===o.length,`array length mismatch; expected length ${t.count}`,"value",o);let a=o.map(s);return this.#t.has(i)&&(a=a.map(ie)),ie(he(a))}}const n=this.types[e];if(n){const i=Ar(this.#t.get(e));return s=>{const o=n.map(({name:a,type:c})=>{const u=this.getEncoder(c)(s[a]);return this.#t.has(c)?ie(u):u});return o.unshift(i),he(o)}}_(!1,`unknown type: ${e}`,"type",e)}encodeType(e){const t=this.#t.get(e);return _(t,`unknown type: ${JSON.stringify(e)}`,"name",e),t}encodeData(e,t){return this.getEncoder(e)(t)}hashStruct(e,t){return ie(this.encodeData(e,t))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,t,n){if(Ea(e))return n(e,t);const i=Ss(e).array;if(i)return _(i.count===-1||i.count===t.length,`array length mismatch; expected length ${i.count}`,"value",t),t.map(o=>this._visit(i.prefix,o,n));const s=this.types[e];if(s)return s.reduce((o,{name:a,type:c})=>(o[a]=this._visit(c,t[a],n),o),{});_(!1,`unknown type: ${e}`,"type",e)}visit(e,t){return this._visit(this.primaryType,e,t)}static from(e){return new tt(e)}static getPrimaryType(e){return tt.from(e).primaryType}static hashStruct(e,t,n){return tt.from(t).hashStruct(e,n)}static hashDomain(e){const t=[];for(const n in e){if(e[n]==null)continue;const i=bl[n];_(i,`invalid typed-data domain key: ${JSON.stringify(n)}`,"domain",e),t.push({name:n,type:i})}return t.sort((n,i)=>va.indexOf(n.name)-va.indexOf(i.name)),tt.hashStruct("EIP712Domain",{EIP712Domain:t},e)}static encode(e,t,n){return he(["0x1901",tt.hashDomain(e),tt.from(t).hash(n)])}static hash(e,t,n){return ie(tt.encode(e,t,n))}static async resolveNames(e,t,n,i){e=Object.assign({},e);for(const a in e)e[a]==null&&delete e[a];const s={};e.verifyingContract&&!xe(e.verifyingContract,20)&&(s[e.verifyingContract]="0x");const o=tt.from(t);o.visit(n,(a,c)=>(a==="address"&&!xe(c,20)&&(s[c]="0x"),c));for(const a in s)s[a]=await i(a);return e.verifyingContract&&s[e.verifyingContract]&&(e.verifyingContract=s[e.verifyingContract]),n=o.visit(n,(a,c)=>a==="address"&&s[c]?s[c]:c),{domain:e,value:n}}static getPayload(e,t,n){tt.hashDomain(e);const i={},s=[];va.forEach(c=>{const u=e[c];u!=null&&(i[c]=i2[c](u),s.push({name:c,type:bl[c]}))});const o=tt.from(t);t=o.types;const a=Object.assign({},t);return _(a.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",t),a.EIP712Domain=s,o.encode(n),{types:a,domain:i,primaryType:o.primaryType,message:o.visit(n,(c,u)=>{if(c.match(/^bytes(\d*)/))return G(K(u));if(c.match(/^u?int/))return z(u).toString();switch(c){case"address":return u.toLowerCase();case"bool":return!!u;case"string":return _(typeof u=="string","invalid string","value",u),u}_(!1,"unsupported type","type",c)})}}}function nt(r){const e=new Set;return r.forEach(t=>e.add(t)),Object.freeze(e)}const s2="external public payable override",o2=nt(s2.split(" ")),mg="constant external internal payable private public pure view override",a2=nt(mg.split(" ")),Ag="constructor error event fallback function receive struct",vg=nt(Ag.split(" ")),Eg="calldata memory storage payable indexed",c2=nt(Eg.split(" ")),u2="tuple returns",f2=[Ag,Eg,u2,mg].join(" "),l2=nt(f2.split(" ")),d2={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},h2=new RegExp("^(\\s*)"),g2=new RegExp("^([0-9]+)"),p2=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),Sg=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),Cg=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");class Tt{#e;#t;get offset(){return this.#e}get length(){return this.#t.length-this.#e}constructor(e){this.#e=0,this.#t=e.slice()}clone(){return new Tt(this.#t)}reset(){this.#e=0}#r(e=0,t=0){return new Tt(this.#t.slice(e,t).map(n=>Object.freeze(Object.assign({},n,{match:n.match-e,linkBack:n.linkBack-e,linkNext:n.linkNext-e}))))}popKeyword(e){const t=this.peek();if(t.type!=="KEYWORD"||!e.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){const t=this.peek();throw new Error(`expected ${e}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=this.#r(this.#e+1,e.match+1);return this.#e=e.match+1,t}popParams(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=[];for(;this.#e<e.match-1;){const n=this.peek().linkNext;t.push(this.#r(this.#e+1,n)),this.#e=n}return this.#e=e.match+1,t}peek(){if(this.#e>=this.#t.length)throw new Error("out-of-bounds");return this.#t[this.#e]}peekKeyword(e){const t=this.peekType("KEYWORD");return t!=null&&e.has(t)?t:null}peekType(e){if(this.length===0)return null;const t=this.peek();return t.type===e?t.text:null}pop(){const e=this.peek();return this.#e++,e}toString(){const e=[];for(let t=this.#e;t<this.#t.length;t++){const n=this.#t[t];e.push(`${n.type}:${n.text}`)}return`<TokenString ${e.join(" ")}>`}}function Yr(r){const e=[],t=o=>{const a=s<r.length?JSON.stringify(r[s]):"$EOI";throw new Error(`invalid token ${a} at ${s}: ${o}`)};let n=[],i=[],s=0;for(;s<r.length;){let o=r.substring(s),a=o.match(h2);a&&(s+=a[1].length,o=r.substring(s));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:s,value:-1};e.push(c);let u=d2[o[0]]||"";if(u){if(c.type=u,c.text=o[0],s++,u==="OPEN_PAREN")n.push(e.length-1),i.push(e.length-1);else if(u=="CLOSE_PAREN")n.length===0&&t("no matching open bracket"),c.match=n.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=i.pop(),e[c.linkBack].linkNext=e.length-1;else if(u==="COMMA")c.linkBack=i.pop(),e[c.linkBack].linkNext=e.length-1,i.push(e.length-1);else if(u==="OPEN_BRACKET")c.type="BRACKET";else if(u==="CLOSE_BRACKET"){let l=e.pop().text;if(e.length>0&&e[e.length-1].type==="NUMBER"){const f=e.pop().text;l=f+l,e[e.length-1].value=ee(f)}if(e.length===0||e[e.length-1].type!=="BRACKET")throw new Error("missing opening bracket");e[e.length-1].text+=l}continue}if(a=o.match(p2),a){if(c.text=a[1],s+=c.text.length,l2.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(Cg)){c.type="TYPE";continue}c.type="ID";continue}if(a=o.match(g2),a){c.text=a[1],c.type="NUMBER",s+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${s}`)}return new Tt(e.map(o=>Object.freeze(o)))}function ml(r,e){let t=[];for(const n in e.keys())r.has(n)&&t.push(n);if(t.length>1)throw new Error(`conflicting types: ${t.join(", ")}`)}function $o(r,e){if(e.peekKeyword(vg)){const t=e.pop().text;if(t!==r)throw new Error(`expected ${r}, got ${t}`)}return e.popType("ID")}function vr(r,e){const t=new Set;for(;;){const n=r.peekType("KEYWORD");if(n==null||e&&!e.has(n))break;if(r.pop(),t.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);t.add(n)}return Object.freeze(t)}function Ig(r){let e=vr(r,a2);return ml(e,nt("constant payable nonpayable".split(" "))),ml(e,nt("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function br(r,e){return r.popParams().map(t=>pe.from(t,e))}function kg(r){if(r.peekType("AT")){if(r.pop(),r.peekType("NUMBER"))return z(r.pop().text);throw new Error("invalid gas")}return null}function wn(r){if(r.length)throw new Error(`unexpected tokens at offset ${r.offset}: ${r.toString()}`)}const x2=new RegExp(/^(.*)\[([0-9]*)\]$/);function Al(r){const e=r.match(Cg);if(_(e,"invalid type","type",r),r==="uint")return"uint256";if(r==="int")return"int256";if(e[2]){const t=parseInt(e[2]);_(t!==0&&t<=32,"invalid bytes length","type",r)}else if(e[3]){const t=parseInt(e[3]);_(t!==0&&t<=256&&t%8===0,"invalid numeric width","type",r)}return r}const Ee={},lt=Symbol.for("_ethers_internal"),vl="_ParamTypeInternal",El="_ErrorInternal",Sl="_EventInternal",Cl="_ConstructorInternal",Il="_FallbackInternal",kl="_FunctionInternal",Tl="_StructInternal";class pe{name;type;baseType;indexed;components;arrayLength;arrayChildren;constructor(e,t,n,i,s,o,a,c){if(In(e,Ee,"ParamType"),Object.defineProperty(this,lt,{value:vl}),o&&(o=Object.freeze(o.slice())),i==="array"){if(a==null||c==null)throw new Error("")}else if(a!=null||c!=null)throw new Error("");if(i==="tuple"){if(o==null)throw new Error("")}else if(o!=null)throw new Error("");q(this,{name:t,type:n,baseType:i,indexed:s,components:o,arrayLength:a,arrayChildren:c})}format(e){if(e==null&&(e="sighash"),e==="json"){const n=this.name||"";if(this.isArray()){const s=JSON.parse(this.arrayChildren.format("json"));return s.name=n,s.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(s)}const i={type:this.baseType==="tuple"?"tuple":this.type,name:n};return typeof this.indexed=="boolean"&&(i.indexed=this.indexed),this.isTuple()&&(i.components=this.components.map(s=>JSON.parse(s.format(e)))),JSON.stringify(i)}let t="";return this.isArray()?(t+=this.arrayChildren.format(e),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(n=>n.format(e)).join(e==="full"?", ":",")+")":t+=this.type,e!=="sighash"&&(this.indexed===!0&&(t+=" indexed"),e==="full"&&this.name&&(t+=" "+this.name)),t}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(e,t){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");const n=this;return e.map(i=>n.arrayChildren.walk(i,t))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");const n=this;return e.map((i,s)=>n.components[s].walk(i,t))}return t(this.type,e)}#e(e,t,n,i){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const o=this.arrayChildren,a=t.slice();a.forEach((c,u)=>{o.#e(e,c,n,l=>{a[u]=l})}),i(a);return}if(this.isTuple()){const o=this.components;let a;if(Array.isArray(t))a=t.slice();else{if(t==null||typeof t!="object")throw new Error("invalid tuple value");a=o.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in t))throw new Error(`missing value for component ${c.name}`);return t[c.name]})}if(a.length!==this.components.length)throw new Error("array is wrong length");a.forEach((c,u)=>{o[u].#e(e,c,n,l=>{a[u]=l})}),i(a);return}const s=n(this.type,t);s.then?e.push((async function(){i(await s)})()):i(s)}async walkAsync(e,t){const n=[],i=[e];return this.#e(n,e,t,s=>{i[0]=s}),n.length&&await Promise.all(n),i[0]}static from(e,t){if(pe.isParamType(e))return e;if(typeof e=="string")try{return pe.from(Yr(e),t)}catch{_(!1,"invalid param type","obj",e)}else if(e instanceof Tt){let a="",c="",u=null;vr(e,nt(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(c="tuple",u=e.popParams().map(x=>pe.from(x)),a=`tuple(${u.map(x=>x.format()).join(",")})`):(a=Al(e.popType("TYPE")),c=a);let l=null,f=null;for(;e.length&&e.peekType("BRACKET");){const x=e.pop();l=new pe(Ee,"",a,c,null,u,f,l),f=x.value,a+=x.text,c="array",u=null}let d=null;if(vr(e,c2).has("indexed")){if(!t)throw new Error("");d=!0}const h=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new pe(Ee,h,a,c,d,u,f,l)}const n=e.name;_(!n||typeof n=="string"&&n.match(Sg),"invalid name","obj.name",n);let i=e.indexed;i!=null&&(_(t,"parameter cannot be indexed","obj.indexed",e.indexed),i=!!i);let s=e.type,o=s.match(x2);if(o){const a=parseInt(o[2]||"-1"),c=pe.from({type:o[1],components:e.components});return new pe(Ee,n||"",s,"array",i,null,a,c)}if(s==="tuple"||s.startsWith("tuple(")||s.startsWith("(")){const a=e.components!=null?e.components.map(u=>pe.from(u)):null;return new pe(Ee,n||"",s,"tuple",i,a,null,null)}return s=Al(e.type),new pe(Ee,n||"",s,s,i,null,null,null)}static isParamType(e){return e&&e[lt]===vl}}class mn{type;inputs;constructor(e,t,n){In(e,Ee,"Fragment"),n=Object.freeze(n.slice()),q(this,{type:t,inputs:n})}static from(e){if(typeof e=="string"){try{mn.from(JSON.parse(e))}catch{}return mn.from(Yr(e))}if(e instanceof Tt)switch(e.peekKeyword(vg)){case"constructor":return dr.from(e);case"error":return at.from(e);case"event":return Jt.from(e);case"fallback":case"receive":return ar.from(e);case"function":return Qt.from(e);case"struct":return bn.from(e)}else if(typeof e=="object"){switch(e.type){case"constructor":return dr.from(e);case"error":return at.from(e);case"event":return Jt.from(e);case"fallback":case"receive":return ar.from(e);case"function":return Qt.from(e);case"struct":return bn.from(e)}F(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}_(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return dr.isFragment(e)}static isError(e){return at.isFragment(e)}static isEvent(e){return Jt.isFragment(e)}static isFunction(e){return Qt.isFragment(e)}static isStruct(e){return bn.isFragment(e)}}class Fo extends mn{name;constructor(e,t,n,i){super(e,t,i),_(typeof n=="string"&&n.match(Sg),"invalid identifier","name",n),i=Object.freeze(i.slice()),q(this,{name:n})}}function Vi(r,e){return"("+e.map(t=>t.format(r)).join(r==="full"?", ":",")+")"}class at extends Fo{constructor(e,t,n){super(e,"error",t,n),Object.defineProperty(this,lt,{value:El})}get selector(){return Ar(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});const t=[];return e!=="sighash"&&t.push("error"),t.push(this.name+Vi(e,this.inputs)),t.join(" ")}static from(e){if(at.isFragment(e))return e;if(typeof e=="string")return at.from(Yr(e));if(e instanceof Tt){const t=$o("error",e),n=br(e);return wn(e),new at(Ee,t,n)}return new at(Ee,e.name,e.inputs?e.inputs.map(pe.from):[])}static isFragment(e){return e&&e[lt]===El}}class Jt extends Fo{anonymous;constructor(e,t,n,i){super(e,"event",t,n),Object.defineProperty(this,lt,{value:Sl}),q(this,{anonymous:i})}get topicHash(){return Ar(this.format("sighash"))}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});const t=[];return e!=="sighash"&&t.push("event"),t.push(this.name+Vi(e,this.inputs)),e!=="sighash"&&this.anonymous&&t.push("anonymous"),t.join(" ")}static getTopicHash(e,t){return t=(t||[]).map(i=>pe.from(i)),new Jt(Ee,e,t,!1).topicHash}static from(e){if(Jt.isFragment(e))return e;if(typeof e=="string")try{return Jt.from(Yr(e))}catch{_(!1,"invalid event fragment","obj",e)}else if(e instanceof Tt){const t=$o("event",e),n=br(e,!0),i=!!vr(e,nt(["anonymous"])).has("anonymous");return wn(e),new Jt(Ee,t,n,i)}return new Jt(Ee,e.name,e.inputs?e.inputs.map(t=>pe.from(t,!0)):[],!!e.anonymous)}static isFragment(e){return e&&e[lt]===Sl}}class dr extends mn{payable;gas;constructor(e,t,n,i,s){super(e,t,n),Object.defineProperty(this,lt,{value:Cl}),q(this,{payable:i,gas:s})}format(e){if(F(e!=null&&e!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),e==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});const t=[`constructor${Vi(e,this.inputs)}`];return this.payable&&t.push("payable"),this.gas!=null&&t.push(`@${this.gas.toString()}`),t.join(" ")}static from(e){if(dr.isFragment(e))return e;if(typeof e=="string")try{return dr.from(Yr(e))}catch{_(!1,"invalid constuctor fragment","obj",e)}else if(e instanceof Tt){vr(e,nt(["constructor"]));const t=br(e),n=!!vr(e,o2).has("payable"),i=kg(e);return wn(e),new dr(Ee,"constructor",t,n,i)}return new dr(Ee,"constructor",e.inputs?e.inputs.map(pe.from):[],!!e.payable,e.gas!=null?e.gas:null)}static isFragment(e){return e&&e[lt]===Cl}}class ar extends mn{payable;constructor(e,t,n){super(e,"fallback",t),Object.defineProperty(this,lt,{value:Il}),q(this,{payable:n})}format(e){const t=this.inputs.length===0?"receive":"fallback";if(e==="json"){const n=this.payable?"payable":"nonpayable";return JSON.stringify({type:t,stateMutability:n})}return`${t}()${this.payable?" payable":""}`}static from(e){if(ar.isFragment(e))return e;if(typeof e=="string")try{return ar.from(Yr(e))}catch{_(!1,"invalid fallback fragment","obj",e)}else if(e instanceof Tt){const t=e.toString(),n=e.peekKeyword(nt(["fallback","receive"]));if(_(n,"type must be fallback or receive","obj",t),e.popKeyword(nt(["fallback","receive"]))==="receive"){const a=br(e);return _(a.length===0,"receive cannot have arguments","obj.inputs",a),vr(e,nt(["payable"])),wn(e),new ar(Ee,[],!0)}let s=br(e);s.length?_(s.length===1&&s[0].type==="bytes","invalid fallback inputs","obj.inputs",s.map(a=>a.format("minimal")).join(", ")):s=[pe.from("bytes")];const o=Ig(e);if(_(o==="nonpayable"||o==="payable","fallback cannot be constants","obj.stateMutability",o),vr(e,nt(["returns"])).has("returns")){const a=br(e);_(a.length===1&&a[0].type==="bytes","invalid fallback outputs","obj.outputs",a.map(c=>c.format("minimal")).join(", "))}return wn(e),new ar(Ee,s,o==="payable")}if(e.type==="receive")return new ar(Ee,[],!0);if(e.type==="fallback"){const t=[pe.from("bytes")],n=e.stateMutability==="payable";return new ar(Ee,t,n)}_(!1,"invalid fallback description","obj",e)}static isFragment(e){return e&&e[lt]===Il}}class Qt extends Fo{constant;outputs;stateMutability;payable;gas;constructor(e,t,n,i,s,o){super(e,"function",t,i),Object.defineProperty(this,lt,{value:kl}),s=Object.freeze(s.slice()),q(this,{constant:n==="view"||n==="pure",gas:o,outputs:s,payable:n==="payable",stateMutability:n})}get selector(){return Ar(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(n=>JSON.parse(n.format(e))),outputs:this.outputs.map(n=>JSON.parse(n.format(e)))});const t=[];return e!=="sighash"&&t.push("function"),t.push(this.name+Vi(e,this.inputs)),e!=="sighash"&&(this.stateMutability!=="nonpayable"&&t.push(this.stateMutability),this.outputs&&this.outputs.length&&(t.push("returns"),t.push(Vi(e,this.outputs))),this.gas!=null&&t.push(`@${this.gas.toString()}`)),t.join(" ")}static getSelector(e,t){return t=(t||[]).map(i=>pe.from(i)),new Qt(Ee,e,"view",t,[],null).selector}static from(e){if(Qt.isFragment(e))return e;if(typeof e=="string")try{return Qt.from(Yr(e))}catch{_(!1,"invalid function fragment","obj",e)}else if(e instanceof Tt){const n=$o("function",e),i=br(e),s=Ig(e);let o=[];vr(e,nt(["returns"])).has("returns")&&(o=br(e));const a=kg(e);return wn(e),new Qt(Ee,n,s,i,o,a)}let t=e.stateMutability;return t==null&&(t="payable",typeof e.constant=="boolean"?(t="view",e.constant||(t="payable",typeof e.payable=="boolean"&&!e.payable&&(t="nonpayable"))):typeof e.payable=="boolean"&&!e.payable&&(t="nonpayable")),new Qt(Ee,e.name,t,e.inputs?e.inputs.map(pe.from):[],e.outputs?e.outputs.map(pe.from):[],e.gas!=null?e.gas:null)}static isFragment(e){return e&&e[lt]===kl}}class bn extends Fo{constructor(e,t,n){super(e,"struct",t,n),Object.defineProperty(this,lt,{value:Tl})}format(){throw new Error("@TODO")}static from(e){if(typeof e=="string")try{return bn.from(Yr(e))}catch{_(!1,"invalid struct fragment","obj",e)}else if(e instanceof Tt){const t=$o("struct",e),n=br(e);return wn(e),new bn(Ee,t,n)}return new bn(Ee,e.name,e.inputs?e.inputs.map(pe.from):[])}static isFragment(e){return e&&e[lt]===Tl}}const Lt=new Map;Lt.set(0,"GENERIC_PANIC");Lt.set(1,"ASSERT_FALSE");Lt.set(17,"OVERFLOW");Lt.set(18,"DIVIDE_BY_ZERO");Lt.set(33,"ENUM_RANGE_ERROR");Lt.set(34,"BAD_STORAGE_DATA");Lt.set(49,"STACK_UNDERFLOW");Lt.set(50,"ARRAY_RANGE_ERROR");Lt.set(65,"OUT_OF_MEMORY");Lt.set(81,"UNINITIALIZED_FUNCTION_CALL");const b2=new RegExp(/^bytes([0-9]*)$/),y2=new RegExp(/^(u?int)([0-9]*)$/);let Sa=null,Pl=1024;function w2(r,e,t,n){let i="missing revert data",s=null;const o=null;let a=null;if(t){i="execution reverted";const u=K(t);if(t=G(t),u.length===0)i+=" (no data present; likely require(false) occurred",s="require(false)";else if(u.length%32!==4)i+=" (could not decode reason; invalid data length)";else if(G(u.slice(0,4))==="0x08c379a0")try{s=n.decode(["string"],u.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[s]},i+=`: ${JSON.stringify(s)}`}catch{i+=" (could not decode reason; invalid string data)"}else if(G(u.slice(0,4))==="0x4e487b71")try{const l=Number(n.decode(["uint256"],u.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[l]},s=`Panic due to ${Lt.get(l)||"UNKNOWN"}(${l})`,i+=`: ${s}`}catch{i+=" (could not decode panic code)"}else i+=" (unknown custom error)"}const c={to:e.to?te(e.to):null,data:e.data||"0x"};return e.from&&(c.from=te(e.from)),me(i,"CALL_EXCEPTION",{action:r,data:t,reason:s,transaction:c,invocation:o,revert:a})}class si{#e(e){if(e.isArray())return new Dm(this.#e(e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new Es(e.components.map(n=>this.#e(n)),e.name);switch(e.baseType){case"address":return new _m(e.name);case"bool":return new Mm(e.name);case"string":return new Wm(e.name);case"bytes":return new $m(e.name);case"":return new Hm(e.name)}let t=e.type.match(y2);if(t){let n=parseInt(t[2]||"256");return _(n!==0&&n<=256&&n%8===0,"invalid "+t[1]+" bit length","param",e),new Vm(n/8,t[1]==="int",e.name)}if(t=e.type.match(b2),t){let n=parseInt(t[1]);return _(n!==0&&n<=32,"invalid bytes length","param",e),new Fm(n,e.name)}_(!1,"invalid type","type",e.type)}getDefaultValue(e){const t=e.map(i=>this.#e(pe.from(i)));return new Es(t,"_").defaultValue()}encode(e,t){Ah(t.length,e.length,"types/values length mismatch");const n=e.map(o=>this.#e(pe.from(o))),i=new Es(n,"_"),s=new bc;return i.encode(s,t),s.data}decode(e,t,n){const i=e.map(o=>this.#e(pe.from(o)));return new Es(i,"_").decode(new nu(t,n,Pl))}static _setDefaultMaxInflation(e){_(typeof e=="number"&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),Pl=e}static defaultAbiCoder(){return Sa==null&&(Sa=new si),Sa}static getBuiltinCallException(e,t,n){return w2(e,t,n,si.defaultAbiCoder())}}class m2{fragment;name;signature;topic;args;constructor(e,t,n){const i=e.name,s=e.format();q(this,{fragment:e,name:i,signature:s,topic:t,args:n})}}class A2{fragment;name;args;signature;selector;value;constructor(e,t,n,i){const s=e.name,o=e.format();q(this,{fragment:e,name:s,args:n,signature:o,selector:t,value:i})}}class v2{fragment;name;args;signature;selector;constructor(e,t,n){const i=e.name,s=e.format();q(this,{fragment:e,name:i,args:n,signature:s,selector:t})}}class Nl{hash;_isIndexed;static isIndexed(e){return!!(e&&e._isIndexed)}constructor(e){q(this,{hash:e,_isIndexed:!0})}}const Ol={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},Ul={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:r=>`reverted with reason string ${JSON.stringify(r)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:r=>{let e="unknown panic code";return r>=0&&r<=255&&Ol[r.toString()]&&(e=Ol[r.toString()]),`reverted with panic code 0x${r.toString(16)} (${e})`}}};class un{fragments;deploy;fallback;receive;#e;#t;#r;#n;constructor(e){let t=[];typeof e=="string"?t=JSON.parse(e):t=e,this.#r=new Map,this.#e=new Map,this.#t=new Map;const n=[];for(const o of t)try{n.push(mn.from(o))}catch(a){console.log(`[Warning] Invalid Fragment ${JSON.stringify(o)}:`,a.message)}q(this,{fragments:Object.freeze(n)});let i=null,s=!1;this.#n=this.getAbiCoder(),this.fragments.forEach((o,a)=>{let c;switch(o.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}q(this,{deploy:o});return;case"fallback":o.inputs.length===0?s=!0:(_(!i||o.payable!==i.payable,"conflicting fallback fragments",`fragments[${a}]`,o),i=o,s=i.payable);return;case"function":c=this.#r;break;case"event":c=this.#t;break;case"error":c=this.#e;break;default:return}const u=o.format();c.has(u)||c.set(u,o)}),this.deploy||q(this,{deploy:dr.from("constructor()")}),q(this,{fallback:i,receive:s})}format(e){const t=e?"minimal":"full";return this.fragments.map(i=>i.format(t))}formatJson(){const e=this.fragments.map(t=>t.format("json"));return JSON.stringify(e.map(t=>JSON.parse(t)))}getAbiCoder(){return si.defaultAbiCoder()}#i(e,t,n){if(xe(e)){const s=e.toLowerCase();for(const o of this.#r.values())if(s===o.selector)return o;return null}if(e.indexOf("(")===-1){const s=[];for(const[o,a]of this.#r)o.split("(")[0]===e&&s.push(a);if(t){const o=t.length>0?t[t.length-1]:null;let a=t.length,c=!0;Ie.isTyped(o)&&o.type==="overrides"&&(c=!1,a--);for(let u=s.length-1;u>=0;u--){const l=s[u].inputs.length;l!==a&&(!c||l!==a-1)&&s.splice(u,1)}for(let u=s.length-1;u>=0;u--){const l=s[u].inputs;for(let f=0;f<t.length;f++)if(Ie.isTyped(t[f])){if(f>=l.length){if(t[f].type==="overrides")continue;s.splice(u,1);break}if(t[f].type!==l[f].baseType){s.splice(u,1);break}}}}if(s.length===1&&t&&t.length!==s[0].inputs.length){const o=t[t.length-1];(o==null||Array.isArray(o)||typeof o!="object")&&s.splice(0,1)}if(s.length===0)return null;if(s.length>1&&n){const o=s.map(a=>JSON.stringify(a.format())).join(", ");_(!1,`ambiguous function description (i.e. matches ${o})`,"key",e)}return s[0]}const i=this.#r.get(Qt.from(e).format());return i||null}getFunctionName(e){const t=this.#i(e,null,!1);return _(t,"no matching function","key",e),t.name}hasFunction(e){return!!this.#i(e,null,!1)}getFunction(e,t){return this.#i(e,t||null,!0)}forEachFunction(e){const t=Array.from(this.#r.keys());t.sort((n,i)=>n.localeCompare(i));for(let n=0;n<t.length;n++){const i=t[n];e(this.#r.get(i),n)}}#o(e,t,n){if(xe(e)){const s=e.toLowerCase();for(const o of this.#t.values())if(s===o.topicHash)return o;return null}if(e.indexOf("(")===-1){const s=[];for(const[o,a]of this.#t)o.split("(")[0]===e&&s.push(a);if(t){for(let o=s.length-1;o>=0;o--)s[o].inputs.length<t.length&&s.splice(o,1);for(let o=s.length-1;o>=0;o--){const a=s[o].inputs;for(let c=0;c<t.length;c++)if(Ie.isTyped(t[c])&&t[c].type!==a[c].baseType){s.splice(o,1);break}}}if(s.length===0)return null;if(s.length>1&&n){const o=s.map(a=>JSON.stringify(a.format())).join(", ");_(!1,`ambiguous event description (i.e. matches ${o})`,"key",e)}return s[0]}const i=this.#t.get(Jt.from(e).format());return i||null}getEventName(e){const t=this.#o(e,null,!1);return _(t,"no matching event","key",e),t.name}hasEvent(e){return!!this.#o(e,null,!1)}getEvent(e,t){return this.#o(e,t||null,!0)}forEachEvent(e){const t=Array.from(this.#t.keys());t.sort((n,i)=>n.localeCompare(i));for(let n=0;n<t.length;n++){const i=t[n];e(this.#t.get(i),n)}}getError(e,t){if(xe(e)){const i=e.toLowerCase();if(Ul[i])return at.from(Ul[i].signature);for(const s of this.#e.values())if(i===s.selector)return s;return null}if(e.indexOf("(")===-1){const i=[];for(const[s,o]of this.#e)s.split("(")[0]===e&&i.push(o);if(i.length===0)return e==="Error"?at.from("error Error(string)"):e==="Panic"?at.from("error Panic(uint256)"):null;if(i.length>1){const s=i.map(o=>JSON.stringify(o.format())).join(", ");_(!1,`ambiguous error description (i.e. ${s})`,"name",e)}return i[0]}if(e=at.from(e).format(),e==="Error(string)")return at.from("error Error(string)");if(e==="Panic(uint256)")return at.from("error Panic(uint256)");const n=this.#e.get(e);return n||null}forEachError(e){const t=Array.from(this.#e.keys());t.sort((n,i)=>n.localeCompare(i));for(let n=0;n<t.length;n++){const i=t[n];e(this.#e.get(i),n)}}_decodeParams(e,t){return this.#n.decode(e,t)}_encodeParams(e,t){return this.#n.encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);_(n,"unknown error","fragment",e),e=n}return _(be(t,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",t),this._decodeParams(e.inputs,be(t,4))}encodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);_(n,"unknown error","fragment",e),e=n}return he([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);_(n,"unknown function","fragment",e),e=n}return _(be(t,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",t),this._decodeParams(e.inputs,be(t,4))}encodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);_(n,"unknown function","fragment",e),e=n}return he([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionResult(e,t){if(typeof e=="string"){const s=this.getFunction(e);_(s,"unknown function","fragment",e),e=s}let n="invalid length for result data";const i=Ve(t);if(i.length%32===0)try{return this.#n.decode(e.outputs,i)}catch{n="could not decode result data"}F(!1,n,"BAD_DATA",{value:G(i),info:{method:e.name,signature:e.format()}})}makeError(e,t){const n=K(e,"data"),i=si.getBuiltinCallException("call",t,n);if(i.message.startsWith("execution reverted (unknown custom error)")){const a=G(n.slice(0,4)),c=this.getError(a);if(c)try{const u=this.#n.decode(c.inputs,n.slice(4));i.revert={name:c.name,signature:c.format(),args:u},i.reason=i.revert.signature,i.message=`execution reverted: ${i.reason}`}catch{i.message="execution reverted (coult not decode custom error)"}}const o=this.parseTransaction(t);return o&&(i.invocation={method:o.name,signature:o.signature,args:o.args}),i}encodeFunctionResult(e,t){if(typeof e=="string"){const n=this.getFunction(e);_(n,"unknown function","fragment",e),e=n}return G(this.#n.encode(e.outputs,t||[]))}encodeFilterTopics(e,t){if(typeof e=="string"){const s=this.getEvent(e);_(s,"unknown event","eventFragment",e),e=s}F(t.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:e.inputs.length});const n=[];e.anonymous||n.push(e.topicHash);const i=(s,o)=>s.type==="string"?Ar(o):s.type==="bytes"?ie(G(o)):(s.type==="bool"&&typeof o=="boolean"?o=o?"0x01":"0x00":s.type.match(/^u?int/)?o=wr(o):s.type.match(/^bytes/)?o=uy(o,32):s.type==="address"&&this.#n.encode(["address"],[o]),yr(G(o),32));for(t.forEach((s,o)=>{const a=e.inputs[o];if(!a.indexed){_(s==null,"cannot filter non-indexed parameters; must be null","contract."+a.name,s);return}s==null?n.push(null):a.baseType==="array"||a.baseType==="tuple"?_(!1,"filtering with tuples or arrays not supported","contract."+a.name,s):Array.isArray(s)?n.push(s.map(c=>i(a,c))):n.push(i(a,s))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(e,t){if(typeof e=="string"){const o=this.getEvent(e);_(o,"unknown event","eventFragment",e),e=o}const n=[],i=[],s=[];return e.anonymous||n.push(e.topicHash),_(t.length===e.inputs.length,"event arguments/values mismatch","values",t),e.inputs.forEach((o,a)=>{const c=t[a];if(o.indexed)if(o.type==="string")n.push(Ar(c));else if(o.type==="bytes")n.push(ie(c));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");n.push(this.#n.encode([o.type],[c]))}else i.push(o),s.push(c)}),{data:this.#n.encode(i,s),topics:n}}decodeEventLog(e,t,n){if(typeof e=="string"){const p=this.getEvent(e);_(p,"unknown event","eventFragment",e),e=p}if(n!=null&&!e.anonymous){const p=e.topicHash;_(xe(n[0],32)&&n[0].toLowerCase()===p,"fragment/topic mismatch","topics[0]",n[0]),n=n.slice(1)}const i=[],s=[],o=[];e.inputs.forEach((p,h)=>{p.indexed?p.type==="string"||p.type==="bytes"||p.baseType==="tuple"||p.baseType==="array"?(i.push(pe.from({type:"bytes32",name:p.name})),o.push(!0)):(i.push(p),o.push(!1)):(s.push(p),o.push(!1))});const a=n!=null?this.#n.decode(i,he(n)):null,c=this.#n.decode(s,t,!0),u=[],l=[];let f=0,d=0;return e.inputs.forEach((p,h)=>{let x=null;if(p.indexed)if(a==null)x=new Nl(null);else if(o[h])x=new Nl(a[d++]);else try{x=a[d++]}catch(b){x=b}else try{x=c[f++]}catch(b){x=b}u.push(x),l.push(p.name||null)}),lr.fromItems(u,l)}parseTransaction(e){const t=K(e.data,"tx.data"),n=z(e.value!=null?e.value:0,"tx.value"),i=this.getFunction(G(t.slice(0,4)));if(!i)return null;const s=this.#n.decode(i.inputs,t.slice(4));return new A2(i,i.selector,s,n)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){const t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new m2(t,t.topicHash,this.decodeEventLog(t,e.data,e.topics))}parseError(e){const t=G(e),n=this.getError(be(t,0,4));if(!n)return null;const i=this.#n.decode(n.inputs,be(t,4));return new v2(n,n.selector,i)}static from(e){return e instanceof un?e:typeof e=="string"?new un(JSON.parse(e)):typeof e.formatJson=="function"?new un(e.formatJson()):typeof e.format=="function"?new un(e.format("json")):new un(e)}}const Tg=BigInt(0);function Jn(r){return r??null}function Oe(r){return r==null?null:r.toString()}class Rl{gasPrice;maxFeePerGas;maxPriorityFeePerGas;constructor(e,t,n){q(this,{gasPrice:Jn(e),maxFeePerGas:Jn(t),maxPriorityFeePerGas:Jn(n)})}toJSON(){const{gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:n}=this;return{_type:"FeeData",gasPrice:Oe(e),maxFeePerGas:Oe(t),maxPriorityFeePerGas:Oe(n)}}}function Wi(r){const e={};r.to&&(e.to=r.to),r.from&&(e.from=r.from),r.data&&(e.data=G(r.data));const t="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const i of t)!(i in r)||r[i]==null||(e[i]=z(r[i],`request.${i}`));const n="type,nonce".split(/,/);for(const i of n)!(i in r)||r[i]==null||(e[i]=ee(r[i],`request.${i}`));return r.accessList&&(e.accessList=kn(r.accessList)),r.authorizationList&&(e.authorizationList=r.authorizationList.slice()),"blockTag"in r&&(e.blockTag=r.blockTag),"enableCcipRead"in r&&(e.enableCcipRead=!!r.enableCcipRead),"customData"in r&&(e.customData=r.customData),"blobVersionedHashes"in r&&r.blobVersionedHashes&&(e.blobVersionedHashes=r.blobVersionedHashes.slice()),"kzg"in r&&(e.kzg=r.kzg),"blobs"in r&&r.blobs&&(e.blobs=r.blobs.map(i=>Io(i)?G(i):Object.assign({},i))),e}class E2{provider;number;hash;timestamp;parentHash;parentBeaconBlockRoot;nonce;difficulty;gasLimit;gasUsed;stateRoot;receiptsRoot;blobGasUsed;excessBlobGas;miner;prevRandao;extraData;baseFeePerGas;#e;constructor(e,t){this.#e=e.transactions.map(n=>typeof n!="string"?new os(n,t):n),q(this,{provider:t,hash:Jn(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:Jn(e.prevRandao),extraData:e.extraData,baseFeePerGas:Jn(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return this.#e.map(e=>typeof e=="string"?e:e.hash)}get prefetchedTransactions(){const e=this.#e.slice();return e.length===0?[]:(F(typeof e[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){const{baseFeePerGas:e,difficulty:t,extraData:n,gasLimit:i,gasUsed:s,hash:o,miner:a,prevRandao:c,nonce:u,number:l,parentHash:f,parentBeaconBlockRoot:d,stateRoot:p,receiptsRoot:h,timestamp:x,transactions:b}=this;return{_type:"Block",baseFeePerGas:Oe(e),difficulty:Oe(t),extraData:n,gasLimit:Oe(i),gasUsed:Oe(s),blobGasUsed:Oe(this.blobGasUsed),excessBlobGas:Oe(this.excessBlobGas),hash:o,miner:a,prevRandao:c,nonce:u,number:l,parentHash:f,timestamp:x,parentBeaconBlockRoot:d,stateRoot:p,receiptsRoot:h,transactions:b}}[Symbol.iterator](){let e=0;const t=this.transactions;return{next:()=>e<this.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}get length(){return this.#e.length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(e){let t;if(typeof e=="number")t=this.#e[e];else{const n=e.toLowerCase();for(const i of this.#e)if(typeof i=="string"){if(i!==n)continue;t=i;break}else{if(i.hash!==n)continue;t=i;break}}if(t==null)throw new Error("no such tx");return typeof t=="string"?await this.provider.getTransaction(t):t}getPrefetchedTransaction(e){const t=this.prefetchedTransactions;if(typeof e=="number")return t[e];e=e.toLowerCase();for(const n of t)if(n.hash===e)return n;_(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return S2(this)}}class ss{provider;transactionHash;blockHash;blockNumber;removed;address;data;topics;index;transactionIndex;constructor(e,t){this.provider=t;const n=Object.freeze(e.topics.slice());q(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:n,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){const{address:e,blockHash:t,blockNumber:n,data:i,index:s,removed:o,topics:a,transactionHash:c,transactionIndex:u}=this;return{_type:"log",address:e,blockHash:t,blockNumber:n,data:i,index:s,removed:o,topics:a,transactionHash:c,transactionIndex:u}}async getBlock(){const e=await this.provider.getBlock(this.blockHash);return F(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){const e=await this.provider.getTransaction(this.transactionHash);return F(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){const e=await this.provider.getTransactionReceipt(this.transactionHash);return F(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return C2(this)}}class Pg{provider;to;from;contractAddress;hash;index;blockHash;blockNumber;logsBloom;gasUsed;blobGasUsed;cumulativeGasUsed;gasPrice;blobGasPrice;type;status;root;#e;constructor(e,t){this.#e=Object.freeze(e.logs.map(i=>new ss(i,t)));let n=Tg;e.effectiveGasPrice!=null?n=e.effectiveGasPrice:e.gasPrice!=null&&(n=e.gasPrice),q(this,{provider:t,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:n,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return this.#e}toJSON(){const{to:e,from:t,contractAddress:n,hash:i,index:s,blockHash:o,blockNumber:a,logsBloom:c,logs:u,status:l,root:f}=this;return{_type:"TransactionReceipt",blockHash:o,blockNumber:a,contractAddress:n,cumulativeGasUsed:Oe(this.cumulativeGasUsed),from:t,gasPrice:Oe(this.gasPrice),blobGasUsed:Oe(this.blobGasUsed),blobGasPrice:Oe(this.blobGasPrice),gasUsed:Oe(this.gasUsed),hash:i,index:s,logs:u,logsBloom:c,root:f,status:l,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const e=await this.provider.getBlock(this.blockHash);if(e==null)throw new Error("TODO");return e}async getTransaction(){const e=await this.provider.getTransaction(this.hash);if(e==null)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return Og(this)}reorderedEvent(e){return F(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),Ng(this,e)}}class os{provider;blockNumber;blockHash;index;hash;type;to;from;nonce;gasLimit;gasPrice;maxPriorityFeePerGas;maxFeePerGas;maxFeePerBlobGas;data;value;chainId;signature;accessList;blobVersionedHashes;authorizationList;#e;constructor(e,t){this.provider=t,this.blockNumber=e.blockNumber!=null?e.blockNumber:null,this.blockHash=e.blockHash!=null?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=e.maxPriorityFeePerGas!=null?e.maxPriorityFeePerGas:null,this.maxFeePerGas=e.maxFeePerGas!=null?e.maxFeePerGas:null,this.maxFeePerBlobGas=e.maxFeePerBlobGas!=null?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=e.accessList!=null?e.accessList:null,this.blobVersionedHashes=e.blobVersionedHashes!=null?e.blobVersionedHashes:null,this.authorizationList=e.authorizationList!=null?e.authorizationList:null,this.#e=-1}toJSON(){const{blockNumber:e,blockHash:t,index:n,hash:i,type:s,to:o,from:a,nonce:c,data:u,signature:l,accessList:f,blobVersionedHashes:d}=this;return{_type:"TransactionResponse",accessList:f,blockNumber:e,blockHash:t,blobVersionedHashes:d,chainId:Oe(this.chainId),data:u,from:a,gasLimit:Oe(this.gasLimit),gasPrice:Oe(this.gasPrice),hash:i,maxFeePerGas:Oe(this.maxFeePerGas),maxPriorityFeePerGas:Oe(this.maxPriorityFeePerGas),maxFeePerBlobGas:Oe(this.maxFeePerBlobGas),nonce:c,signature:l,to:o,index:n,type:s,value:Oe(this.value)}}async getBlock(){let e=this.blockNumber;if(e==null){const n=await this.getTransaction();n&&(e=n.blockNumber)}if(e==null)return null;const t=this.provider.getBlock(e);if(t==null)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:t,blockNumber:n}=await Ze({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return t==null||t.blockNumber==null?0:n-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,t){const n=e??1,i=t??0;let s=this.#e,o=-1,a=s===-1;const c=async()=>{if(a)return null;const{blockNumber:d,nonce:p}=await Ze({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(p<this.nonce){s=d;return}if(a)return null;const h=await this.getTransaction();if(!(h&&h.blockNumber!=null))for(o===-1&&(o=s-3,o<this.#e&&(o=this.#e));o<=d;){if(a)return null;const x=await this.provider.getBlock(o,!0);if(x==null)return;for(const b of x)if(b===this.hash)return;for(let b=0;b<x.length;b++){const w=await x.getTransaction(b);if(w.from===this.from&&w.nonce===this.nonce){if(a)return null;const m=await this.provider.getTransactionReceipt(w.hash);if(m==null||d-m.blockNumber+1<n)return;let g="replaced";w.data===this.data&&w.to===this.to&&w.value===this.value?g="repriced":w.data==="0x"&&w.from===w.to&&w.value===Tg&&(g="cancelled"),F(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:g==="replaced"||g==="cancelled",reason:g,replacement:w.replaceableTransaction(s),hash:w.hash,receipt:m})}}o++}},u=d=>{if(d==null||d.status!==0)return d;F(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:d.to,from:d.from,data:""},receipt:d})},l=await this.provider.getTransactionReceipt(this.hash);if(n===0)return u(l);if(l){if(n===1||await l.confirmations()>=n)return u(l)}else if(await c(),n===0)return null;return await new Promise((d,p)=>{const h=[],x=()=>{h.forEach(w=>w())};if(h.push(()=>{a=!0}),i>0){const w=setTimeout(()=>{x(),p(me("wait for transaction timeout","TIMEOUT"))},i);h.push(()=>{clearTimeout(w)})}const b=async w=>{if(await w.confirmations()>=n){x();try{d(u(w))}catch(m){p(m)}}};if(h.push(()=>{this.provider.off(this.hash,b)}),this.provider.on(this.hash,b),s>=0){const w=async()=>{try{await c()}catch(m){if(ze(m,"TRANSACTION_REPLACED")){x(),p(m);return}}a||this.provider.once("block",w)};h.push(()=>{this.provider.off("block",w)}),this.provider.once("block",w)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return F(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Og(this)}reorderedEvent(e){return F(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),F(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),Ng(this,e)}replaceableTransaction(e){_(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);const t=new os(this,this.provider);return t.#e=e,t}}function S2(r){return{orphan:"drop-block",hash:r.hash,number:r.number}}function Ng(r,e){return{orphan:"reorder-transaction",tx:r,other:e}}function Og(r){return{orphan:"drop-transaction",tx:r}}function C2(r){return{orphan:"drop-log",log:{transactionHash:r.transactionHash,blockHash:r.blockHash,blockNumber:r.blockNumber,address:r.address,data:r.data,topics:Object.freeze(r.topics.slice()),index:r.index}}}class Eu extends ss{interface;fragment;args;constructor(e,t,n){super(e,e.provider);const i=t.decodeEventLog(n,e.data,e.topics);q(this,{args:i,fragment:n,interface:t})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class Ug extends ss{error;constructor(e,t){super(e,e.provider),q(this,{error:t})}}class I2 extends Pg{#e;constructor(e,t,n){super(n,t),this.#e=e}get logs(){return super.logs.map(e=>{const t=e.topics.length?this.#e.getEvent(e.topics[0]):null;if(t)try{return new Eu(e,this.#e,t)}catch(n){return new Ug(e,n)}return e})}}class Su extends os{#e;constructor(e,t,n){super(n,t),this.#e=e}async wait(e,t){const n=await super.wait(e,t);return n==null?null:new I2(this.#e,this.provider,n)}}class Rg extends kh{log;constructor(e,t,n,i){super(e,t,n),q(this,{log:i})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class k2 extends Rg{constructor(e,t,n,i,s){super(e,t,n,new Eu(s,e.interface,i));const o=e.interface.decodeEventLog(i,this.log.data,this.log.topics);q(this,{args:o,fragment:i})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const Bl=BigInt(0);function Bg(r){return r&&typeof r.call=="function"}function _g(r){return r&&typeof r.estimateGas=="function"}function Go(r){return r&&typeof r.resolveName=="function"}function Lg(r){return r&&typeof r.sendTransaction=="function"}function Dg(r){if(r!=null){if(Go(r))return r;if(r.provider)return r.provider}}class T2{#e;fragment;constructor(e,t,n){if(q(this,{fragment:t}),t.inputs.length<n.length)throw new Error("too many arguments");const i=An(e.runner,"resolveName"),s=Go(i)?i:null;this.#e=(async function(){const o=await Promise.all(t.inputs.map((a,c)=>n[c]==null?null:a.walkAsync(n[c],(l,f)=>l==="address"?Array.isArray(f)?Promise.all(f.map(d=>$e(d,s))):$e(f,s):f)));return e.interface.encodeFilterTopics(t,o)})()}getTopicFilter(){return this.#e}}function An(r,e){return r==null?null:typeof r[e]=="function"?r:r.provider&&typeof r.provider[e]=="function"?r.provider:null}function dn(r){return r==null?null:r.provider||null}async function Mg(r,e){const t=Ie.dereference(r,"overrides");_(typeof t=="object","invalid overrides parameter","overrides",r);const n=Wi(t);return _(n.to==null||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),_(n.data==null||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}async function P2(r,e,t){const n=An(r,"resolveName"),i=Go(n)?n:null;return await Promise.all(e.map((s,o)=>s.walkAsync(t[o],(a,c)=>(c=Ie.dereference(c,a),a==="address"?$e(c,i):c))))}function N2(r){const e=async function(o){const a=await Mg(o,["data"]);a.to=await r.getAddress(),a.from&&(a.from=await $e(a.from,Dg(r.runner)));const c=r.interface,u=z(a.value||Bl,"overrides.value")===Bl,l=(a.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!l&&!u&&_(!1,"cannot send data to receive or send value to non-payable fallback","overrides",o),_(c.fallback||l,"cannot send data to receive-only contract","overrides.data",a.data);const f=c.receive||c.fallback&&c.fallback.payable;return _(f||u,"cannot send value to non-payable fallback","overrides.value",a.value),_(c.fallback||l,"cannot send data to receive-only contract","overrides.data",a.data),a},t=async function(o){const a=An(r.runner,"call");F(Bg(a),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await e(o);try{return await a.call(c)}catch(u){throw ru(u)&&u.data?r.interface.makeError(u.data,c):u}},n=async function(o){const a=r.runner;F(Lg(a),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await a.sendTransaction(await e(o)),u=dn(r.runner);return new Su(r.interface,u,c)},i=async function(o){const a=An(r.runner,"estimateGas");return F(_g(a),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await a.estimateGas(await e(o))},s=async o=>await n(o);return q(s,{_contract:r,estimateGas:i,populateTransaction:e,send:n,staticCall:t}),s}function O2(r,e){const t=function(...u){const l=r.interface.getFunction(e,u);return F(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:u}}),l},n=async function(...u){const l=t(...u);let f={};if(l.inputs.length+1===u.length&&(f=await Mg(u.pop()),f.from&&(f.from=await $e(f.from,Dg(r.runner)))),l.inputs.length!==u.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const d=await P2(r.runner,l.inputs,u);return Object.assign({},f,await Ze({to:r.getAddress(),data:r.interface.encodeFunctionData(l,d)}))},i=async function(...u){const l=await a(...u);return l.length===1?l[0]:l},s=async function(...u){const l=r.runner;F(Lg(l),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const f=await l.sendTransaction(await n(...u)),d=dn(r.runner);return new Su(r.interface,d,f)},o=async function(...u){const l=An(r.runner,"estimateGas");return F(_g(l),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await l.estimateGas(await n(...u))},a=async function(...u){const l=An(r.runner,"call");F(Bg(l),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const f=await n(...u);let d="0x";try{d=await l.call(f)}catch(h){throw ru(h)&&h.data?r.interface.makeError(h.data,f):h}const p=t(...u);return r.interface.decodeFunctionResult(p,d)},c=async(...u)=>t(...u).constant?await i(...u):await s(...u);return q(c,{name:r.interface.getFunctionName(e),_contract:r,_key:e,getFragment:t,estimateGas:o,populateTransaction:n,send:s,staticCall:i,staticCallResult:a}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{const u=r.interface.getFunction(e);return F(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),u}}),c}function U2(r,e){const t=function(...i){const s=r.interface.getEvent(e,i);return F(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:i}}),s},n=function(...i){return new T2(r,t(...i),i)};return q(n,{name:r.interface.getEventName(e),_contract:r,_key:e,getFragment:t}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const i=r.interface.getEvent(e);return F(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),i}}),n}const lo=Symbol.for("_ethersInternal_contract"),$g=new WeakMap;function R2(r,e){$g.set(r[lo],e)}function dt(r){return $g.get(r[lo])}function B2(r){return r&&typeof r=="object"&&"getTopicFilter"in r&&typeof r.getTopicFilter=="function"&&r.fragment}async function Cu(r,e){let t,n=null;if(Array.isArray(e)){const s=function(o){if(xe(o,32))return o;const a=r.interface.getEvent(o);return _(a,"unknown fragment","name",o),a.topicHash};t=e.map(o=>o==null?null:Array.isArray(o)?o.map(s):s(o))}else e==="*"?t=[null]:typeof e=="string"?xe(e,32)?t=[e]:(n=r.interface.getEvent(e),_(n,"unknown fragment","event",e),t=[n.topicHash]):B2(e)?t=await e.getTopicFilter():"fragment"in e?(n=e.fragment,t=[n.topicHash]):_(!1,"unknown event name","event",e);t=t.map(s=>{if(s==null)return null;if(Array.isArray(s)){const o=Array.from(new Set(s.map(a=>a.toLowerCase())).values());return o.length===1?o[0]:(o.sort(),o)}return s.toLowerCase()});const i=t.map(s=>s==null?"null":Array.isArray(s)?s.join("|"):s).join("&");return{fragment:n,tag:i,topics:t}}async function Ti(r,e){const{subs:t}=dt(r);return t.get((await Cu(r,e)).tag)||null}async function _l(r,e,t){const n=dn(r.runner);F(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:i,tag:s,topics:o}=await Cu(r,t),{addr:a,subs:c}=dt(r);let u=c.get(s);if(!u){const f={address:a||r,topics:o},d=b=>{let w=i;if(w==null)try{w=r.interface.getEvent(b.topics[0])}catch{}if(w){const m=w,g=i?r.interface.decodeEventLog(i,b.data,b.topics):[];Uc(r,t,g,A=>new k2(r,A,t,m,b))}else Uc(r,t,[],m=>new Rg(r,m,t,b))};let p=[];u={tag:s,listeners:[],start:()=>{p.length||p.push(n.on(f,d))},stop:async()=>{if(p.length==0)return;let b=p;p=[],await Promise.all(b),n.off(f,d)}},c.set(s,u)}return u}let Oc=Promise.resolve();async function _2(r,e,t,n){await Oc;const i=await Ti(r,e);if(!i)return!1;const s=i.listeners.length;return i.listeners=i.listeners.filter(({listener:o,once:a})=>{const c=Array.from(t);n&&c.push(n(a?null:o));try{o.call(r,...c)}catch{}return!a}),i.listeners.length===0&&(i.stop(),dt(r).subs.delete(i.tag)),s>0}async function Uc(r,e,t,n){try{await Oc}catch{}const i=_2(r,e,t,n);return Oc=i,await i}const Cs=["then"];class _i{target;interface;runner;filters;[lo];fallback;constructor(e,t,n,i){_(typeof e=="string"||K0(e),"invalid value for Contract target","target",e),n==null&&(n=null);const s=un.from(t);q(this,{target:e,runner:n,interface:s}),Object.defineProperty(this,lo,{value:{}});let o,a=null,c=null;if(i){const f=dn(n);c=new Su(this.interface,f,i)}let u=new Map;if(typeof e=="string")if(xe(e))a=e,o=Promise.resolve(e);else{const f=An(n,"resolveName");if(!Go(f))throw me("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});o=f.resolveName(e).then(d=>{if(d==null)throw me("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return dt(this).addr=d,d})}else o=e.getAddress().then(f=>{if(f==null)throw new Error("TODO");return dt(this).addr=f,f});R2(this,{addrPromise:o,addr:a,deployTx:c,subs:u});const l=new Proxy({},{get:(f,d,p)=>{if(typeof d=="symbol"||Cs.indexOf(d)>=0)return Reflect.get(f,d,p);try{return this.getEvent(d)}catch(h){if(!ze(h,"INVALID_ARGUMENT")||h.argument!=="key")throw h}},has:(f,d)=>Cs.indexOf(d)>=0?Reflect.has(f,d):Reflect.has(f,d)||this.interface.hasEvent(String(d))});return q(this,{filters:l}),q(this,{fallback:s.receive||s.fallback?N2(this):null}),new Proxy(this,{get:(f,d,p)=>{if(typeof d=="symbol"||d in f||Cs.indexOf(d)>=0)return Reflect.get(f,d,p);try{return f.getFunction(d)}catch(h){if(!ze(h,"INVALID_ARGUMENT")||h.argument!=="key")throw h}},has:(f,d)=>typeof d=="symbol"||d in f||Cs.indexOf(d)>=0?Reflect.has(f,d):f.interface.hasFunction(d)})}connect(e){return new _i(this.target,this.interface,e)}attach(e){return new _i(e,this.interface,this.runner)}async getAddress(){return await dt(this).addrPromise}async getDeployedCode(){const e=dn(this.runner);F(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await e.getCode(await this.getAddress());return t==="0x"?null:t}async waitForDeployment(){const e=this.deploymentTransaction();if(e)return await e.wait(),this;if(await this.getDeployedCode()!=null)return this;const n=dn(this.runner);return F(n!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((i,s)=>{const o=async()=>{try{if(await this.getDeployedCode()!=null)return i(this);n.once("block",o)}catch(a){s(a)}};o()})}deploymentTransaction(){return dt(this).deployTx}getFunction(e){return typeof e!="string"&&(e=e.format()),O2(this,e)}getEvent(e){return typeof e!="string"&&(e=e.format()),U2(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,t,n){t==null&&(t=0),n==null&&(n="latest");const{addr:i,addrPromise:s}=dt(this),o=i||await s,{fragment:a,topics:c}=await Cu(this,e),u={address:o,topics:c,fromBlock:t,toBlock:n},l=dn(this.runner);return F(l,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await l.getLogs(u)).map(f=>{let d=a;if(d==null)try{d=this.interface.getEvent(f.topics[0])}catch{}if(d)try{return new Eu(f,this.interface,d)}catch(p){return new Ug(f,p)}return new ss(f,l)})}async on(e,t){const n=await _l(this,"on",e);return n.listeners.push({listener:t,once:!1}),n.start(),this}async once(e,t){const n=await _l(this,"once",e);return n.listeners.push({listener:t,once:!0}),n.start(),this}async emit(e,...t){return await Uc(this,e,t,null)}async listenerCount(e){if(e){const i=await Ti(this,e);return i?i.listeners.length:0}const{subs:t}=dt(this);let n=0;for(const{listeners:i}of t.values())n+=i.length;return n}async listeners(e){if(e){const i=await Ti(this,e);return i?i.listeners.map(({listener:s})=>s):[]}const{subs:t}=dt(this);let n=[];for(const{listeners:i}of t.values())n=n.concat(i.map(({listener:s})=>s));return n}async off(e,t){const n=await Ti(this,e);if(!n)return this;if(t){const i=n.listeners.map(({listener:s})=>s).indexOf(t);i>=0&&n.listeners.splice(i,1)}return(t==null||n.listeners.length===0)&&(n.stop(),dt(this).subs.delete(n.tag)),this}async removeAllListeners(e){if(e){const t=await Ti(this,e);if(!t)return this;t.stop(),dt(this).subs.delete(t.tag)}else{const{subs:t}=dt(this);for(const{tag:n,stop:i}of t.values())i(),t.delete(n)}return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return await this.off(e,t)}static buildClass(e){class t extends _i{constructor(i,s=null){super(i,e,s)}}return t}static from(e,t,n){return n==null&&(n=null),new this(e,t,n)}}function L2(){return _i}class Li extends L2(){}function Ca(r){return r.match(/^ipfs:\/\/ipfs\//i)?r=r.substring(12):r.match(/^ipfs:\/\//i)?r=r.substring(7):_(!1,"unsupported IPFS format","link",r),`https://gateway.ipfs.io/ipfs/${r}`}class D2{name;constructor(e){q(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,t){throw new Error("unsupported coin")}async decodeAddress(e,t){throw new Error("unsupported coin")}}const Fg=new RegExp("^(ipfs)://(.*)$","i"),Ll=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),Fg,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];class Qn{provider;address;name;#e;#t;constructor(e,t,n){q(this,{provider:e,address:t,name:n}),this.#e=null,this.#t=new Li(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e)}async supportsWildcard(){return this.#e==null&&(this.#e=(async()=>{try{return await this.#t.supportsInterface("0x9061b923")}catch(e){if(ze(e,"CALL_EXCEPTION"))return!1;throw this.#e=null,e}})()),await this.#e}async#r(e,t){t=(t||[]).slice();const n=this.#t.interface;t.unshift(Nc(this.name));let i=null;await this.supportsWildcard()&&(i=n.getFunction(e),F(i,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),t=[Z1(this.name,255),n.encodeFunctionData(i,t)],e="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const s=await this.#t[e](...t);return i?n.decodeFunctionResult(i,s)[0]:s}catch(s){if(!ze(s,"CALL_EXCEPTION"))throw s}return null}async getAddress(e){if(e==null&&(e=60),e===60)try{const s=await this.#r("addr(bytes32)");return s==null||s===Gi?null:s}catch(s){if(ze(s,"CALL_EXCEPTION"))return null;throw s}if(e>=0&&e<2147483648){let s=e+2147483648;const o=await this.#r("addr(bytes32,uint)",[s]);if(xe(o,20))return te(o)}let t=null;for(const s of this.provider.plugins)if(s instanceof D2&&s.supportsCoinType(e)){t=s;break}if(t==null)return null;const n=await this.#r("addr(bytes32,uint)",[e]);if(n==null||n==="0x")return null;const i=await t.decodeAddress(e,n);if(i!=null)return i;F(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:n}})}async getText(e){const t=await this.#r("text(bytes32,string)",[e]);return t==null||t==="0x"?null:t}async getContentHash(){const e=await this.#r("contenthash(bytes32)");if(e==null||e==="0x")return null;const t=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const i=t[1]==="e3010170"?"ipfs":"ipns",s=parseInt(t[4],16);if(t[5].length===s*2)return`${i}://${Ih("0x"+t[2])}`}const n=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(n&&n[1].length===64)return`bzz://${n[1]}`;F(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const e=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(t==null)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:t});for(let n=0;n<Ll.length;n++){const i=t.match(Ll[n]);if(i==null)continue;const s=i[1].toLowerCase();switch(s){case"https":case"data":return e.push({type:"url",value:t}),{linkage:e,url:t};case"ipfs":{const o=Ca(t);return e.push({type:"ipfs",value:t}),e.push({type:"url",value:o}),{linkage:e,url:o}}case"erc721":case"erc1155":{const o=s==="erc721"?"tokenURI(uint256)":"uri(uint256)";e.push({type:s,value:t});const a=await this.getAddress();if(a==null)return e.push({type:"!owner",value:""}),{url:null,linkage:e};const c=(i[2]||"").split("/");if(c.length!==2)return e.push({type:`!${s}caip`,value:i[2]||""}),{url:null,linkage:e};const u=c[1],l=new Li(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(s==="erc721"){const x=await l.ownerOf(u);if(a!==x)return e.push({type:"!owner",value:x}),{url:null,linkage:e};e.push({type:"owner",value:x})}else if(s==="erc1155"){const x=await l.balanceOf(a,u);if(!x)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:x.toString()})}let f=await l[o](u);if(f==null||f==="0x")return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:f}),s==="erc1155"&&(f=f.replace("{id}",wr(u,32).substring(2)),e.push({type:"metadata-url-expanded",value:f})),f.match(/^ipfs:/i)&&(f=Ca(f)),e.push({type:"metadata-url",value:f});let d={};const p=await new Xt(f).send();p.assertOk();try{d=p.bodyJson}catch{try{e.push({type:"!metadata",value:p.bodyText})}catch{const w=p.body;return w&&e.push({type:"!metadata",value:G(w)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!d)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(d)});let h=d.image;if(typeof h!="string")return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(!h.match(/^(https:\/\/|data:)/i)){if(h.match(Fg)==null)return e.push({type:"!imageUrl-ipfs",value:h}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:h}),h=Ca(h)}return e.push({type:"url",value:h}),{linkage:e,url:h}}}}}catch{}return{linkage:e,url:null}}static async getEnsAddress(e){const t=await e.getNetwork(),n=t.getPlugin("org.ethers.plugins.network.Ens");return F(n,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),n.address}static async#n(e,t){const n=await Qn.getEnsAddress(e);try{const s=await new Li(n,["function resolver(bytes32) view returns (address)"],e).resolver(Nc(t),{enableCcipRead:!0});return s===Gi?null:s}catch(i){throw i}return null}static async fromName(e,t){let n=t;for(;;){if(n===""||n==="."||t!=="eth"&&n==="eth")return null;const i=await Qn.#n(e,n);if(i!=null){const s=new Qn(e,i,t);return n!==t&&!await s.supportsWildcard()?null:s}n=n.split(".").slice(1).join(".")}}}const Dl=BigInt(0);function oe(r,e){return(function(t){return t==null?e:r(t)})}function Ji(r,e){return(t=>{if(e&&t==null)return null;if(!Array.isArray(t))throw new Error("not an array");return t.map(n=>r(n))})}function as(r,e){return(t=>{const n={};for(const i in r){let s=i;if(e&&i in e&&!(s in t)){for(const o of e[i])if(o in t){s=o;break}}try{const o=r[i](t[s]);o!==void 0&&(n[i]=o)}catch(o){const a=o instanceof Error?o.message:"not-an-error";F(!1,`invalid value for value.${i} (${a})`,"BAD_DATA",{value:t})}}return n})}function M2(r){switch(r){case!0:case"true":return!0;case!1:case"false":return!1}_(!1,`invalid boolean; ${JSON.stringify(r)}`,"value",r)}function oi(r){return _(xe(r,!0),"invalid data","value",r),r}function je(r){return _(xe(r,32),"invalid hash","value",r),r}const $2=as({address:te,blockHash:je,blockNumber:ee,data:oi,index:ee,removed:oe(M2,!1),topics:Ji(je),transactionHash:je,transactionIndex:ee},{index:["logIndex"]});function F2(r){return $2(r)}const G2=as({hash:oe(je),parentHash:je,parentBeaconBlockRoot:oe(je,null),number:ee,timestamp:ee,nonce:oe(oi),difficulty:z,gasLimit:z,gasUsed:z,stateRoot:oe(je,null),receiptsRoot:oe(je,null),blobGasUsed:oe(z,null),excessBlobGas:oe(z,null),miner:oe(te),prevRandao:oe(je,null),extraData:oi,baseFeePerGas:oe(z)},{prevRandao:["mixHash"]});function H2(r){const e=G2(r);return e.transactions=r.transactions.map(t=>typeof t=="string"?t:Gg(t)),e}const K2=as({transactionIndex:ee,blockNumber:ee,transactionHash:je,address:te,topics:Ji(je),data:oi,index:ee,blockHash:je},{index:["logIndex"]});function j2(r){return K2(r)}const z2=as({to:oe(te,null),from:oe(te,null),contractAddress:oe(te,null),index:ee,root:oe(G),gasUsed:z,blobGasUsed:oe(z,null),logsBloom:oe(oi),blockHash:je,hash:je,logs:Ji(j2),blockNumber:ee,cumulativeGasUsed:z,effectiveGasPrice:oe(z),blobGasPrice:oe(z,null),status:oe(ee),type:oe(ee,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function V2(r){return z2(r)}function Gg(r){r.to&&z(r.to)===Dl&&(r.to="0x0000000000000000000000000000000000000000");const e=as({hash:je,index:oe(ee,void 0),type:t=>t==="0x"||t==null?0:ee(t),accessList:oe(kn,null),blobVersionedHashes:oe(Ji(je,!0),null),authorizationList:oe(Ji(t=>{let n;if(t.signature)n=t.signature;else{let i=t.yParity;i==="0x1b"?i=0:i==="0x1c"&&(i=1),n=Object.assign({},t,{yParity:i})}return{address:te(t.address),chainId:z(t.chainId),nonce:z(t.nonce),signature:Ce.from(n)}},!1),null),blockHash:oe(je,null),blockNumber:oe(ee,null),transactionIndex:oe(ee,null),from:te,gasPrice:oe(z),maxPriorityFeePerGas:oe(z),maxFeePerGas:oe(z),maxFeePerBlobGas:oe(z,null),gasLimit:z,to:oe(te,null),value:z,nonce:ee,data:oi,creates:oe(te,null),chainId:oe(z,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(r);if(e.to==null&&e.creates==null&&(e.creates=Rm(e)),(r.type===1||r.type===2)&&r.accessList==null&&(e.accessList=[]),r.signature?e.signature=Ce.from(r.signature):e.signature=Ce.from(r),e.chainId==null){const t=e.signature.legacyChainId;t!=null&&(e.chainId=t)}return e.blockHash&&z(e.blockHash)===Dl&&(e.blockHash=null),e}const W2="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class cs{name;constructor(e){q(this,{name:e})}clone(){return new cs(this.name)}}class Ho extends cs{effectiveBlock;txBase;txCreate;txDataZero;txDataNonzero;txAccessListStorageKey;txAccessListAddress;constructor(e,t){e==null&&(e=0),super(`org.ethers.network.plugins.GasCost#${e||0}`);const n={effectiveBlock:e};function i(s,o){let a=(t||{})[s];a==null&&(a=o),_(typeof a=="number",`invalud value for ${s}`,"costs",t),n[s]=a}i("txBase",21e3),i("txCreate",32e3),i("txDataZero",4),i("txDataNonzero",16),i("txAccessListStorageKey",1900),i("txAccessListAddress",2400),q(this,n)}clone(){return new Ho(this.effectiveBlock,this)}}class Ko extends cs{address;targetNetwork;constructor(e,t){super("org.ethers.plugins.network.Ens"),q(this,{address:e||W2,targetNetwork:t??1})}clone(){return new Ko(this.address,this.targetNetwork)}}class J2 extends cs{#e;#t;get url(){return this.#e}get processFunc(){return this.#t}constructor(e,t){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),this.#e=e,this.#t=t}clone(){return this}}const Ia=new Map;class xt{#e;#t;#r;constructor(e,t){this.#e=e,this.#t=z(t),this.#r=new Map}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return this.#e}set name(e){this.#e=e}get chainId(){return this.#t}set chainId(e){this.#t=z(e,"chainId")}matches(e){if(e==null)return!1;if(typeof e=="string"){try{return this.chainId===z(e)}catch{}return this.name===e}if(typeof e=="number"||typeof e=="bigint"){try{return this.chainId===z(e)}catch{}return!1}if(typeof e=="object"){if(e.chainId!=null){try{return this.chainId===z(e.chainId)}catch{}return!1}return e.name!=null?this.name===e.name:!1}return!1}get plugins(){return Array.from(this.#r.values())}attachPlugin(e){if(this.#r.get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return this.#r.set(e.name,e.clone()),this}getPlugin(e){return this.#r.get(e)||null}getPlugins(e){return this.plugins.filter(t=>t.name.split("#")[0]===e)}clone(){const e=new xt(this.name,this.chainId);return this.plugins.forEach(t=>{e.attachPlugin(t.clone())}),e}computeIntrinsicGas(e){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new Ho;let n=t.txBase;if(e.to==null&&(n+=t.txCreate),e.data)for(let i=2;i<e.data.length;i+=2)e.data.substring(i,i+2)==="00"?n+=t.txDataZero:n+=t.txDataNonzero;if(e.accessList){const i=kn(e.accessList);for(const s in i)n+=t.txAccessListAddress+t.txAccessListStorageKey*i[s].storageKeys.length}return n}static from(e){if(Q2(),e==null)return xt.from("mainnet");if(typeof e=="number"&&(e=BigInt(e)),typeof e=="string"||typeof e=="bigint"){const t=Ia.get(e);if(t)return t();if(typeof e=="bigint")return new xt("unknown",e);_(!1,"unknown network","network",e)}if(typeof e.clone=="function")return e.clone();if(typeof e=="object"){_(typeof e.name=="string"&&typeof e.chainId=="number","invalid network object name or chainId","network",e);const t=new xt(e.name,e.chainId);return(e.ensAddress||e.ensNetwork!=null)&&t.attachPlugin(new Ko(e.ensAddress,e.ensNetwork)),t}_(!1,"invalid network","network",e)}static register(e,t){typeof e=="number"&&(e=BigInt(e));const n=Ia.get(e);n&&_(!1,`conflicting network for ${JSON.stringify(n.name)}`,"nameOrChainId",e),Ia.set(e,t)}}function Ml(r,e){const t=String(r);if(!t.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${r}`);const n=t.split(".");if(n.length===1&&n.push(""),n.length!==2)throw new Error(`invalid gwei value: ${r}`);for(;n[1].length<e;)n[1]+="0";if(n[1].length>9){let i=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||i++,n[1]=i.toString()}return BigInt(n[0]+n[1])}function $l(r){return new J2(r,async(e,t,n)=>{n.setHeader("User-Agent","ethers");let i;try{const[s,o]=await Promise.all([n.send(),e()]);i=s;const a=i.bodyJson.standard;return{gasPrice:o.gasPrice,maxFeePerGas:Ml(a.maxFee,9),maxPriorityFeePerGas:Ml(a.maxPriorityFee,9)}}catch(s){F(!1,`error encountered with polygon gas station (${JSON.stringify(n.url)})`,"SERVER_ERROR",{request:n,response:i,error:s})}})}let Fl=!1;function Q2(){if(Fl)return;Fl=!0;function r(e,t,n){const i=function(){const s=new xt(e,t);return n.ensNetwork!=null&&s.attachPlugin(new Ko(null,n.ensNetwork)),s.attachPlugin(new Ho),(n.plugins||[]).forEach(o=>{s.attachPlugin(o)}),s};xt.register(e,i),xt.register(t,i),n.altNames&&n.altNames.forEach(s=>{xt.register(s,i)})}r("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),r("ropsten",3,{ensNetwork:3}),r("rinkeby",4,{ensNetwork:4}),r("goerli",5,{ensNetwork:5}),r("kovan",42,{ensNetwork:42}),r("sepolia",11155111,{ensNetwork:11155111}),r("holesky",17e3,{ensNetwork:17e3}),r("classic",61,{}),r("classicKotti",6,{}),r("arbitrum",42161,{ensNetwork:1}),r("arbitrum-goerli",421613,{}),r("arbitrum-sepolia",421614,{}),r("base",8453,{ensNetwork:1}),r("base-goerli",84531,{}),r("base-sepolia",84532,{}),r("bnb",56,{ensNetwork:1}),r("bnbt",97,{}),r("linea",59144,{ensNetwork:1}),r("linea-goerli",59140,{}),r("linea-sepolia",59141,{}),r("matic",137,{ensNetwork:1,plugins:[$l("https://gasstation.polygon.technology/v2")]}),r("matic-amoy",80002,{}),r("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[$l("https://gasstation-testnet.polygon.technology/v2")]}),r("optimism",10,{ensNetwork:1,plugins:[]}),r("optimism-goerli",420,{}),r("optimism-sepolia",11155420,{}),r("xdai",100,{ensNetwork:1})}function Rc(r){return JSON.parse(JSON.stringify(r))}class q2{#e;#t;#r;#n;constructor(e){this.#e=e,this.#t=null,this.#r=4e3,this.#n=-2}get pollingInterval(){return this.#r}set pollingInterval(e){this.#r=e}async#i(){try{const e=await this.#e.getBlockNumber();if(this.#n===-2){this.#n=e;return}if(e!==this.#n){for(let t=this.#n+1;t<=e;t++){if(this.#t==null)return;await this.#e.emit("block",t)}this.#n=e}}catch{}this.#t!=null&&(this.#t=this.#e._setTimeout(this.#i.bind(this),this.#r))}start(){this.#t||(this.#t=this.#e._setTimeout(this.#i.bind(this),this.#r),this.#i())}stop(){this.#t&&(this.#e._clearTimeout(this.#t),this.#t=null)}pause(e){this.stop(),e&&(this.#n=-2)}resume(){this.start()}}class Iu{#e;#t;#r;constructor(e){this.#e=e,this.#r=!1,this.#t=t=>{this._poll(t,this.#e)}}async _poll(e,t){throw new Error("sub-classes must override this")}start(){this.#r||(this.#r=!0,this.#t(-2),this.#e.on("block",this.#t))}stop(){this.#r&&(this.#r=!1,this.#e.off("block",this.#t))}pause(e){this.stop()}resume(){this.start()}}class Z2 extends Iu{#e;#t;constructor(e,t){super(e),this.#e=t,this.#t=-2}pause(e){e&&(this.#t=-2),super.pause(e)}async _poll(e,t){const n=await t.getBlock(this.#e);n!=null&&(this.#t===-2?this.#t=n.number:n.number>this.#t&&(t.emit(this.#e,n.number),this.#t=n.number))}}class Y2 extends Iu{#e;constructor(e,t){super(e),this.#e=Rc(t)}async _poll(e,t){throw new Error("@TODO")}}class X2 extends Iu{#e;constructor(e,t){super(e),this.#e=t}async _poll(e,t){const n=await t.getTransactionReceipt(this.#e);n&&t.emit(this.#e,n)}}class ku{#e;#t;#r;#n;#i;constructor(e,t){this.#e=e,this.#t=Rc(t),this.#r=this.#o.bind(this),this.#n=!1,this.#i=-2}async#o(e){if(this.#i===-2)return;const t=Rc(this.#t);t.fromBlock=this.#i+1,t.toBlock=e;const n=await this.#e.getLogs(t);if(n.length===0){this.#i<e-60&&(this.#i=e-60);return}for(const i of n)this.#e.emit(this.#t,i),this.#i=i.blockNumber}start(){this.#n||(this.#n=!0,this.#i===-2&&this.#e.getBlockNumber().then(e=>{this.#i=e}),this.#e.on("block",this.#r))}stop(){this.#n&&(this.#n=!1,this.#e.off("block",this.#r))}pause(e){this.stop(),e&&(this.#i=-2)}resume(){this.start()}}const eA=BigInt(2),tA=10;function Is(r){return r&&typeof r.then=="function"}function js(r,e){return r+":"+JSON.stringify(e,(t,n)=>{if(n==null)return"null";if(typeof n=="bigint")return`bigint:${n.toString()}`;if(typeof n=="string")return n.toLowerCase();if(typeof n=="object"&&!Array.isArray(n)){const i=Object.keys(n);return i.sort(),i.reduce((s,o)=>(s[o]=n[o],s),{})}return n})}class Hg{name;constructor(e){q(this,{name:e})}start(){}stop(){}pause(e){}resume(){}}function rA(r){return JSON.parse(JSON.stringify(r))}function Bc(r){return r=Array.from(new Set(r).values()),r.sort(),r}async function ka(r,e){if(r==null)throw new Error("invalid event");if(Array.isArray(r)&&(r={topics:r}),typeof r=="string")switch(r){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:r,tag:r}}if(xe(r,32)){const t=r.toLowerCase();return{type:"transaction",tag:js("tx",{hash:t}),hash:t}}if(r.orphan){const t=r;return{type:"orphan",tag:js("orphan",t),filter:rA(t)}}if(r.address||r.topics){const t=r,n={topics:(t.topics||[]).map(i=>i==null?null:Array.isArray(i)?Bc(i.map(s=>s.toLowerCase())):i.toLowerCase())};if(t.address){const i=[],s=[],o=a=>{xe(a)?i.push(a):s.push((async()=>{i.push(await $e(a,e))})())};Array.isArray(t.address)?t.address.forEach(o):o(t.address),s.length&&await Promise.all(s),n.address=Bc(i.map(a=>a.toLowerCase()))}return{filter:n,tag:js("event",n),type:"event"}}_(!1,"unknown ProviderEvent","event",r)}function Ta(){return new Date().getTime()}const nA={cacheTimeout:250,pollingInterval:4e3};class iA{#e;#t;#r;#n;#i;#o;#s;#a;#h;#u;#g;#p;constructor(e,t){if(this.#p=Object.assign({},nA,t||{}),e==="any")this.#o=!0,this.#i=null;else if(e){const n=xt.from(e);this.#o=!1,this.#i=Promise.resolve(n),setTimeout(()=>{this.emit("network",n,null)},0)}else this.#o=!1,this.#i=null;this.#a=-1,this.#s=new Map,this.#e=new Map,this.#t=new Map,this.#r=null,this.#n=!1,this.#h=1,this.#u=new Map,this.#g=!1}get pollingInterval(){return this.#p.pollingInterval}get provider(){return this}get plugins(){return Array.from(this.#t.values())}attachPlugin(e){if(this.#t.get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return this.#t.set(e.name,e.connect(this)),this}getPlugin(e){return this.#t.get(e)||null}get disableCcipRead(){return this.#g}set disableCcipRead(e){this.#g=!!e}async#c(e){const t=this.#p.cacheTimeout;if(t<0)return await this._perform(e);const n=js(e.method,e);let i=this.#s.get(n);return i||(i=this._perform(e),this.#s.set(n,i),setTimeout(()=>{this.#s.get(n)===i&&this.#s.delete(n)},t)),await i}async ccipReadFetch(e,t,n){if(this.disableCcipRead||n.length===0||e.to==null)return null;const i=e.to.toLowerCase(),s=t.toLowerCase(),o=[];for(let a=0;a<n.length;a++){const c=n[a],u=c.replace("{sender}",i).replace("{data}",s),l=new Xt(u);c.indexOf("{data}")===-1&&(l.body={data:s,sender:i}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:l,index:a,urls:n});let f="unknown error",d;try{d=await l.send()}catch(p){o.push(p.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:l,result:{error:p}});continue}try{const p=d.bodyJson;if(p.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:l,result:p}),p.data;p.message&&(f=p.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:l,result:p})}catch{}F(d.statusCode<400||d.statusCode>=500,`response not found during CCIP fetch: ${f}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:c,errorMessage:f}}),o.push(f)}F(!1,`error encountered during CCIP fetch: ${o.map(a=>JSON.stringify(a)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:n,errorMessages:o}})}_wrapBlock(e,t){return new E2(H2(e),this)}_wrapLog(e,t){return new ss(F2(e),this)}_wrapTransactionReceipt(e,t){return new Pg(V2(e),this)}_wrapTransactionResponse(e,t){return new os(Gg(e),this)}_detectNetwork(){F(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){F(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){const e=ee(await this.#c({method:"getBlockNumber"}),"%response");return this.#a>=0&&(this.#a=e),e}_getAddress(e){return $e(e,this)}_getBlockTag(e){if(e==null)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}if(xe(e))return xe(e,32)?e:Rt(e);if(typeof e=="bigint"&&(e=ee(e,"blockTag")),typeof e=="number")return e>=0?Rt(e):this.#a>=0?Rt(this.#a+e):this.getBlockNumber().then(t=>Rt(t+e));_(!1,"invalid blockTag","blockTag",e)}_getFilter(e){const t=(e.topics||[]).map(c=>c==null?null:Array.isArray(c)?Bc(c.map(u=>u.toLowerCase())):c.toLowerCase()),n="blockHash"in e?e.blockHash:void 0,i=(c,u,l)=>{let f;switch(c.length){case 0:break;case 1:f=c[0];break;default:c.sort(),f=c}if(n&&(u!=null||l!=null))throw new Error("invalid filter");const d={};return f&&(d.address=f),t.length&&(d.topics=t),u&&(d.fromBlock=u),l&&(d.toBlock=l),n&&(d.blockHash=n),d};let s=[];if(e.address)if(Array.isArray(e.address))for(const c of e.address)s.push(this._getAddress(c));else s.push(this._getAddress(e.address));let o;"fromBlock"in e&&(o=this._getBlockTag(e.fromBlock));let a;return"toBlock"in e&&(a=this._getBlockTag(e.toBlock)),s.filter(c=>typeof c!="string").length||o!=null&&typeof o!="string"||a!=null&&typeof a!="string"?Promise.all([Promise.all(s),o,a]).then(c=>i(c[0],c[1],c[2])):i(s,o,a)}_getTransactionRequest(e){const t=Wi(e),n=[];if(["to","from"].forEach(i=>{if(t[i]==null)return;const s=$e(t[i],this);Is(s)?n.push((async function(){t[i]=await s})()):t[i]=s}),t.blockTag!=null){const i=this._getBlockTag(t.blockTag);Is(i)?n.push((async function(){t.blockTag=await i})()):t.blockTag=i}return n.length?(async function(){return await Promise.all(n),t})():t}async getNetwork(){if(this.#i==null){const i=(async()=>{try{const s=await this._detectNetwork();return this.emit("network",s,null),s}catch(s){throw this.#i===i&&(this.#i=null),s}})();return this.#i=i,(await i).clone()}const e=this.#i,[t,n]=await Promise.all([e,this._detectNetwork()]);return t.chainId!==n.chainId&&(this.#o?(this.emit("network",n,t),this.#i===e&&(this.#i=Promise.resolve(n))):F(!1,`network changed: ${t.chainId} => ${n.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const e=await this.getNetwork(),t=async()=>{const{_block:i,gasPrice:s,priorityFee:o}=await Ze({_block:this.#b("latest",!1),gasPrice:(async()=>{try{const l=await this.#c({method:"getGasPrice"});return z(l,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const l=await this.#c({method:"getPriorityFee"});return z(l,"%response")}catch{}return null})()});let a=null,c=null;const u=this._wrapBlock(i,e);return u&&u.baseFeePerGas&&(c=o??BigInt("1000000000"),a=u.baseFeePerGas*eA+c),new Rl(s,a,c)},n=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(n){const i=new Xt(n.url),s=await n.processFunc(t,this,i);return new Rl(s.gasPrice,s.maxFeePerGas,s.maxPriorityFeePerGas)}return await t()}async estimateGas(e){let t=this._getTransactionRequest(e);return Is(t)&&(t=await t),z(await this.#c({method:"estimateGas",transaction:t}),"%response")}async#f(e,t,n){F(n<tA,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:t,enableCcipRead:!0})});const i=Wi(e);try{return G(await this._perform({method:"call",transaction:i,blockTag:t}))}catch(s){if(!this.disableCcipRead&&ru(s)&&s.data&&n>=0&&t==="latest"&&i.to!=null&&be(s.data,0,4)==="0x556f1830"){const o=s.data,a=await $e(i.to,this);let c;try{c=uA(be(s.data,4))}catch(f){F(!1,f.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:i,info:{data:o}})}F(c.sender.toLowerCase()===a.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:o,reason:"OffchainLookup",transaction:i,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const u=await this.ccipReadFetch(i,c.calldata,c.urls);F(u!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:i,info:{data:s.data,errorArgs:c.errorArgs}});const l={to:a,data:he([c.selector,cA([u,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:l});try{const f=await this.#f(l,t,n+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},l),result:f}),f}catch(f){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},l),error:f}),f}}throw s}}async#l(e){const{value:t}=await Ze({network:this.getNetwork(),value:e});return t}async call(e){const{tx:t,blockTag:n}=await Ze({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await this.#l(this.#f(t,n,e.enableCcipRead?0:-1))}async#d(e,t,n){let i=this._getAddress(t),s=this._getBlockTag(n);return(typeof i!="string"||typeof s!="string")&&([i,s]=await Promise.all([i,s])),await this.#l(this.#c(Object.assign(e,{address:i,blockTag:s})))}async getBalance(e,t){return z(await this.#d({method:"getBalance"},e,t),"%response")}async getTransactionCount(e,t){return ee(await this.#d({method:"getTransactionCount"},e,t),"%response")}async getCode(e,t){return G(await this.#d({method:"getCode"},e,t))}async getStorage(e,t,n){const i=z(t,"position");return G(await this.#d({method:"getStorage",position:i},e,n))}async broadcastTransaction(e){const{blockNumber:t,hash:n,network:i}=await Ze({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),s=Ct.from(e);if(s.hash!==n)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(s,i).replaceableTransaction(t)}async#b(e,t){if(xe(e,32))return await this.#c({method:"getBlock",blockHash:e,includeTransactions:t});let n=this._getBlockTag(e);return typeof n!="string"&&(n=await n),await this.#c({method:"getBlock",blockTag:n,includeTransactions:t})}async getBlock(e,t){const{network:n,params:i}=await Ze({network:this.getNetwork(),params:this.#b(e,!!t)});return i==null?null:this._wrapBlock(i,n)}async getTransaction(e){const{network:t,params:n}=await Ze({network:this.getNetwork(),params:this.#c({method:"getTransaction",hash:e})});return n==null?null:this._wrapTransactionResponse(n,t)}async getTransactionReceipt(e){const{network:t,params:n}=await Ze({network:this.getNetwork(),params:this.#c({method:"getTransactionReceipt",hash:e})});if(n==null)return null;if(n.gasPrice==null&&n.effectiveGasPrice==null){const i=await this.#c({method:"getTransaction",hash:e});if(i==null)throw new Error("report this; could not find tx or effectiveGasPrice");n.effectiveGasPrice=i.gasPrice}return this._wrapTransactionReceipt(n,t)}async getTransactionResult(e){const{result:t}=await Ze({network:this.getNetwork(),result:this.#c({method:"getTransactionResult",hash:e})});return t==null?null:G(t)}async getLogs(e){let t=this._getFilter(e);Is(t)&&(t=await t);const{network:n,params:i}=await Ze({network:this.getNetwork(),params:this.#c({method:"getLogs",filter:t})});return i.map(s=>this._wrapLog(s,n))}_getProvider(e){F(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await Qn.fromName(this,e)}async getAvatar(e){const t=await this.getResolver(e);return t?await t.getAvatar():null}async resolveName(e){const t=await this.getResolver(e);return t?await t.getAddress():null}async lookupAddress(e){e=te(e);const t=Nc(e.substring(2).toLowerCase()+".addr.reverse");try{const n=await Qn.getEnsAddress(this),s=await new Li(n,["function resolver(bytes32) view returns (address)"],this).resolver(t);if(s==null||s===Gi)return null;const a=await new Li(s,["function name(bytes32) view returns (string)"],this).name(t);return await this.resolveName(a)!==e?null:a}catch(n){if(ze(n,"BAD_DATA")&&n.value==="0x"||ze(n,"CALL_EXCEPTION"))return null;throw n}return null}async waitForTransaction(e,t,n){const i=t??1;return i===0?this.getTransactionReceipt(e):new Promise(async(s,o)=>{let a=null;const c=(async u=>{try{const l=await this.getTransactionReceipt(e);if(l!=null&&u-l.blockNumber+1>=i){s(l),a&&(clearTimeout(a),a=null);return}}catch(l){console.log("EEE",l)}this.once("block",c)});n!=null&&(a=setTimeout(()=>{a!=null&&(a=null,this.off("block",c),o(me("timeout","TIMEOUT",{reason:"timeout"})))},n)),c(await this.getBlockNumber())})}async waitForBlock(e){F(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){const t=this.#u.get(e);t&&(t.timer&&clearTimeout(t.timer),this.#u.delete(e))}_setTimeout(e,t){t==null&&(t=0);const n=this.#h++,i=()=>{this.#u.delete(n),e()};if(this.paused)this.#u.set(n,{timer:null,func:i,time:t});else{const s=setTimeout(i,t);this.#u.set(n,{timer:s,func:i,time:Ta()})}return n}_forEachSubscriber(e){for(const t of this.#e.values())e(t.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new Hg(e.type);case"block":{const t=new q2(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new Z2(this,e.type);case"event":return new ku(this,e.filter);case"transaction":return new X2(this,e.hash);case"orphan":return new Y2(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,t){for(const n of this.#e.values())if(n.subscriber===e){n.started&&n.subscriber.stop(),n.subscriber=t,n.started&&t.start(),this.#r!=null&&t.pause(this.#r);break}}async#x(e,t){let n=await ka(e,this);return n.type==="event"&&t&&t.length>0&&t[0].removed===!0&&(n=await ka({orphan:"drop-log",log:t[0]},this)),this.#e.get(n.tag)||null}async#y(e){const t=await ka(e,this),n=t.tag;let i=this.#e.get(n);return i||(i={subscriber:this._getSubscriber(t),tag:n,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},this.#e.set(n,i)),i}async on(e,t){const n=await this.#y(e);return n.listeners.push({listener:t,once:!1}),n.started||(n.subscriber.start(),n.started=!0,this.#r!=null&&n.subscriber.pause(this.#r)),this}async once(e,t){const n=await this.#y(e);return n.listeners.push({listener:t,once:!0}),n.started||(n.subscriber.start(),n.started=!0,this.#r!=null&&n.subscriber.pause(this.#r)),this}async emit(e,...t){const n=await this.#x(e,t);if(!n||n.listeners.length===0)return!1;const i=n.listeners.length;return n.listeners=n.listeners.filter(({listener:s,once:o})=>{const a=new kh(this,o?null:s,e);try{s.call(this,...t,a)}catch{}return!o}),n.listeners.length===0&&(n.started&&n.subscriber.stop(),this.#e.delete(n.tag)),i>0}async listenerCount(e){if(e){const n=await this.#x(e);return n?n.listeners.length:0}let t=0;for(const{listeners:n}of this.#e.values())t+=n.length;return t}async listeners(e){if(e){const n=await this.#x(e);return n?n.listeners.map(({listener:i})=>i):[]}let t=[];for(const{listeners:n}of this.#e.values())t=t.concat(n.map(({listener:i})=>i));return t}async off(e,t){const n=await this.#x(e);if(!n)return this;if(t){const i=n.listeners.map(({listener:s})=>s).indexOf(t);i>=0&&n.listeners.splice(i,1)}return(!t||n.listeners.length===0)&&(n.started&&n.subscriber.stop(),this.#e.delete(n.tag)),this}async removeAllListeners(e){if(e){const{tag:t,started:n,subscriber:i}=await this.#y(e);n&&i.stop(),this.#e.delete(t)}else for(const[t,{started:n,subscriber:i}]of this.#e)n&&i.stop(),this.#e.delete(t);return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return this.off(e,t)}get destroyed(){return this.#n}destroy(){this.removeAllListeners();for(const e of this.#u.keys())this._clearTimeout(e);this.#n=!0}get paused(){return this.#r!=null}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(this.#a=-1,this.#r!=null){if(this.#r==!!e)return;F(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(e)),this.#r=!!e;for(const t of this.#u.values())t.timer&&clearTimeout(t.timer),t.time=Ta()-t.time}resume(){if(this.#r!=null){this._forEachSubscriber(e=>e.resume()),this.#r=null;for(const e of this.#u.values()){let t=e.time;t<0&&(t=0),e.time=Ta(),setTimeout(e.func,t)}}}}function sA(r,e){try{const t=_c(r,e);if(t)return to(t)}catch{}return null}function _c(r,e){if(r==="0x")return null;try{const t=ee(be(r,e,e+32)),n=ee(be(r,t,t+32));return be(r,t+32,t+32+n)}catch{}return null}function Gl(r){const e=ke(r);if(e.length>32)throw new Error("internal; should not happen");const t=new Uint8Array(32);return t.set(e,32-e.length),t}function oA(r){if(r.length%32===0)return r;const e=new Uint8Array(Math.ceil(r.length/32)*32);return e.set(r),e}const aA=new Uint8Array([]);function cA(r){const e=[];let t=0;for(let n=0;n<r.length;n++)e.push(aA),t+=32;for(let n=0;n<r.length;n++){const i=K(r[n]);e[n]=Gl(t),e.push(Gl(i.length)),e.push(oA(i)),t+=32+Math.ceil(i.length/32)*32}return he(e)}const Hl="0x0000000000000000000000000000000000000000000000000000000000000000";function uA(r){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};F(zn(r)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const t=be(r,0,32);F(be(t,0,12)===be(Hl,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=be(t,12);try{const n=[],i=ee(be(r,32,64)),s=ee(be(r,i,i+32)),o=be(r,i+32);for(let a=0;a<s;a++){const c=sA(o,a*32);if(c==null)throw new Error("abort");n.push(c)}e.urls=n}catch{F(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const n=_c(r,64);if(n==null)throw new Error("abort");e.calldata=n}catch{F(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}F(be(r,100,128)===be(Hl,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=be(r,96,100);try{const n=_c(r,128);if(n==null)throw new Error("abort");e.extraData=n}catch{F(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(n=>e[n]),e}function rn(r,e){if(r.provider)return r.provider;F(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function Kl(r,e){let t=Wi(e);if(t.to!=null&&(t.to=$e(t.to,r)),t.from!=null){const n=t.from;t.from=Promise.all([r.getAddress(),$e(n,r)]).then(([i,s])=>(_(i.toLowerCase()===s.toLowerCase(),"transaction from mismatch","tx.from",s),i))}else t.from=r.getAddress();return await Ze(t)}class Tu{provider;constructor(e){q(this,{provider:e||null})}async getNonce(e){return rn(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await Kl(this,e)}async populateTransaction(e){const t=rn(this,"populateTransaction"),n=await Kl(this,e);n.nonce==null&&(n.nonce=await this.getNonce("pending")),n.gasLimit==null&&(n.gasLimit=await this.estimateGas(n));const i=await this.provider.getNetwork();if(n.chainId!=null){const o=z(n.chainId);_(o===i.chainId,"transaction chainId mismatch","tx.chainId",e.chainId)}else n.chainId=i.chainId;const s=n.maxFeePerGas!=null||n.maxPriorityFeePerGas!=null;if(n.gasPrice!=null&&(n.type===2||s)?_(!1,"eip-1559 transaction do not support gasPrice","tx",e):(n.type===0||n.type===1)&&s&&_(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e),(n.type===2||n.type==null)&&n.maxFeePerGas!=null&&n.maxPriorityFeePerGas!=null)n.type=2;else if(n.type===0||n.type===1){const o=await t.getFeeData();F(o.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice)}else{const o=await t.getFeeData();if(n.type==null)if(o.maxFeePerGas!=null&&o.maxPriorityFeePerGas!=null)if(n.authorizationList&&n.authorizationList.length?n.type=4:n.type=2,n.gasPrice!=null){const a=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=a,n.maxPriorityFeePerGas=a}else n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas);else o.gasPrice!=null?(F(!s,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice),n.type=0):F(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(n.type===2||n.type===3||n.type===4)&&(n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas))}return await Ze(n)}async populateAuthorization(e){const t=Object.assign({},e);return t.chainId==null&&(t.chainId=(await rn(this,"getNetwork").getNetwork()).chainId),t.nonce==null&&(t.nonce=await this.getNonce()),t}async estimateGas(e){return rn(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return rn(this,"call").call(await this.populateCall(e))}async resolveName(e){return await rn(this,"resolveName").resolveName(e)}async sendTransaction(e){const t=rn(this,"sendTransaction"),n=await this.populateTransaction(e);delete n.from;const i=Ct.from(n);return await t.broadcastTransaction(await this.signTransaction(i))}authorize(e){F(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}class Pu extends Tu{address;constructor(e,t){super(t),q(this,{address:e})}async getAddress(){return this.address}connect(e){return new Pu(this.address,e)}#e(e,t){F(!1,`VoidSigner cannot sign ${e}`,"UNSUPPORTED_OPERATION",{operation:t})}async signTransaction(e){this.#e("transactions","signTransaction")}async signMessage(e){this.#e("messages","signMessage")}async signTypedData(e,t,n){this.#e("typed-data","signTypedData")}}function fA(r){return JSON.parse(JSON.stringify(r))}class Kg{#e;#t;#r;#n;#i;#o;constructor(e){this.#e=e,this.#t=null,this.#r=this.#s.bind(this),this.#n=!1,this.#i=null,this.#o=!1}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,t){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}async#s(e){try{this.#t==null&&(this.#t=this._subscribe(this.#e));let t=null;try{t=await this.#t}catch(s){if(!ze(s,"UNSUPPORTED_OPERATION")||s.operation!=="eth_newFilter")throw s}if(t==null){this.#t=null,this.#e._recoverSubscriber(this,this._recover(this.#e));return}const n=await this.#e.getNetwork();if(this.#i||(this.#i=n),this.#i.chainId!==n.chainId)throw new Error("chaid changed");if(this.#o)return;const i=await this.#e.send("eth_getFilterChanges",[t]);await this._emitResults(this.#e,i)}catch(t){console.log("@TODO",t)}this.#e.once("block",this.#r)}#a(){const e=this.#t;e&&(this.#t=null,e.then(t=>{this.#e.destroyed||this.#e.send("eth_uninstallFilter",[t])}))}start(){this.#n||(this.#n=!0,this.#s(-2))}stop(){this.#n&&(this.#n=!1,this.#o=!0,this.#a(),this.#e.off("block",this.#r))}pause(e){e&&this.#a(),this.#e.off("block",this.#r)}resume(){this.start()}}class lA extends Kg{#e;constructor(e,t){super(e),this.#e=fA(t)}_recover(e){return new ku(e,this.#e)}async _subscribe(e){return await e.send("eth_newFilter",[this.#e])}async _emitResults(e,t){for(const n of t)e.emit(this.#e,e._wrapLog(n,e._network))}}class dA extends Kg{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,t){for(const n of t)e.emit("pending",n)}}const hA="bigint,boolean,function,number,string,symbol".split(/,/g);function zs(r){if(r==null||hA.indexOf(typeof r)>=0||typeof r.getAddress=="function")return r;if(Array.isArray(r))return r.map(zs);if(typeof r=="object")return Object.keys(r).reduce((e,t)=>(e[t]=r[t],e),{});throw new Error(`should not happen: ${r} (${typeof r})`)}function gA(r){return new Promise(e=>{setTimeout(e,r)})}function Rn(r){return r&&r.toLowerCase()}function jl(r){return r&&typeof r.pollingInterval=="number"}const jg={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class Pa extends Tu{address;constructor(e,t){super(e),t=te(t),q(this,{address:t})}connect(e){F(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(e){return await this.populateCall(e)}async sendUncheckedTransaction(e){const t=zs(e),n=[];if(t.from){const s=t.from;n.push((async()=>{const o=await $e(s,this.provider);_(o!=null&&o.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",e),t.from=o})())}else t.from=this.address;if(t.gasLimit==null&&n.push((async()=>{t.gasLimit=await this.provider.estimateGas({...t,from:this.address})})()),t.to!=null){const s=t.to;n.push((async()=>{t.to=await $e(s,this.provider)})())}n.length&&await Promise.all(n);const i=this.provider.getRpcTransaction(t);return this.provider.send("eth_sendTransaction",[i])}async sendTransaction(e){const t=await this.provider.getBlockNumber(),n=await this.sendUncheckedTransaction(e);return await new Promise((i,s)=>{const o=[1e3,100];let a=0;const c=async()=>{try{const u=await this.provider.getTransaction(n);if(u!=null){i(u.replaceableTransaction(t));return}}catch(u){if(ze(u,"CANCELLED")||ze(u,"BAD_DATA")||ze(u,"NETWORK_ERROR")||ze(u,"UNSUPPORTED_OPERATION")){u.info==null&&(u.info={}),u.info.sendTransactionHash=n,s(u);return}if(ze(u,"INVALID_ARGUMENT")&&(a++,u.info==null&&(u.info={}),u.info.sendTransactionHash=n,a>10)){s(u);return}this.provider.emit("error",me("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:u}))}this.provider._setTimeout(()=>{c()},o.pop()||4e3)};c()})}async signTransaction(e){const t=zs(e);if(t.from){const i=await $e(t.from,this.provider);_(i!=null&&i.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",e),t.from=i}else t.from=this.address;const n=this.provider.getRpcTransaction(t);return await this.provider.send("eth_signTransaction",[n])}async signMessage(e){const t=typeof e=="string"?de(e):e;return await this.provider.send("personal_sign",[G(t),this.address.toLowerCase()])}async signTypedData(e,t,n){const i=zs(n),s=await tt.resolveNames(e,t,i,async o=>{const a=await $e(o);return _(a!=null,"TypedData does not support null address","value",o),a});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(tt.getPayload(s.domain,t,s.value))])}async unlock(e){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),e,null])}async _legacySignMessage(e){const t=typeof e=="string"?de(e):e;return await this.provider.send("eth_sign",[this.address.toLowerCase(),G(t)])}}class pA extends iA{#e;#t;#r;#n;#i;#o;#s;#a(){if(this.#n)return;const e=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");this.#n=setTimeout(()=>{this.#n=null;const t=this.#r;for(this.#r=[];t.length;){const n=[t.shift()];for(;t.length&&n.length!==this.#e.batchMaxCount;)if(n.push(t.shift()),JSON.stringify(n.map(s=>s.payload)).length>this.#e.batchMaxSize){t.unshift(n.pop());break}(async()=>{const i=n.length===1?n[0].payload:n.map(s=>s.payload);this.emit("debug",{action:"sendRpcPayload",payload:i});try{const s=await this._send(i);this.emit("debug",{action:"receiveRpcResult",result:s});for(const{resolve:o,reject:a,payload:c}of n){if(this.destroyed){a(me("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:c.method}));continue}const u=s.filter(l=>l.id===c.id)[0];if(u==null){const l=me("missing response for request","BAD_DATA",{value:s,info:{payload:c}});this.emit("error",l),a(l);continue}if("error"in u){a(this.getRpcError(c,u));continue}o(u.result)}}catch(s){this.emit("debug",{action:"receiveRpcError",error:s});for(const{reject:o}of n)o(s)}})()}},e)}constructor(e,t){super(e,t),this.#t=1,this.#e=Object.assign({},jg,t||{}),this.#r=[],this.#n=null,this.#o=null,this.#s=null;{let i=null;const s=new Promise(o=>{i=o});this.#i={promise:s,resolve:i}}const n=this._getOption("staticNetwork");typeof n=="boolean"?(_(!n||e!=="any","staticNetwork cannot be used on special network 'any'","options",t),n&&e!=null&&(this.#o=xt.from(e))):n&&(_(e==null||n.matches(e),"staticNetwork MUST match network object","options",t),this.#o=n)}_getOption(e){return this.#e[e]}get _network(){return F(this.#o,"network is not available yet","NETWORK_ERROR"),this.#o}async _perform(e){if(e.method==="call"||e.method==="estimateGas"){let n=e.transaction;if(n&&n.type!=null&&z(n.type)&&n.maxFeePerGas==null&&n.maxPriorityFeePerGas==null){const i=await this.getFeeData();i.maxFeePerGas==null&&i.maxPriorityFeePerGas==null&&(e=Object.assign({},e,{transaction:Object.assign({},n,{type:void 0})}))}}const t=this.getRpcRequest(e);return t!=null?await this.send(t.method,t.args):super._perform(e)}async _detectNetwork(){const e=this._getOption("staticNetwork");if(e)if(e===!0){if(this.#o)return this.#o}else return e;return this.#s?await this.#s:this.ready?(this.#s=(async()=>{try{const t=xt.from(z(await this.send("eth_chainId",[])));return this.#s=null,t}catch(t){throw this.#s=null,t}})(),await this.#s):(this.#s=(async()=>{const t={id:this.#t++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:t});let n;try{n=(await this._send(t))[0],this.#s=null}catch(i){throw this.#s=null,this.emit("debug",{action:"receiveRpcError",error:i}),i}if(this.emit("debug",{action:"receiveRpcResult",result:n}),"result"in n)return xt.from(z(n.result));throw this.getRpcError(t,n)})(),await this.#s)}_start(){this.#i==null||this.#i.resolve==null||(this.#i.resolve(),this.#i=null,(async()=>{for(;this.#o==null&&!this.destroyed;)try{this.#o=await this._detectNetwork()}catch(e){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",me("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:e}})),await gA(1e3)}this.#a()})())}async _waitUntilReady(){if(this.#i!=null)return await this.#i.promise}_getSubscriber(e){return e.type==="pending"?new dA(this):e.type==="event"?this._getOption("polling")?new ku(this,e.filter):new lA(this,e.filter):e.type==="orphan"&&e.filter.orphan==="drop-log"?new Hg("orphan"):super._getSubscriber(e)}get ready(){return this.#i==null}getRpcTransaction(e){const t={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(n=>{if(e[n]==null)return;let i=n;n==="gasLimit"&&(i="gas"),t[i]=Rt(z(e[n],`tx.${n}`))}),["from","to","data"].forEach(n=>{e[n]!=null&&(t[n]=G(e[n]))}),e.accessList&&(t.accessList=kn(e.accessList)),e.blobVersionedHashes&&(t.blobVersionedHashes=e.blobVersionedHashes.map(n=>n.toLowerCase())),e.authorizationList&&(t.authorizationList=e.authorizationList.map(n=>{const i=W0(n);return{address:i.address,nonce:Rt(i.nonce),chainId:Rt(i.chainId),yParity:Rt(i.signature.yParity),r:Rt(i.signature.r),s:Rt(i.signature.s)}})),t}getRpcRequest(e){switch(e.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[Rn(e.address),e.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[Rn(e.address),e.blockTag]};case"getCode":return{method:"eth_getCode",args:[Rn(e.address),e.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[Rn(e.address),"0x"+e.position.toString(16),e.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[e.signedTransaction]};case"getBlock":if("blockTag"in e)return{method:"eth_getBlockByNumber",args:[e.blockTag,!!e.includeTransactions]};if("blockHash"in e)return{method:"eth_getBlockByHash",args:[e.blockHash,!!e.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[e.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[e.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(e.transaction),e.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(e.transaction)]};case"getLogs":return e.filter&&e.filter.address!=null&&(Array.isArray(e.filter.address)?e.filter.address=e.filter.address.map(Rn):e.filter.address=Rn(e.filter.address)),{method:"eth_getLogs",args:[e.filter]}}return null}getRpcError(e,t){const{method:n}=e,{error:i}=t;if(n==="eth_estimateGas"&&i.message){const a=i.message;if(!a.match(/revert/i)&&a.match(/insufficient funds/i))return me("insufficient funds","INSUFFICIENT_FUNDS",{transaction:e.params[0],info:{payload:e,error:i}});if(a.match(/nonce/i)&&a.match(/too low/i))return me("nonce has already been used","NONCE_EXPIRED",{transaction:e.params[0],info:{payload:e,error:i}})}if(n==="eth_call"||n==="eth_estimateGas"){const a=Lc(i),c=si.getBuiltinCallException(n==="eth_call"?"call":"estimateGas",e.params[0],a?a.data:null);return c.info={error:i,payload:e},c}const s=JSON.stringify(bA(i));if(typeof i.message=="string"&&i.message.match(/user denied|ethers-user-denied/i))return me("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[n]||"unknown",reason:"rejected",info:{payload:e,error:i}});if(n==="eth_sendRawTransaction"||n==="eth_sendTransaction"){const a=e.params[0];if(s.match(/insufficient funds|base fee exceeds gas limit/i))return me("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:a,info:{error:i}});if(s.match(/nonce/i)&&s.match(/too low/i))return me("nonce has already been used","NONCE_EXPIRED",{transaction:a,info:{error:i}});if(s.match(/replacement transaction/i)&&s.match(/underpriced/i))return me("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:a,info:{error:i}});if(s.match(/only replay-protected/i))return me("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:n,info:{transaction:a,info:{error:i}}})}let o=!!s.match(/the method .* does not exist/i);return o||i&&i.details&&i.details.startsWith("Unauthorized method:")&&(o=!0),o?me("unsupported operation","UNSUPPORTED_OPERATION",{operation:e.method,info:{error:i,payload:e}}):me("could not coalesce error","UNKNOWN_ERROR",{error:i,payload:e})}send(e,t){if(this.destroyed)return Promise.reject(me("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e}));const n=this.#t++,i=new Promise((s,o)=>{this.#r.push({resolve:s,reject:o,payload:{method:e,params:t,id:n,jsonrpc:"2.0"}})});return this.#a(),i}async getSigner(e){e==null&&(e=0);const t=this.send("eth_accounts",[]);if(typeof e=="number"){const i=await t;if(e>=i.length)throw new Error("no such account");return new Pa(this,i[e])}const{accounts:n}=await Ze({network:this.getNetwork(),accounts:t});e=te(e);for(const i of n)if(te(i)===e)return new Pa(this,e);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(t=>new Pa(this,t))}destroy(){this.#n&&(clearTimeout(this.#n),this.#n=null);for(const{payload:e,reject:t}of this.#r)t(me("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:e.method}));this.#r=[],super.destroy()}}class zg extends pA{#e;constructor(e,t){super(e,t);let n=this._getOption("pollingInterval");n==null&&(n=jg.pollingInterval),this.#e=n}_getSubscriber(e){const t=super._getSubscriber(e);return jl(t)&&(t.pollingInterval=this.#e),t}get pollingInterval(){return this.#e}set pollingInterval(e){if(!Number.isInteger(e)||e<0)throw new Error("invalid interval");this.#e=e,this._forEachSubscriber(t=>{jl(t)&&(t.pollingInterval=this.#e)})}}class xA extends zg{#e;constructor(e,t,n){e==null&&(e="http://localhost:8545"),super(t,n),typeof e=="string"?this.#e=new Xt(e):this.#e=e.clone()}_getConnection(){return this.#e.clone()}async send(e,t){return await this._start(),await super.send(e,t)}async _send(e){const t=this._getConnection();t.body=JSON.stringify(e),t.setHeader("content-type","application/json");const n=await t.send();n.assertOk();let i=n.bodyJson;return Array.isArray(i)||(i=[i]),i}}function Lc(r){if(r==null)return null;if(typeof r.message=="string"&&r.message.match(/revert/i)&&xe(r.data))return{message:r.message,data:r.data};if(typeof r=="object"){for(const e in r){const t=Lc(r[e]);if(t)return t}return null}if(typeof r=="string")try{return Lc(JSON.parse(r))}catch{}return null}function Dc(r,e){if(r!=null){if(typeof r.message=="string"&&e.push(r.message),typeof r=="object")for(const t in r)Dc(r[t],e);if(typeof r=="string")try{return Dc(JSON.parse(r),e)}catch{}}}function bA(r){const e=[];return Dc(r,e),e}class fr extends zg{#e;#t;constructor(e,t,n){const i=Object.assign({},n??{},{batchMaxCount:1});_(e&&e.request,"invalid EIP-1193 provider","ethereum",e),super(t,i),this.#t=null,n&&n.providerInfo&&(this.#t=n.providerInfo),this.#e=async(s,o)=>{const a={method:s,params:o};this.emit("debug",{action:"sendEip1193Request",payload:a});try{const c=await e.request(a);return this.emit("debug",{action:"receiveEip1193Result",result:c}),c}catch(c){const u=new Error(c.message);throw u.code=c.code,u.data=c.data,u.payload=a,this.emit("debug",{action:"receiveEip1193Error",error:u}),u}}}get providerInfo(){return this.#t}async send(e,t){return await this._start(),await super.send(e,t)}async _send(e){_(!Array.isArray(e),"EIP-1193 does not support batch request","payload",e);try{const t=await this.#e(e.method,e.params||[]);return[{id:e.id,result:t}]}catch(t){return[{id:e.id,error:{code:t.code,data:t.data,message:t.message}}]}}getRpcError(e,t){switch(t=JSON.parse(JSON.stringify(t)),t.error.code||-1){case 4001:t.error.message=`ethers-user-denied: ${t.error.message}`;break;case 4200:t.error.message=`ethers-unsupported: ${t.error.message}`;break}return super.getRpcError(e,t)}async hasSigner(e){e==null&&(e=0);const t=await this.send("eth_accounts",[]);return typeof e=="number"?t.length>e:(e=e.toLowerCase(),t.filter(n=>n.toLowerCase()===e).length!==0)}async getSigner(e){if(e==null&&(e=0),!await this.hasSigner(e))try{await this.#e("eth_requestAccounts",[])}catch(t){const n=t.payload;throw this.getRpcError(n,{id:n.id,error:t})}return await super.getSigner(e)}static async discover(e){if(e==null&&(e={}),e.provider)return new fr(e.provider);const t=e.window?e.window:typeof window<"u"?window:null;if(t==null)return null;const n=e.anyProvider;if(n&&t.ethereum)return new fr(t.ethereum);if(!("addEventListener"in t&&"dispatchEvent"in t&&"removeEventListener"in t))return null;const i=e.timeout?e.timeout:300;return i===0?null:await new Promise((s,o)=>{let a=[];const c=f=>{a.push(f.detail),n&&u()},u=()=>{if(clearTimeout(l),a.length)if(e&&e.filter){const f=e.filter(a.map(d=>Object.assign({},d.info)));if(f==null)s(null);else if(f instanceof fr)s(f);else{let d=null;if(f.uuid&&(d=a.filter(h=>f.uuid===h.info.uuid)[0]),d){const{provider:p,info:h}=d;s(new fr(p,void 0,{providerInfo:h}))}else o(me("filter returned unknown info","UNSUPPORTED_OPERATION",{value:f}))}}else{const{provider:f,info:d}=a[0];s(new fr(f,void 0,{providerInfo:d}))}else s(null);t.removeEventListener("eip6963:announceProvider",c)},l=setTimeout(()=>{u()},i);t.addEventListener("eip6963:announceProvider",c),t.dispatchEvent(new Event("eip6963:requestProvider"))})}}class jo extends Tu{address;#e;constructor(e,t){super(t),_(e&&typeof e.sign=="function","invalid private key","privateKey","[ REDACTED ]"),this.#e=e;const n=is(this.signingKey.publicKey);q(this,{address:n})}get signingKey(){return this.#e}get privateKey(){return this.signingKey.privateKey}async getAddress(){return this.address}connect(e){return new jo(this.#e,e)}async signTransaction(e){e=Wi(e);const{to:t,from:n}=await Ze({to:e.to?$e(e.to,this):void 0,from:e.from?$e(e.from,this):void 0});t!=null&&(e.to=t),n!=null&&(e.from=n),e.from!=null&&(_(te(e.from)===this.address,"transaction from address mismatch","tx.from",e.from),delete e.from);const i=Ct.from(e);return i.signature=this.signingKey.sign(i.unsignedHash),i.serialized}async signMessage(e){return this.signMessageSync(e)}signMessageSync(e){return this.signingKey.sign(xg(e)).serialized}authorizeSync(e){_(typeof e.address=="string","invalid address for authorizeSync","auth.address",e);const t=this.signingKey.sign(h1(e));return Object.assign({},{address:te(e.address),nonce:z(e.nonce||0),chainId:z(e.chainId||0)},{signature:t})}async authorize(e){return e=Object.assign({},e,{address:await $e(e.address,this)}),this.authorizeSync(await this.populateAuthorization(e))}async signTypedData(e,t,n){const i=await tt.resolveNames(e,t,n,async s=>{F(this.provider!=null,"cannot resolve ENS names without a provider","UNSUPPORTED_OPERATION",{operation:"resolveName",info:{name:s}});const o=await this.provider.resolveName(s);return F(o!=null,"unconfigured ENS name","UNCONFIGURED_NAME",{value:s}),o});return this.signingKey.sign(tt.hash(i.domain,t,i.value)).serialized}}const ho=" !#$%&'()*+,-./<=>?@[]^_`{|}~",yA=/^[a-z]*$/i;function zl(r,e){let t=97;return r.reduce((n,i)=>(i===e?t++:i.match(yA)?n.push(String.fromCharCode(t)+i):(t=97,n.push(i)),n),[])}function wA(r,e){for(let i=ho.length-1;i>=0;i--)r=r.split(ho[i]).join(e.substring(2*i,2*i+2));const t=[],n=r.replace(/(:|([0-9])|([A-Z][a-z]*))/g,(i,s,o,a)=>{if(o)for(let c=parseInt(o);c>=0;c--)t.push(";");else t.push(s.toLowerCase());return""});if(n)throw new Error(`leftovers: ${JSON.stringify(n)}`);return zl(zl(t,";"),":")}function mA(r){return _(r[0]==="0","unsupported auwl data","data",r),wA(r.substring(1+2*ho.length),r.substring(1,1+2*ho.length))}class AA{locale;constructor(e){q(this,{locale:e})}split(e){return e.toLowerCase().split(/\s+/g)}join(e){return e.join(" ")}}class vA extends AA{#e;#t;constructor(e,t,n){super(e),this.#e=t,this.#t=n,this.#r=null}get _data(){return this.#e}_decodeWords(){return mA(this.#e)}#r;#n(){if(this.#r==null){const e=this._decodeWords();if(Ar(e.join(`
`)+`
`)!==this.#t)throw new Error(`BIP39 Wordlist for ${this.locale} FAILED`);this.#r=e}return this.#r}getWord(e){const t=this.#n();return _(e>=0&&e<t.length,`invalid word index: ${e}`,"index",e),t[e]}getWordIndex(e){return this.#n().indexOf(e)}}const EA="0erleonalorenseinceregesticitStanvetearctssi#ch2Athck&tneLl0And#Il.yLeOutO=S|S%b/ra@SurdU'0Ce[Cid|CountCu'Hie=IdOu,-Qui*Ro[TT]T%T*[Tu$0AptDD-tD*[Ju,M.UltV<)Vi)0Rob-0FairF%dRaid0A(EEntRee0Ead0MRRp%tS!_rmBumCoholErtI&LLeyLowMo,O}PhaReadySoT Ways0A>urAz(gOngOuntU'd0Aly,Ch%Ci|G G!GryIm$K!Noun)Nu$O` Sw T&naTiqueXietyY1ArtOlogyPe?P!Pro=Ril1ChCt-EaEnaGueMMedM%MyOundR<+Re,Ri=RowTTefa@Ti,Tw%k0KPe@SaultSetSi,SumeThma0H!>OmTa{T&dT.udeTra@0Ct]D.Gu,NtTh%ToTumn0Era+OcadoOid0AkeA*AyEsomeFulKw?d0Is:ByChel%C#D+GL<)Lc#y~MbooN<aNn RRelyRga(R*lSeS-SketTt!3A^AnAutyCau'ComeEfF%eG(Ha=H(dLie=LowLtN^Nef./TrayTt Twe&Y#d3Cyc!DKeNdOlogyRdR`Tt _{AdeAmeAnketA,EakE[IndOodO[omOu'UeUrUsh_rdAtDyIlMbNeNusOkO,Rd R(gRrowSsTtomUn)XY_{etA(AndA[A=EadEezeI{Id+IefIghtIngIskOccoliOk&OnzeOomO` OwnUsh2Bb!DdyD+tFf$oIldLbLkL!tNd!Nk Rd&Rg R,SS(e[SyTt Y Zz:Bba+B(B!CtusGeKe~LmM aMpNN$N)lNdyNn#NoeNvasNy#Pab!P.$Pta(RRb#RdRgoRpetRryRtSeShS(o/!Su$TT$ogT^Teg%yTt!UghtU'Ut]Ve3Il(gL yM|NsusNturyRe$Rta(_irAlkAmp]An+AosApt Ar+A'AtEapE{Ee'EfErryE,I{&IefIldIm}yOi)Oo'R#-U{!UnkUrn0G?Nnam#Rc!Tiz&TyVil_imApArifyAwAyE<ErkEv I{I|IffImbIn-IpO{OgO'O`OudOwnUbUmpU, Ut^_^A,C#utDeFfeeIlInL!@L%LumnMb(eMeMf%tM-Mm#Mp<yNc tNdu@NfirmNg*[N}@Nsid NtrolNv()OkOlPp PyR$ReRnR*@/Tt#U^UntryUp!Ur'Us(V Yo>_{Ad!AftAmA}AshAt AwlAzyEamEd.EekEwI{etImeIspIt-OpO[Ou^OwdUci$UelUi'Umb!Un^UshYY,$2BeLtu*PPbo?dRiousRr|Rta(R=Sh]/omTe3C!:DMa+MpN)Ng R(gShUght WnY3AlBa>BrisCadeCemb CideCl(eC%a>C*a'ErF&'F(eFyG*eLayLiv M<dMi'Ni$Nti,NyP?tP&dPos.P`PutyRi=ScribeS tSignSkSpair/royTailTe@VelopVi)Vo>3AgramAlAm#dAryCeE'lEtFf G.$Gn.yLemmaNn NosaurRe@RtSag*eScov Sea'ShSmi[S%d Splay/<)V tVideV%)Zzy5Ct%Cum|G~Lph(Ma(Na>NkeyN%OrSeUb!Ve_ftAg#AmaA,-AwEamE[IftIllInkIpI=OpUmY2CkMbNeR(g/T^Ty1Arf1Nam-:G G!RlyRnR`Sily/Sy1HoOlogyOnomy0GeItUca>1F%t0G1GhtTh 2BowD E@r-Eg<tEm|Eph<tEvat%I>Se0B?kBodyBra)Er+Ot]PloyPow Pty0Ab!A@DD![D%'EmyErgyF%)Ga+G(eH<)JoyLi,OughR-hRollSu*T Ti*TryVelope1Isode0U$Uip0AA'OdeOs]R%Upt0CapeSayS&)Ta>0Ern$H-s1Id&)IlOkeOl=1A@Amp!Ce[Ch<+C.eCludeCu'Ecu>Erci'Hau,Hib.I!I,ItOt-P<dPe@Pi*Pla(Po'P*[T&dTra0EEbrow:Br-CeCultyDeIntI`~L'MeMilyMousNNcyNtasyRmSh]TT$Th TigueUltV%.e3Atu*Bru?yD $EEdElMa!N)/iv$T^V W3B Ct]EldGu*LeLmLt N$NdNeNg NishReRmR,Sc$ShTT}[X_gAmeAshAtAv%EeIghtIpOatO{O%Ow UidUshY_mCusGIlLd~owOdOtR)Re,R+tRkRtu}RumRw?dSsil/ UndX_gi!AmeEqu|EshI&dIn+OgOntO,OwnOz&U.2ElNNnyRna)RyTu*:D+tInLaxy~ yMePRa+Rba+Rd&Rl-Rm|SSpTeTh U+Ze3N $NiusN*Nt!Nu(e/u*2O,0AntFtGg!Ng RaffeRlVe_dAn)A*A[IdeImp'ObeOomOryO=OwUe_tDde[LdOdO'RillaSpelSsipV nWn_bA)A(AntApeA[Av.yEatE&IdIefItOc yOupOwUnt_rdE[IdeIltIt?N3M:B.IrLfMm M, NdPpyRb%RdRshR=,TVeWkZ?d3AdAl`ArtAvyD+hogIght~oLmetLpNRo3Dd&Gh~NtPRe/%y5BbyCkeyLdLeLiday~owMeNeyOdPeRnRr%R'Sp.$/TelUrV 5BGeM<Mb!M%Nd*dNgryNtRd!RryRtSb<d3Brid:1EOn0EaEntifyLe2N%e4LLeg$L}[0A+Ita>M&'Mu}Pa@Po'Pro=Pul'0ChCludeComeC*a'DexD-a>Do%Du,ryF<tFl-tF%mHa!H .Iti$Je@JuryMa>N Noc|PutQuiryS<eSe@SideSpi*/$lTa@T e,ToVe,V.eVol=3On0L<dOla>Sue0Em1Ory:CketGu?RZz3AlousAns~yWel9BInKeUr}yY5D+I)MpNg!Ni%Nk/:Ng?oo3EnEpT^upY3CkDD}yNdNgdomSsTT^&TeTt&Wi4EeIfeO{Ow:BBelB%Dd DyKeMpNgua+PtopR+T T(UghUndryVaWWnWsu.Y Zy3Ad AfArnA=Ctu*FtGG$G&dIsu*M#NdNg`NsOp?dSs#Tt Vel3ArB tyBr?yC&'FeFtGhtKeMbM.NkOnQuid/Tt!VeZ?d5AdAnB, C$CkG-NelyNgOpTt yUdUn+VeY$5CkyGga+Mb N?N^Xury3R-s:Ch(eDG-G}tIdIlInJ%KeMm$NNa+Nda>NgoNs]Nu$P!Rb!R^Rg(R(eRketRria+SkSs/ T^T i$ThTrixTt XimumZe3AdowAnAsu*AtCh<-D$DiaLodyLtMb M%yNt]NuRcyR+R.RryShSsa+T$Thod3Dd!DnightLk~]M-NdNimumN%Nu>Rac!Rr%S ySs/akeXXedXtu*5Bi!DelDifyMM|N.%NkeyN, N`OnR$ReRn(gSqu.oTh T]T%Unta(U'VeVie5ChFf(LeLtiplySc!SeumShroomS-/Tu$3Self/ yTh:I=MePk(Rrow/yT]Tu*3ArCkEdGati=G!@I` PhewR=/TTw%kUtr$V WsXt3CeGht5B!I'M(eeOd!Rm$R`SeTab!TeTh(gTi)VelW5C!?Mb R'T:K0EyJe@Li+Scu*S =Ta(Vious0CurE<Tob 0Or1FF Fi)T&2L1Ay0DI=Ymp-0It0CeEI#L(eLy1EnEraIn]Po'T]1An+B.Ch?dD D(?yG<I|Ig($Ph<0Tr-h0H 0Tdo%T TputTside0AlEnEr0NN 0Yg&0/ 0O}:CtDd!GeIrLa)LmNdaNelN-N` P RadeR|RkRrotRtySsT^ThTi|TrolTt nU'VeYm|3A)AnutArAs<tL-<NN$tyNcilOp!Pp Rfe@Rm.Rs#T2O}OtoRa'Ys-$0AnoCn-Ctu*E)GGe#~LotNkO} Pe/olT^Zza_)A}tA,-A>AyEa'Ed+U{UgUn+2EmEtIntL?LeLi)NdNyOlPul?Rt]S.]Ssib!/TatoTt yV tyWd W _@i)Ai'Ed-tEf Epa*Es|EttyEv|I)IdeIm?yIntI%.yIs#Iva>IzeOb!mO)[Odu)Of.OgramOje@Omo>OofOp tyOsp O>@OudOvide2Bl-Dd(g~LpL'Mpk(N^PilPpyR^a'R.yRpo'R'ShTZz!3Ramid:99Al.yAntumArt E,]I{ItIzO>:Bb.Cco#CeCkD?DioIlInI'~yMpN^NdomN+PidReTeTh V&WZ%3AdyAlAs#BelBuildC$lCei=CipeC%dCyc!Du)F!@F%mFu'G]G*tGul?Je@LaxLea'LiefLyMa(Memb M(dMo=Nd NewNtOp&PairPeatPla)P%tQui*ScueSemb!Si,Sour)Sp#'SultTi*T*atTurnUn]Ve$ViewW?d2Y`m0BBb#CeChDeD+F!GhtGidNgOtPp!SkTu$V$V 5AdA,BotBu,CketM<)OfOkieOmSeTa>UghUndU>Y$5Bb DeGLeNNwayR$:DDd!D}[FeIlLadLm#L#LtLu>MeMp!NdTisfyToshiU)Usa+VeY1A!AnA*Att E}HemeHoolI&)I[%sOrp]OutRapRe&RiptRub1AAr^As#AtC#dC*tCt]Cur.yEdEkGm|Le@~M(?Ni%N'Nt&)RiesRvi)Ss]Tt!TupV&_dowAftAllowA*EdEllEriffIeldIftI}IpIv O{OeOotOpOrtOuld O=RimpRugUff!Y0Bl(gCkDeE+GhtGnL|Lk~yLv Mil?Mp!N)NgR&/ Tua>XZe1A>Et^IIllInIrtUll0AbAmEepEnd I)IdeIghtImOg<OtOwUsh0AllArtI!OkeOo`0A{AkeApIffOw0ApCc Ci$CkDaFtL?Ldi LidLut]L=Me#eNgOnRryRtUlUndUpUr)U`0A)A*Ati$AwnEakEci$EedEllEndH eI)Id IkeInIr.L.OilOns%O#OrtOtRayReadR(gY0Ua*UeezeUir*l_b!AdiumAffA+AirsAmpAndArtA>AyEakEelEmEpE*oI{IllIngO{Oma^O}OolOryO=Ra>gyReetRikeR#gRugg!Ud|UffUmb!Y!0Bje@Bm.BwayC)[ChDd&Ff G?G+,ItMm NNnyN'tP PplyP*meReRfa)R+Rpri'RroundR=ySpe@/a(1AllowAmpApArmE?EetIftImIngIt^Ord1MbolMptomRup/em:B!Ck!GIlL|LkNkPeR+tSk/eTtooXi3A^Am~NN<tNnisNtRm/Xt_nkAtEmeEnE%yE*EyIngIsOughtReeRi=RowUmbUnd 0CketDeG LtMb MeNyPRedSsueT!5A,BaccoDayDdl EGe` I!tK&MatoM%rowNeNgueNightOlO`PP-Pp!R^RnadoRtoi'SsT$Uri,W?dW WnY_{AdeAff-Ag-A(Ansf ApAshA=lAyEatEeEndI$IbeI{Igg ImIpOphyOub!U{UeUlyUmpetU,U`Y2BeIt]Mb!NaN}lRkeyRnRt!1El=EntyI)InI,O1PeP-$:5Ly5B*lla0Ab!Awa*C!Cov D DoFairFoldHappyIf%mIqueItIv 'KnownLo{TilUsu$Veil1Da>GradeHoldOnP Set1B<Ge0A+EEdEfulE![U$0Il.y:C<tCuumGueLidL!yL=NNishP%Rious/Ult3H-!L=tNd%Ntu*NueRbRifyRs]RyS'lT <3Ab!Br<tCiousCt%yDeoEw~a+Nta+Ol(Rtu$RusSaS.Su$T$Vid5C$I)IdLc<oLumeTeYa+:GeG#ItLk~LnutNtRfa*RmRri%ShSp/eT VeY3Al`Ap#ArA'lA` BDd(gEk&dIrdLcome/T_!AtEatEelEnE*IpIsp 0DeD`FeLd~NNdowNeNgNkNn Nt ReSdomSeShT}[5LfM<Nd OdOlRdRkRldRryR`_pE{E,!I,I>Ong::Rd3Ar~ow9UUngU`:3BraRo9NeO",SA="0x3c8acc1e7b08d8e76f9fda015ef48dc8c710a73cb7e0f77b2c18a9b5a7adde60";let Na=null;class vn extends vA{constructor(){super("en",EA,SA)}static wordlist(){return Na==null&&(Na=new vn),Na}}function Vg(r){return(1<<r)-1<<8-r&255}function CA(r){return(1<<r)-1&255}function Oa(r,e){vh("NFKD"),e==null&&(e=vn.wordlist());const t=e.split(r);_(t.length%3===0&&t.length>=12&&t.length<=24,"invalid mnemonic length","mnemonic","[ REDACTED ]");const n=new Uint8Array(Math.ceil(11*t.length/8));let i=0;for(let u=0;u<t.length;u++){let l=e.getWordIndex(t[u].normalize("NFKD"));_(l>=0,`invalid mnemonic word at index ${u}`,"mnemonic","[ REDACTED ]");for(let f=0;f<11;f++)l&1<<10-f&&(n[i>>3]|=1<<7-i%8),i++}const s=32*t.length/3,o=t.length/3,a=Vg(o),c=K(st(n.slice(0,s/8)))[0]&a;return _(c===(n[n.length-1]&a),"invalid mnemonic checksum","mnemonic","[ REDACTED ]"),G(n.slice(0,s/8))}function Ua(r,e){_(r.length%4===0&&r.length>=16&&r.length<=32,"invalid entropy size","entropy","[ REDACTED ]"),e==null&&(e=vn.wordlist());const t=[0];let n=11;for(let o=0;o<r.length;o++)n>8?(t[t.length-1]<<=8,t[t.length-1]|=r[o],n-=8):(t[t.length-1]<<=n,t[t.length-1]|=r[o]>>8-n,t.push(r[o]&CA(8-n)),n+=3);const i=r.length/4,s=parseInt(st(r).substring(2,4),16)&Vg(i);return t[t.length-1]<<=i,t[t.length-1]|=s>>8-i,e.join(t.map(o=>e.getWord(o)))}const Ra={};class ai{phrase;password;wordlist;entropy;constructor(e,t,n,i,s){i==null&&(i=""),s==null&&(s=vn.wordlist()),In(e,Ra,"Mnemonic"),q(this,{phrase:n,password:i,wordlist:s,entropy:t})}computeSeed(){const e=de("mnemonic"+this.password,"NFKD");return Zr(de(this.phrase,"NFKD"),e,2048,64,"sha512")}static fromPhrase(e,t,n){const i=Oa(e,n);return e=Ua(K(i),n),new ai(Ra,i,e,t,n)}static fromEntropy(e,t,n){const i=K(e,"entropy"),s=Ua(i,n);return new ai(Ra,G(i),s,t,n)}static entropyToPhrase(e,t){const n=K(e,"entropy");return Ua(n,t)}static phraseToEntropy(e,t){return Oa(e,t)}static isValidMnemonic(e,t){try{return Oa(e,t),!0}catch{}return!1}}/*! MIT License. Copyright 2015-2022 Richard Moore <me@ricmoo.com>. See LICENSE.txt. */var Fe=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ba=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Vs,vt,jt;const IA={16:10,24:12,32:14},kA=[1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145],wt=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22],ks=[82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125],TA=[3328402341,4168907908,4000806809,4135287693,4294111757,3597364157,3731845041,2445657428,1613770832,33620227,3462883241,1445669757,3892248089,3050821474,1303096294,3967186586,2412431941,528646813,2311702848,4202528135,4026202645,2992200171,2387036105,4226871307,1101901292,3017069671,1604494077,1169141738,597466303,1403299063,3832705686,2613100635,1974974402,3791519004,1033081774,1277568618,1815492186,2118074177,4126668546,2211236943,1748251740,1369810420,3521504564,4193382664,3799085459,2883115123,1647391059,706024767,134480908,2512897874,1176707941,2646852446,806885416,932615841,168101135,798661301,235341577,605164086,461406363,3756188221,3454790438,1311188841,2142417613,3933566367,302582043,495158174,1479289972,874125870,907746093,3698224818,3025820398,1537253627,2756858614,1983593293,3084310113,2108928974,1378429307,3722699582,1580150641,327451799,2790478837,3117535592,0,3253595436,1075847264,3825007647,2041688520,3059440621,3563743934,2378943302,1740553945,1916352843,2487896798,2555137236,2958579944,2244988746,3151024235,3320835882,1336584933,3992714006,2252555205,2588757463,1714631509,293963156,2319795663,3925473552,67240454,4269768577,2689618160,2017213508,631218106,1269344483,2723238387,1571005438,2151694528,93294474,1066570413,563977660,1882732616,4059428100,1673313503,2008463041,2950355573,1109467491,537923632,3858759450,4260623118,3218264685,2177748300,403442708,638784309,3287084079,3193921505,899127202,2286175436,773265209,2479146071,1437050866,4236148354,2050833735,3362022572,3126681063,840505643,3866325909,3227541664,427917720,2655997905,2749160575,1143087718,1412049534,999329963,193497219,2353415882,3354324521,1807268051,672404540,2816401017,3160301282,369822493,2916866934,3688947771,1681011286,1949973070,336202270,2454276571,201721354,1210328172,3093060836,2680341085,3184776046,1135389935,3294782118,965841320,831886756,3554993207,4068047243,3588745010,2345191491,1849112409,3664604599,26054028,2983581028,2622377682,1235855840,3630984372,2891339514,4092916743,3488279077,3395642799,4101667470,1202630377,268961816,1874508501,4034427016,1243948399,1546530418,941366308,1470539505,1941222599,2546386513,3421038627,2715671932,3899946140,1042226977,2521517021,1639824860,227249030,260737669,3765465232,2084453954,1907733956,3429263018,2420656344,100860677,4160157185,470683154,3261161891,1781871967,2924959737,1773779408,394692241,2579611992,974986535,664706745,3655459128,3958962195,731420851,571543859,3530123707,2849626480,126783113,865375399,765172662,1008606754,361203602,3387549984,2278477385,2857719295,1344809080,2782912378,59542671,1503764984,160008576,437062935,1707065306,3622233649,2218934982,3496503480,2185314755,697932208,1512910199,504303377,2075177163,2824099068,1841019862,739644986],PA=[2781242211,2230877308,2582542199,2381740923,234877682,3184946027,2984144751,1418839493,1348481072,50462977,2848876391,2102799147,434634494,1656084439,3863849899,2599188086,1167051466,2636087938,1082771913,2281340285,368048890,3954334041,3381544775,201060592,3963727277,1739838676,4250903202,3930435503,3206782108,4149453988,2531553906,1536934080,3262494647,484572669,2923271059,1783375398,1517041206,1098792767,49674231,1334037708,1550332980,4098991525,886171109,150598129,2481090929,1940642008,1398944049,1059722517,201851908,1385547719,1699095331,1587397571,674240536,2704774806,252314885,3039795866,151914247,908333586,2602270848,1038082786,651029483,1766729511,3447698098,2682942837,454166793,2652734339,1951935532,775166490,758520603,3000790638,4004797018,4217086112,4137964114,1299594043,1639438038,3464344499,2068982057,1054729187,1901997871,2534638724,4121318227,1757008337,0,750906861,1614815264,535035132,3363418545,3988151131,3201591914,1183697867,3647454910,1265776953,3734260298,3566750796,3903871064,1250283471,1807470800,717615087,3847203498,384695291,3313910595,3617213773,1432761139,2484176261,3481945413,283769337,100925954,2180939647,4037038160,1148730428,3123027871,3813386408,4087501137,4267549603,3229630528,2315620239,2906624658,3156319645,1215313976,82966005,3747855548,3245848246,1974459098,1665278241,807407632,451280895,251524083,1841287890,1283575245,337120268,891687699,801369324,3787349855,2721421207,3431482436,959321879,1469301956,4065699751,2197585534,1199193405,2898814052,3887750493,724703513,2514908019,2696962144,2551808385,3516813135,2141445340,1715741218,2119445034,2872807568,2198571144,3398190662,700968686,3547052216,1009259540,2041044702,3803995742,487983883,1991105499,1004265696,1449407026,1316239930,504629770,3683797321,168560134,1816667172,3837287516,1570751170,1857934291,4014189740,2797888098,2822345105,2754712981,936633572,2347923833,852879335,1133234376,1500395319,3084545389,2348912013,1689376213,3533459022,3762923945,3034082412,4205598294,133428468,634383082,2949277029,2398386810,3913789102,403703816,3580869306,2297460856,1867130149,1918643758,607656988,4049053350,3346248884,1368901318,600565992,2090982877,2632479860,557719327,3717614411,3697393085,2249034635,2232388234,2430627952,1115438654,3295786421,2865522278,3633334344,84280067,33027830,303828494,2747425121,1600795957,4188952407,3496589753,2434238086,1486471617,658119965,3106381470,953803233,334231800,3005978776,857870609,3151128937,1890179545,2298973838,2805175444,3056442267,574365214,2450884487,550103529,1233637070,4289353045,2018519080,2057691103,2399374476,4166623649,2148108681,387583245,3664101311,836232934,3330556482,3100665960,3280093505,2955516313,2002398509,287182607,3413881008,4238890068,3597515707,975967766],NA=[1671808611,2089089148,2006576759,2072901243,4061003762,1807603307,1873927791,3310653893,810573872,16974337,1739181671,729634347,4263110654,3613570519,2883997099,1989864566,3393556426,2191335298,3376449993,2106063485,4195741690,1508618841,1204391495,4027317232,2917941677,3563566036,2734514082,2951366063,2629772188,2767672228,1922491506,3227229120,3082974647,4246528509,2477669779,644500518,911895606,1061256767,4144166391,3427763148,878471220,2784252325,3845444069,4043897329,1905517169,3631459288,827548209,356461077,67897348,3344078279,593839651,3277757891,405286936,2527147926,84871685,2595565466,118033927,305538066,2157648768,3795705826,3945188843,661212711,2999812018,1973414517,152769033,2208177539,745822252,439235610,455947803,1857215598,1525593178,2700827552,1391895634,994932283,3596728278,3016654259,695947817,3812548067,795958831,2224493444,1408607827,3513301457,0,3979133421,543178784,4229948412,2982705585,1542305371,1790891114,3410398667,3201918910,961245753,1256100938,1289001036,1491644504,3477767631,3496721360,4012557807,2867154858,4212583931,1137018435,1305975373,861234739,2241073541,1171229253,4178635257,33948674,2139225727,1357946960,1011120188,2679776671,2833468328,1374921297,2751356323,1086357568,2408187279,2460827538,2646352285,944271416,4110742005,3168756668,3066132406,3665145818,560153121,271589392,4279952895,4077846003,3530407890,3444343245,202643468,322250259,3962553324,1608629855,2543990167,1154254916,389623319,3294073796,2817676711,2122513534,1028094525,1689045092,1575467613,422261273,1939203699,1621147744,2174228865,1339137615,3699352540,577127458,712922154,2427141008,2290289544,1187679302,3995715566,3100863416,339486740,3732514782,1591917662,186455563,3681988059,3762019296,844522546,978220090,169743370,1239126601,101321734,611076132,1558493276,3260915650,3547250131,2901361580,1655096418,2443721105,2510565781,3828863972,2039214713,3878868455,3359869896,928607799,1840765549,2374762893,3580146133,1322425422,2850048425,1823791212,1459268694,4094161908,3928346602,1706019429,2056189050,2934523822,135794696,3134549946,2022240376,628050469,779246638,472135708,2800834470,3032970164,3327236038,3894660072,3715932637,1956440180,522272287,1272813131,3185336765,2340818315,2323976074,1888542832,1044544574,3049550261,1722469478,1222152264,50660867,4127324150,236067854,1638122081,895445557,1475980887,3117443513,2257655686,3243809217,489110045,2662934430,3778599393,4162055160,2561878936,288563729,1773916777,3648039385,2391345038,2493985684,2612407707,505560094,2274497927,3911240169,3460925390,1442818645,678973480,3749357023,2358182796,2717407649,2306869641,219617805,3218761151,3862026214,1120306242,1756942440,1103331905,2578459033,762796589,252780047,2966125488,1425844308,3151392187,372911126],OA=[1667474886,2088535288,2004326894,2071694838,4075949567,1802223062,1869591006,3318043793,808472672,16843522,1734846926,724270422,4278065639,3621216949,2880169549,1987484396,3402253711,2189597983,3385409673,2105378810,4210693615,1499065266,1195886990,4042263547,2913856577,3570689971,2728590687,2947541573,2627518243,2762274643,1920112356,3233831835,3082273397,4261223649,2475929149,640051788,909531756,1061110142,4160160501,3435941763,875846760,2779116625,3857003729,4059105529,1903268834,3638064043,825316194,353713962,67374088,3351728789,589522246,3284360861,404236336,2526454071,84217610,2593830191,117901582,303183396,2155911963,3806477791,3958056653,656894286,2998062463,1970642922,151591698,2206440989,741110872,437923380,454765878,1852748508,1515908788,2694904667,1381168804,993742198,3604373943,3014905469,690584402,3823320797,791638366,2223281939,1398011302,3520161977,0,3991743681,538992704,4244381667,2981218425,1532751286,1785380564,3419096717,3200178535,960056178,1246420628,1280103576,1482221744,3486468741,3503319995,4025428677,2863326543,4227536621,1128514950,1296947098,859002214,2240123921,1162203018,4193849577,33687044,2139062782,1347481760,1010582648,2678045221,2829640523,1364325282,2745433693,1077985408,2408548869,2459086143,2644360225,943212656,4126475505,3166494563,3065430391,3671750063,555836226,269496352,4294908645,4092792573,3537006015,3452783745,202118168,320025894,3974901699,1600119230,2543297077,1145359496,387397934,3301201811,2812801621,2122220284,1027426170,1684319432,1566435258,421079858,1936954854,1616945344,2172753945,1330631070,3705438115,572679748,707427924,2425400123,2290647819,1179044492,4008585671,3099120491,336870440,3739122087,1583276732,185277718,3688593069,3772791771,842159716,976899700,168435220,1229577106,101059084,606366792,1549591736,3267517855,3553849021,2897014595,1650632388,2442242105,2509612081,3840161747,2038008818,3890688725,3368567691,926374254,1835907034,2374863873,3587531953,1313788572,2846482505,1819063512,1448540844,4109633523,3941213647,1701162954,2054852340,2930698567,134748176,3132806511,2021165296,623210314,774795868,471606328,2795958615,3031746419,3334885783,3907527627,3722280097,1953799400,522133822,1263263126,3183336545,2341176845,2324333839,1886425312,1044267644,3048588401,1718004428,1212733584,50529542,4143317495,235803164,1633788866,892690282,1465383342,3115962473,2256965911,3250673817,488449850,2661202215,3789633753,4177007595,2560144171,286339874,1768537042,3654906025,2391705863,2492770099,2610673197,505291324,2273808917,3924369609,3469625735,1431699370,673740880,3755965093,2358021891,2711746649,2307489801,218961690,3217021541,3873845719,1111672452,1751693520,1094828930,2576986153,757954394,252645662,2964376443,1414855848,3149649517,370555436],UA=[1374988112,2118214995,437757123,975658646,1001089995,530400753,2902087851,1273168787,540080725,2910219766,2295101073,4110568485,1340463100,3307916247,641025152,3043140495,3736164937,632953703,1172967064,1576976609,3274667266,2169303058,2370213795,1809054150,59727847,361929877,3211623147,2505202138,3569255213,1484005843,1239443753,2395588676,1975683434,4102977912,2572697195,666464733,3202437046,4035489047,3374361702,2110667444,1675577880,3843699074,2538681184,1649639237,2976151520,3144396420,4269907996,4178062228,1883793496,2403728665,2497604743,1383856311,2876494627,1917518562,3810496343,1716890410,3001755655,800440835,2261089178,3543599269,807962610,599762354,33778362,3977675356,2328828971,2809771154,4077384432,1315562145,1708848333,101039829,3509871135,3299278474,875451293,2733856160,92987698,2767645557,193195065,1080094634,1584504582,3178106961,1042385657,2531067453,3711829422,1306967366,2438237621,1908694277,67556463,1615861247,429456164,3602770327,2302690252,1742315127,2968011453,126454664,3877198648,2043211483,2709260871,2084704233,4169408201,0,159417987,841739592,504459436,1817866830,4245618683,260388950,1034867998,908933415,168810852,1750902305,2606453969,607530554,202008497,2472011535,3035535058,463180190,2160117071,1641816226,1517767529,470948374,3801332234,3231722213,1008918595,303765277,235474187,4069246893,766945465,337553864,1475418501,2943682380,4003061179,2743034109,4144047775,1551037884,1147550661,1543208500,2336434550,3408119516,3069049960,3102011747,3610369226,1113818384,328671808,2227573024,2236228733,3535486456,2935566865,3341394285,496906059,3702665459,226906860,2009195472,733156972,2842737049,294930682,1206477858,2835123396,2700099354,1451044056,573804783,2269728455,3644379585,2362090238,2564033334,2801107407,2776292904,3669462566,1068351396,742039012,1350078989,1784663195,1417561698,4136440770,2430122216,775550814,2193862645,2673705150,1775276924,1876241833,3475313331,3366754619,270040487,3902563182,3678124923,3441850377,1851332852,3969562369,2203032232,3868552805,2868897406,566021896,4011190502,3135740889,1248802510,3936291284,699432150,832877231,708780849,3332740144,899835584,1951317047,4236429990,3767586992,866637845,4043610186,1106041591,2144161806,395441711,1984812685,1139781709,3433712980,3835036895,2664543715,1282050075,3240894392,1181045119,2640243204,25965917,4203181171,4211818798,3009879386,2463879762,3910161971,1842759443,2597806476,933301370,1509430414,3943906441,3467192302,3076639029,3776767469,2051518780,2631065433,1441952575,404016761,1942435775,1408749034,1610459739,3745345300,2017778566,3400528769,3110650942,941896748,3265478751,371049330,3168937228,675039627,4279080257,967311729,135050206,3635733660,1683407248,2076935265,3576870512,1215061108,3501741890],RA=[1347548327,1400783205,3273267108,2520393566,3409685355,4045380933,2880240216,2471224067,1428173050,4138563181,2441661558,636813900,4233094615,3620022987,2149987652,2411029155,1239331162,1730525723,2554718734,3781033664,46346101,310463728,2743944855,3328955385,3875770207,2501218972,3955191162,3667219033,768917123,3545789473,692707433,1150208456,1786102409,2029293177,1805211710,3710368113,3065962831,401639597,1724457132,3028143674,409198410,2196052529,1620529459,1164071807,3769721975,2226875310,486441376,2499348523,1483753576,428819965,2274680428,3075636216,598438867,3799141122,1474502543,711349675,129166120,53458370,2592523643,2782082824,4063242375,2988687269,3120694122,1559041666,730517276,2460449204,4042459122,2706270690,3446004468,3573941694,533804130,2328143614,2637442643,2695033685,839224033,1973745387,957055980,2856345839,106852767,1371368976,4181598602,1033297158,2933734917,1179510461,3046200461,91341917,1862534868,4284502037,605657339,2547432937,3431546947,2003294622,3182487618,2282195339,954669403,3682191598,1201765386,3917234703,3388507166,0,2198438022,1211247597,2887651696,1315723890,4227665663,1443857720,507358933,657861945,1678381017,560487590,3516619604,975451694,2970356327,261314535,3535072918,2652609425,1333838021,2724322336,1767536459,370938394,182621114,3854606378,1128014560,487725847,185469197,2918353863,3106780840,3356761769,2237133081,1286567175,3152976349,4255350624,2683765030,3160175349,3309594171,878443390,1988838185,3704300486,1756818940,1673061617,3403100636,272786309,1075025698,545572369,2105887268,4174560061,296679730,1841768865,1260232239,4091327024,3960309330,3497509347,1814803222,2578018489,4195456072,575138148,3299409036,446754879,3629546796,4011996048,3347532110,3252238545,4270639778,915985419,3483825537,681933534,651868046,2755636671,3828103837,223377554,2607439820,1649704518,3270937875,3901806776,1580087799,4118987695,3198115200,2087309459,2842678573,3016697106,1003007129,2802849917,1860738147,2077965243,164439672,4100872472,32283319,2827177882,1709610350,2125135846,136428751,3874428392,3652904859,3460984630,3572145929,3593056380,2939266226,824852259,818324884,3224740454,930369212,2801566410,2967507152,355706840,1257309336,4148292826,243256656,790073846,2373340630,1296297904,1422699085,3756299780,3818836405,457992840,3099667487,2135319889,77422314,1560382517,1945798516,788204353,1521706781,1385356242,870912086,325965383,2358957921,2050466060,2388260884,2313884476,4006521127,901210569,3990953189,1014646705,1503449823,1062597235,2031621326,3212035895,3931371469,1533017514,350174575,2256028891,2177544179,1052338372,741876788,1606591296,1914052035,213705253,2334669897,1107234197,1899603969,3725069491,2631447780,2422494913,1635502980,1893020342,1950903388,1120974935],BA=[2807058932,1699970625,2764249623,1586903591,1808481195,1173430173,1487645946,59984867,4199882800,1844882806,1989249228,1277555970,3623636965,3419915562,1149249077,2744104290,1514790577,459744698,244860394,3235995134,1963115311,4027744588,2544078150,4190530515,1608975247,2627016082,2062270317,1507497298,2200818878,567498868,1764313568,3359936201,2305455554,2037970062,1047239e3,1910319033,1337376481,2904027272,2892417312,984907214,1243112415,830661914,861968209,2135253587,2011214180,2927934315,2686254721,731183368,1750626376,4246310725,1820824798,4172763771,3542330227,48394827,2404901663,2871682645,671593195,3254988725,2073724613,145085239,2280796200,2779915199,1790575107,2187128086,472615631,3029510009,4075877127,3802222185,4107101658,3201631749,1646252340,4270507174,1402811438,1436590835,3778151818,3950355702,3963161475,4020912224,2667994737,273792366,2331590177,104699613,95345982,3175501286,2377486676,1560637892,3564045318,369057872,4213447064,3919042237,1137477952,2658625497,1119727848,2340947849,1530455833,4007360968,172466556,266959938,516552836,0,2256734592,3980931627,1890328081,1917742170,4294704398,945164165,3575528878,958871085,3647212047,2787207260,1423022939,775562294,1739656202,3876557655,2530391278,2443058075,3310321856,547512796,1265195639,437656594,3121275539,719700128,3762502690,387781147,218828297,3350065803,2830708150,2848461854,428169201,122466165,3720081049,1627235199,648017665,4122762354,1002783846,2117360635,695634755,3336358691,4234721005,4049844452,3704280881,2232435299,574624663,287343814,612205898,1039717051,840019705,2708326185,793451934,821288114,1391201670,3822090177,376187827,3113855344,1224348052,1679968233,2361698556,1058709744,752375421,2431590963,1321699145,3519142200,2734591178,188127444,2177869557,3727205754,2384911031,3215212461,2648976442,2450346104,3432737375,1180849278,331544205,3102249176,4150144569,2952102595,2159976285,2474404304,766078933,313773861,2570832044,2108100632,1668212892,3145456443,2013908262,418672217,3070356634,2594734927,1852171925,3867060991,3473416636,3907448597,2614737639,919489135,164948639,2094410160,2997825956,590424639,2486224549,1723872674,3157750862,3399941250,3501252752,3625268135,2555048196,3673637356,1343127501,4130281361,3599595085,2957853679,1297403050,81781910,3051593425,2283490410,532201772,1367295589,3926170974,895287692,1953757831,1093597963,492483431,3528626907,1446242576,1192455638,1636604631,209336225,344873464,1015671571,669961897,3375740769,3857572124,2973530695,3747192018,1933530610,3464042516,935293895,3454686199,2858115069,1863638845,3683022916,4085369519,3292445032,875313188,1080017571,3279033885,621591778,1233856572,2504130317,24197544,3017672716,3835484340,3247465558,2220981195,3060847922,1551124588,1463996600],_A=[4104605777,1097159550,396673818,660510266,2875968315,2638606623,4200115116,3808662347,821712160,1986918061,3430322568,38544885,3856137295,718002117,893681702,1654886325,2975484382,3122358053,3926825029,4274053469,796197571,1290801793,1184342925,3556361835,2405426947,2459735317,1836772287,1381620373,3196267988,1948373848,3764988233,3385345166,3263785589,2390325492,1480485785,3111247143,3780097726,2293045232,548169417,3459953789,3746175075,439452389,1362321559,1400849762,1685577905,1806599355,2174754046,137073913,1214797936,1174215055,3731654548,2079897426,1943217067,1258480242,529487843,1437280870,3945269170,3049390895,3313212038,923313619,679998e3,3215307299,57326082,377642221,3474729866,2041877159,133361907,1776460110,3673476453,96392454,878845905,2801699524,777231668,4082475170,2330014213,4142626212,2213296395,1626319424,1906247262,1846563261,562755902,3708173718,1040559837,3871163981,1418573201,3294430577,114585348,1343618912,2566595609,3186202582,1078185097,3651041127,3896688048,2307622919,425408743,3371096953,2081048481,1108339068,2216610296,0,2156299017,736970802,292596766,1517440620,251657213,2235061775,2933202493,758720310,265905162,1554391400,1532285339,908999204,174567692,1474760595,4002861748,2610011675,3234156416,3693126241,2001430874,303699484,2478443234,2687165888,585122620,454499602,151849742,2345119218,3064510765,514443284,4044981591,1963412655,2581445614,2137062819,19308535,1928707164,1715193156,4219352155,1126790795,600235211,3992742070,3841024952,836553431,1669664834,2535604243,3323011204,1243905413,3141400786,4180808110,698445255,2653899549,2989552604,2253581325,3252932727,3004591147,1891211689,2487810577,3915653703,4237083816,4030667424,2100090966,865136418,1229899655,953270745,3399679628,3557504664,4118925222,2061379749,3079546586,2915017791,983426092,2022837584,1607244650,2118541908,2366882550,3635996816,972512814,3283088770,1568718495,3499326569,3576539503,621982671,2895723464,410887952,2623762152,1002142683,645401037,1494807662,2595684844,1335535747,2507040230,4293295786,3167684641,367585007,3885750714,1865862730,2668221674,2960971305,2763173681,1059270954,2777952454,2724642869,1320957812,2194319100,2429595872,2815956275,77089521,3973773121,3444575871,2448830231,1305906550,4021308739,2857194700,2516901860,3518358430,1787304780,740276417,1699839814,1592394909,2352307457,2272556026,188821243,1729977011,3687994002,274084841,3594982253,3613494426,2701949495,4162096729,322734571,2837966542,1640576439,484830689,1202797690,3537852828,4067639125,349075736,3342319475,4157467219,4255800159,1030690015,1155237496,2951971274,1757691577,607398968,2738905026,499347990,3794078908,1011452712,227885567,2818666809,213114376,3034881240,1455525988,3414450555,850817237,1817998408,3092726480],LA=[0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795],DA=[0,185469197,370938394,487725847,741876788,657861945,975451694,824852259,1483753576,1400783205,1315723890,1164071807,1950903388,2135319889,1649704518,1767536459,2967507152,3152976349,2801566410,2918353863,2631447780,2547432937,2328143614,2177544179,3901806776,3818836405,4270639778,4118987695,3299409036,3483825537,3535072918,3652904859,2077965243,1893020342,1841768865,1724457132,1474502543,1559041666,1107234197,1257309336,598438867,681933534,901210569,1052338372,261314535,77422314,428819965,310463728,3409685355,3224740454,3710368113,3593056380,3875770207,3960309330,4045380933,4195456072,2471224067,2554718734,2237133081,2388260884,3212035895,3028143674,2842678573,2724322336,4138563181,4255350624,3769721975,3955191162,3667219033,3516619604,3431546947,3347532110,2933734917,2782082824,3099667487,3016697106,2196052529,2313884476,2499348523,2683765030,1179510461,1296297904,1347548327,1533017514,1786102409,1635502980,2087309459,2003294622,507358933,355706840,136428751,53458370,839224033,957055980,605657339,790073846,2373340630,2256028891,2607439820,2422494913,2706270690,2856345839,3075636216,3160175349,3573941694,3725069491,3273267108,3356761769,4181598602,4063242375,4011996048,3828103837,1033297158,915985419,730517276,545572369,296679730,446754879,129166120,213705253,1709610350,1860738147,1945798516,2029293177,1239331162,1120974935,1606591296,1422699085,4148292826,4233094615,3781033664,3931371469,3682191598,3497509347,3446004468,3328955385,2939266226,2755636671,3106780840,2988687269,2198438022,2282195339,2501218972,2652609425,1201765386,1286567175,1371368976,1521706781,1805211710,1620529459,2105887268,1988838185,533804130,350174575,164439672,46346101,870912086,954669403,636813900,788204353,2358957921,2274680428,2592523643,2441661558,2695033685,2880240216,3065962831,3182487618,3572145929,3756299780,3270937875,3388507166,4174560061,4091327024,4006521127,3854606378,1014646705,930369212,711349675,560487590,272786309,457992840,106852767,223377554,1678381017,1862534868,1914052035,2031621326,1211247597,1128014560,1580087799,1428173050,32283319,182621114,401639597,486441376,768917123,651868046,1003007129,818324884,1503449823,1385356242,1333838021,1150208456,1973745387,2125135846,1673061617,1756818940,2970356327,3120694122,2802849917,2887651696,2637442643,2520393566,2334669897,2149987652,3917234703,3799141122,4284502037,4100872472,3309594171,3460984630,3545789473,3629546796,2050466060,1899603969,1814803222,1730525723,1443857720,1560382517,1075025698,1260232239,575138148,692707433,878443390,1062597235,243256656,91341917,409198410,325965383,3403100636,3252238545,3704300486,3620022987,3874428392,3990953189,4042459122,4227665663,2460449204,2578018489,2226875310,2411029155,3198115200,3046200461,2827177882,2743944855],MA=[0,218828297,437656594,387781147,875313188,958871085,775562294,590424639,1750626376,1699970625,1917742170,2135253587,1551124588,1367295589,1180849278,1265195639,3501252752,3720081049,3399941250,3350065803,3835484340,3919042237,4270507174,4085369519,3102249176,3051593425,2734591178,2952102595,2361698556,2177869557,2530391278,2614737639,3145456443,3060847922,2708326185,2892417312,2404901663,2187128086,2504130317,2555048196,3542330227,3727205754,3375740769,3292445032,3876557655,3926170974,4246310725,4027744588,1808481195,1723872674,1910319033,2094410160,1608975247,1391201670,1173430173,1224348052,59984867,244860394,428169201,344873464,935293895,984907214,766078933,547512796,1844882806,1627235199,2011214180,2062270317,1507497298,1423022939,1137477952,1321699145,95345982,145085239,532201772,313773861,830661914,1015671571,731183368,648017665,3175501286,2957853679,2807058932,2858115069,2305455554,2220981195,2474404304,2658625497,3575528878,3625268135,3473416636,3254988725,3778151818,3963161475,4213447064,4130281361,3599595085,3683022916,3432737375,3247465558,3802222185,4020912224,4172763771,4122762354,3201631749,3017672716,2764249623,2848461854,2331590177,2280796200,2431590963,2648976442,104699613,188127444,472615631,287343814,840019705,1058709744,671593195,621591778,1852171925,1668212892,1953757831,2037970062,1514790577,1463996600,1080017571,1297403050,3673637356,3623636965,3235995134,3454686199,4007360968,3822090177,4107101658,4190530515,2997825956,3215212461,2830708150,2779915199,2256734592,2340947849,2627016082,2443058075,172466556,122466165,273792366,492483431,1047239e3,861968209,612205898,695634755,1646252340,1863638845,2013908262,1963115311,1446242576,1530455833,1277555970,1093597963,1636604631,1820824798,2073724613,1989249228,1436590835,1487645946,1337376481,1119727848,164948639,81781910,331544205,516552836,1039717051,821288114,669961897,719700128,2973530695,3157750862,2871682645,2787207260,2232435299,2283490410,2667994737,2450346104,3647212047,3564045318,3279033885,3464042516,3980931627,3762502690,4150144569,4199882800,3070356634,3121275539,2904027272,2686254721,2200818878,2384911031,2570832044,2486224549,3747192018,3528626907,3310321856,3359936201,3950355702,3867060991,4049844452,4234721005,1739656202,1790575107,2108100632,1890328081,1402811438,1586903591,1233856572,1149249077,266959938,48394827,369057872,418672217,1002783846,919489135,567498868,752375421,209336225,24197544,376187827,459744698,945164165,895287692,574624663,793451934,1679968233,1764313568,2117360635,1933530610,1343127501,1560637892,1243112415,1192455638,3704280881,3519142200,3336358691,3419915562,3907448597,3857572124,4075877127,4294704398,3029510009,3113855344,2927934315,2744104290,2159976285,2377486676,2594734927,2544078150],$A=[0,151849742,303699484,454499602,607398968,758720310,908999204,1059270954,1214797936,1097159550,1517440620,1400849762,1817998408,1699839814,2118541908,2001430874,2429595872,2581445614,2194319100,2345119218,3034881240,3186202582,2801699524,2951971274,3635996816,3518358430,3399679628,3283088770,4237083816,4118925222,4002861748,3885750714,1002142683,850817237,698445255,548169417,529487843,377642221,227885567,77089521,1943217067,2061379749,1640576439,1757691577,1474760595,1592394909,1174215055,1290801793,2875968315,2724642869,3111247143,2960971305,2405426947,2253581325,2638606623,2487810577,3808662347,3926825029,4044981591,4162096729,3342319475,3459953789,3576539503,3693126241,1986918061,2137062819,1685577905,1836772287,1381620373,1532285339,1078185097,1229899655,1040559837,923313619,740276417,621982671,439452389,322734571,137073913,19308535,3871163981,4021308739,4104605777,4255800159,3263785589,3414450555,3499326569,3651041127,2933202493,2815956275,3167684641,3049390895,2330014213,2213296395,2566595609,2448830231,1305906550,1155237496,1607244650,1455525988,1776460110,1626319424,2079897426,1928707164,96392454,213114376,396673818,514443284,562755902,679998e3,865136418,983426092,3708173718,3557504664,3474729866,3323011204,4180808110,4030667424,3945269170,3794078908,2507040230,2623762152,2272556026,2390325492,2975484382,3092726480,2738905026,2857194700,3973773121,3856137295,4274053469,4157467219,3371096953,3252932727,3673476453,3556361835,2763173681,2915017791,3064510765,3215307299,2156299017,2307622919,2459735317,2610011675,2081048481,1963412655,1846563261,1729977011,1480485785,1362321559,1243905413,1126790795,878845905,1030690015,645401037,796197571,274084841,425408743,38544885,188821243,3613494426,3731654548,3313212038,3430322568,4082475170,4200115116,3780097726,3896688048,2668221674,2516901860,2366882550,2216610296,3141400786,2989552604,2837966542,2687165888,1202797690,1320957812,1437280870,1554391400,1669664834,1787304780,1906247262,2022837584,265905162,114585348,499347990,349075736,736970802,585122620,972512814,821712160,2595684844,2478443234,2293045232,2174754046,3196267988,3079546586,2895723464,2777952454,3537852828,3687994002,3234156416,3385345166,4142626212,4293295786,3841024952,3992742070,174567692,57326082,410887952,292596766,777231668,660510266,1011452712,893681702,1108339068,1258480242,1343618912,1494807662,1715193156,1865862730,1948373848,2100090966,2701949495,2818666809,3004591147,3122358053,2235061775,2352307457,2535604243,2653899549,3915653703,3764988233,4219352155,4067639125,3444575871,3294430577,3746175075,3594982253,836553431,953270745,600235211,718002117,367585007,484830689,133361907,251657213,2041877159,1891211689,1806599355,1654886325,1568718495,1418573201,1335535747,1184342925];function _a(r){const e=[];for(let t=0;t<r.length;t+=4)e.push(r[t]<<24|r[t+1]<<16|r[t+2]<<8|r[t+3]);return e}class Nu{get key(){return Fe(this,Vs,"f").slice()}constructor(e){if(Vs.set(this,void 0),vt.set(this,void 0),jt.set(this,void 0),!(this instanceof Nu))throw Error("AES must be instanitated with `new`");Ba(this,Vs,new Uint8Array(e),"f");const t=IA[this.key.length];if(t==null)throw new TypeError("invalid key size (must be 16, 24 or 32 bytes)");Ba(this,jt,[],"f"),Ba(this,vt,[],"f");for(let l=0;l<=t;l++)Fe(this,jt,"f").push([0,0,0,0]),Fe(this,vt,"f").push([0,0,0,0]);const n=(t+1)*4,i=this.key.length/4,s=_a(this.key);let o;for(let l=0;l<i;l++)o=l>>2,Fe(this,jt,"f")[o][l%4]=s[l],Fe(this,vt,"f")[t-o][l%4]=s[l];let a=0,c=i,u;for(;c<n;){if(u=s[i-1],s[0]^=wt[u>>16&255]<<24^wt[u>>8&255]<<16^wt[u&255]<<8^wt[u>>24&255]^kA[a]<<24,a+=1,i!=8)for(let p=1;p<i;p++)s[p]^=s[p-1];else{for(let p=1;p<i/2;p++)s[p]^=s[p-1];u=s[i/2-1],s[i/2]^=wt[u&255]^wt[u>>8&255]<<8^wt[u>>16&255]<<16^wt[u>>24&255]<<24;for(let p=i/2+1;p<i;p++)s[p]^=s[p-1]}let l=0,f,d;for(;l<i&&c<n;)f=c>>2,d=c%4,Fe(this,jt,"f")[f][d]=s[l],Fe(this,vt,"f")[t-f][d]=s[l++],c++}for(let l=1;l<t;l++)for(let f=0;f<4;f++)u=Fe(this,vt,"f")[l][f],Fe(this,vt,"f")[l][f]=LA[u>>24&255]^DA[u>>16&255]^MA[u>>8&255]^$A[u&255]}encrypt(e){if(e.length!=16)throw new TypeError("invalid plaintext size (must be 16 bytes)");const t=Fe(this,jt,"f").length-1,n=[0,0,0,0];let i=_a(e);for(let a=0;a<4;a++)i[a]^=Fe(this,jt,"f")[0][a];for(let a=1;a<t;a++){for(let c=0;c<4;c++)n[c]=TA[i[c]>>24&255]^PA[i[(c+1)%4]>>16&255]^NA[i[(c+2)%4]>>8&255]^OA[i[(c+3)%4]&255]^Fe(this,jt,"f")[a][c];i=n.slice()}const s=new Uint8Array(16);let o=0;for(let a=0;a<4;a++)o=Fe(this,jt,"f")[t][a],s[4*a]=(wt[i[a]>>24&255]^o>>24)&255,s[4*a+1]=(wt[i[(a+1)%4]>>16&255]^o>>16)&255,s[4*a+2]=(wt[i[(a+2)%4]>>8&255]^o>>8)&255,s[4*a+3]=(wt[i[(a+3)%4]&255]^o)&255;return s}decrypt(e){if(e.length!=16)throw new TypeError("invalid ciphertext size (must be 16 bytes)");const t=Fe(this,vt,"f").length-1,n=[0,0,0,0];let i=_a(e);for(let a=0;a<4;a++)i[a]^=Fe(this,vt,"f")[0][a];for(let a=1;a<t;a++){for(let c=0;c<4;c++)n[c]=UA[i[c]>>24&255]^RA[i[(c+3)%4]>>16&255]^BA[i[(c+2)%4]>>8&255]^_A[i[(c+1)%4]&255]^Fe(this,vt,"f")[a][c];i=n.slice()}const s=new Uint8Array(16);let o=0;for(let a=0;a<4;a++)o=Fe(this,vt,"f")[t][a],s[4*a]=(ks[i[a]>>24&255]^o>>24)&255,s[4*a+1]=(ks[i[(a+3)%4]>>16&255]^o>>16)&255,s[4*a+2]=(ks[i[(a+2)%4]>>8&255]^o>>8)&255,s[4*a+3]=(ks[i[(a+1)%4]&255]^o)&255;return s}}Vs=new WeakMap,vt=new WeakMap,jt=new WeakMap;class Wg{constructor(e,t,n){if(n&&!(this instanceof n))throw new Error(`${e} must be instantiated with "new"`);Object.defineProperties(this,{aes:{enumerable:!0,value:new Nu(t)},name:{enumerable:!0,value:e}})}}var Ts=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},Bn=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Pi,sr;class Ou extends Wg{constructor(e,t){if(super("ECC",e,Ou),Pi.set(this,void 0),sr.set(this,void 0),t){if(t.length%16)throw new TypeError("invalid iv size (must be 16 bytes)");Ts(this,Pi,new Uint8Array(t),"f")}else Ts(this,Pi,new Uint8Array(16),"f");Ts(this,sr,this.iv,"f")}get iv(){return new Uint8Array(Bn(this,Pi,"f"))}encrypt(e){if(e.length%16)throw new TypeError("invalid plaintext size (must be multiple of 16 bytes)");const t=new Uint8Array(e.length);for(let n=0;n<e.length;n+=16){for(let i=0;i<16;i++)Bn(this,sr,"f")[i]^=e[n+i];Ts(this,sr,this.aes.encrypt(Bn(this,sr,"f")),"f"),t.set(Bn(this,sr,"f"),n)}return t}decrypt(e){if(e.length%16)throw new TypeError("invalid ciphertext size (must be multiple of 16 bytes)");const t=new Uint8Array(e.length);for(let n=0;n<e.length;n+=16){const i=this.aes.decrypt(e.subarray(n,n+16));for(let s=0;s<16;s++)t[n+s]=i[s]^Bn(this,sr,"f")[s],Bn(this,sr,"f")[s]=e[n+s]}return t}}Pi=new WeakMap,sr=new WeakMap;var _n=function(r,e,t,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(r,t):i?i.value=t:e.set(r,t),t},mt=function(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)},Ni,sn,Et;class ci extends Wg{constructor(e,t){super("CTR",e,ci),Ni.set(this,void 0),sn.set(this,void 0),Et.set(this,void 0),_n(this,Et,new Uint8Array(16),"f"),mt(this,Et,"f").fill(0),_n(this,Ni,mt(this,Et,"f"),"f"),_n(this,sn,16,"f"),t==null&&(t=1),typeof t=="number"?this.setCounterValue(t):this.setCounterBytes(t)}get counter(){return new Uint8Array(mt(this,Et,"f"))}setCounterValue(e){if(!Number.isInteger(e)||e<0||e>Number.MAX_SAFE_INTEGER)throw new TypeError("invalid counter initial integer value");for(let t=15;t>=0;--t)mt(this,Et,"f")[t]=e%256,e=Math.floor(e/256)}setCounterBytes(e){if(e.length!==16)throw new TypeError("invalid counter initial Uint8Array value length");mt(this,Et,"f").set(e)}increment(){for(let e=15;e>=0;e--)if(mt(this,Et,"f")[e]===255)mt(this,Et,"f")[e]=0;else{mt(this,Et,"f")[e]++;break}}encrypt(e){var t,n;const i=new Uint8Array(e);for(let s=0;s<i.length;s++)mt(this,sn,"f")===16&&(_n(this,Ni,this.aes.encrypt(mt(this,Et,"f")),"f"),_n(this,sn,0,"f"),this.increment()),i[s]^=mt(this,Ni,"f")[_n(this,sn,(n=mt(this,sn,"f"),t=n++,n),"f"),t];return i}decrypt(e){return this.encrypt(e)}}Ni=new WeakMap,sn=new WeakMap,Et=new WeakMap;function FA(r){if(r.length<16)throw new TypeError("PKCS#7 invalid length");const e=r[r.length-1];if(e>16)throw new TypeError("PKCS#7 padding byte out of range");const t=r.length-e;for(let n=0;n<e;n++)if(r[t+n]!==e)throw new TypeError("PKCS#7 invalid padding byte");return new Uint8Array(r.subarray(0,t))}function Jg(r){return typeof r=="string"&&!r.startsWith("0x")&&(r="0x"+r),Ve(r)}function Ei(r,e){for(r=String(r);r.length<e;)r="0"+r;return r}function us(r){return typeof r=="string"?de(r,"NFKC"):Ve(r)}function Ne(r,e){const t=e.match(/^([a-z0-9$_.-]*)(:([a-z]+))?(!)?$/i);_(t!=null,"invalid path","path",e);const n=t[1],i=t[3],s=t[4]==="!";let o=r;for(const a of n.toLowerCase().split(".")){if(Array.isArray(o)){if(!a.match(/^[0-9]+$/))break;o=o[parseInt(a)]}else if(typeof o=="object"){let c=null;for(const u in o)if(u.toLowerCase()===a){c=o[u];break}o=c}else o=null;if(o==null)break}if(_(!s||o!=null,"missing required value","path",n),i&&o!=null){if(i==="int"){if(typeof o=="string"&&o.match(/^-?[0-9]+$/))return parseInt(o);if(Number.isSafeInteger(o))return o}if(i==="number"&&typeof o=="string"&&o.match(/^-?[0-9.]*$/))return parseFloat(o);if(i==="data"&&typeof o=="string")return Jg(o);if(i==="array"&&Array.isArray(o)||i===typeof o)return o;_(!1,`wrong type found for ${i} `,"path",n)}return o}const Qg="m/44'/60'/0'/0/0";function Vl(r){try{const e=JSON.parse(r);if((e.version!=null?parseInt(e.version):0)===3)return!0}catch{}return!1}function GA(r,e,t){if(Ne(r,"crypto.cipher:string")==="aes-128-ctr"){const i=Ne(r,"crypto.cipherparams.iv:data!"),s=new ci(e,i);return G(s.decrypt(t))}F(!1,"unsupported cipher","UNSUPPORTED_OPERATION",{operation:"decrypt"})}function go(r,e){const t=K(e),n=Ne(r,"crypto.ciphertext:data!"),i=G(ie(he([t.slice(16,32),n]))).substring(2);_(i===Ne(r,"crypto.mac:string!").toLowerCase(),"incorrect password","password","[ REDACTED ]");const s=GA(r,t.slice(0,16),n),o=is(s);if(r.address){let u=r.address.toLowerCase();u.startsWith("0x")||(u="0x"+u),_(te(u)===o,"keystore address/privateKey mismatch","address",r.address)}const a={address:o,privateKey:s};if(Ne(r,"x-ethers.version:string")==="0.1"){const u=t.slice(32,64),l=Ne(r,"x-ethers.mnemonicCiphertext:data!"),f=Ne(r,"x-ethers.mnemonicCounter:data!"),d=new ci(u,f);a.mnemonic={path:Ne(r,"x-ethers.path:string")||Qg,locale:Ne(r,"x-ethers.locale:string")||"en",entropy:G(K(d.decrypt(l)))}}return a}function qg(r){const e=Ne(r,"crypto.kdf:string");if(e&&typeof e=="string"){if(e.toLowerCase()==="scrypt"){const t=Ne(r,"crypto.kdfparams.salt:data!"),n=Ne(r,"crypto.kdfparams.n:int!"),i=Ne(r,"crypto.kdfparams.r:int!"),s=Ne(r,"crypto.kdfparams.p:int!");_(n>0&&(n&n-1)===0,"invalid kdf.N","kdf.N",n),_(i>0&&s>0,"invalid kdf","kdf",e);const o=Ne(r,"crypto.kdfparams.dklen:int!");return _(o===32,"invalid kdf.dklen","kdf.dflen",o),{name:"scrypt",salt:t,N:n,r:i,p:s,dkLen:64}}else if(e.toLowerCase()==="pbkdf2"){const t=Ne(r,"crypto.kdfparams.salt:data!"),n=Ne(r,"crypto.kdfparams.prf:string!"),i=n.split("-").pop();_(i==="sha256"||i==="sha512","invalid kdf.pdf","kdf.pdf",n);const s=Ne(r,"crypto.kdfparams.c:int!"),o=Ne(r,"crypto.kdfparams.dklen:int!");return _(o===32,"invalid kdf.dklen","kdf.dklen",o),{name:"pbkdf2",salt:t,count:s,dkLen:o,algorithm:i}}}_(!1,"unsupported key-derivation function","kdf",e)}function HA(r,e){const t=JSON.parse(r),n=us(e),i=qg(t);if(i.name==="pbkdf2"){const{salt:f,count:d,dkLen:p,algorithm:h}=i,x=Zr(n,f,d,p,h);return go(t,x)}F(i.name==="scrypt","cannot be reached","UNKNOWN_ERROR",{params:i});const{salt:s,N:o,r:a,p:c,dkLen:u}=i,l=pi(n,s,o,a,c,u);return go(t,l)}function Wl(r){return new Promise(e=>{setTimeout(()=>{e()},r)})}async function KA(r,e,t){const n=JSON.parse(r),i=us(e),s=qg(n);if(s.name==="pbkdf2"){t&&(t(0),await Wl(0));const{salt:d,count:p,dkLen:h,algorithm:x}=s,b=Zr(i,d,p,h,x);return t&&(t(1),await Wl(0)),go(n,b)}F(s.name==="scrypt","cannot be reached","UNKNOWN_ERROR",{params:s});const{salt:o,N:a,r:c,p:u,dkLen:l}=s,f=await gi(i,o,a,c,u,l,t);return go(n,f)}function Zg(r){const e=r.salt!=null?K(r.salt,"options.salt"):xr(32);let t=1<<17,n=8,i=1;return r.scrypt&&(r.scrypt.N&&(t=r.scrypt.N),r.scrypt.r&&(n=r.scrypt.r),r.scrypt.p&&(i=r.scrypt.p)),_(typeof t=="number"&&t>0&&Number.isSafeInteger(t)&&(BigInt(t)&BigInt(t-1))===BigInt(0),"invalid scrypt N parameter","options.N",t),_(typeof n=="number"&&n>0&&Number.isSafeInteger(n),"invalid scrypt r parameter","options.r",n),_(typeof i=="number"&&i>0&&Number.isSafeInteger(i),"invalid scrypt p parameter","options.p",i),{name:"scrypt",dkLen:32,salt:e,N:t,r:n,p:i}}function Yg(r,e,t,n){const i=K(t.privateKey,"privateKey"),s=n.iv!=null?K(n.iv,"options.iv"):xr(16);_(s.length===16,"invalid options.iv length","options.iv",n.iv);const o=n.uuid!=null?K(n.uuid,"options.uuid"):xr(16);_(o.length===16,"invalid options.uuid length","options.uuid",n.iv);const a=r.slice(0,16),c=r.slice(16,32),u=new ci(a,s),l=K(u.encrypt(i)),f=ie(he([c,l])),d={address:t.address.substring(2).toLowerCase(),id:Ny(o),version:3,Crypto:{cipher:"aes-128-ctr",cipherparams:{iv:G(s).substring(2)},ciphertext:G(l).substring(2),kdf:"scrypt",kdfparams:{salt:G(e.salt).substring(2),n:e.N,dklen:32,p:e.p,r:e.r},mac:f.substring(2)}};if(t.mnemonic){const p=n.client!=null?n.client:`ethers/${mh}`,h=t.mnemonic.path||Qg,x=t.mnemonic.locale||"en",b=r.slice(32,64),w=K(t.mnemonic.entropy,"account.mnemonic.entropy"),m=xr(16),g=new ci(b,m),A=K(g.encrypt(w)),v=new Date,P="UTC--"+(v.getUTCFullYear()+"-"+Ei(v.getUTCMonth()+1,2)+"-"+Ei(v.getUTCDate(),2)+"T"+Ei(v.getUTCHours(),2)+"-"+Ei(v.getUTCMinutes(),2)+"-"+Ei(v.getUTCSeconds(),2)+".0Z")+"--"+d.address;d["x-ethers"]={client:p,gethFilename:P,path:h,locale:x,mnemonicCounter:G(m).substring(2),mnemonicCiphertext:G(A).substring(2),version:"0.1"}}return JSON.stringify(d)}function Xg(r,e,t){t==null&&(t={});const n=us(e),i=Zg(t),s=pi(n,i.salt,i.N,i.r,i.p,64);return Yg(K(s),i,r,t)}async function ep(r,e,t){t==null&&(t={});const n=us(e),i=Zg(t),s=await gi(n,i.salt,i.N,i.r,i.p,64,t.progressCallback);return Yg(K(s),i,r,t)}const La="m/44'/60'/0'/0/0",jA=new Uint8Array([66,105,116,99,111,105,110,32,115,101,101,100]),Jr=2147483648,zA=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),VA="0123456789abcdef";function po(r,e){let t="";for(;r;)t=VA[r%16]+t,r=Math.trunc(r/16);for(;t.length<e*2;)t="0"+t;return"0x"+t}function Mc(r){const e=K(r),t=be(st(st(e)),0,4),n=he([e,t]);return Ih(n)}const Vt={};function tp(r,e,t,n){const i=new Uint8Array(37);r&Jr?(F(n!=null,"cannot derive child of neutered node","UNSUPPORTED_OPERATION",{operation:"deriveChild"}),i.set(K(n),1)):i.set(K(t));for(let o=24;o>=0;o-=8)i[33+(o>>3)]=r>>24-o&255;const s=K(di("sha512",e,i));return{IL:s.slice(0,32),IR:s.slice(32)}}function rp(r,e){const t=e.split("/");_(t.length>0,"invalid path","path",e),t[0]==="m"&&(_(r.depth===0,`cannot derive root path (i.e. path starting with "m/") for a node at non-zero depth ${r.depth}`,"path",e),t.shift());let n=r;for(let i=0;i<t.length;i++){const s=t[i];if(s.match(/^[0-9]+'$/)){const o=parseInt(s.substring(0,s.length-1));_(o<Jr,"invalid path index",`path[${i}]`,s),n=n.deriveChild(Jr+o)}else if(s.match(/^[0-9]+$/)){const o=parseInt(s);_(o<Jr,"invalid path index",`path[${i}]`,s),n=n.deriveChild(o)}else _(!1,"invalid path component",`path[${i}]`,s)}return n}class It extends jo{publicKey;fingerprint;parentFingerprint;mnemonic;chainCode;path;index;depth;constructor(e,t,n,i,s,o,a,c,u){super(t,u),In(e,Vt,"HDNodeWallet"),q(this,{publicKey:t.compressedPublicKey});const l=be(hi(st(this.publicKey)),0,4);q(this,{parentFingerprint:n,fingerprint:l,chainCode:i,path:s,index:o,depth:a}),q(this,{mnemonic:c})}connect(e){return new It(Vt,this.signingKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.mnemonic,e)}#e(){const e={address:this.address,privateKey:this.privateKey},t=this.mnemonic;return this.path&&t&&t.wordlist.locale==="en"&&t.password===""&&(e.mnemonic={path:this.path,locale:"en",entropy:t.entropy}),e}async encrypt(e,t){return await ep(this.#e(),e,{progressCallback:t})}encryptSync(e){return Xg(this.#e(),e)}get extendedKey(){return F(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),Mc(he(["0x0488ADE4",po(this.depth,1),this.parentFingerprint,po(this.index,4),this.chainCode,he(["0x00",this.privateKey])]))}hasPath(){return this.path!=null}neuter(){return new Qi(Vt,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,this.provider)}deriveChild(e){const t=ee(e,"index");_(t<=4294967295,"invalid index","index",t);let n=this.path;n&&(n+="/"+(t&~Jr),t&Jr&&(n+="'"));const{IR:i,IL:s}=tp(t,this.chainCode,this.publicKey,this.privateKey),o=new ct(wr((Po(s)+BigInt(this.privateKey))%zA,32));return new It(Vt,o,this.fingerprint,G(i),n,t,this.depth+1,this.mnemonic,this.provider)}derivePath(e){return rp(this,e)}static#t(e,t){_(Io(e),"invalid seed","seed","[REDACTED]");const n=K(e,"seed");_(n.length>=16&&n.length<=64,"invalid seed","seed","[REDACTED]");const i=K(di("sha512",jA,n)),s=new ct(G(i.slice(0,32)));return new It(Vt,s,"0x00000000",G(i.slice(32)),"m",0,0,t,null)}static fromExtendedKey(e){const t=ke(gy(e));_(t.length===82||Mc(t.slice(0,78))===e,"invalid extended key","extendedKey","[ REDACTED ]");const n=t[4],i=G(t.slice(5,9)),s=parseInt(G(t.slice(9,13)).substring(2),16),o=G(t.slice(13,45)),a=t.slice(45,78);switch(G(t.slice(0,4))){case"0x0488b21e":case"0x043587cf":{const c=G(a);return new Qi(Vt,is(c),c,i,o,null,s,n,null)}case"0x0488ade4":case"0x04358394 ":if(a[0]!==0)break;return new It(Vt,new ct(a.slice(1)),i,o,null,s,n,null,null)}_(!1,"invalid extended key prefix","extendedKey","[ REDACTED ]")}static createRandom(e,t,n){e==null&&(e=""),t==null&&(t=La),n==null&&(n=vn.wordlist());const i=ai.fromEntropy(xr(16),e,n);return It.#t(i.computeSeed(),i).derivePath(t)}static fromMnemonic(e,t){return t||(t=La),It.#t(e.computeSeed(),e).derivePath(t)}static fromPhrase(e,t,n,i){t==null&&(t=""),n==null&&(n=La),i==null&&(i=vn.wordlist());const s=ai.fromPhrase(e,t,i);return It.#t(s.computeSeed(),s).derivePath(n)}static fromSeed(e){return It.#t(e,null)}}class Qi extends Pu{publicKey;fingerprint;parentFingerprint;chainCode;path;index;depth;constructor(e,t,n,i,s,o,a,c,u){super(t,u),In(e,Vt,"HDNodeVoidWallet"),q(this,{publicKey:n});const l=be(hi(st(n)),0,4);q(this,{publicKey:n,fingerprint:l,parentFingerprint:i,chainCode:s,path:o,index:a,depth:c})}connect(e){return new Qi(Vt,this.address,this.publicKey,this.parentFingerprint,this.chainCode,this.path,this.index,this.depth,e)}get extendedKey(){return F(this.depth<256,"Depth too deep","UNSUPPORTED_OPERATION",{operation:"extendedKey"}),Mc(he(["0x0488B21E",po(this.depth,1),this.parentFingerprint,po(this.index,4),this.chainCode,this.publicKey]))}hasPath(){return this.path!=null}deriveChild(e){const t=ee(e,"index");_(t<=4294967295,"invalid index","index",t);let n=this.path;n&&(n+="/"+(t&~Jr),t&Jr&&(n+="'"));const{IR:i,IL:s}=tp(t,this.chainCode,this.publicKey,null),o=ct.addPoints(s,this.publicKey,!0),a=is(o);return new Qi(Vt,a,o,this.fingerprint,G(i),n,t,this.depth+1,this.provider)}derivePath(e){return rp(this,e)}}function Jl(r){try{if(JSON.parse(r).encseed)return!0}catch{}return!1}function Ql(r,e){const t=JSON.parse(r),n=us(e),i=te(Ne(t,"ethaddr:string!")),s=Jg(Ne(t,"encseed:string!"));_(s&&s.length%16===0,"invalid encseed","json",r);const o=K(Zr(n,n,2e3,32,"sha256")).slice(0,16),a=s.slice(0,16),c=s.slice(16),u=new Ou(o,a),l=FA(K(u.decrypt(c)));let f="";for(let d=0;d<l.length;d++)f+=String.fromCharCode(l[d]);return{address:i,privateKey:Ar(f)}}function ql(r){return new Promise(e=>{setTimeout(()=>{e()},r)})}class hn extends jo{constructor(e,t){typeof e=="string"&&!e.startsWith("0x")&&(e="0x"+e);let n=typeof e=="string"?new ct(e):e;super(n,t)}connect(e){return new hn(this.signingKey,e)}async encrypt(e,t){const n={address:this.address,privateKey:this.privateKey};return await ep(n,e,{progressCallback:t})}encryptSync(e){const t={address:this.address,privateKey:this.privateKey};return Xg(t,e)}static#e(e){if(_(e,"invalid JSON wallet","json","[ REDACTED ]"),"mnemonic"in e&&e.mnemonic&&e.mnemonic.locale==="en"){const n=ai.fromEntropy(e.mnemonic.entropy),i=It.fromMnemonic(n,e.mnemonic.path);if(i.address===e.address&&i.privateKey===e.privateKey)return i;console.log("WARNING: JSON mismatch address/privateKey != mnemonic; fallback onto private key")}const t=new hn(e.privateKey);return _(t.address===e.address,"address/privateKey mismatch","json","[ REDACTED ]"),t}static async fromEncryptedJson(e,t,n){let i=null;return Vl(e)?i=await KA(e,t,n):Jl(e)&&(n&&(n(0),await ql(0)),i=Ql(e,t),n&&(n(1),await ql(0))),hn.#e(i)}static fromEncryptedJsonSync(e,t){let n=null;return Vl(e)?n=HA(e,t):Jl(e)?n=Ql(e,t):_(!1,"invalid JSON wallet","json","[ REDACTED ]"),hn.#e(n)}static createRandom(e){const t=It.createRandom();return e?t.connect(e):t}static fromPhrase(e,t){const n=It.fromPhrase(e);return t?n.connect(t):n}}var zt;(function(r){r.DEVICE_REGISTERED="deviceRegistered",r.DEVICE_REMOVED="deviceRemoved",r.AUTHENTICATION_SUCCESS="authenticationSuccess",r.AUTHENTICATION_FAILED="authenticationFailed",r.ERROR="error"})(zt||(zt={}));const Ln=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function zo(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function qi(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Er(r,...e){if(!zo(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function np(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");qi(r.outputLen),qi(r.blockLen)}function ui(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ip(r,e){Er(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function WA(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function er(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Da(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Ht(r,e){return r<<32-e|r>>>e}function Ps(r,e){return r<<e|r>>>32-e>>>0}const JA=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function QA(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function qA(r){for(let e=0;e<r.length;e++)r[e]=QA(r[e]);return r}const Zl=JA?r=>r:qA,sp=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",ZA=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function qn(r){if(Er(r),sp)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=ZA[r[t]];return e}const nr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Yl(r){if(r>=nr._0&&r<=nr._9)return r-nr._0;if(r>=nr.A&&r<=nr.F)return r-(nr.A-10);if(r>=nr.a&&r<=nr.f)return r-(nr.a-10)}function xo(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(sp)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=Yl(r.charCodeAt(s)),a=Yl(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function YA(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Vo(r){return typeof r=="string"&&(r=YA(r)),Er(r),r}function jr(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];Er(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}let Uu=class{};function fs(r){const e=n=>r().update(Vo(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function op(r=32){if(Ln&&typeof Ln.getRandomValues=="function")return Ln.getRandomValues(new Uint8Array(r));if(Ln&&typeof Ln.randomBytes=="function")return Uint8Array.from(Ln.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ru=BigInt(0),$c=BigInt(1);function bo(r,e=""){if(typeof r!="boolean"){const t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof r)}return r}function gn(r,e,t=""){const n=zo(r),i=r?.length,s=e!==void 0;if(!n||s&&i!==e){const o=t&&`"${t}" `,a=s?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof r}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return r}function Ns(r){const e=r.toString(16);return e.length&1?"0"+e:e}function ap(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Ru:BigInt("0x"+r)}function Wo(r){return ap(qn(r))}function cp(r){return Er(r),ap(qn(Uint8Array.from(r).reverse()))}function Bu(r,e){return xo(r.toString(16).padStart(e*2,"0"))}function up(r,e){return Bu(r,e).reverse()}function ot(r,e,t){let n;if(typeof e=="string")try{n=xo(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(zo(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");return n.length,n}const Ma=r=>typeof r=="bigint"&&Ru<=r;function XA(r,e,t){return Ma(r)&&Ma(e)&&Ma(t)&&e<=r&&r<t}function ev(r,e,t,n){if(!XA(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function fp(r){let e;for(e=0;r>Ru;r>>=$c,e+=1);return e}const ls=r=>($c<<BigInt(r))-$c;function tv(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const n=p=>new Uint8Array(p),i=p=>Uint8Array.of(p);let s=n(r),o=n(r),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},u=(...p)=>t(o,s,...p),l=(p=n(0))=>{o=u(i(0),p),s=u(),p.length!==0&&(o=u(i(1),p),s=u())},f=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let p=0;const h=[];for(;p<e;){s=u();const x=s.slice();h.push(x),p+=s.length}return jr(...h)};return(p,h)=>{c(),l(p);let x;for(;!(x=h(f()));)l();return c(),x}}function _u(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(i,s,o){const a=r[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(t).forEach(([i,s])=>n(i,s,!0))}function Xl(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ut=BigInt(0),it=BigInt(1),pn=BigInt(2),lp=BigInt(3),dp=BigInt(4),hp=BigInt(5),rv=BigInt(7),gp=BigInt(8),nv=BigInt(9),pp=BigInt(16);function Ut(r,e){const t=r%e;return t>=ut?t:e+t}function At(r,e,t){let n=r;for(;e-- >ut;)n*=n,n%=t;return n}function ed(r,e){if(r===ut)throw new Error("invert: expected non-zero number");if(e<=ut)throw new Error("invert: expected positive modulus, got "+e);let t=Ut(r,e),n=e,i=ut,s=it;for(;t!==ut;){const a=n/t,c=n%t,u=i-s*a;n=t,t=c,i=s,s=u}if(n!==it)throw new Error("invert: does not exist");return Ut(i,e)}function Lu(r,e,t){if(!r.eql(r.sqr(e),t))throw new Error("Cannot find square root")}function xp(r,e){const t=(r.ORDER+it)/dp,n=r.pow(e,t);return Lu(r,n,e),n}function iv(r,e){const t=(r.ORDER-hp)/gp,n=r.mul(e,pn),i=r.pow(n,t),s=r.mul(e,i),o=r.mul(r.mul(s,pn),i),a=r.mul(s,r.sub(o,r.ONE));return Lu(r,a,e),a}function sv(r){const e=Xr(r),t=bp(r),n=t(e,e.neg(e.ONE)),i=t(e,n),s=t(e,e.neg(n)),o=(r+rv)/pp;return(a,c)=>{let u=a.pow(c,o),l=a.mul(u,n);const f=a.mul(u,i),d=a.mul(u,s),p=a.eql(a.sqr(l),c),h=a.eql(a.sqr(f),c);u=a.cmov(u,l,p),l=a.cmov(d,f,h);const x=a.eql(a.sqr(l),c),b=a.cmov(u,l,x);return Lu(a,b,c),b}}function bp(r){if(r<lp)throw new Error("sqrt is not defined for small field");let e=r-it,t=0;for(;e%pn===ut;)e/=pn,t++;let n=pn;const i=Xr(r);for(;td(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return xp;let s=i.pow(n,e);const o=(e+it)/pn;return function(c,u){if(c.is0(u))return u;if(td(c,u)!==1)throw new Error("Cannot find square root");let l=t,f=c.mul(c.ONE,s),d=c.pow(u,e),p=c.pow(u,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let h=1,x=c.sqr(d);for(;!c.eql(x,c.ONE);)if(h++,x=c.sqr(x),h===l)throw new Error("Cannot find square root");const b=it<<BigInt(l-h-1),w=c.pow(f,b);l=h,f=c.sqr(w),d=c.mul(d,f),p=c.mul(p,w)}return p}}function ov(r){return r%dp===lp?xp:r%gp===hp?iv:r%pp===nv?sv(r):bp(r)}const av=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function cv(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=av.reduce((n,i)=>(n[i]="function",n),e);return _u(r,t),r}function uv(r,e,t){if(t<ut)throw new Error("invalid exponent, negatives unsupported");if(t===ut)return r.ONE;if(t===it)return e;let n=r.ONE,i=e;for(;t>ut;)t&it&&(n=r.mul(n,i)),i=r.sqr(i),t>>=it;return n}function yp(r,e,t=!1){const n=new Array(e.length).fill(t?r.ZERO:void 0),i=e.reduce((o,a,c)=>r.is0(a)?o:(n[c]=o,r.mul(o,a)),r.ONE),s=r.inv(i);return e.reduceRight((o,a,c)=>r.is0(a)?o:(n[c]=r.mul(o,n[c]),r.mul(o,a)),s),n}function td(r,e){const t=(r.ORDER-it)/pn,n=r.pow(e,t),i=r.eql(n,r.ONE),s=r.eql(n,r.ZERO),o=r.eql(n,r.neg(r.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function wp(r,e){e!==void 0&&qi(e);const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Xr(r,e,t=!1,n={}){if(r<=ut)throw new Error("invalid field: expected ORDER > 0, got "+r);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");const d=e;d.BITS&&(i=d.BITS),d.sqrt&&(s=d.sqrt),typeof d.isLE=="boolean"&&(t=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:c,nByteLength:u}=wp(r,i);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let l;const f=Object.freeze({ORDER:r,isLE:t,BITS:c,BYTES:u,MASK:ls(c),ZERO:ut,ONE:it,allowedLengths:a,create:d=>Ut(d,r),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return ut<=d&&d<r},is0:d=>d===ut,isValidNot0:d=>!f.is0(d)&&f.isValid(d),isOdd:d=>(d&it)===it,neg:d=>Ut(-d,r),eql:(d,p)=>d===p,sqr:d=>Ut(d*d,r),add:(d,p)=>Ut(d+p,r),sub:(d,p)=>Ut(d-p,r),mul:(d,p)=>Ut(d*p,r),pow:(d,p)=>uv(f,d,p),div:(d,p)=>Ut(d*ed(p,r),r),sqrN:d=>d*d,addN:(d,p)=>d+p,subN:(d,p)=>d-p,mulN:(d,p)=>d*p,inv:d=>ed(d,r),sqrt:s||(d=>(l||(l=ov(r)),l(f,d))),toBytes:d=>t?up(d,u):Bu(d,u),fromBytes:(d,p=!0)=>{if(a){if(!a.includes(d.length)||d.length>u)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);const x=new Uint8Array(u);x.set(d,t?0:x.length-d.length),d=x}if(d.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+d.length);let h=t?cp(d):Wo(d);if(o&&(h=Ut(h,r)),!p&&!f.isValid(h))throw new Error("invalid field element: outside of range 0..ORDER");return h},invertBatch:d=>yp(f,d),cmov:(d,p,h)=>h?p:d});return Object.freeze(f)}function mp(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function Ap(r){const e=mp(r);return e+Math.ceil(e/2)}function fv(r,e,t=!1){const n=r.length,i=mp(e),s=Ap(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?cp(r):Wo(r),a=Ut(o,e-it)+it;return t?up(a,i):Bu(a,i)}function lv(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,u=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+u,a,n)}function dv(r,e,t){return r&e^~r&t}function hv(r,e,t){return r&e^r&t^e&t}class Du extends Uu{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Da(this.buffer)}update(e){ui(this),e=Vo(e),Er(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Da(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ui(this),ip(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,er(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)t[f]=0;lv(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Da(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const Mr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Qe=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),qe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Os=BigInt(2**32-1),rd=BigInt(32);function gv(r,e=!1){return e?{h:Number(r&Os),l:Number(r>>rd&Os)}:{h:Number(r>>rd&Os)|0,l:Number(r&Os)|0}}function vp(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=gv(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const nd=(r,e,t)=>r>>>t,id=(r,e,t)=>r<<32-t|e>>>t,Dn=(r,e,t)=>r>>>t|e<<32-t,Mn=(r,e,t)=>r<<32-t|e>>>t,Us=(r,e,t)=>r<<64-t|e>>>t-32,Rs=(r,e,t)=>r>>>t-32|e<<64-t,pv=(r,e,t)=>r<<t|e>>>32-t,xv=(r,e,t)=>e<<t|r>>>32-t,bv=(r,e,t)=>e<<t-32|r>>>64-t,yv=(r,e,t)=>r<<t-32|e>>>64-t;function ir(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const wv=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),mv=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Av=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),vv=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,Ev=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),Sv=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,Cv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$r=new Uint32Array(64);let Iv=class extends Du{constructor(e=32){super(64,e,8,!1),this.A=Mr[0]|0,this.B=Mr[1]|0,this.C=Mr[2]|0,this.D=Mr[3]|0,this.E=Mr[4]|0,this.F=Mr[5]|0,this.G=Mr[6]|0,this.H=Mr[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)$r[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const d=$r[f-15],p=$r[f-2],h=Ht(d,7)^Ht(d,18)^d>>>3,x=Ht(p,17)^Ht(p,19)^p>>>10;$r[f]=x+$r[f-7]+h+$r[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const d=Ht(a,6)^Ht(a,11)^Ht(a,25),p=l+d+dv(a,c,u)+Cv[f]+$r[f]|0,x=(Ht(n,2)^Ht(n,13)^Ht(n,22))+hv(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+x|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){er($r)}destroy(){this.set(0,0,0,0,0,0,0,0),er(this.buffer)}};const Ep=vp(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),kv=Ep[0],Tv=Ep[1],Fr=new Uint32Array(80),Gr=new Uint32Array(80);class Sp extends Du{constructor(e=64){super(128,e,16,!1),this.Ah=qe[0]|0,this.Al=qe[1]|0,this.Bh=qe[2]|0,this.Bl=qe[3]|0,this.Ch=qe[4]|0,this.Cl=qe[5]|0,this.Dh=qe[6]|0,this.Dl=qe[7]|0,this.Eh=qe[8]|0,this.El=qe[9]|0,this.Fh=qe[10]|0,this.Fl=qe[11]|0,this.Gh=qe[12]|0,this.Gl=qe[13]|0,this.Hh=qe[14]|0,this.Hl=qe[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:f,Fl:d,Gh:p,Gl:h,Hh:x,Hl:b}=this;return[e,t,n,i,s,o,a,c,u,l,f,d,p,h,x,b]}set(e,t,n,i,s,o,a,c,u,l,f,d,p,h,x,b){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=f|0,this.Fl=d|0,this.Gh=p|0,this.Gl=h|0,this.Hh=x|0,this.Hl=b|0}process(e,t){for(let g=0;g<16;g++,t+=4)Fr[g]=e.getUint32(t),Gr[g]=e.getUint32(t+=4);for(let g=16;g<80;g++){const A=Fr[g-15]|0,v=Gr[g-15]|0,T=Dn(A,v,1)^Dn(A,v,8)^nd(A,v,7),P=Mn(A,v,1)^Mn(A,v,8)^id(A,v,7),I=Fr[g-2]|0,S=Gr[g-2]|0,N=Dn(I,S,19)^Us(I,S,61)^nd(I,S,6),O=Mn(I,S,19)^Rs(I,S,61)^id(I,S,6),E=Av(P,O,Gr[g-7],Gr[g-16]),y=vv(E,T,N,Fr[g-7],Fr[g-16]);Fr[g]=y|0,Gr[g]=E|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:f,El:d,Fh:p,Fl:h,Gh:x,Gl:b,Hh:w,Hl:m}=this;for(let g=0;g<80;g++){const A=Dn(f,d,14)^Dn(f,d,18)^Us(f,d,41),v=Mn(f,d,14)^Mn(f,d,18)^Rs(f,d,41),T=f&p^~f&x,P=d&h^~d&b,I=Ev(m,v,P,Tv[g],Gr[g]),S=Sv(I,w,A,T,kv[g],Fr[g]),N=I|0,O=Dn(n,i,28)^Us(n,i,34)^Us(n,i,39),E=Mn(n,i,28)^Rs(n,i,34)^Rs(n,i,39),y=n&s^n&a^s&a,k=i&o^i&c^o&c;w=x|0,m=b|0,x=p|0,b=h|0,p=f|0,h=d|0,{h:f,l:d}=ir(u|0,l|0,S|0,N|0),u=a|0,l=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const C=wv(N,E,k);n=mv(C,S,O,y),i=C|0}({h:n,l:i}=ir(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=ir(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=ir(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=ir(this.Dh|0,this.Dl|0,u|0,l|0),{h:f,l:d}=ir(this.Eh|0,this.El|0,f|0,d|0),{h:p,l:h}=ir(this.Fh|0,this.Fl|0,p|0,h|0),{h:x,l:b}=ir(this.Gh|0,this.Gl|0,x|0,b|0),{h:w,l:m}=ir(this.Hh|0,this.Hl|0,w|0,m|0),this.set(n,i,s,o,a,c,u,l,f,d,p,h,x,b,w,m)}roundClean(){er(Fr,Gr)}destroy(){er(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class Pv extends Sp{constructor(){super(48),this.Ah=Qe[0]|0,this.Al=Qe[1]|0,this.Bh=Qe[2]|0,this.Bl=Qe[3]|0,this.Ch=Qe[4]|0,this.Cl=Qe[5]|0,this.Dh=Qe[6]|0,this.Dl=Qe[7]|0,this.Eh=Qe[8]|0,this.El=Qe[9]|0,this.Fh=Qe[10]|0,this.Fl=Qe[11]|0,this.Gh=Qe[12]|0,this.Gl=Qe[13]|0,this.Hh=Qe[14]|0,this.Hl=Qe[15]|0}}const Mu=fs(()=>new Iv),Nv=fs(()=>new Sp),Ov=fs(()=>new Pv);let Cp=class extends Uu{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,np(e);const n=Vo(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),er(s)}update(e){return ui(this),this.iHash.update(e),this}digestInto(e){ui(this),Er(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Ip=(r,e,t)=>new Cp(r,e).update(t).digest();Ip.create=(r,e)=>new Cp(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fi=BigInt(0),xn=BigInt(1);function yo(r,e){const t=e.negate();return r?t:e}function $a(r,e){const t=yp(r.Fp,e.map(n=>n.Z));return e.map((n,i)=>r.fromAffine(n.toAffine(t[i])))}function kp(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Fa(r,e){kp(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=ls(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function sd(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=xn);const u=e*n,l=u+Math.abs(a)-1,f=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:f,isNeg:d,isNegF:p,offsetF:u}}function Uv(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function Rv(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const Ga=new WeakMap,Tp=new WeakMap;function Ha(r){return Tp.get(r)||1}function od(r){if(r!==fi)throw new Error("invalid wNAF")}class Bv{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let i=e;for(;t>fi;)t&xn&&(n=n.add(i)),i=i.double(),t>>=xn;return n}precomputeWindow(e,t){const{windows:n,windowSize:i}=Fa(t,this.bits),s=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,s.push(a);for(let u=1;u<i;u++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=Fa(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:u,isZero:l,isNeg:f,isNegF:d,offsetF:p}=sd(n,a,o);n=c,l?s=s.add(yo(d,t[p])):i=i.add(yo(f,t[u]))}return od(n),{p:i,f:s}}wNAFUnsafe(e,t,n,i=this.ZERO){const s=Fa(e,this.bits);for(let o=0;o<s.windows&&n!==fi;o++){const{nextN:a,offset:c,isZero:u,isNeg:l}=sd(n,o,s);if(n=a,!u){const f=t[c];i=i.add(l?f.negate():f)}}return od(n),i}getPrecomputes(e,t,n){let i=Ga.get(t);return i||(i=this.precomputeWindow(t,e),e!==1&&(typeof n=="function"&&(i=n(i)),Ga.set(t,i))),i}cached(e,t,n){const i=Ha(e);return this.wNAF(i,this.getPrecomputes(i,e,n),t)}unsafe(e,t,n,i){const s=Ha(e);return s===1?this._unsafeLadder(e,t,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,n),t,i)}createCache(e,t){kp(t,this.bits),Tp.set(e,t),Ga.delete(e)}hasCache(e){return Ha(e)!==1}}function _v(r,e,t,n){let i=e,s=r.ZERO,o=r.ZERO;for(;t>fi||n>fi;)t&xn&&(s=s.add(i)),n&xn&&(o=o.add(i)),i=i.double(),t>>=xn,n>>=xn;return{p1:s,p2:o}}function Lv(r,e,t,n){Uv(t,r),Rv(n,e);const i=t.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=r.ZERO,a=fp(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const u=ls(c),l=new Array(Number(u)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let d=o;for(let p=f;p>=0;p-=c){l.fill(o);for(let x=0;x<s;x++){const b=n[x],w=Number(b>>BigInt(p)&u);l[w]=l[w].add(t[x])}let h=o;for(let x=l.length-1,b=o;x>0;x--)b=b.add(l[x]),h=h.add(b);if(d=d.add(h),p!==0)for(let x=0;x<c;x++)d=d.double()}return d}function ad(r,e,t){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return cv(e),e}else return Xr(r,{isLE:t})}function Dv(r,e,t={},n){if(n===void 0&&(n=r==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(const c of["p","n","h"]){const u=e[c];if(!(typeof u=="bigint"&&u>fi))throw new Error(`CURVE.${c} must be positive bigint`)}const i=ad(e.p,t.Fp,n),s=ad(e.n,t.Fn,n),a=["Gx","Gy","a","b"];for(const c of a)if(!i.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const cd=(r,e)=>(r+(r>=0?e:-e)/Pp)/e;function Mv(r,e,t){const[[n,i],[s,o]]=e,a=cd(o*r,t),c=cd(-i*r,t);let u=r-a*n-c*s,l=-a*i-c*o;const f=u<hr,d=l<hr;f&&(u=-u),d&&(l=-l);const p=ls(Math.ceil(fp(t)/2))+Zn;if(u<hr||u>=p||l<hr||l>=p)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:f,k1:u,k2neg:d,k2:l}}function Fc(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function Ka(r,e){const t={};for(let n of Object.keys(e))t[n]=r[n]===void 0?e[n]:r[n];return bo(t.lowS,"lowS"),bo(t.prehash,"prehash"),t.format!==void 0&&Fc(t.format),t}class $v extends Error{constructor(e=""){super(e)}}const cr={Err:$v,_tlv:{encode:(r,e)=>{const{Err:t}=cr;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=Ns(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?Ns(i.length/2|128):"";return Ns(r)+s+i+e},decode(r,e){const{Err:t}=cr;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const u=e.subarray(n,n+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const l of u)o=o<<8|l;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=cr;if(r<hr)throw new e("integer: negative integers are not allowed");let t=Ns(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=cr;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Wo(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=cr,i=ot("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:u,l}=n.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(r){const{_tlv:e,_int:t}=cr,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},hr=BigInt(0),Zn=BigInt(1),Pp=BigInt(2),Bs=BigInt(3),Fv=BigInt(4);function Kn(r,e){const{BYTES:t}=r;let n;if(typeof e=="bigint")n=e;else{let i=ot("private key",e);try{n=r.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!r.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function Gv(r,e={}){const t=Dv("weierstrass",r,e),{Fp:n,Fn:i}=t;let s=t.CURVE;const{h:o,n:a}=s;_u(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const u=Op(n,i);function l(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function f(E,y,k){const{x:C,y:U}=y.toAffine(),R=n.toBytes(C);if(bo(k,"isCompressed"),k){l();const B=!n.isOdd(U);return jr(Np(B),R)}else return jr(Uint8Array.of(4),R,n.toBytes(U))}function d(E){gn(E,void 0,"Point");const{publicKey:y,publicKeyUncompressed:k}=u,C=E.length,U=E[0],R=E.subarray(1);if(C===y&&(U===2||U===3)){const B=n.fromBytes(R);if(!n.isValid(B))throw new Error("bad point: is not on curve, wrong x");const L=x(B);let D;try{D=n.sqrt(L)}catch(j){const J=j instanceof Error?": "+j.message:"";throw new Error("bad point: is not on curve, sqrt error"+J)}l();const M=n.isOdd(D);return(U&1)===1!==M&&(D=n.neg(D)),{x:B,y:D}}else if(C===k&&U===4){const B=n.BYTES,L=n.fromBytes(R.subarray(0,B)),D=n.fromBytes(R.subarray(B,B*2));if(!b(L,D))throw new Error("bad point: is not on curve");return{x:L,y:D}}else throw new Error(`bad point: got length ${C}, expected compressed=${y} or uncompressed=${k}`)}const p=e.toBytes||f,h=e.fromBytes||d;function x(E){const y=n.sqr(E),k=n.mul(y,E);return n.add(n.add(k,n.mul(E,s.a)),s.b)}function b(E,y){const k=n.sqr(y),C=x(E);return n.eql(k,C)}if(!b(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const w=n.mul(n.pow(s.a,Bs),Fv),m=n.mul(n.sqr(s.b),BigInt(27));if(n.is0(n.add(w,m)))throw new Error("bad curve params: a or b");function g(E,y,k=!1){if(!n.isValid(y)||k&&n.is0(y))throw new Error(`bad point coordinate ${E}`);return y}function A(E){if(!(E instanceof S))throw new Error("ProjectivePoint expected")}function v(E){if(!c||!c.basises)throw new Error("no endo");return Mv(E,c.basises,i.ORDER)}const T=Xl((E,y)=>{const{X:k,Y:C,Z:U}=E;if(n.eql(U,n.ONE))return{x:k,y:C};const R=E.is0();y==null&&(y=R?n.ONE:n.inv(U));const B=n.mul(k,y),L=n.mul(C,y),D=n.mul(U,y);if(R)return{x:n.ZERO,y:n.ZERO};if(!n.eql(D,n.ONE))throw new Error("invZ was invalid");return{x:B,y:L}}),P=Xl(E=>{if(E.is0()){if(e.allowInfinityPoint&&!n.is0(E.Y))return;throw new Error("bad point: ZERO")}const{x:y,y:k}=E.toAffine();if(!n.isValid(y)||!n.isValid(k))throw new Error("bad point: x or y not field elements");if(!b(y,k))throw new Error("bad point: equation left != right");if(!E.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function I(E,y,k,C,U){return k=new S(n.mul(k.X,E),k.Y,k.Z),y=yo(C,y),k=yo(U,k),y.add(k)}class S{constructor(y,k,C){this.X=g("x",y),this.Y=g("y",k,!0),this.Z=g("z",C),Object.freeze(this)}static CURVE(){return s}static fromAffine(y){const{x:k,y:C}=y||{};if(!y||!n.isValid(k)||!n.isValid(C))throw new Error("invalid affine point");if(y instanceof S)throw new Error("projective point not allowed");return n.is0(k)&&n.is0(C)?S.ZERO:new S(k,C,n.ONE)}static fromBytes(y){const k=S.fromAffine(h(gn(y,void 0,"point")));return k.assertValidity(),k}static fromHex(y){return S.fromBytes(ot("pointHex",y))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(y=8,k=!0){return O.createCache(this,y),k||this.multiply(Bs),this}assertValidity(){P(this)}hasEvenY(){const{y}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(y)}equals(y){A(y);const{X:k,Y:C,Z:U}=this,{X:R,Y:B,Z:L}=y,D=n.eql(n.mul(k,L),n.mul(R,U)),M=n.eql(n.mul(C,L),n.mul(B,U));return D&&M}negate(){return new S(this.X,n.neg(this.Y),this.Z)}double(){const{a:y,b:k}=s,C=n.mul(k,Bs),{X:U,Y:R,Z:B}=this;let L=n.ZERO,D=n.ZERO,M=n.ZERO,$=n.mul(U,U),j=n.mul(R,R),J=n.mul(B,B),H=n.mul(U,R);return H=n.add(H,H),M=n.mul(U,B),M=n.add(M,M),L=n.mul(y,M),D=n.mul(C,J),D=n.add(L,D),L=n.sub(j,D),D=n.add(j,D),D=n.mul(L,D),L=n.mul(H,L),M=n.mul(C,M),J=n.mul(y,J),H=n.sub($,J),H=n.mul(y,H),H=n.add(H,M),M=n.add($,$),$=n.add(M,$),$=n.add($,J),$=n.mul($,H),D=n.add(D,$),J=n.mul(R,B),J=n.add(J,J),$=n.mul(J,H),L=n.sub(L,$),M=n.mul(J,j),M=n.add(M,M),M=n.add(M,M),new S(L,D,M)}add(y){A(y);const{X:k,Y:C,Z:U}=this,{X:R,Y:B,Z:L}=y;let D=n.ZERO,M=n.ZERO,$=n.ZERO;const j=s.a,J=n.mul(s.b,Bs);let H=n.mul(k,R),Q=n.mul(C,B),Z=n.mul(U,L),se=n.add(k,C),re=n.add(R,B);se=n.mul(se,re),re=n.add(H,Q),se=n.sub(se,re),re=n.add(k,U);let ce=n.add(R,L);return re=n.mul(re,ce),ce=n.add(H,Z),re=n.sub(re,ce),ce=n.add(C,U),D=n.add(B,L),ce=n.mul(ce,D),D=n.add(Q,Z),ce=n.sub(ce,D),$=n.mul(j,re),D=n.mul(J,Z),$=n.add(D,$),D=n.sub(Q,$),$=n.add(Q,$),M=n.mul(D,$),Q=n.add(H,H),Q=n.add(Q,H),Z=n.mul(j,Z),re=n.mul(J,re),Q=n.add(Q,Z),Z=n.sub(H,Z),Z=n.mul(j,Z),re=n.add(re,Z),H=n.mul(Q,re),M=n.add(M,H),H=n.mul(ce,re),D=n.mul(se,D),D=n.sub(D,H),H=n.mul(se,Q),$=n.mul(ce,$),$=n.add($,H),new S(D,M,$)}subtract(y){return this.add(y.negate())}is0(){return this.equals(S.ZERO)}multiply(y){const{endo:k}=e;if(!i.isValidNot0(y))throw new Error("invalid scalar: out of range");let C,U;const R=B=>O.cached(this,B,L=>$a(S,L));if(k){const{k1neg:B,k1:L,k2neg:D,k2:M}=v(y),{p:$,f:j}=R(L),{p:J,f:H}=R(M);U=j.add(H),C=I(k.beta,$,J,B,D)}else{const{p:B,f:L}=R(y);C=B,U=L}return $a(S,[C,U])[0]}multiplyUnsafe(y){const{endo:k}=e,C=this;if(!i.isValid(y))throw new Error("invalid scalar: out of range");if(y===hr||C.is0())return S.ZERO;if(y===Zn)return C;if(O.hasCache(this))return this.multiply(y);if(k){const{k1neg:U,k1:R,k2neg:B,k2:L}=v(y),{p1:D,p2:M}=_v(S,C,R,L);return I(k.beta,D,M,U,B)}else return O.unsafe(C,y)}multiplyAndAddUnsafe(y,k,C){const U=this.multiplyUnsafe(k).add(y.multiplyUnsafe(C));return U.is0()?void 0:U}toAffine(y){return T(this,y)}isTorsionFree(){const{isTorsionFree:y}=e;return o===Zn?!0:y?y(S,this):O.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:y}=e;return o===Zn?this:y?y(S,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(y=!0){return bo(y,"isCompressed"),this.assertValidity(),p(S,this,y)}toHex(y=!0){return qn(this.toBytes(y))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(y=!0){return this.toBytes(y)}_setWindowSize(y){this.precompute(y)}static normalizeZ(y){return $a(S,y)}static msm(y,k){return Lv(S,i,y,k)}static fromPrivateKey(y){return S.BASE.multiply(Kn(i,y))}}S.BASE=new S(s.Gx,s.Gy,n.ONE),S.ZERO=new S(n.ZERO,n.ONE,n.ZERO),S.Fp=n,S.Fn=i;const N=i.BITS,O=new Bv(S,e.endo?Math.ceil(N/2):N);return S.BASE.precompute(8),S}function Np(r){return Uint8Array.of(r?2:3)}function Op(r,e){return{secretKey:e.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Hv(r,e={}){const{Fn:t}=r,n=e.randomBytes||op,i=Object.assign(Op(r.Fp,t),{seed:Ap(t.ORDER)});function s(p){try{return!!Kn(t,p)}catch{return!1}}function o(p,h){const{publicKey:x,publicKeyUncompressed:b}=i;try{const w=p.length;return h===!0&&w!==x||h===!1&&w!==b?!1:!!r.fromBytes(p)}catch{return!1}}function a(p=n(i.seed)){return fv(gn(p,i.seed,"seed"),t.ORDER)}function c(p,h=!0){return r.BASE.multiply(Kn(t,p)).toBytes(h)}function u(p){const h=a(p);return{secretKey:h,publicKey:c(h)}}function l(p){if(typeof p=="bigint")return!1;if(p instanceof r)return!0;const{secretKey:h,publicKey:x,publicKeyUncompressed:b}=i;if(t.allowedLengths||h===x)return;const w=ot("key",p).length;return w===x||w===b}function f(p,h,x=!0){if(l(p)===!0)throw new Error("first arg must be private key");if(l(h)===!1)throw new Error("second arg must be public key");const b=Kn(t,p);return r.fromHex(h).multiply(b).toBytes(x)}return Object.freeze({getPublicKey:c,getSharedSecret:f,keygen:u,Point:r,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:p=>Kn(t,p),precompute(p=8,h=r.BASE){return h.precompute(p,!1)}},lengths:i})}function Kv(r,e,t={}){np(e),_u(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=t.randomBytes||op,i=t.hmac||((k,...C)=>Ip(e,k,jr(...C))),{Fp:s,Fn:o}=r,{ORDER:a,BITS:c}=o,{keygen:u,getPublicKey:l,getSharedSecret:f,utils:d,lengths:p}=Hv(r,t),h={prehash:!1,lowS:typeof t.lowS=="boolean"?t.lowS:!1,format:void 0,extraEntropy:!1},x="compact";function b(k){const C=a>>Zn;return k>C}function w(k,C){if(!o.isValidNot0(C))throw new Error(`invalid signature ${k}: out of range 1..Point.Fn.ORDER`);return C}function m(k,C){Fc(C);const U=p.signature,R=C==="compact"?U:C==="recovered"?U+1:void 0;return gn(k,R,`${C} signature`)}class g{constructor(C,U,R){this.r=w("r",C),this.s=w("s",U),R!=null&&(this.recovery=R),Object.freeze(this)}static fromBytes(C,U=x){m(C,U);let R;if(U==="der"){const{r:M,s:$}=cr.toSig(gn(C));return new g(M,$)}U==="recovered"&&(R=C[0],U="compact",C=C.subarray(1));const B=o.BYTES,L=C.subarray(0,B),D=C.subarray(B,B*2);return new g(o.fromBytes(L),o.fromBytes(D),R)}static fromHex(C,U){return this.fromBytes(xo(C),U)}addRecoveryBit(C){return new g(this.r,this.s,C)}recoverPublicKey(C){const U=s.ORDER,{r:R,s:B,recovery:L}=this;if(L==null||![0,1,2,3].includes(L))throw new Error("recovery id invalid");if(a*Pp<U&&L>1)throw new Error("recovery id is ambiguous for h>1 curve");const M=L===2||L===3?R+a:R;if(!s.isValid(M))throw new Error("recovery id 2 or 3 invalid");const $=s.toBytes(M),j=r.fromBytes(jr(Np((L&1)===0),$)),J=o.inv(M),H=v(ot("msgHash",C)),Q=o.create(-H*J),Z=o.create(B*J),se=r.BASE.multiplyUnsafe(Q).add(j.multiplyUnsafe(Z));if(se.is0())throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return b(this.s)}toBytes(C=x){if(Fc(C),C==="der")return xo(cr.hexFromSig(this));const U=o.toBytes(this.r),R=o.toBytes(this.s);if(C==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return jr(Uint8Array.of(this.recovery),U,R)}return jr(U,R)}toHex(C){return qn(this.toBytes(C))}assertValidity(){}static fromCompact(C){return g.fromBytes(ot("sig",C),"compact")}static fromDER(C){return g.fromBytes(ot("sig",C),"der")}normalizeS(){return this.hasHighS()?new g(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return qn(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return qn(this.toBytes("compact"))}}const A=t.bits2int||function(C){if(C.length>8192)throw new Error("input is too large");const U=Wo(C),R=C.length*8-c;return R>0?U>>BigInt(R):U},v=t.bits2int_modN||function(C){return o.create(A(C))},T=ls(c);function P(k){return ev("num < 2^"+c,k,hr,T),o.toBytes(k)}function I(k,C){return gn(k,void 0,"message"),C?gn(e(k),void 0,"prehashed message"):k}function S(k,C,U){if(["recovered","canonical"].some(Q=>Q in U))throw new Error("sign() legacy options not supported");const{lowS:R,prehash:B,extraEntropy:L}=Ka(U,h);k=I(k,B);const D=v(k),M=Kn(o,C),$=[P(M),P(D)];if(L!=null&&L!==!1){const Q=L===!0?n(p.secretKey):L;$.push(ot("extraEntropy",Q))}const j=jr(...$),J=D;function H(Q){const Z=A(Q);if(!o.isValidNot0(Z))return;const se=o.inv(Z),re=r.BASE.multiply(Z).toAffine(),ce=o.create(re.x);if(ce===hr)return;const Te=o.create(se*o.create(J+ce*M));if(Te===hr)return;let ye=(re.x===ce?0:2)|Number(re.y&Zn),Je=Te;return R&&b(Te)&&(Je=o.neg(Te),ye^=1),new g(ce,Je,ye)}return{seed:j,k2sig:H}}function N(k,C,U={}){k=ot("message",k);const{seed:R,k2sig:B}=S(k,C,U);return tv(e.outputLen,o.BYTES,i)(R,B)}function O(k){let C;const U=typeof k=="string"||zo(k),R=!U&&k!==null&&typeof k=="object"&&typeof k.r=="bigint"&&typeof k.s=="bigint";if(!U&&!R)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(R)C=new g(k.r,k.s);else if(U){try{C=g.fromBytes(ot("sig",k),"der")}catch(B){if(!(B instanceof cr.Err))throw B}if(!C)try{C=g.fromBytes(ot("sig",k),"compact")}catch{return!1}}return C||!1}function E(k,C,U,R={}){const{lowS:B,prehash:L,format:D}=Ka(R,h);if(U=ot("publicKey",U),C=I(ot("message",C),L),"strict"in R)throw new Error("options.strict was renamed to lowS");const M=D===void 0?O(k):g.fromBytes(ot("sig",k),D);if(M===!1)return!1;try{const $=r.fromBytes(U);if(B&&M.hasHighS())return!1;const{r:j,s:J}=M,H=v(C),Q=o.inv(J),Z=o.create(H*Q),se=o.create(j*Q),re=r.BASE.multiplyUnsafe(Z).add($.multiplyUnsafe(se));return re.is0()?!1:o.create(re.x)===j}catch{return!1}}function y(k,C,U={}){const{prehash:R}=Ka(U,h);return C=I(C,R),g.fromBytes(k,"recovered").recoverPublicKey(C).toBytes()}return Object.freeze({keygen:u,getPublicKey:l,getSharedSecret:f,utils:d,lengths:p,Point:r,sign:N,verify:E,recoverPublicKey:y,Signature:g,hash:e})}function jv(r){const e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp;let n=r.allowedPrivateKeyLengths?Array.from(new Set(r.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Xr(e.n,{BITS:r.nBitLength,allowedLengths:n,modFromBytes:r.wrapPrivateKey}),s={Fp:t,Fn:i,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:s}}function zv(r){const{CURVE:e,curveOpts:t}=jv(r),n={hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,hash:r.hash,ecdsaOpts:n}}function Vv(r,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},r,wp(t.Fn.ORDER,t.Fn.BITS))})}function Wv(r){const{CURVE:e,curveOpts:t,hash:n,ecdsaOpts:i}=zv(r),s=Gv(e,t),o=Kv(s,n,i);return Vv(r,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Jo(r,e){const t=n=>Wv({...r,hash:n});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Up={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Rp={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Bp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Jv=Xr(Up.p),Qv=Xr(Rp.p),qv=Xr(Bp.p),Zv=Jo({...Up,Fp:Jv,lowS:!1},Mu);Jo({...Rp,Fp:Qv,lowS:!1},Ov);Jo({...Bp,Fp:qv,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Nv);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gc=Zv;/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $u={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Yv={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},ud=BigInt(2);function Xv(r){const e=$u.p,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=r*r*r%e,l=u*u*r%e,f=At(l,t,e)*l%e,d=At(f,t,e)*l%e,p=At(d,ud,e)*u%e,h=At(p,i,e)*p%e,x=At(h,s,e)*h%e,b=At(x,a,e)*x%e,w=At(b,c,e)*b%e,m=At(w,a,e)*x%e,g=At(m,t,e)*l%e,A=At(g,o,e)*h%e,v=At(A,n,e)*u%e,T=At(v,ud,e);if(!Hc.eql(Hc.sqr(T),r))throw new Error("Cannot find square root");return T}const Hc=Xr($u.p,{sqrt:Xv}),_s=Jo({...$u,Fp:Hc,lowS:!0,endo:Yv},Mu),Ws=Mu,e3=BigInt(0),Si=BigInt(1),t3=BigInt(2),r3=BigInt(7),n3=BigInt(256),i3=BigInt(113),_p=[],Lp=[],Dp=[];for(let r=0,e=Si,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],_p.push(2*(5*n+t)),Lp.push((r+1)*(r+2)/2%64);let i=e3;for(let s=0;s<7;s++)e=(e<<Si^(e>>r3)*i3)%n3,e&t3&&(i^=Si<<(Si<<BigInt(s))-Si);Dp.push(i)}const Mp=vp(Dp,!0),s3=Mp[0],o3=Mp[1],fd=(r,e,t)=>t>32?bv(r,e,t):pv(r,e,t),ld=(r,e,t)=>t>32?yv(r,e,t):xv(r,e,t);function a3(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=t[c],l=t[c+1],f=fd(u,l,1)^t[a],d=ld(u,l,1)^t[a+1];for(let p=0;p<50;p+=10)r[o+p]^=f,r[o+p+1]^=d}let i=r[2],s=r[3];for(let o=0;o<24;o++){const a=Lp[o],c=fd(i,s,a),u=ld(i,s,a),l=_p[o];i=r[l],s=r[l+1],r[l]=c,r[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=s3[n],r[1]^=o3[n]}er(t)}class Fu extends Uu{constructor(e,t,n,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=i,this.rounds=s,qi(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=WA(this.state)}clone(){return this._cloneInto()}keccak(){Zl(this.state32),a3(this.state32,this.rounds),Zl(this.state32),this.posOut=0,this.pos=0}update(e){ui(this),e=Vo(e),Er(e);const{blockLen:t,state:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(t-this.pos,i-s);for(let a=0;a<o;a++)n[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:i}=this;e[n]^=t,(t&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){ui(this,!1),Er(e),this.finish();const t=this.state,{blockLen:n}=this;for(let i=0,s=e.length;i<s;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,s-i);e.set(t.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return qi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ip(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,er(this.state)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Fu(t,n,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const c3=(r,e,t)=>fs(()=>new Fu(e,r,t)),u3=c3(1,136,256/8),f3=Uint8Array.from([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),$p=Uint8Array.from(new Array(16).fill(0).map((r,e)=>e)),l3=$p.map(r=>(9*r+5)%16),Fp=(()=>{const t=[[$p],[l3]];for(let n=0;n<4;n++)for(let i of t)i.push(i[n].map(s=>f3[s]));return t})(),Gp=Fp[0],Hp=Fp[1],Kp=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map(r=>Uint8Array.from(r)),d3=Gp.map((r,e)=>r.map(t=>Kp[e][t])),h3=Hp.map((r,e)=>r.map(t=>Kp[e][t])),g3=Uint32Array.from([0,1518500249,1859775393,2400959708,2840853838]),p3=Uint32Array.from([1352829926,1548603684,1836072691,2053994217,0]);function dd(r,e,t,n){return r===0?e^t^n:r===1?e&t|~e&n:r===2?(e|~t)^n:r===3?e&n|t&~n:e^(t|~n)}const Ls=new Uint32Array(16);class x3 extends Du{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:n,h3:i,h4:s}=this;return[e,t,n,i,s]}set(e,t,n,i,s){this.h0=e|0,this.h1=t|0,this.h2=n|0,this.h3=i|0,this.h4=s|0}process(e,t){for(let p=0;p<16;p++,t+=4)Ls[p]=e.getUint32(t,!0);let n=this.h0|0,i=n,s=this.h1|0,o=s,a=this.h2|0,c=a,u=this.h3|0,l=u,f=this.h4|0,d=f;for(let p=0;p<5;p++){const h=4-p,x=g3[p],b=p3[p],w=Gp[p],m=Hp[p],g=d3[p],A=h3[p];for(let v=0;v<16;v++){const T=Ps(n+dd(p,s,a,u)+Ls[w[v]]+x,g[v])+f|0;n=f,f=u,u=Ps(a,10)|0,a=s,s=T}for(let v=0;v<16;v++){const T=Ps(i+dd(h,o,c,l)+Ls[m[v]]+b,A[v])+d|0;i=d,d=l,l=Ps(c,10)|0,c=o,o=T}}this.set(this.h1+a+l|0,this.h2+u+d|0,this.h3+f+i|0,this.h4+n+o|0,this.h0+s+c|0)}roundClean(){er(Ls)}destroy(){this.destroyed=!0,er(this.buffer),this.set(0,0,0,0,0)}}const b3=fs(()=>new x3),y3=b3;async function Ir(r,e,t={}){const n=new TextEncoder,i=r?typeof r=="string"?n.encode(hd(r)):r:crypto.getRandomValues(new Uint8Array(32)),s=e?(Array.isArray(e)?e:[e]).map(p=>hd(p.toString())):[],o=n.encode(s.join("|")),a=new Uint8Array(i.length+o.length);if(a.set(i),a.set(o,i.length),a.length<16)throw new Error(`Insufficient input entropy (${a.length})`);const c="v1",u={},{includeP256:l=!0,includeSecp256k1Bitcoin:f=!0,includeSecp256k1Ethereum:d=!0}=t;if(l){const p=[{label:"signing",type:"pub/priv"},{label:"encryption",type:"epub/epriv"}],[h,x]=await Promise.all(p.map(async({label:b})=>{const w=n.encode(`${b}-${c}`),m=await ja(a,w);if(!Gc.utils.isValidPrivateKey(m))throw new Error(`Invalid private key for ${b}`);const g=Gc.getPublicKey(m,!1);return{pub:w3(g),priv:Kc(m)}}));u.pub=h.pub,u.priv=h.priv,u.epub=x.pub,u.epriv=x.priv}if(f){const p=n.encode(`secp256k1-bitcoin-${c}`),h=await ja(a,p);if(!_s.utils.isValidPrivateKey(h))throw new Error("Invalid secp256k1 private key for Bitcoin");const x=_s.getPublicKey(h,!0);u.secp256k1Bitcoin={privateKey:Oi(h),publicKey:Oi(x),address:v3(x)}}if(d){const p=n.encode(`secp256k1-ethereum-${c}`),h=await ja(a,p);if(!_s.utils.isValidPrivateKey(h))throw new Error("Invalid secp256k1 private key for Ethereum");const x=_s.getPublicKey(h,!1);u.secp256k1Ethereum={privateKey:"0x"+Oi(h),publicKey:"0x"+Oi(x),address:E3(x)}}return u}function Kc(r){return btoa(String.fromCharCode(...r)).replace(/\//g,"_").replace(/=/g,"").replace(/\+/g,"-")}function w3(r){if(r[0]!==4)throw new Error("Invalid uncompressed public key format");return[Kc(r.slice(1,33)),Kc(r.slice(33,65))].join(".")}function hd(r){return r.normalize("NFC").trim()}async function ja(r,e,t=3e5){try{const n=await crypto.subtle.importKey("raw",r,{name:"PBKDF2"},!1,["deriveBits"]),i=await crypto.subtle.deriveBits({name:"PBKDF2",salt:e,iterations:t,hash:"SHA-256"},n,256),s=new Uint8Array(i);return gd(s)}catch{const i=m3(r,e);return gd(i)}}function m3(r,e){const t=new Uint8Array(32);for(let n=0;n<32;n++)t[n]=(n*7+e[n%e.length])%256;return t}function gd(r){r.every(n=>n===0)&&(r[0]=1);const e=new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,186,174,220,230]);let t=!0;for(let n=0;n<32;n++)if(r[n]<e[n]){t=!1;break}else if(r[n]>e[n])break;return t&&(r[31]=229),(r.every(n=>n===0)||r.every(n=>n===1))&&(r.fill(0),r[0]=1,r[31]=255),r}function Oi(r){return Array.from(r).map(e=>e.toString(16).padStart(2,"0")).join("")}const pd="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";function A3(r){if(r.length===0)return"";let e=0;for(let i=0;i<r.length&&r[i]===0;i++)e++;const t=[0];for(let i=e;i<r.length;i++){let s=r[i];for(let o=0;o<t.length;o++)s+=t[o]<<8,t[o]=s%58,s=s/58|0;for(;s>0;)t.push(s%58),s=s/58|0}let n="";for(let i=0;i<e;i++)n+=pd[0];for(let i=t.length-1;i>=0;i--)n+=pd[t[i]];return n}function v3(r){const e=Ws(r),t=y3(e),n=new Uint8Array(21);n[0]=0,n.set(t,1);const i=Ws(Ws(n)),s=new Uint8Array(25);return s.set(n),s.set(i.slice(0,4),21),A3(s)}function E3(r){const e=r.slice(1),n=u3(e).slice(-20);return"0x"+Oi(n)}const xd=3,bd=64,S3={rpName:"Shogun Wallet",timeout:6e4,userVerification:"preferred",attestation:"none",authenticatorAttachment:"platform",requireResidentKey:!1};class wo extends Cn{config;gunInstance;credential;abortController=null;constructor(e,t){super(),this.gunInstance=e,this.credential=null,this.config={...S3,...t,rpId:t?.rpId??(typeof window<"u"&&window.location&&window.location.hostname?window.location.hostname.split(":")[0]:"localhost")}}validateUsername(e){if(!e||typeof e!="string")throw new Error("Username must be a non-empty string");if(e.length<xd||e.length>bd)throw new Error(`Username must be between ${xd} and ${bd} characters`);if(!/^[a-zA-Z0-9_-]+$/.test(e))throw new Error("Username can only contain letters, numbers, underscores and hyphens")}async createAccount(e,t,n=!1){try{this.validateUsername(e);const i=3;let s=null;for(let o=1;o<=i;o++)try{const a=await this.generateCredentials(e,t,n);if(a.success)return this.emit(zt.DEVICE_REGISTERED,{type:zt.DEVICE_REGISTERED,data:{username:e},timestamp:Date.now()}),a;s=new Error(a.error??"Unknown error")}catch(a){if(s=a,o<i){await new Promise(c=>setTimeout(c,1e3*o));continue}}throw s||new Error("Failed to create account after retries")}catch(i){throw this.emit(zt.ERROR,{type:zt.ERROR,data:{error:i.message},timestamp:Date.now()}),i}}async authenticateUser(e,t,n={}){try{if(this.validateUsername(e),!t){const o=new Error("No WebAuthn credentials found for this username");return Le.handle(Y.WEBAUTHN,"NO_CREDENTIALS",o.message,o),{success:!1,error:o.message}}this.abortAuthentication(),this.abortController=new AbortController;const i=n.timeout||this.config.timeout,s=setTimeout(()=>this.abortController?.abort(),i);try{const a={challenge:this.generateChallenge(e),allowCredentials:[],timeout:i,userVerification:n.userVerification||this.config.userVerification,rpId:this.config.rpId},c=await navigator.credentials.get({publicKey:a,signal:this.abortController.signal});if(!c)throw new Error("WebAuthn verification failed");const{password:u}=this.generateCredentialsFromSalt(e,t),l=this.getDeviceInfo(c.id),f={success:!0,username:e,password:u,credentialId:this.bufferToBase64(c.rawId),deviceInfo:l};return this.emit(zt.AUTHENTICATION_SUCCESS,{type:zt.AUTHENTICATION_SUCCESS,data:{username:e,deviceInfo:l},timestamp:Date.now()}),f}finally{clearTimeout(s),this.abortController=null}}catch(i){const s=i instanceof Error?i.message:"Unknown WebAuthn error";return this.emit(zt.AUTHENTICATION_FAILED,{type:zt.AUTHENTICATION_FAILED,data:{username:e,error:s},timestamp:Date.now()}),Le.handle(Y.WEBAUTHN,"AUTH_ERROR",s,i),{success:!1,error:s}}}abortAuthentication(){this.abortController&&(this.abortController.abort(),this.abortController=null)}getDeviceInfo(e){const t=this.getPlatformInfo();return{deviceId:e,timestamp:Date.now(),name:t.name,platform:t.platform,lastUsed:Date.now()}}getPlatformInfo(){if(typeof navigator>"u")return{name:"unknown",platform:"unknown"};const e=navigator.platform,t=navigator.userAgent;return/iPhone|iPad|iPod/.test(e)?{name:"iOS Device",platform:e}:/Android/.test(t)?{name:"Android Device",platform:e}:/Win/.test(e)?{name:"Windows Device",platform:e}:/Mac/.test(e)?{name:"Mac Device",platform:e}:/Linux/.test(e)?{name:"Linux Device",platform:e}:{name:"Unknown Device",platform:e}}generateChallenge(e){const t=Date.now().toString(),n=this.getRandomBytes(32),i=`${e}-${t}-${this.uint8ArrayToHex(n)}`;return new TextEncoder().encode(i)}getRandomBytes(e){if(typeof window<"u"&&window.crypto)return window.crypto.getRandomValues(new Uint8Array(e));throw new Error("No cryptographic implementation available")}uint8ArrayToHex(e){return Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")}bufferToBase64(e){const n=new Uint8Array(e).reduce((i,s)=>i+String.fromCharCode(s),"");return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}generateCredentialsFromSalt(e,t){const n=de(e+t);return{password:st(n)}}isSupported(){return typeof window<"u"&&window.PublicKeyCredential!==void 0}async createCredential(e){try{const t=crypto.getRandomValues(new Uint8Array(32)),n=new TextEncoder().encode(e),i={challenge:t,rp:{name:"Shogun Wallet",...this.config.rpId!=="localhost"&&{id:this.config.rpId}},user:{id:n,name:e,displayName:e},pubKeyCredParams:[{type:"public-key",alg:-7}],timeout:this.config.timeout,attestation:this.config.attestation,authenticatorSelection:{authenticatorAttachment:this.config.authenticatorAttachment,userVerification:this.config.userVerification,requireResidentKey:this.config.requireResidentKey}},s=await navigator.credentials.create({publicKey:i});if(!s)throw new Error("Credential creation failed");const o=s,a={id:o.id,rawId:o.rawId,type:o.type,response:{clientDataJSON:o.response.clientDataJSON},getClientExtensionResults:o.getClientExtensionResults};return"attestationObject"in o.response&&(a.response.attestationObject=o.response.attestationObject),this.credential=a,a}catch(t){console.error("Detailed error in credential creation:",t);const n=t instanceof Error?t.message:"Unknown error";throw new Error(`Error creating credentials: ${n}`)}}async generateCredentials(e,t,n=!1){try{if(n){const i=await this.verifyCredential(e);if(!i.success||!i.credentialId)return{success:!1,username:e,key:void 0,credentialId:"",error:i.error,publicKey:null};const s=await yd(e,i.credentialId);return{success:!0,username:e,key:s,credentialId:i.credentialId,publicKey:null}}else{const i=await this.createCredential(e),s=i.id;let o=null;i?.response?.getPublicKey&&(o=i.response.getPublicKey());const a=await yd(e,s);return{success:!0,username:e,key:a,credentialId:s,publicKey:o}}}catch(i){console.error("Error in generateCredentials:",i);const s=i instanceof Error?i.message:"Unknown error during WebAuthn operation";return{success:!1,username:e,key:void 0,credentialId:"",error:s,publicKey:null}}}async verifyCredential(e){try{const n={challenge:crypto.getRandomValues(new Uint8Array(32)),timeout:this.config.timeout,userVerification:this.config.userVerification,...this.config.rpId!=="localhost"&&{rpId:this.config.rpId}};this.credential?.rawId&&(n.allowCredentials=[{id:this.credential.rawId,type:"public-key"}]);const i=await navigator.credentials.get({publicKey:n});return i?{success:!0,credentialId:i.id,username:e}:{success:!1,error:"Credential verification failed"}}catch(t){return console.error("Error verifying credentials:",t),{success:!1,error:t instanceof Error?t.message:"Unknown error verifying credentials"}}}async removeDevice(e,t,n){if(!n||!n.credentials||!n.credentials[t])return{success:!1};const i={...n};return i.credentials&&delete i.credentials[t],{success:!0,updatedCredentials:i}}async sign(e){return await navigator.credentials.get({publicKey:{challenge:new Uint8Array(16),rpId:this.config.rpId}})}}typeof window<"u"?window.Webauthn=wo:typeof global<"u"&&(global.Webauthn=wo);async function yd(r,e){const t=ie(de(e)),n=`${r}_${e}`;return await Ir(t,n,{includeP256:!0})}const Ds={encode:function(r){const e=new Uint8Array(r);return btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},decode:function(r){for(r=r.replace(/-/g,"+").replace(/_/g,"/");r.length%4;)r+="=";const e=atob(r);return new Uint8Array(e.split("").map(t=>t.charCodeAt(0)))}};class C3{webauthn;credentials=new Map;constructor(e){this.webauthn=e||new wo}async createSigningCredential(e){try{const t=await navigator.credentials.create({publicKey:{challenge:crypto.getRandomValues(new Uint8Array(32)),rp:{id:window.location.hostname==="localhost"?"localhost":window.location.hostname,name:"Shogun Wallet"},user:{id:new TextEncoder().encode(e),name:e,displayName:e},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-25},{type:"public-key",alg:-257}],authenticatorSelection:{userVerification:"preferred"},timeout:6e4,attestation:"none"}});if(!t)throw new Error("Failed to create WebAuthn credential");const i=t.response.getPublicKey();if(!i)throw new Error("Failed to get public key from credential");const s=new Uint8Array(i),o=s.slice(27,59),a=s.slice(59,91),c=Ds.encode(o),u=Ds.encode(a),l=`${c}.${u}`,f=ie(de(t.id)),d={id:t.id,rawId:t.rawId,publicKey:{x:c,y:u},pub:l,hashedCredentialId:f};return this.credentials.set(t.id,d),d}catch(t){throw console.error("Error creating signing credential:",t),new Error(`Failed to create signing credential: ${t.message}`)}}createAuthenticator(e){const t=this.credentials.get(e);if(!t)throw new Error(`Credential ${e} not found`);return async n=>{try{const s={challenge:new TextEncoder().encode(JSON.stringify(n)),rpId:window.location.hostname==="localhost"?"localhost":window.location.hostname,userVerification:"preferred",allowCredentials:[{type:"public-key",id:t.rawId}],timeout:6e4},o=await navigator.credentials.get({publicKey:s});if(!o)throw new Error("WebAuthn assertion failed");return o.response}catch(i){throw console.error("WebAuthn assertion error:",i),i}}}async createDerivedKeyPair(e,t,n){const i=this.credentials.get(e);if(!i)throw new Error(`Credential ${e} not found`);try{const s=await Ir(i.hashedCredentialId,n,{includeP256:!0});return{pub:s.pub,priv:s.priv,epub:s.epub,epriv:s.epriv}}catch(s){throw console.error("Error deriving keys from WebAuthn credential:",s),s}}async createGunUser(e,t,n){const i=this.credentials.get(e);if(!i)throw new Error(`Credential ${e} not found`);try{const s=await this.createDerivedKeyPair(e,t);return new Promise(o=>{n.user().create(s,a=>{a.err?n.user().auth(s,c=>{if(c.err)o({success:!1,error:c.err});else{const u=c.pub;i.gunUserPub=u,this.credentials.set(e,i),o({success:!0,userPub:u})}}):n.user().auth(s,c=>{if(c.err)o({success:!1,error:c.err});else{const u=c.pub;i.gunUserPub=u,this.credentials.set(e,i),o({success:!0,userPub:u})}})})})}catch(s){return console.error("Error creating Gun user:",s),{success:!1,error:s.message}}}async signWithDerivedKeys(e,t,n,i){try{await this.createAuthenticator(t)(e);const o=await this.createDerivedKeyPair(t,n,i),a=JSON.stringify(e),c=Ws(new TextEncoder().encode(a)),u=Ds.decode(o.priv),l=Gc.sign(c,u),f={m:a,s:Ds.encode(l.toCompactRawBytes())};return"SEA"+JSON.stringify(f)}catch(s){throw console.error("Error signing with derived keys:",s),s}}getGunUserPub(e){return this.credentials.get(e)?.gunUserPub}getHashedCredentialId(e){return this.credentials.get(e)?.hashedCredentialId}async verifyConsistency(e,t,n){if(!this.credentials.get(e))return{consistent:!1};const s=await this.createDerivedKeyPair(e,t);return{consistent:n?s.pub===n:!0,actualUserPub:s.pub,expectedUserPub:n}}getCredential(e){return this.credentials.get(e)}listCredentials(){return Array.from(this.credentials.values())}removeCredential(e){return this.credentials.delete(e)}}class I3 extends Co{name="webauthn";version="1.0.0";description="Provides WebAuthn authentication functionality for ShogunCore";webauthn=null;signer=null;initialize(e){if(super.initialize(e),typeof window>"u"){console.warn("[webauthnPlugin] WebAuthn plugin disabled - not in browser environment");return}if(!this.isSupported()){console.warn("[webauthnPlugin] WebAuthn not supported in this environment");return}this.webauthn=new wo(e.gun),this.signer=new C3(this.webauthn),console.log("[webauthnPlugin] WebAuthn plugin initialized with signer support")}destroy(){this.webauthn=null,this.signer=null,super.destroy(),console.log("[webauthnPlugin] WebAuthn plugin destroyed")}assertWebauthn(){if(this.assertInitialized(),!this.webauthn)throw new Error("WebAuthn module not initialized");return this.webauthn}assertSigner(){if(this.assertInitialized(),!this.signer)throw new Error("WebAuthn signer not initialized");return this.signer}async generatePairFromCredentials(e){try{return await this.assertSigner().createDerivedKeyPair(e.credentialId,e.username)}catch(t){return console.error("Error generating pair from WebAuthn credentials:",t),null}}isSupported(){return typeof window>"u"||typeof window.PublicKeyCredential>"u"?!1:this.webauthn?this.webauthn.isSupported():typeof window.PublicKeyCredential<"u"}async generateCredentials(e,t,n=!1){return this.assertWebauthn().generateCredentials(e,t,n)}async createAccount(e,t,n=!1){return this.assertWebauthn().createAccount(e,t,n)}async authenticateUser(e,t,n){return this.assertWebauthn().authenticateUser(e,t,n)}abortAuthentication(){this.assertWebauthn().abortAuthentication()}async removeDevice(e,t,n){return this.assertWebauthn().removeDevice(e,t,n)}async createSigningCredential(e){try{const t=this.assertWebauthn();return typeof t.createSigningCredential=="function"?await t.createSigningCredential(e):await this.assertSigner().createSigningCredential(e)}catch(t){throw console.error(`Error creating signing credential: ${t.message}`),t}}createAuthenticator(e){try{const t=this.assertWebauthn();return typeof t.createAuthenticator=="function"?t.createAuthenticator(e):this.assertSigner().createAuthenticator(e)}catch(t){throw console.error(`Error creating authenticator: ${t.message}`),t}}async createDerivedKeyPair(e,t,n){try{const i=this.assertWebauthn();return typeof i.createDerivedKeyPair=="function"?await i.createDerivedKeyPair(e,t,n):await this.assertSigner().createDerivedKeyPair(e,t,n)}catch(i){throw console.error(`Error creating derived key pair: ${i.message}`),i}}async signWithDerivedKeys(e,t,n,i){try{const s=this.assertWebauthn();return typeof s.signWithDerivedKeys=="function"?await s.signWithDerivedKeys(e,t,n,i):await this.assertSigner().signWithDerivedKeys(e,t,n,i)}catch(s){throw console.error(`Error signing with derived keys: ${s.message}`),s}}getSigningCredential(e){const t=this.assertWebauthn();return typeof t.getSigningCredential=="function"?t.getSigningCredential(e):this.assertSigner().getCredential(e)}listSigningCredentials(){const e=this.assertWebauthn();return typeof e.listSigningCredentials=="function"?e.listSigningCredentials():this.assertSigner().listCredentials()}removeSigningCredential(e){const t=this.assertWebauthn();return typeof t.removeSigningCredential=="function"?t.removeSigningCredential(e):this.assertSigner().removeCredential(e)}async createGunUserFromSigningCredential(e,t){try{const n=this.assertWebauthn();if(typeof n.createGunUserFromSigningCredential=="function")return await n.createGunUserFromSigningCredential(e,t);const i=this.assertInitialized();return await this.assertSigner().createGunUser(e,t,i.gun)}catch(n){throw console.error(`Error creating Gun user from signing credential: ${n.message}`),n}}getGunUserPubFromSigningCredential(e){const t=this.assertWebauthn();return typeof t.getGunUserPubFromSigningCredential=="function"?t.getGunUserPubFromSigningCredential(e):this.assertSigner().getGunUserPub(e)}getHashedCredentialId(e){const t=this.assertWebauthn();return typeof t.getHashedCredentialId=="function"?t.getHashedCredentialId(e):this.assertSigner().getHashedCredentialId(e)}async verifyConsistency(e,t,n){try{const i=this.assertWebauthn();return typeof i.verifyConsistency=="function"?await i.verifyConsistency(e,t,n):await this.assertSigner().verifyConsistency(e,t,n)}catch(i){return console.error(`Error verifying consistency: ${i.message}`),{consistent:!1}}}async setupConsistentOneshotSigning(e){try{const t=this.assertWebauthn();if(typeof t.setupConsistentOneshotSigning=="function")return await t.setupConsistentOneshotSigning(e);const n=await this.createSigningCredential(e),i=this.createAuthenticator(n.id),s=await this.createGunUserFromSigningCredential(n.id,e);return{credential:n,authenticator:i,gunUser:s,pub:n.pub,hashedCredentialId:n.hashedCredentialId}}catch(t){throw console.error(`Error setting up consistent oneshot signing: ${t.message}`),t}}async login(e){try{const t=this.assertInitialized();if(!e)throw new Error("Username required for WebAuthn login");if(!this.isSupported())throw new Error("WebAuthn is not supported by this browser");const{authenticator:n,pub:i}=await this.setupConsistentOneshotSigning(e);if(t.authenticate)return await t.authenticate(e,n,i);const s=await this.generateCredentials(e,null,!0);if(!s?.success)throw new Error(s?.error||"WebAuthn verification failed");return t.setAuthMethod("webauthn"),await t.login(e,"",s.key)}catch(t){return console.error(`Error during WebAuthn login: ${t}`),Le.handle(Y.WEBAUTHN,"WEBAUTHN_LOGIN_ERROR",t.message||"Error during WebAuthn login",t),{success:!1,error:t.message||"Error during WebAuthn login"}}}async signUp(e){try{const t=this.assertInitialized();if(!e)throw new Error("Username required for WebAuthn registration");if(!this.isSupported())throw new Error("WebAuthn is not supported by this browser");const{authenticator:n,pub:i}=await this.setupConsistentOneshotSigning(e);if(t.signUp)return await t.signUp(e,n,i);const s=await this.generateCredentials(e,null,!1);if(!s?.success)throw new Error(s?.error||"Unable to generate WebAuthn credentials");t.setAuthMethod("webauthn");const o=await this.generatePairFromCredentials(s);if(!o)throw new Error("Failed to generate SEA pair from WebAuthn credentials");return await t.signUp(e,void 0,o)}catch(t){return console.error(`Error during WebAuthn registration: ${t}`),Le.handle(Y.WEBAUTHN,"WEBAUTHN_SIGNUP_ERROR",t.message||"Error during WebAuthn registration",t),{success:!1,error:t.message||"Error during WebAuthn registration"}}}}class En extends Cn{MESSAGE_TO_SIGN="I Love Shogun!";DEFAULT_CONFIG={cacheDuration:1800*1e3,maxRetries:3,retryDelay:1e3,timeout:6e4};config;signatureCache=new Map;provider=null;customProvider=null;customWallet=null;constructor(e={}){super(),this.config={...this.DEFAULT_CONFIG,...e},this.initProvider(),this.setupEventListeners()}initProvider(){if(typeof window<"u")try{const e=this.getAvailableEthereumProvider();e?this.provider=new fr(e):console.warn("No compatible Ethereum provider found")}catch(e){console.error("Failed to initialize BrowserProvider",e)}else console.warn("Window object not available (non-browser environment)")}getAvailableEthereumProvider(){if(typeof window>"u")return;const e=[{source:()=>window._ethereumProviders&&window._ethereumProviders[0],name:"Registry Primary"},{source:()=>window.ethereum,name:"Standard ethereum"},{source:()=>window.web3?.currentProvider,name:"Legacy web3"},{source:()=>window.metamask,name:"MetaMask specific"},{source:()=>window.ethereum?.providers?.find(t=>t.isMetaMask),name:"MetaMask from providers array"},{source:()=>window.ethereum?.providers?.[0],name:"First provider in array"},{source:()=>window.enkrypt?.providers?.ethereum,name:"Enkrypt"},{source:()=>window.coinbaseWalletExtension,name:"Coinbase"},{source:()=>window.trustWallet,name:"Trust Wallet"},{source:()=>Array.isArray(window._ethereumProviders)?window._ethereumProviders.find(t=>!t._isProxy):void 0,name:"Registry non-proxy"}];for(const{source:t,name:n}of e)try{const i=t();if(i&&typeof i.request=="function")return i}catch(i){console.warn(`Error checking provider ${n}:`,i);continue}console.warn("No compatible Ethereum provider found")}async setupProvider(){try{if(typeof window<"u"){const e=this.getAvailableEthereumProvider();e?this.provider=new fr(e):console.warn("No compatible Ethereum provider found")}else console.warn("Window object not available (non-browser environment)")}catch(e){console.error("Failed to initialize BrowserProvider",e)}}setupEventListeners(){if(this.provider){this.provider.on("network",(e,t)=>{this.emit("chainChanged",e)});try{const e=this.getAvailableEthereumProvider();e?.on&&(e.on("accountsChanged",t=>{this.emit("accountsChanged",t)}),e.on("chainChanged",t=>{this.emit("chainChanged",{chainId:t})}))}catch(e){console.warn("Failed to setup account change listeners",e)}}}cleanup(){this.provider&&this.provider.removeAllListeners(),this.removeAllListeners()}getCachedSignature(e){const t=this.signatureCache.get(e);return t?Date.now()-t.timestamp>this.config.cacheDuration?(this.signatureCache.delete(e),null):!t.signature||typeof t.signature!="string"||t.signature.length<16?(console.warn(`Invalid cached signature for address ${e} (length: ${t.signature?t.signature.length:0}), deleting from cache.`),this.signatureCache.delete(e),null):t.signature:null}cacheSignature(e,t){this.signatureCache.set(e,{signature:t,timestamp:Date.now(),address:e})}validateAddress(e){if(!e)throw new Error("Address not provided");try{const t=String(e).trim().toLowerCase();if(!Bm(t))throw new Error("Invalid address format");return te(t)}catch(t){throw Le.handle(Y.VALIDATION,"INVALID_ADDRESS","Invalid Ethereum address provided",t),t}}async connectMetaMask(){try{if(!this.provider&&(this.initProvider(),!this.provider))throw new Error("MetaMask is not available. Please install MetaMask extension.");const e=this.getAvailableEthereumProvider();if(!e)throw new Error("No compatible Ethereum provider found");let t=[];try{t=await e.request({method:"eth_requestAccounts"})}catch(n){if(console.warn("First account request failed, trying window.ethereum:",n),window.ethereum&&window.ethereum!==e)try{t=await window.ethereum.request({method:"eth_requestAccounts"})}catch(i){throw console.error("All account request methods failed",i),new Error("User denied account access")}else throw new Error("User denied account access")}!t||t.length;for(let n=1;n<=this.config.maxRetries;n++)try{const s=await(await this.provider.getSigner()).getAddress();if(!s)throw console.error("No address returned from signer"),new Error("No address returned from signer");return this.emit("connected",{address:s}),{success:!0,address:s}}catch(i){if(console.error(`Attempt ${n} failed:`,i),n===this.config.maxRetries)throw i;await new Promise(s=>setTimeout(s,this.config.retryDelay))}throw new Error("Failed to get signer after all attempts")}catch(e){return console.error("Failed to connect to MetaMask:",e),Le.handle(Y.WEBAUTHN,"METAMASK_CONNECTION_ERROR",e.message??"Unknown error while connecting to MetaMask",e),{success:!1,error:e.message}}}async generateCredentials(e){try{const t=this.validateAddress(e),n=this.getCachedSignature(t);if(n)return this.generateCredentialsFromSignature(t,n);let i;try{i=await this.requestSignatureWithTimeout(t,this.MESSAGE_TO_SIGN,this.config.timeout)}catch(s){throw console.warn(`Failed to get signature: ${s}. Using fallback method.`),s}return this.cacheSignature(t,i),this.generateCredentialsFromSignature(t,i)}catch(t){throw Le.handle(Y.WEBAUTHN,"CREDENTIALS_GENERATION_ERROR",t.message??"Error generating MetaMask credentials",t),t}}async generateCredentialsFromSignature(e,t){const n=ie(de(e)),i=`${e}_${t}`;return await Ir(n,i,{includeP256:!0})}generateFallbackCredentials(e){console.warn("Using fallback credentials generation for address:",e);const t=ie(de(e+"fallback"));return{username:e.toLowerCase(),password:t,message:this.MESSAGE_TO_SIGN,signature:t}}static isMetaMaskAvailable(){if(typeof window>"u")return!1;const e=[()=>window.ethereum,()=>window.web3?.currentProvider,()=>window.metamask,()=>window._ethereumProviders?.[0]];for(const t of e)try{const n=t();if(n&&typeof n.request=="function")return!0}catch{}return!1}requestSignatureWithTimeout(e,t,n=3e4){return new Promise((i,s)=>{const o=setTimeout(()=>{s(new Error("Signature request timed out"))},n),a=()=>{clearTimeout(o)},c=l=>{a(),s(l)};(async()=>{try{const l=await this.provider.getSigner(),f=await l.getAddress();if(f.toLowerCase()!==e.toLowerCase())throw new Error(`Signer address (${f}) does not match expected address (${e})`);const d=await l.signMessage(t);a(),i(d)}catch(l){console.error("Failed to request signature:",l),c(l)}})()})}isAvailable(){return En.isMetaMaskAvailable()}setCustomProvider(e,t){try{this.customProvider=new xA(e),this.customWallet=new hn(t,this.customProvider)}catch(n){throw new Error(`Error configuring provider: ${n.message??"Unknown error"}`)}}async getSigner(){try{if(this.customWallet)return this.customWallet;if(this.provider||this.initProvider(),!this.provider)throw new Error("Provider not initialized");return await this.provider.getSigner()}catch(e){throw new Error(`Unable to get Ethereum signer: ${e.message||"Unknown error"}`)}}async getProvider(){return this.customProvider?this.customProvider:(this.provider||this.initProvider(),this.provider)}async generatePassword(e){if(!e)throw new Error("Invalid signature");return ie(de(e)).slice(2,66)}async verifySignature(e,t){if(!e||!t)throw new Error("Invalid message or signature");try{return Y1(e,t)}catch{throw new Error("Invalid message or signature")}}async getEthereumSigner(){if(!En.isMetaMaskAvailable())throw new Error("MetaMask not found. Please install MetaMask to continue.");try{const e=window.ethereum;return await e.request({method:"eth_requestAccounts"}),new fr(e).getSigner()}catch(e){throw new Error(`Error accessing MetaMask: ${e.message??"Unknown error"}`)}}}typeof window<"u"?window.Web3Connector=En:typeof global<"u"&&(global.Web3Connector=En);class k3{web3Connector;credentials=new Map;MESSAGE_TO_SIGN="I Love Shogun!";constructor(e){this.web3Connector=e||new En}async createSigningCredential(e){try{const t=te(e.toLowerCase()),n=await this.requestSignature(t),i=`${t.toLowerCase()}`,s=ie(de(`${t.toLowerCase()}:shogun-web3`)),o={address:t,signature:n,message:this.MESSAGE_TO_SIGN,username:i,password:s};return this.credentials.set(t.toLowerCase(),o),o}catch(t){throw console.error("Error creating Web3 signing credential:",t),new Error(`Failed to create Web3 signing credential: ${t.message}`)}}async requestSignature(e){try{const t=await this.web3Connector.getSigner(),n=await t.getAddress();if(n.toLowerCase()!==e.toLowerCase())throw new Error(`Signer address (${n}) does not match expected address (${e})`);return await t.signMessage(this.MESSAGE_TO_SIGN)}catch(t){throw console.error("Failed to request signature:",t),t}}createAuthenticator(e){if(!this.credentials.get(e.toLowerCase()))throw new Error(`Credential for address ${e} not found`);return async n=>{try{const i=await this.web3Connector.getSigner();if((await i.getAddress()).toLowerCase()!==e.toLowerCase())throw new Error("Address mismatch during authentication");const o=JSON.stringify(n);return await i.signMessage(o)}catch(i){throw console.error("Web3 authentication error:",i),i}}}async createDerivedKeyPair(e,t){return this.createDerivedKeyPairFromAddress(e,t)}async authenticateWithExistingPair(e,t){try{console.log("🔧 Web3Signer - authenticating with deterministic pair for address:",e);const n=await this.createDerivedKeyPairFromAddress(e);return console.log("🔧 Web3Signer - deterministic pair created, attempting auth with GunDB"),new Promise(i=>{t.user().auth(n,s=>{if(s.err)console.log("🔧 Web3Signer - auth failed:",s.err),i({success:!1,error:s.err});else{const o=s.pub;console.log("🔧 Web3Signer - auth successful, userPub:",o?o.slice(0,8)+"...":"null"),i({success:!0,userPub:o})}})})}catch(n){return console.error("Error authenticating with deterministic pair:",n),{success:!1,error:n.message}}}async createDerivedKeyPairFromAddress(e,t){try{const n=te(e.toLowerCase()),i=ie(de(`${n.toLowerCase()}:shogun-web3`));console.log("🔧 Web3Signer - generating deterministic pair for address:",n);const s=await Ir(i,t,{includeP256:!0});return{pub:s.pub,priv:s.priv,epub:s.epub,epriv:s.epriv}}catch(n){throw console.error("Error creating derived key pair from address:",n),n}}async createGunUser(e,t){try{console.log("🔧 Web3Signer - creating Gun user with deterministic pair for address:",e);const n=await this.createDerivedKeyPairFromAddress(e);return new Promise(i=>{t.user().create(n,s=>{s.err?(console.log("🔧 Web3Signer - user creation failed, trying auth:",s.err),t.user().auth(n,o=>{if(o.err)console.log("🔧 Web3Signer - auth also failed:",o.err),i({success:!1,error:o.err});else{const a=o.pub;console.log("🔧 Web3Signer - auth successful, userPub:",a?a.slice(0,8)+"...":"null"),i({success:!0,userPub:a})}})):(console.log("🔧 Web3Signer - user created successfully, now logging in"),t.user().auth(n,o=>{if(o.err)console.log("🔧 Web3Signer - login after creation failed:",o.err),i({success:!1,error:o.err});else{const a=o.pub;console.log("🔧 Web3Signer - login successful, userPub:",a?a.slice(0,8)+"...":"null"),i({success:!0,userPub:a})}}))})})}catch(n){return console.error("Error creating Gun user:",n),{success:!1,error:n.message}}}async signWithDerivedKeys(e,t,n){try{await this.createAuthenticator(t)(e);const s=await this.createDerivedKeyPair(t,n),o=JSON.stringify(e),a=ie(de(o)),u=await new hn(s.priv).signMessage(o);return"SEA"+JSON.stringify({m:o,s:u})}catch(i){throw console.error("Error signing with derived keys:",i),i}}async getGunUserPub(e){try{return(await this.createDerivedKeyPairFromAddress(e)).pub}catch(t){console.error("Error getting Gun user pub:",t);return}}getPassword(e){try{const t=te(e.toLowerCase());return ie(de(`${t.toLowerCase()}:shogun-web3`))}catch(t){console.error("Error getting password:",t);return}}async verifyConsistency(e,t){try{const n=await this.createDerivedKeyPairFromAddress(e);return{consistent:t?n.pub===t:!0,actualUserPub:n.pub,expectedUserPub:t}}catch(n){return console.error("Error verifying consistency:",n),{consistent:!1}}}getCredential(e){return this.credentials.get(e.toLowerCase())}listCredentials(){return Array.from(this.credentials.values())}removeCredential(e){return this.credentials.delete(e.toLowerCase())}}class T3 extends Co{name="web3";version="1.0.0";description="Provides Ethereum wallet connection and authentication for ShogunCore";Web3=null;signer=null;initialize(e){super.initialize(e),this.Web3=new En,this.signer=new k3(this.Web3)}destroy(){this.Web3&&this.Web3.cleanup(),this.Web3=null,this.signer=null,super.destroy()}assertMetaMask(){if(this.assertInitialized(),!this.Web3)throw new Error("Web3 module not initialized");return this.Web3}assertSigner(){if(this.assertInitialized(),!this.signer)throw new Error("Web3 signer not initialized");return this.signer}isAvailable(){return this.assertMetaMask().isAvailable()}async connectMetaMask(){return this.assertMetaMask().connectMetaMask()}async generateCredentials(e){return this.assertMetaMask().generateCredentials(e)}cleanup(){this.assertMetaMask().cleanup()}setCustomProvider(e,t){this.assertMetaMask().setCustomProvider(e,t)}async getSigner(){return this.assertMetaMask().getSigner()}async getProvider(){return this.assertMetaMask().getProvider()}async generatePassword(e){return this.assertMetaMask().generatePassword(e)}async verifySignature(e,t){return this.assertMetaMask().verifySignature(e,t)}async createSigningCredential(e){try{const t=this.assertMetaMask();return typeof t.createSigningCredential=="function"?await t.createSigningCredential(e):await this.assertSigner().createSigningCredential(e)}catch(t){throw console.error(`Error creating Web3 signing credential: ${t.message}`),t}}createAuthenticator(e){try{const t=this.assertMetaMask();return typeof t.createAuthenticator=="function"?t.createAuthenticator(e):this.assertSigner().createAuthenticator(e)}catch(t){throw console.error(`Error creating Web3 authenticator: ${t.message}`),t}}async createDerivedKeyPair(e,t){try{const n=this.assertMetaMask();return typeof n.createDerivedKeyPair=="function"?await n.createDerivedKeyPair(e,t):await this.assertSigner().createDerivedKeyPair(e,t)}catch(n){throw console.error(`Error creating derived key pair: ${n.message}`),n}}async signWithDerivedKeys(e,t,n){try{const i=this.assertMetaMask();return typeof i.signWithDerivedKeys=="function"?await i.signWithDerivedKeys(e,t,n):await this.assertSigner().signWithDerivedKeys(e,t,n)}catch(i){throw console.error(`Error signing with derived keys: ${i.message}`),i}}getSigningCredential(e){const t=this.assertMetaMask();return typeof t.getSigningCredential=="function"?t.getSigningCredential(e):this.assertSigner().getCredential(e)}listSigningCredentials(){const e=this.assertMetaMask();return typeof e.listSigningCredentials=="function"?e.listSigningCredentials():this.assertSigner().listCredentials()}removeSigningCredential(e){const t=this.assertMetaMask();return typeof t.removeSigningCredential=="function"?t.removeSigningCredential(e):this.assertSigner().removeCredential(e)}async createGunUserFromSigningCredential(e){try{console.log("🔧 createGunUserFromSigningCredential called with address:",e);const t=this.assertMetaMask();if(typeof t.createGunUserFromSigningCredential=="function"){console.log("🔧 Using connector's createGunUserFromSigningCredential");const o=await t.createGunUserFromSigningCredential(e);return console.log("🔧 Connector result:",o),o}console.log("🔧 Using fallback createGunUser");const n=this.assertInitialized();console.log("🔧 Attempting authentication with deterministic pair");const i=await this.assertSigner().authenticateWithExistingPair(e,n.gun);if(i.success)return console.log("🔧 Authentication successful with existing user"),i;console.log("🔧 Authentication failed, creating new user");const s=await this.assertSigner().createGunUser(e,n.gun);return console.log("🔧 User creation result:",s),s}catch(t){throw console.error(`Error creating Gun user from Web3 signing credential: ${t.message}`),t}}async getGunUserPubFromSigningCredential(e){const t=this.assertMetaMask();return typeof t.getGunUserPubFromSigningCredential=="function"?await t.getGunUserPubFromSigningCredential(e):await this.assertSigner().getGunUserPub(e)}getPassword(e){const t=this.assertMetaMask();return typeof t.getPassword=="function"?t.getPassword(e):this.assertSigner().getPassword(e)}async verifyConsistency(e,t){try{const n=this.assertMetaMask();return typeof n.verifyConsistency=="function"?await n.verifyConsistency(e,t):await this.assertSigner().verifyConsistency(e,t)}catch(n){return console.error(`Error verifying Web3 consistency: ${n.message}`),{consistent:!1}}}async setupConsistentOneshotSigning(e){try{const t=this.assertMetaMask();if(typeof t.setupConsistentOneshotSigning=="function")return await t.setupConsistentOneshotSigning(e);const n=await this.createSigningCredential(e),i=this.createAuthenticator(e),s=await this.createGunUserFromSigningCredential(e);return{credential:n,authenticator:i,gunUser:s,username:e,password:"web3-generated-password"}}catch(t){throw console.error(`Error setting up consistent Web3 oneshot signing: ${t.message}`),t}}async login(e){try{const t=this.assertInitialized();if(!e)throw Ae(Y.VALIDATION,"ADDRESS_REQUIRED","Ethereum address required for Web3 login");if(!this.isAvailable())throw Ae(Y.ENVIRONMENT,"WEB3_UNAVAILABLE","Web3 is not available in the browser");if(console.log("🔧 Web3 login - starting login for address:",e),this.getSigningCredential(e)){console.log("🔧 Web3 login - found existing credential, using it");const o=await this.createGunUserFromSigningCredential(e);if(console.log("🔧 Web3 login - existing credential result:",o),o.success&&o.userPub){t.setAuthMethod("web3");const a={success:!0,user:{userPub:o.userPub,username:e},userPub:o.userPub};return console.log("🔧 Web3 login - returning result:",{success:a.success,userPub:a.userPub?a.userPub.slice(0,8)+"...":"null",username:a.user?.username}),t.emit("auth:login",{userPub:o.userPub||"",username:e,method:"web3"}),a}}console.log("🔧 Web3 login - no existing credential, creating new one");const{gunUser:i}=await this.setupConsistentOneshotSigning(e);if(console.log("🔧 Web3 login - setupConsistentOneshotSigning result:",{gunUser:i,address:e}),!i.success)throw Ae(Y.AUTHENTICATION,"WEB3_LOGIN_FAILED",i.error||"Failed to log in with Web3 credentials");console.log("🔧 Web3 login - gunUser success, userPub:",i.userPub?i.userPub.slice(0,8)+"...":"null"),t.setAuthMethod("web3");const s={success:!0,user:{userPub:i.userPub,username:e},userPub:i.userPub};return console.log("🔧 Web3 login - returning result:",{success:s.success,userPub:s.userPub?s.userPub.slice(0,8)+"...":"null",username:s.user?.username}),t.emit("auth:login",{userPub:i.userPub||"",username:e,method:"web3"}),s}catch(t){const n=t?.type||Y.AUTHENTICATION,i=t?.code||"WEB3_LOGIN_ERROR",s=t?.message||"Unknown error during Web3 login";return Le.handle(n,i,s,t),{success:!1,error:s}}}async signUp(e){try{const t=this.assertInitialized();if(!e)throw Ae(Y.VALIDATION,"ADDRESS_REQUIRED","Ethereum address required for Web3 registration");if(!this.isAvailable())throw Ae(Y.ENVIRONMENT,"WEB3_UNAVAILABLE","Web3 is not available in the browser");const{gunUser:n}=await this.setupConsistentOneshotSigning(e);if(!n.success)throw Ae(Y.AUTHENTICATION,"WEB3_SIGNUP_FAILED",n.error||"Failed to sign up with Web3 credentials");return t.setAuthMethod("web3"),{success:!0,user:{userPub:n.userPub,username:e},userPub:n.userPub}}catch(t){const n=t?.type||Y.AUTHENTICATION,i=t?.code||"WEB3_SIGNUP_ERROR",s=t?.message||"Unknown error during Web3 registration";return Le.handle(n,i,s,t),{success:!1,error:s}}}}const za=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gu=r=>r instanceof Uint8Array,Va=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Kt=(r,e)=>r<<32-e|r>>>e,P3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!P3)throw new Error("Non little-endian hardware is not supported");const N3=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Xe(r){if(!Gu(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=N3[r[t]];return e}function Sn(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let n=0;n<t.length;n++){const i=n*2,s=r.slice(i,i+2),o=Number.parseInt(s,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function O3(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Zi(r){if(typeof r=="string"&&(r=O3(r)),!Gu(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function Qo(...r){const e=new Uint8Array(r.reduce((n,i)=>n+i.length,0));let t=0;return r.forEach(n=>{if(!Gu(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}class jp{clone(){return this._cloneInto()}}function zp(r){const e=n=>r().update(Zi(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Vp(r=32){if(za&&typeof za.getRandomValues=="function")return za.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}function jc(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function U3(r){if(typeof r!="boolean")throw new Error(`Expected boolean, not ${r}`)}function Wp(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function R3(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");jc(r.outputLen),jc(r.blockLen)}function B3(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function _3(r,e){Wp(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const qt={number:jc,bool:U3,bytes:Wp,hash:R3,exists:B3,output:_3};function L3(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,u=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+u,a,n)}class D3 extends jp{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Va(this.buffer)}update(e){qt.exists(this);const{view:t,buffer:n,blockLen:i}=this;e=Zi(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Va(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){qt.exists(this),qt.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)t[f]=0;L3(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Va(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,l[f],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(n),e}}const M3=(r,e,t)=>r&e^~r&t,$3=(r,e,t)=>r&e^r&t^e&t,F3=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Hr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Kr=new Uint32Array(64);class Jp extends D3{constructor(){super(64,32,8,!1),this.A=Hr[0]|0,this.B=Hr[1]|0,this.C=Hr[2]|0,this.D=Hr[3]|0,this.E=Hr[4]|0,this.F=Hr[5]|0,this.G=Hr[6]|0,this.H=Hr[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)Kr[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const d=Kr[f-15],p=Kr[f-2],h=Kt(d,7)^Kt(d,18)^d>>>3,x=Kt(p,17)^Kt(p,19)^p>>>10;Kr[f]=x+Kr[f-7]+h+Kr[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let f=0;f<64;f++){const d=Kt(a,6)^Kt(a,11)^Kt(a,25),p=l+d+M3(a,c,u)+F3[f]+Kr[f]|0,x=(Kt(n,2)^Kt(n,13)^Kt(n,22))+$3(n,i,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=i,i=n,n=p+x|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,i,s,o,a,c,u,l)}roundClean(){Kr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class G3 extends Jp{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const bi=zp(()=>new Jp);zp(()=>new G3);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function yi(r){if(!Number.isSafeInteger(r))throw new Error(`Wrong integer: ${r}`)}function kr(...r){const e=(i,s)=>o=>i(s(o)),t=Array.from(r).reverse().reduce((i,s)=>i?e(i,s.encode):s.encode,void 0),n=r.reduce((i,s)=>i?e(i,s.decode):s.decode,void 0);return{encode:t,decode:n}}function Tr(r){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(t=>{if(yi(t),t<0||t>=r.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${r.length})`);return r[t]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(t=>{if(typeof t!="string")throw new Error(`alphabet.decode: not string element=${t}`);const n=r.indexOf(t);if(n===-1)throw new Error(`Unknown letter: "${t}". Allowed: ${r}`);return n})}}}function Pr(r=""){if(typeof r!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let t of e)if(typeof t!="string")throw new Error(`join.encode: non-string input=${t}`);return e.join(r)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(r)}}}function qo(r,e="="){if(yi(r),typeof e!="string")throw new Error("padding chr should be string");return{encode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`padding.encode: non-string input=${n}`);for(;t.length*r%8;)t.push(e);return t},decode(t){if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("padding.encode input should be array of strings");for(let i of t)if(typeof i!="string")throw new Error(`padding.decode: non-string input=${i}`);let n=t.length;if(n*r%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;n>0&&t[n-1]===e;n--)if(!((n-1)*r%8))throw new Error("Invalid padding: string has too much padding");return t.slice(0,n)}}}function Qp(r){if(typeof r!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>r(e)}}function wd(r,e,t){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(t<2)throw new Error(`convertRadix: wrong to=${t}, base cannot be less than 2`);if(!Array.isArray(r))throw new Error("convertRadix: data should be array");if(!r.length)return[];let n=0;const i=[],s=Array.from(r);for(s.forEach(o=>{if(yi(o),o<0||o>=e)throw new Error(`Wrong integer: ${o}`)});;){let o=0,a=!0;for(let c=n;c<s.length;c++){const u=s[c],l=e*o+u;if(!Number.isSafeInteger(l)||e*o/e!==o||l-u!==e*o)throw new Error("convertRadix: carry overflow");if(o=l%t,s[c]=Math.floor(l/t),!Number.isSafeInteger(s[c])||s[c]*t+o!==l)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:n=c;else continue}if(i.push(o),a)break}for(let o=0;o<r.length-1&&r[o]===0;o++)i.push(0);return i.reverse()}const qp=(r,e)=>e?qp(e,r%e):r,mo=(r,e)=>r+(e-qp(r,e));function zc(r,e,t,n){if(!Array.isArray(r))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(mo(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${mo(e,t)}`);let i=0,s=0;const o=2**t-1,a=[];for(const c of r){if(yi(c),c>=2**e)throw new Error(`convertRadix2: invalid data word=${c} from=${e}`);if(i=i<<e|c,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=t;s-=t)a.push((i>>s-t&o)>>>0);i&=2**s-1}if(i=i<<t-s&o,!n&&s>=e)throw new Error("Excess padding");if(!n&&i)throw new Error(`Non-zero padding: ${i}`);return n&&s>0&&a.push(i>>>0),a}function H3(r){return yi(r),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return wd(Array.from(e),2**8,r)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(wd(e,r,2**8))}}}function en(r,e=!1){if(yi(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(mo(8,r)>32||mo(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return zc(Array.from(t),8,r,!e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(zc(t,r,8,e))}}}function md(r){if(typeof r!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return r.apply(null,e)}catch{}}}const K3=kr(en(4),Tr("0123456789ABCDEF"),Pr("")),j3=kr(en(5),Tr("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),qo(5),Pr(""));kr(en(5),Tr("0123456789ABCDEFGHIJKLMNOPQRSTUV"),qo(5),Pr(""));kr(en(5),Tr("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Pr(""),Qp(r=>r.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Sr=kr(en(6),Tr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),qo(6),Pr("")),z3=kr(en(6),Tr("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),qo(6),Pr("")),Hu=r=>kr(H3(58),Tr(r),Pr("")),Vc=Hu("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Hu("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Hu("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Ad=[0,2,3,5,6,7,9,10,11],V3={encode(r){let e="";for(let t=0;t<r.length;t+=8){const n=r.subarray(t,t+8);e+=Vc.encode(n).padStart(Ad[n.length],"1")}return e},decode(r){let e=[];for(let t=0;t<r.length;t+=11){const n=r.slice(t,t+11),i=Ad.indexOf(n.length),s=Vc.decode(n);for(let o=0;o<s.length-i;o++)if(s[o]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(e)}},Wc=kr(Tr("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Pr("")),vd=[996825010,642813549,513874426,1027748829,705979059];function Ci(r){const e=r>>25;let t=(r&33554431)<<5;for(let n=0;n<vd.length;n++)(e>>n&1)===1&&(t^=vd[n]);return t}function Ed(r,e,t=1){const n=r.length;let i=1;for(let s=0;s<n;s++){const o=r.charCodeAt(s);if(o<33||o>126)throw new Error(`Invalid prefix (${r})`);i=Ci(i)^o>>5}i=Ci(i);for(let s=0;s<n;s++)i=Ci(i)^r.charCodeAt(s)&31;for(let s of e)i=Ci(i)^s;for(let s=0;s<6;s++)i=Ci(i);return i^=t,Wc.encode(zc([i%2**30],30,5,!1))}function Zp(r){const e=r==="bech32"?1:734539939,t=en(5),n=t.decode,i=t.encode,s=md(n);function o(l,f,d=90){if(typeof l!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof l}`);if(!Array.isArray(f)||f.length&&typeof f[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof f}`);const p=l.length+7+f.length;if(d!==!1&&p>d)throw new TypeError(`Length ${p} exceeds limit ${d}`);return l=l.toLowerCase(),`${l}1${Wc.encode(f)}${Ed(l,f,e)}`}function a(l,f=90){if(typeof l!="string")throw new Error(`bech32.decode input should be string, not ${typeof l}`);if(l.length<8||f!==!1&&l.length>f)throw new TypeError(`Wrong string length: ${l.length} (${l}). Expected (8..${f})`);const d=l.toLowerCase();if(l!==d&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");l=d;const p=l.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const h=l.slice(0,p),x=l.slice(p+1);if(x.length<6)throw new Error("Data must be at least 6 characters long");const b=Wc.decode(x).slice(0,-6),w=Ed(h,b,e);if(!x.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:h,words:b}}const c=md(a);function u(l){const{prefix:f,words:d}=a(l,!1);return{prefix:f,words:d,bytes:n(d)}}return{encode:o,decode:a,decodeToBytes:u,decodeUnsafe:c,fromWords:n,fromWordsUnsafe:s,toWords:i}}const li=Zp("bech32");Zp("bech32m");const W3={encode:r=>new TextDecoder().decode(r),decode:r=>new TextEncoder().encode(r)},J3=kr(en(4),Tr("0123456789abcdef"),Pr(""),Qp(r=>{if(typeof r!="string"||r.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof r} with length ${r.length}`);return r.toLowerCase()})),Q3={utf8:W3,hex:J3,base16:K3,base32:j3,base64:Sr,base64url:z3,base58:Vc,base58xmr:V3};`${Object.keys(Q3).join(", ")}`;function Wa(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`positive integer expected, not ${r}`)}function Sd(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function q3(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function gr(r,...e){if(!q3(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const et=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Z3=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Z3)throw new Error("Non little-endian hardware is not supported");function Y3(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function X3(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const eE=(r,e)=>(Object.assign(e,r),e),Qr=16,tE=283;function Ku(r){return r<<1^tE&-(r>>7)}function jn(r,e){let t=0;for(;e>0;e>>=1)t^=r&-(e&1),r=Ku(r);return t}const Jc=(()=>{let r=new Uint8Array(256);for(let t=0,n=1;t<256;t++,n^=Ku(n))r[t]=n;const e=new Uint8Array(256);e[0]=99;for(let t=0;t<255;t++){let n=r[255-t];n|=n<<8,e[r[t]]=(n^n>>4^n>>5^n>>6^n>>7^99)&255}return e})(),rE=Jc.map((r,e)=>Jc.indexOf(e)),nE=r=>r<<24|r>>>8,Ja=r=>r<<8|r>>>24;function Yp(r,e){if(r.length!==256)throw new Error("Wrong sbox length");const t=new Uint32Array(256).map((u,l)=>e(r[l])),n=t.map(Ja),i=n.map(Ja),s=i.map(Ja),o=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let l=0;l<256;l++){const f=u*256+l;o[f]=t[u]^n[l],a[f]=i[u]^s[l],c[f]=r[u]<<8|r[l]}return{sbox:r,sbox2:c,T0:t,T1:n,T2:i,T3:s,T01:o,T23:a}}const ju=Yp(Jc,r=>jn(r,3)<<24|r<<16|r<<8|jn(r,2)),Xp=Yp(rE,r=>jn(r,11)<<24|jn(r,13)<<16|jn(r,9)<<8|jn(r,14)),iE=(()=>{const r=new Uint8Array(16);for(let e=0,t=1;e<16;e++,t=Ku(t))r[e]=t;return r})();function ex(r){gr(r);const e=r.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:t}=ju,n=et(r),i=n.length,s=a=>Zt(t,a,a,a,a),o=new Uint32Array(e+28);o.set(n);for(let a=i;a<o.length;a++){let c=o[a-1];a%i===0?c=s(nE(c))^iE[a/i-1]:i>6&&a%i===4&&(c=s(c)),o[a]=o[a-i]^c}return o}function sE(r){const e=ex(r),t=e.slice(),n=e.length,{sbox2:i}=ju,{T0:s,T1:o,T2:a,T3:c}=Xp;for(let u=0;u<n;u+=4)for(let l=0;l<4;l++)t[u+l]=e[n-u-4+l];e.fill(0);for(let u=4;u<n-4;u++){const l=t[u],f=Zt(i,l,l,l,l);t[u]=s[f&255]^o[f>>>8&255]^a[f>>>16&255]^c[f>>>24]}return t}function zr(r,e,t,n,i,s){return r[t<<8&65280|n>>>8&255]^e[i>>>8&65280|s>>>24&255]}function Zt(r,e,t,n,i){return r[e&255|t&65280]|r[n>>>16&255|i>>>16&65280]<<16}function Cd(r,e,t,n,i){const{sbox2:s,T01:o,T23:a}=ju;let c=0;e^=r[c++],t^=r[c++],n^=r[c++],i^=r[c++];const u=r.length/4-2;for(let h=0;h<u;h++){const x=r[c++]^zr(o,a,e,t,n,i),b=r[c++]^zr(o,a,t,n,i,e),w=r[c++]^zr(o,a,n,i,e,t),m=r[c++]^zr(o,a,i,e,t,n);e=x,t=b,n=w,i=m}const l=r[c++]^Zt(s,e,t,n,i),f=r[c++]^Zt(s,t,n,i,e),d=r[c++]^Zt(s,n,i,e,t),p=r[c++]^Zt(s,i,e,t,n);return{s0:l,s1:f,s2:d,s3:p}}function oE(r,e,t,n,i){const{sbox2:s,T01:o,T23:a}=Xp;let c=0;e^=r[c++],t^=r[c++],n^=r[c++],i^=r[c++];const u=r.length/4-2;for(let h=0;h<u;h++){const x=r[c++]^zr(o,a,e,i,n,t),b=r[c++]^zr(o,a,t,e,i,n),w=r[c++]^zr(o,a,n,t,e,i),m=r[c++]^zr(o,a,i,n,t,e);e=x,t=b,n=w,i=m}const l=r[c++]^Zt(s,e,i,n,t),f=r[c++]^Zt(s,t,e,i,n),d=r[c++]^Zt(s,n,t,e,i),p=r[c++]^Zt(s,i,n,t,e);return{s0:l,s1:f,s2:d,s3:p}}function tx(r,e){if(!e)return new Uint8Array(r);if(gr(e),e.length<r)throw new Error(`aes: wrong destination length, expected at least ${r}, got: ${e.length}`);return e}function aE(r){if(gr(r),r.length%Qr!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Qr}`)}function cE(r,e,t){let n=r.length;const i=n%Qr;if(!e&&i!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=et(r);if(e){let c=Qr-i;c||(c=Qr),n=n+c}const o=tx(n,t),a=et(o);return{b:s,o:a,out:o}}function uE(r,e){if(!e)return r;const t=r.length;if(!t)throw new Error("aes/pcks5: empty ciphertext not allowed");const n=r[t-1];if(n<=0||n>16)throw new Error(`aes/pcks5: wrong padding byte: ${n}`);const i=r.subarray(0,-n);for(let s=0;s<n;s++)if(r[t-s-1]!==n)throw new Error("aes/pcks5: wrong padding");return i}function fE(r){const e=new Uint8Array(16),t=et(e);e.set(r);const n=Qr-r.length;for(let i=Qr-n;i<Qr;i++)e[i]=n;return t}const rx=eE({blockSize:16,nonceLength:16},function(e,t,n={}){gr(e),gr(t,16);const i=!n.disablePadding;return{encrypt:(s,o)=>{const a=ex(e),{b:c,o:u,out:l}=cE(s,i,o),f=et(t);let d=f[0],p=f[1],h=f[2],x=f[3],b=0;for(;b+4<=c.length;)d^=c[b+0],p^=c[b+1],h^=c[b+2],x^=c[b+3],{s0:d,s1:p,s2:h,s3:x}=Cd(a,d,p,h,x),u[b++]=d,u[b++]=p,u[b++]=h,u[b++]=x;if(i){const w=fE(s.subarray(b*4));d^=w[0],p^=w[1],h^=w[2],x^=w[3],{s0:d,s1:p,s2:h,s3:x}=Cd(a,d,p,h,x),u[b++]=d,u[b++]=p,u[b++]=h,u[b++]=x}return a.fill(0),l},decrypt:(s,o)=>{aE(s);const a=sE(e),c=et(t),u=tx(s.length,o),l=et(s),f=et(u);let d=c[0],p=c[1],h=c[2],x=c[3];for(let b=0;b+4<=l.length;){const w=d,m=p,g=h,A=x;d=l[b+0],p=l[b+1],h=l[b+2],x=l[b+3];const{s0:v,s1:T,s2:P,s3:I}=oE(a,d,p,h,x);f[b++]=v^w,f[b++]=T^m,f[b++]=P^g,f[b++]=I^A}return a.fill(0),uE(u,i)}}}),nx=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),lE=nx("expand 16-byte k"),dE=nx("expand 32-byte k"),hE=et(lE),ix=et(dE);ix.slice();function le(r,e){return r<<e|r>>>32-e}function Qc(r){return r.byteOffset%4===0}const Ms=64,gE=16,sx=2**32-1,Id=new Uint32Array;function pE(r,e,t,n,i,s,o,a){const c=i.length,u=new Uint8Array(Ms),l=et(u),f=Qc(i)&&Qc(s),d=f?et(i):Id,p=f?et(s):Id;for(let h=0;h<c;o++){if(r(e,t,n,l,o,a),o>=sx)throw new Error("arx: counter overflow");const x=Math.min(Ms,c-h);if(f&&x===Ms){const b=h/4;if(h%4!==0)throw new Error("arx: invalid block position");for(let w=0,m;w<gE;w++)m=b+w,p[m]=d[m]^l[w];h+=Ms;continue}for(let b=0,w;b<x;b++)w=h+b,s[w]=i[w]^u[b];h+=x}}function xE(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=Y3({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Wa(i),Wa(o),Sd(s),Sd(t),(a,c,u,l,f=0)=>{gr(a),gr(c),gr(u);const d=u.length;if(l||(l=new Uint8Array(d)),gr(l),Wa(f),f<0||f>=sx)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const p=[];let h=a.length,x,b;if(h===32)x=a.slice(),p.push(x),b=ix;else if(h===16&&t)x=new Uint8Array(32),x.set(a),x.set(a,16),b=hE,p.push(x);else throw new Error(`arx: invalid 32-byte key, got length=${h}`);Qc(c)||(c=c.slice(),p.push(c));const w=et(x);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(b,w,et(c.subarray(0,16)),w),c=c.subarray(16)}const m=16-i;if(m!==c.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){const A=new Uint8Array(12);A.set(c,s?0:12-c.length),c=A,p.push(c)}const g=et(c);for(pE(r,b,w,g,u,l,f,o);p.length>0;)p.pop().fill(0);return l}}function bE(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],u=r[3],l=e[0],f=e[1],d=e[2],p=e[3],h=e[4],x=e[5],b=e[6],w=e[7],m=i,g=t[0],A=t[1],v=t[2],T=o,P=a,I=c,S=u,N=l,O=f,E=d,y=p,k=h,C=x,U=b,R=w,B=m,L=g,D=A,M=v;for(let j=0;j<s;j+=2)T=T+N|0,B=le(B^T,16),k=k+B|0,N=le(N^k,12),T=T+N|0,B=le(B^T,8),k=k+B|0,N=le(N^k,7),P=P+O|0,L=le(L^P,16),C=C+L|0,O=le(O^C,12),P=P+O|0,L=le(L^P,8),C=C+L|0,O=le(O^C,7),I=I+E|0,D=le(D^I,16),U=U+D|0,E=le(E^U,12),I=I+E|0,D=le(D^I,8),U=U+D|0,E=le(E^U,7),S=S+y|0,M=le(M^S,16),R=R+M|0,y=le(y^R,12),S=S+y|0,M=le(M^S,8),R=R+M|0,y=le(y^R,7),T=T+O|0,M=le(M^T,16),U=U+M|0,O=le(O^U,12),T=T+O|0,M=le(M^T,8),U=U+M|0,O=le(O^U,7),P=P+E|0,B=le(B^P,16),R=R+B|0,E=le(E^R,12),P=P+E|0,B=le(B^P,8),R=R+B|0,E=le(E^R,7),I=I+y|0,L=le(L^I,16),k=k+L|0,y=le(y^k,12),I=I+y|0,L=le(L^I,8),k=k+L|0,y=le(y^k,7),S=S+N|0,D=le(D^S,16),C=C+D|0,N=le(N^C,12),S=S+N|0,D=le(D^S,8),C=C+D|0,N=le(N^C,7);let $=0;n[$++]=o+T|0,n[$++]=a+P|0,n[$++]=c+I|0,n[$++]=u+S|0,n[$++]=l+N|0,n[$++]=f+O|0,n[$++]=d+E|0,n[$++]=p+y|0,n[$++]=h+k|0,n[$++]=x+C|0,n[$++]=b+U|0,n[$++]=w+R|0,n[$++]=m+B|0,n[$++]=g+L|0,n[$++]=A+D|0,n[$++]=v+M|0}const ox=xE(bE,{counterRight:!1,counterLength:4,allowShortKeys:!1});class ax extends jp{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,qt.hash(e);const n=Zi(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return qt.exists(this),this.iHash.update(e),this}digestInto(e){qt.exists(this),qt.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Zo=(r,e,t)=>new ax(r,e).update(t).digest();Zo.create=(r,e)=>new ax(r,e);function yE(r,e,t){return qt.hash(r),Zo(r,Zi(t),Zi(e))}const Qa=new Uint8Array([0]),kd=new Uint8Array;function wE(r,e,t,n=32){if(qt.hash(r),qt.number(n),n>255*r.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/r.outputLen);t===void 0&&(t=kd);const s=new Uint8Array(i*r.outputLen),o=Zo.create(r,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let u=0;u<i;u++)Qa[0]=u+1,a.update(u===0?kd:c).update(t).update(Qa).digestInto(c),s.set(c,r.outputLen*u),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),Qa.fill(0),s.slice(0,n)}var mE=Object.defineProperty,ve=(r,e)=>{for(var t in e)mE(r,t,{get:e[t],enumerable:!0})},$n=Symbol("verified"),AE=r=>r instanceof Object;function zu(r){if(!AE(r)||typeof r.kind!="number"||typeof r.content!="string"||typeof r.created_at!="number"||typeof r.pubkey!="string"||!r.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(r.tags))return!1;for(let e=0;e<r.tags.length;e++){let t=r.tags[e];if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(typeof t[n]!="string")return!1}return!0}var cx={};ve(cx,{Queue:()=>CE,QueueNode:()=>ux,binarySearch:()=>Vu,bytesToHex:()=>Xe,hexToBytes:()=>Sn,insertEventIntoAscendingList:()=>SE,insertEventIntoDescendingList:()=>EE,normalizeURL:()=>vE,utf8Decoder:()=>pr,utf8Encoder:()=>_t});var pr=new TextDecoder("utf-8"),_t=new TextEncoder;function vE(r){try{r.indexOf("://")===-1&&(r="wss://"+r);let e=new URL(r);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}catch{throw new Error(`Invalid URL: ${r}`)}}function EE(r,e){const[t,n]=Vu(r,i=>e.id===i.id?0:e.created_at===i.created_at?-1:i.created_at-e.created_at);return n||r.splice(t,0,e),r}function SE(r,e){const[t,n]=Vu(r,i=>e.id===i.id?0:e.created_at===i.created_at?-1:e.created_at-i.created_at);return n||r.splice(t,0,e),r}function Vu(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=Math.floor((t+n)/2),s=e(r[i]);if(s===0)return[i,!0];s<0?n=i-1:t=i+1}return[t,!1]}var ux=class{value;next=null;prev=null;constructor(r){this.value=r}},CE=class{first;last;constructor(){this.first=null,this.last=null}enqueue(r){const e=new ux(r);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const r=this.first;return this.first=r.next,this.first&&(this.first.prev=null),r.value}},IE=class{generateSecretKey(){return vi.utils.randomPrivateKey()}getPublicKey(r){return Xe(vi.getPublicKey(r))}finalizeEvent(r,e){const t=r;return t.pubkey=Xe(vi.getPublicKey(e)),t.id=Vr(t),t.sig=Xe(vi.sign(Vr(t),e)),t[$n]=!0,t}verifyEvent(r){if(typeof r[$n]=="boolean")return r[$n];const e=Vr(r);if(e!==r.id)return r[$n]=!1,!1;try{const t=vi.verify(r.sig,e,r.pubkey);return r[$n]=t,t}catch{return r[$n]=!1,!1}}};function kE(r){if(!zu(r))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])}function Vr(r){let e=bi(_t.encode(kE(r)));return Xe(e)}var Yo=new IE,TE=Yo.generateSecretKey,Wu=Yo.getPublicKey,Dt=Yo.finalizeEvent,Yi=Yo.verifyEvent,PE={};ve(PE,{Application:()=>T8,BadgeAward:()=>DE,BadgeDefinition:()=>A8,BlockedRelaysList:()=>s8,BookmarkList:()=>r8,Bookmarksets:()=>y8,Calendar:()=>_8,CalendarEventRSVP:()=>L8,ChannelCreation:()=>px,ChannelHideMessage:()=>yx,ChannelMessage:()=>bx,ChannelMetadata:()=>xx,ChannelMuteUser:()=>wx,ClassifiedListing:()=>O8,ClientAuth:()=>Ax,CommunitiesList:()=>n8,CommunityDefinition:()=>$8,CommunityPostApproval:()=>zE,Contacts:()=>BE,CreateOrUpdateProduct:()=>S8,CreateOrUpdateStall:()=>E8,Curationsets:()=>w8,Date:()=>R8,DirectMessageRelaysList:()=>u8,DraftClassifiedListing:()=>U8,DraftLong:()=>I8,Emojisets:()=>k8,EncryptedDirectMessage:()=>_E,EventDeletion:()=>LE,FileMetadata:()=>$E,FileServerPreference:()=>f8,Followsets:()=>p8,GenericRepost:()=>Yu,Genericlists:()=>x8,GiftWrap:()=>mx,HTTPAuth:()=>Xu,Handlerinformation:()=>M8,Handlerrecommendation:()=>D8,Highlights:()=>YE,InterestsList:()=>a8,Interestsets:()=>v8,JobFeedback:()=>JE,JobRequest:()=>VE,JobResult:()=>WE,Label:()=>jE,LightningPubRPC:()=>d8,LiveChatMessage:()=>FE,LiveEvent:()=>P8,LongFormArticle:()=>C8,Metadata:()=>UE,Mutelist:()=>XE,NWCWalletInfo:()=>l8,NWCWalletRequest:()=>vx,NWCWalletResponse:()=>h8,NostrConnect:()=>g8,OpenTimestamps:()=>ME,Pinlist:()=>e8,PrivateDirectMessage:()=>gx,ProblemTracker:()=>GE,ProfileBadges:()=>m8,PublicChatsList:()=>i8,Reaction:()=>Zu,RecommendRelay:()=>RE,RelayList:()=>t8,Relaysets:()=>b8,Report:()=>HE,Reporting:()=>KE,Repost:()=>qu,Seal:()=>hx,SearchRelaysList:()=>o8,ShortTextNote:()=>dx,Time:()=>B8,UserEmojiList:()=>c8,UserStatuses:()=>N8,Zap:()=>ZE,ZapGoal:()=>QE,ZapRequest:()=>qE,classifyKind:()=>NE,isAddressableKind:()=>Qu,isEphemeralKind:()=>lx,isKind:()=>OE,isRegularKind:()=>fx,isReplaceableKind:()=>Ju});function fx(r){return 1e3<=r&&r<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(r)}function Ju(r){return[0,3].includes(r)||1e4<=r&&r<2e4}function lx(r){return 2e4<=r&&r<3e4}function Qu(r){return 3e4<=r&&r<4e4}function NE(r){return fx(r)?"regular":Ju(r)?"replaceable":lx(r)?"ephemeral":Qu(r)?"parameterized":"unknown"}function OE(r,e){const t=e instanceof Array?e:[e];return zu(r)&&t.includes(r.kind)||!1}var UE=0,dx=1,RE=2,BE=3,_E=4,LE=5,qu=6,Zu=7,DE=8,hx=13,gx=14,Yu=16,px=40,xx=41,bx=42,yx=43,wx=44,ME=1040,mx=1059,$E=1063,FE=1311,GE=1971,HE=1984,KE=1984,jE=1985,zE=4550,VE=5999,WE=6999,JE=7e3,QE=9041,qE=9734,ZE=9735,YE=9802,XE=1e4,e8=10001,t8=10002,r8=10003,n8=10004,i8=10005,s8=10006,o8=10007,a8=10015,c8=10030,u8=10050,f8=10096,l8=13194,d8=21e3,Ax=22242,vx=23194,h8=23195,g8=24133,Xu=27235,p8=3e4,x8=30001,b8=30002,y8=30003,w8=30004,m8=30008,A8=30009,v8=30015,E8=30017,S8=30018,C8=30023,I8=30024,k8=30030,T8=30078,P8=30311,N8=30315,O8=30402,U8=30403,R8=31922,B8=31923,_8=31924,L8=31925,D8=31989,M8=31990,$8=34550,F8={};ve(F8,{getHex64:()=>ef,getInt:()=>Ex,getSubscriptionId:()=>G8,matchEventId:()=>H8,matchEventKind:()=>j8,matchEventPubkey:()=>K8});function ef(r,e){let t=e.length+3,n=r.indexOf(`"${e}":`)+t,i=r.slice(n).indexOf('"')+n+1;return r.slice(i,i+64)}function Ex(r,e){let t=e.length,n=r.indexOf(`"${e}":`)+t+3,i=r.slice(n),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function G8(r){let e=r.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let t=r.slice(e+7+1).indexOf('"');if(t===-1)return null;let n=e+7+1+t,i=r.slice(n+1,80).indexOf('"');if(i===-1)return null;let s=n+1+i;return r.slice(n+1,s)}function H8(r,e){return e===ef(r,"id")}function K8(r,e){return e===ef(r,"pubkey")}function j8(r,e){return e===Ex(r,"kind")}var z8={};ve(z8,{makeAuthEvent:()=>V8});function V8(r,e){return{kind:Ax,created_at:Math.floor(Date.now()/1e3),tags:[["relay",r],["challenge",e]],content:""}}var W8;try{W8=WebSocket}catch{}var J8;try{J8=WebSocket}catch{}var Q8={};ve(Q8,{BECH32_REGEX:()=>Sx,Bech32MaxSize:()=>tf,NostrTypeGuard:()=>q8,decode:()=>Xo,decodeNostrURI:()=>Y8,encodeBytes:()=>ta,naddrEncode:()=>i6,neventEncode:()=>n6,noteEncode:()=>t6,nprofileEncode:()=>r6,npubEncode:()=>e6,nsecEncode:()=>X8});var q8={isNProfile:r=>/^nprofile1[a-z\d]+$/.test(r||""),isNEvent:r=>/^nevent1[a-z\d]+$/.test(r||""),isNAddr:r=>/^naddr1[a-z\d]+$/.test(r||""),isNSec:r=>/^nsec1[a-z\d]{58}$/.test(r||""),isNPub:r=>/^npub1[a-z\d]{58}$/.test(r||""),isNote:r=>/^note1[a-z\d]+$/.test(r||""),isNcryptsec:r=>/^ncryptsec1[a-z\d]+$/.test(r||"")},tf=5e3,Sx=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Z8(r){const e=new Uint8Array(4);return e[0]=r>>24&255,e[1]=r>>16&255,e[2]=r>>8&255,e[3]=r&255,e}function Y8(r){try{return r.startsWith("nostr:")&&(r=r.substring(6)),Xo(r)}catch{return{type:"invalid",data:null}}}function Xo(r){let{prefix:e,words:t}=li.decode(r,tf),n=new Uint8Array(li.fromWords(t));switch(e){case"nprofile":{let i=qa(n);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Xe(i[0][0]),relays:i[1]?i[1].map(s=>pr.decode(s)):[]}}}case"nevent":{let i=qa(n);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Xe(i[0][0]),relays:i[1]?i[1].map(s=>pr.decode(s)):[],author:i[2]?.[0]?Xe(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(Xe(i[3][0]),16):void 0}}}case"naddr":{let i=qa(n);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:pr.decode(i[0][0]),pubkey:Xe(i[2][0]),kind:parseInt(Xe(i[3][0]),16),relays:i[1]?i[1].map(s=>pr.decode(s)):[]}}}case"nsec":return{type:e,data:n};case"npub":case"note":return{type:e,data:Xe(n)};default:throw new Error(`unknown prefix ${e}`)}}function qa(r){let e={},t=r;for(;t.length>0;){let n=t[0],i=t[1],s=t.slice(2,2+i);if(t=t.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${n}`);e[n]=e[n]||[],e[n].push(s)}return e}function X8(r){return ta("nsec",r)}function e6(r){return ta("npub",Sn(r))}function t6(r){return ta("note",Sn(r))}function ea(r,e){let t=li.toWords(e);return li.encode(r,t,tf)}function ta(r,e){return ea(r,e)}function r6(r){let e=rf({0:[Sn(r.pubkey)],1:(r.relays||[]).map(t=>_t.encode(t))});return ea("nprofile",e)}function n6(r){let e;r.kind!==void 0&&(e=Z8(r.kind));let t=rf({0:[Sn(r.id)],1:(r.relays||[]).map(n=>_t.encode(n)),2:r.author?[Sn(r.author)]:[],3:e?[new Uint8Array(e)]:[]});return ea("nevent",t)}function i6(r){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,r.kind,!1);let t=rf({0:[_t.encode(r.identifier)],1:(r.relays||[]).map(n=>_t.encode(n)),2:[Sn(r.pubkey)],3:[new Uint8Array(e)]});return ea("naddr",t)}function rf(r){let e=[];return Object.entries(r).reverse().forEach(([t,n])=>{n.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(t)],0),s.set([i.length],1),s.set(i,2),e.push(s)})}),Qo(...e)}var s6={};ve(s6,{decrypt:()=>o6,encrypt:()=>Cx});function Cx(r,e,t){const n=r instanceof Uint8Array?Xe(r):r,i=ht.getSharedSecret(n,"02"+e),s=Ix(i);let o=Uint8Array.from(Vp(16)),a=_t.encode(t),c=rx(s,o).encrypt(a),u=Sr.encode(new Uint8Array(c)),l=Sr.encode(new Uint8Array(o.buffer));return`${u}?iv=${l}`}function o6(r,e,t){const n=r instanceof Uint8Array?Xe(r):r;let[i,s]=t.split("?iv="),o=ht.getSharedSecret(n,"02"+e),a=Ix(o),c=Sr.decode(s),u=Sr.decode(i),l=rx(a,c).decrypt(u);return pr.decode(l)}function Ix(r){return r.slice(1,33)}var a6={};ve(a6,{NIP05_REGEX:()=>nf,isNip05:()=>c6,isValid:()=>l6,queryProfile:()=>kx,searchDomain:()=>f6,useFetchImplementation:()=>u6});var nf=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,c6=r=>nf.test(r||""),ra;try{ra=fetch}catch{}function u6(r){ra=r}async function f6(r,e=""){try{const t=`https://${r}/.well-known/nostr.json?name=${e}`,n=await ra(t,{redirect:"manual"});if(n.status!==200)throw Error("Wrong response code");return(await n.json()).names}catch{return{}}}async function kx(r){const e=r.match(nf);if(!e)return null;const[,t="_",n]=e;try{const i=`https://${n}/.well-known/nostr.json?name=${t}`,s=await ra(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const o=await s.json(),a=o.names[t];return a?{pubkey:a,relays:o.relays?.[a]}:null}catch{return null}}async function l6(r,e){const t=await kx(e);return t?t.pubkey===r:!1}var d6={};ve(d6,{parse:()=>h6});function h6(r){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let t,n;for(let i=r.tags.length-1;i>=0;i--){const s=r.tags[i];if(s[0]==="e"&&s[1]){const[o,a,c,u,l]=s,f={id:a,relays:c?[c]:[],author:l};if(u==="root"){e.root=f;continue}if(u==="reply"){e.reply=f;continue}if(u==="mention"){e.mentions.push(f);continue}t?n=f:t=f,e.mentions.push(f);continue}if(s[0]==="q"&&s[1]){const[o,a,c]=s;e.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=n||t||e.reply),e.reply||(e.reply=t||e.root),[e.reply,e.root].forEach(i=>{if(!i)return;let s=e.mentions.indexOf(i);if(s!==-1&&e.mentions.splice(s,1),i.author){let o=e.profiles.find(a=>a.pubkey===i.author);o&&o.relays&&(i.relays||(i.relays=[]),o.relays.forEach(a=>{i.relays?.indexOf(a)===-1&&i.relays.push(a)}),o.relays=i.relays)}}),e.mentions.forEach(i=>{if(i.author){let s=e.profiles.find(o=>o.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(o=>{i.relays.indexOf(o)===-1&&i.relays.push(o)}),s.relays=i.relays)}}),e}var g6={};ve(g6,{fetchRelayInformation:()=>x6,useFetchImplementation:()=>p6});var Tx;try{Tx=fetch}catch{}function p6(r){Tx=r}async function x6(r){return await(await fetch(r.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var b6={};ve(b6,{fastEventHash:()=>Nx,getPow:()=>Px,minePow:()=>y6});function Px(r){let e=0;for(let t=0;t<64;t+=8){const n=parseInt(r.substring(t,t+8),16);if(n===0)e+=32;else{e+=Math.clz32(n);break}}return e}function y6(r,e){let t=0;const n=r,i=["nonce",t.toString(),e.toString()];for(n.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==n.created_at&&(t=0,n.created_at=s),i[1]=(++t).toString(),n.id=Nx(n),Px(n.id)>=e)break}return n}function Nx(r){return Xe(bi(_t.encode(JSON.stringify([0,r.pubkey,r.created_at,r.kind,r.tags,r.content]))))}var w6={};ve(w6,{unwrapEvent:()=>O6,unwrapManyEvents:()=>U6,wrapEvent:()=>Kx,wrapManyEvents:()=>N6});var m6={};ve(m6,{createRumor:()=>$x,createSeal:()=>Fx,createWrap:()=>Gx,unwrapEvent:()=>uf,unwrapManyEvents:()=>Hx,wrapEvent:()=>Ao,wrapManyEvents:()=>T6});var A6={};ve(A6,{decrypt:()=>cf,encrypt:()=>af,getConversationKey:()=>sf,v2:()=>I6});var Ox=1,Ux=65535;function sf(r,e){const t=ht.getSharedSecret(r,"02"+e).subarray(1,33);return yE(bi,t,"nip44-v2")}function Rx(r,e){const t=wE(bi,r,e,76);return{chacha_key:t.subarray(0,32),chacha_nonce:t.subarray(32,44),hmac_key:t.subarray(44,76)}}function of(r){if(!Number.isSafeInteger(r)||r<1)throw new Error("expected positive integer");if(r<=32)return 32;const e=1<<Math.floor(Math.log2(r-1))+1,t=e<=256?32:e/8;return t*(Math.floor((r-1)/t)+1)}function v6(r){if(!Number.isSafeInteger(r)||r<Ox||r>Ux)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,r,!1),e}function E6(r){const e=_t.encode(r),t=e.length,n=v6(t),i=new Uint8Array(of(t)-t);return Qo(n,e,i)}function S6(r){const e=new DataView(r.buffer).getUint16(0),t=r.subarray(2,2+e);if(e<Ox||e>Ux||t.length!==e||r.length!==2+of(e))throw new Error("invalid padding");return pr.decode(t)}function Bx(r,e,t){if(t.length!==32)throw new Error("AAD associated data must be 32 bytes");const n=Qo(t,e);return Zo(bi,r,n)}function C6(r){if(typeof r!="string")throw new Error("payload must be a valid string");const e=r.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(r[0]==="#")throw new Error("unknown encryption version");let t;try{t=Sr.decode(r)}catch(s){throw new Error("invalid base64: "+s.message)}const n=t.length;if(n<99||n>65603)throw new Error("invalid data length: "+n);const i=t[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:t.subarray(1,33),ciphertext:t.subarray(33,-32),mac:t.subarray(-32)}}function af(r,e,t=Vp(32)){const{chacha_key:n,chacha_nonce:i,hmac_key:s}=Rx(e,t),o=E6(r),a=ox(n,i,o),c=Bx(s,a,t);return Sr.encode(Qo(new Uint8Array([2]),t,a,c))}function cf(r,e){const{nonce:t,ciphertext:n,mac:i}=C6(r),{chacha_key:s,chacha_nonce:o,hmac_key:a}=Rx(e,t),c=Bx(a,n,t);if(!X3(c,i))throw new Error("invalid MAC");const u=ox(s,o,n);return S6(u)}var I6={utils:{getConversationKey:sf,calcPaddedLen:of},encrypt:af,decrypt:cf},k6=2880*60,_x=()=>Math.round(Date.now()/1e3),Lx=()=>Math.round(_x()-Math.random()*k6),Dx=(r,e)=>sf(r,e),Mx=(r,e,t)=>af(JSON.stringify(r),Dx(e,t)),Td=(r,e)=>JSON.parse(cf(r.content,Dx(e,r.pubkey)));function $x(r,e){const t={created_at:_x(),content:"",tags:[],...r,pubkey:Wu(e)};return t.id=Vr(t),t}function Fx(r,e,t){return Dt({kind:hx,content:Mx(r,e,t),created_at:Lx(),tags:[]},e)}function Gx(r,e){const t=TE();return Dt({kind:mx,content:Mx(r,t,e),created_at:Lx(),tags:[["p",e]]},t)}function Ao(r,e,t){const n=$x(r,e),i=Fx(n,e,t);return Gx(i,t)}function T6(r,e,t){if(!t||t.length===0)throw new Error("At least one recipient is required.");const n=Wu(e),i=[Ao(r,e,n)];return t.forEach(s=>{i.push(Ao(r,e,s))}),i}function uf(r,e){const t=Td(r,e);return Td(t,e)}function Hx(r,e){let t=[];return r.forEach(n=>{t.push(uf(n,e))}),t.sort((n,i)=>n.created_at-i.created_at),t}function P6(r,e,t,n){const i={created_at:Math.ceil(Date.now()/1e3),kind:gx,tags:[],content:e};return(Array.isArray(r)?r:[r]).forEach(({publicKey:o,relayUrl:a})=>{i.tags.push(a?["p",o,a]:["p",o])}),n&&i.tags.push(["e",n.eventId,n.relayUrl||"","reply"]),t&&i.tags.push(["subject",t]),i}function Kx(r,e,t,n,i){const s=P6(e,t,n,i);return Ao(s,r,e.publicKey)}function N6(r,e,t,n,i){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Wu(r)},...e].map(o=>Kx(r,o,t,n,i))}var O6=uf,U6=Hx,R6={};ve(R6,{finishRepostEvent:()=>B6,getRepostedEvent:()=>_6,getRepostedEventPointer:()=>jx});function B6(r,e,t,n){let i;const s=[...r.tags??[],["e",e.id,t],["p",e.pubkey]];return e.kind===dx?i=qu:(i=Yu,s.push(["k",String(e.kind)])),Dt({kind:i,tags:s,content:r.content===""||e.tags?.find(o=>o[0]==="-")?"":JSON.stringify(e),created_at:r.created_at},n)}function jx(r){if(![qu,Yu].includes(r.kind))return;let e,t;for(let n=r.tags.length-1;n>=0&&(e===void 0||t===void 0);n--){const i=r.tags[n];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&t===void 0&&(t=i))}if(e!==void 0)return{id:e[1],relays:[e[2],t?.[2]].filter(n=>typeof n=="string"),author:t?.[1]}}function _6(r,{skipVerification:e}={}){const t=jx(r);if(t===void 0||r.content==="")return;let n;try{n=JSON.parse(r.content)}catch{return}if(n.id===t.id&&!(!e&&!Yi(n)))return n}var L6={};ve(L6,{NOSTR_URI_REGEX:()=>ff,parse:()=>M6,test:()=>D6});var ff=new RegExp(`nostr:(${Sx.source})`);function D6(r){return typeof r=="string"&&new RegExp(`^${ff.source}$`).test(r)}function M6(r){const e=r.match(new RegExp(`^${ff.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${r}`);return{uri:e[0],value:e[1],decoded:Xo(e[1])}}var $6={};ve($6,{finishReactionEvent:()=>F6,getReactedEventPointer:()=>G6});function F6(r,e,t){const n=e.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return Dt({...r,kind:Zu,tags:[...r.tags??[],...n,["e",e.id],["p",e.pubkey]],content:r.content??"+"},t)}function G6(r){if(r.kind!==Zu)return;let e,t;for(let n=r.tags.length-1;n>=0&&(e===void 0||t===void 0);n--){const i=r.tags[n];i.length>=2&&(i[0]==="e"&&e===void 0?e=i:i[0]==="p"&&t===void 0&&(t=i))}if(!(e===void 0||t===void 0))return{id:e[1],relays:[e[2],t[2]].filter(n=>n!==void 0),author:t[1]}}var H6={};ve(H6,{parse:()=>j6});var K6=/\W/m,Pd=/\W |\W$|$|,| /m;function*j6(r){const e=r.length;let t=0,n=0;for(;n<e;){let i=r.indexOf(":",n);if(i===-1)break;if(r.substring(i-5,i)==="nostr"){const s=r.substring(i+60).match(K6),o=s?i+60+s.index:e;try{let a,{data:c,type:u}=Xo(r.substring(i+1,o));switch(u){case"npub":a={pubkey:c};break;case"nsec":case"note":n=o+1;continue;default:a=c}t!==i-5&&(yield{type:"text",text:r.substring(t,i-5)}),yield{type:"reference",pointer:a},n=o,t=n;continue}catch{n=i+1;continue}}else if(r.substring(i-5,i)==="https"||r.substring(i-4,i)==="http"){const s=r.substring(i+4).match(Pd),o=s?i+4+s.index:e,a=r[i-1]==="s"?5:4;try{let c=new URL(r.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid url");if(t!==i-a&&(yield{type:"text",text:r.substring(t,i-a)}),/\.(png|jpe?g|gif|webp)$/i.test(c.pathname)){yield{type:"image",url:c.toString()},n=o,t=n;continue}if(/\.(mp4|avi|webm|mkv)$/i.test(c.pathname)){yield{type:"video",url:c.toString()},n=o,t=n;continue}if(/\.(mp3|aac|ogg|opus)$/i.test(c.pathname)){yield{type:"audio",url:c.toString()},n=o,t=n;continue}yield{type:"url",url:c.toString()},n=o,t=n;continue}catch{n=o+1;continue}}else if(r.substring(i-3,i)==="wss"||r.substring(i-2,i)==="ws"){const s=r.substring(i+4).match(Pd),o=s?i+4+s.index:e,a=r[i-1]==="s"?3:2;try{let c=new URL(r.substring(i-a,o));if(c.hostname.indexOf(".")===-1)throw new Error("invalid ws url");t!==i-a&&(yield{type:"text",text:r.substring(t,i-a)}),yield{type:"relay",url:c.toString()},n=o,t=n;continue}catch{n=o+1;continue}}else{n=i+1;continue}}t!==e&&(yield{type:"text",text:r.substring(t)})}var z6={};ve(z6,{channelCreateEvent:()=>V6,channelHideMessageEvent:()=>Q6,channelMessageEvent:()=>J6,channelMetadataEvent:()=>W6,channelMuteUserEvent:()=>q6});var V6=(r,e)=>{let t;if(typeof r.content=="object")t=JSON.stringify(r.content);else if(typeof r.content=="string")t=r.content;else return;return Dt({kind:px,tags:[...r.tags??[]],content:t,created_at:r.created_at},e)},W6=(r,e)=>{let t;if(typeof r.content=="object")t=JSON.stringify(r.content);else if(typeof r.content=="string")t=r.content;else return;return Dt({kind:xx,tags:[["e",r.channel_create_event_id],...r.tags??[]],content:t,created_at:r.created_at},e)},J6=(r,e)=>{const t=[["e",r.channel_create_event_id,r.relay_url,"root"]];return r.reply_to_channel_message_event_id&&t.push(["e",r.reply_to_channel_message_event_id,r.relay_url,"reply"]),Dt({kind:bx,tags:[...t,...r.tags??[]],content:r.content,created_at:r.created_at},e)},Q6=(r,e)=>{let t;if(typeof r.content=="object")t=JSON.stringify(r.content);else if(typeof r.content=="string")t=r.content;else return;return Dt({kind:yx,tags:[["e",r.channel_message_event_id],...r.tags??[]],content:t,created_at:r.created_at},e)},q6=(r,e)=>{let t;if(typeof r.content=="object")t=JSON.stringify(r.content);else if(typeof r.content=="string")t=r.content;else return;return Dt({kind:wx,tags:[["p",r.pubkey_to_mute],...r.tags??[]],content:t,created_at:r.created_at},e)},Z6={};ve(Z6,{EMOJI_SHORTCODE_REGEX:()=>zx,matchAll:()=>Y6,regex:()=>lf,replaceAll:()=>X6});var zx=/:(\w+):/,lf=()=>new RegExp(`\\B${zx.source}\\B`,"g");function*Y6(r){const e=r.matchAll(lf());for(const t of e)try{const[n,i]=t;yield{shortcode:n,name:i,start:t.index,end:t.index+n.length}}catch{}}function X6(r,e){return r.replaceAll(lf(),(t,n)=>e({shortcode:t,name:n}))}var e4={};ve(e4,{useFetchImplementation:()=>t4,validateGithub:()=>r4});var df;try{df=fetch}catch{}function t4(r){df=r}async function r4(r,e,t){try{return await(await df(`https://gist.github.com/${e}/${t}/raw`)).text()===`Verifying that I control the following Nostr public key: ${r}`}catch{return!1}}var n4={};ve(n4,{makeNwcRequestEvent:()=>s4,parseConnectionString:()=>i4});function i4(r){const{host:e,pathname:t,searchParams:n}=new URL(r),i=t||e,s=n.get("relay"),o=n.get("secret");if(!i||!s||!o)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:o}}async function s4(r,e,t){const i=Cx(e,r,JSON.stringify({method:"pay_invoice",params:{invoice:t}})),s={kind:vx,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",r]]};return Dt(s,e)}var o4={};ve(o4,{normalizeIdentifier:()=>a4});function a4(r){return r=r.trim().toLowerCase(),r=r.normalize("NFKC"),Array.from(r).map(e=>/\p{Letter}/u.test(e)||/\p{Number}/u.test(e)?e:"-").join("")}var c4={};ve(c4,{getSatoshisAmountFromBolt11:()=>g4,getZapEndpoint:()=>f4,makeZapReceipt:()=>h4,makeZapRequest:()=>l4,useFetchImplementation:()=>u4,validateZapRequest:()=>d4});var hf;try{hf=fetch}catch{}function u4(r){hf=r}async function f4(r){try{let e="",{lud06:t,lud16:n}=JSON.parse(r.content);if(t){let{words:o}=li.decode(t,1e3),a=li.fromWords(o);e=pr.decode(a)}else if(n){let[o,a]=n.split("@");e=new URL(`/.well-known/lnurlp/${o}`,`https://${a}`).toString()}else return null;let s=await(await hf(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function l4(r){let e={kind:9734,created_at:Math.round(Date.now()/1e3),content:r.comment||"",tags:[["p","pubkey"in r?r.pubkey:r.event.pubkey],["amount",r.amount.toString()],["relays",...r.relays]]};if("event"in r){if(e.tags.push(["e",r.event.id]),Ju(r.event.kind)){const t=["a",`${r.event.kind}:${r.event.pubkey}:`];e.tags.push(t)}else if(Qu(r.event.kind)){let t=r.event.tags.find(([i,s])=>i==="d"&&s);if(!t)throw new Error("d tag not found or is empty");const n=["a",`${r.event.kind}:${r.event.pubkey}:${t[1]}`];e.tags.push(n)}e.tags.push(["k",r.event.kind.toString()])}return e}function d4(r){let e;try{e=JSON.parse(r)}catch{return"Invalid zap request JSON."}if(!zu(e))return"Zap request is not a valid Nostr event.";if(!Yi(e))return"Invalid signature on zap request.";let t=e.tags.find(([s,o])=>s==="p"&&o);if(!t)return"Zap request doesn't have a 'p' tag.";if(!t[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let n=e.tags.find(([s,o])=>s==="e"&&o);return n&&!n[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,o])=>s==="relays"&&o)?null:"Zap request doesn't have a 'relays' tag."}function h4({zapRequest:r,preimage:e,bolt11:t,paidAt:n}){let i=JSON.parse(r),s=i.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),o={kind:9735,created_at:Math.round(n.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",t],["description",r]]};return e&&o.tags.push(["preimage",e]),o}function g4(r){if(r.length<50)return 0;r=r.substring(0,50);const e=r.lastIndexOf("1");if(e===-1)return 0;const t=r.substring(0,e);if(!t.startsWith("lnbc"))return 0;const n=t.substring(4);if(n.length<1)return 0;const i=n[n.length-1],s=i.charCodeAt(0)-48,o=s>=0&&s<=9;let a=n.length-1;if(o&&a++,a<1)return 0;const c=parseInt(n.substring(0,a));switch(i){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var p4={};ve(p4,{getToken:()=>x4,hashPayload:()=>gf,unpackEventFromToken:()=>Wx,validateEvent:()=>Xx,validateEventKind:()=>Qx,validateEventMethodTag:()=>Zx,validateEventPayloadTag:()=>Yx,validateEventTimestamp:()=>Jx,validateEventUrlTag:()=>qx,validateToken:()=>b4});var Vx="Nostr ";async function x4(r,e,t,n=!1,i){const s={kind:Xu,tags:[["u",r],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",gf(i)]);const o=await t(s);return(n?Vx:"")+Sr.encode(_t.encode(JSON.stringify(o)))}async function b4(r,e,t){const n=await Wx(r).catch(s=>{throw s});return await Xx(n,e,t).catch(s=>{throw s})}async function Wx(r){if(!r)throw new Error("Missing token");r=r.replace(Vx,"");const e=pr.decode(Sr.decode(r));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Jx(r){return r.created_at?Math.round(new Date().getTime()/1e3)-r.created_at<60:!1}function Qx(r){return r.kind===Xu}function qx(r,e){const t=r.tags.find(n=>n[0]==="u");return t?t.length>0&&t[1]===e:!1}function Zx(r,e){const t=r.tags.find(n=>n[0]==="method");return t?t.length>0&&t[1].toLowerCase()===e.toLowerCase():!1}function gf(r){const e=bi(_t.encode(JSON.stringify(r)));return Xe(e)}function Yx(r,e){const t=r.tags.find(i=>i[0]==="payload");if(!t)return!1;const n=gf(e);return t.length>0&&t[1]===n}async function Xx(r,e,t,n){if(!Yi(r))throw new Error("Invalid nostr event, signature invalid");if(!Qx(r))throw new Error("Invalid nostr event, kind invalid");if(!Jx(r))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!qx(r,e))throw new Error("Invalid nostr event, url tag invalid");if(!Zx(r,t))throw new Error("Invalid nostr event, method tag invalid");if(n&&typeof n=="object"&&Object.keys(n).length>0&&!Yx(r,n))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}function y4(r){return!r||typeof r!="string"?!1:/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(r)}function eb(r,e){return r==="web3"&&e.id?`web3_${e.id.toLowerCase()}`:r==="nostr"&&e.id?`nostr_${e.id}`:r==="webauthn"&&e.id?`webauthn_${e.id}`:e.email&&y4(e.email)?`${r}_${e.email.split("@")[0]}`:e.name?`${r}_${e.name.replace(/\s+/g,"_")}`:e.id?`${r}_${e.id}`:`${r}_user`}function w4(r){try{return ie(de(r)).slice(2,34)}catch{return console.warn("ethers not available, using fallback password generation"),Buffer.from(r).toString("hex").slice(0,32)}}const Nd="I Love Shogun!";class vo extends Cn{DEFAULT_CONFIG={cacheDuration:1440*60*1e3,maxRetries:3,retryDelay:1e3,timeout:6e4,network:"mainnet",useApi:!1};config;signatureCache=new Map;connectedAddress=null;connectedType=null;manualKeyPair=null;constructor(e={}){super(),this.config={...this.DEFAULT_CONFIG,...e},this.setupEventListeners()}setupEventListeners(){}clearSignatureCache(e){if(e){this.signatureCache.delete(e);try{const t=`shogun_bitcoin_sig_${e}`;localStorage.removeItem(t),console.log(`Cleared signature cache for address: ${e.substring(0,10)}...`)}catch(t){console.error("Error clearing signature cache from localStorage:",t)}}else{this.signatureCache.clear();try{const t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith("shogun_bitcoin_sig_")&&t.push(i)}t.forEach(n=>localStorage.removeItem(n)),console.log(`Cleared all signature caches (${t.length} entries)`)}catch(t){console.error("Error clearing all signature caches from localStorage:",t)}}}isNostrExtensionAvailable(){return typeof window<"u"&&!!window.nostr}isAvailable(){return this.isNostrExtensionAvailable()||this.manualKeyPair!==null}async connectWallet(e="nostr"){console.log(`Connecting to Bitcoin wallet via ${e}...`);try{let t;switch(e){case"alby":console.log("[nostrConnector] Alby is deprecated, redirecting to Nostr"),t=await this.connectNostr();break;case"nostr":t=await this.connectNostr();break;case"manual":t=await this.connectManual();break;default:throw new Error(`Unsupported wallet type: ${e}`)}return t.success&&t.address&&(this.connectedAddress=t.address,this.connectedType=e,console.log(`Successfully connected to ${e} wallet: ${t.address}`),this.emit("wallet_connected",{address:t.address,type:this.connectedType})),t}catch(t){return console.error(`Error connecting to ${e} wallet:`,t),{success:!1,error:t.message||"Failed to connect to wallet"}}}async connectNostr(){if(!this.isNostrExtensionAvailable())return{success:!1,error:"Nostr extension is not available. Please install a Nostr compatible extension like nos2x, Alby, or Coracle."};try{console.log("[nostrConnector] Attempting to connect to Nostr extension...");const e=await window.nostr.getPublicKey();if(!e)throw new Error("Could not get public key from Nostr extension");console.log(`[nostrConnector] Successfully connected to Nostr extension: ${e.substring(0,10)}...`),this.connectedAddress=e,this.connectedType="nostr",this.emit("connected",{address:e,type:"nostr"});const t=`nostr_${e.substring(0,10)}`;return{success:!0,address:e,username:t,extensionType:"nostr"}}catch(e){throw console.error("[nostrConnector] Nostr connection error:",e),e.message&&e.message.includes("User rejected")?new Error("Nostr connection was rejected by the user"):e.message&&e.message.includes("not available")?new Error("Nostr extension is not available or not properly installed"):new Error(`Nostr connection error: ${e.message}`)}}async connectManual(){if(!this.manualKeyPair)return{success:!1,error:"No manual key pair configured. Use setKeyPair() first."};this.connectedAddress=this.manualKeyPair.address,this.connectedType="manual",this.emit("connected",{address:this.manualKeyPair.address,type:"manual"});const e=`btc_${this.manualKeyPair.address.substring(0,10)}`;return{success:!0,address:this.manualKeyPair.address,username:e,extensionType:"manual"}}setKeyPair(e){this.manualKeyPair=e,e.address&&(this.connectedAddress=e.address,this.connectedType="manual")}async generateCredentials(e,t,n){const i=eb("nostr",{id:e}),s=ie(de(e)),o=`${i}_${e}_${n}_${t}`,a=await Ir(s,o,{includeP256:!0});return{username:i,key:a,message:n,signature:t}}async generatePassword(e){if(!e)throw new Error("Invalid signature");try{const t=e.toLowerCase().replace(/[^a-f0-9]/g,"");return st(de(t))}catch(t){throw console.error("Error generating password:",t),new Error("Failed to generate password from signature")}}async verifySignature(e,t,n){try{const i=typeof n=="object"?n.address||JSON.stringify(n):String(n);if(console.log(`Verifying signature for address: ${i}`),!t||!e||!i)return console.error("Invalid message, signature, or address for verification"),!1;if(this.connectedType==="nostr"||this.connectedType==="alby")try{const s={kind:1,created_at:0,tags:[],content:e,pubkey:i},o={...s,id:Vr(s),sig:t};return Yi(o)}catch(s){return console.error("Error in Nostr signature verification:",s),!1}else if(this.connectedType==="manual"&&this.manualKeyPair){if(console.log("[nostrConnector] Manual verification for keypair"),!this.manualKeyPair.privateKey)return console.error("Manual verification failed: private key is missing."),!1;try{const s={kind:1,created_at:0,tags:[],content:e,pubkey:i},o={...s,id:Vr(s),sig:t};return Yi(o)}catch(s){return console.error("Error in manual signature verification:",s),!1}}return console.warn("No specific verification method available, signature cannot be fully verified"),!1}catch(i){return console.error("Error verifying signature:",i),!1}}getConnectedAddress(){return this.connectedAddress}getConnectedType(){return this.connectedType}async requestSignature(e,t){if(!this.connectedType)throw new Error("No wallet connected");try{switch(this.connectedType){case"alby":case"nostr":if(this.connectedType==="alby"&&console.warn("Alby is deprecated, using Nostr functionality for signature request"),console.log("[nostrConnector] Requesting Nostr signature for message:",t),!window.nostr)throw new Error("Nostr extension not available");const n={kind:1,created_at:0,tags:[],content:t,pubkey:e},i={...n,id:Vr(n),sig:""},s=await window.nostr.signEvent(i);return console.log("Received Nostr signature:",s.sig.substring(0,20)+"..."),s.sig;case"manual":if(console.log("[nostrConnector] Using manual key pair for signature"),!this.manualKeyPair||!this.manualKeyPair.privateKey)throw new Error("No manual key pair available or private key missing");const o={kind:1,created_at:0,tags:[],content:t,pubkey:this.manualKeyPair.address},a={...o,id:Vr(o),sig:""},c=cx.hexToBytes(this.manualKeyPair.privateKey),u=await Dt(a,c);return console.log("Generated manual signature:",u.sig.substring(0,20)+"..."),u.sig;default:throw new Error(`Unsupported wallet type: ${this.connectedType}`)}}catch(n){throw console.error("Error requesting signature:",n),new Error(`Failed to get signature: ${n.message}`)}}cleanup(){this.removeAllListeners(),this.connectedAddress=null,this.connectedType=null,this.manualKeyPair=null}}async function Od(r,e,t){const n=`${r}_${t}`;return await Ir(r,n,{includeP256:!0})}typeof window<"u"?window.NostrConnector=vo:typeof global<"u"&&(global.NostrConnector=vo);class m4{nostrConnector;credentials=new Map;MESSAGE_TO_SIGN="I Love Shogun!";constructor(e){this.nostrConnector=e||new vo}async createSigningCredential(e){try{const t=this.validateAddress(e),n=await this.generateDeterministicSignature(t),i=`${t.toLowerCase()}`,s=await this.generatePassword(n),o={address:t,signature:n,message:this.MESSAGE_TO_SIGN,username:i,password:s};return this.credentials.set(t.toLowerCase(),o),o}catch(t){throw console.error("Error creating Nostr signing credential:",t),new Error(`Failed to create Nostr signing credential: ${t.message}`)}}validateAddress(e){if(!e)throw new Error("Address not provided");try{const t=String(e).trim();if(!/^(npub1|[0-9a-f]{64}|bc1|[13])[a-zA-HJ-NP-Z0-9]{25,59}$/.test(t)&&t.length<10)throw new Error("Invalid Nostr/Bitcoin address format");return t}catch{throw new Error("Invalid Nostr/Bitcoin address provided")}}async generateDeterministicSignature(e){const t=`${e}_${this.MESSAGE_TO_SIGN}_shogun_deterministic`;let n="",i=0;for(let o=0;o<t.length;o++){const a=t.charCodeAt(o);i=i*31+a&4294967295,o%4===3&&(n+=i.toString(16).padStart(8,"0"))}for(;n.length<128;)i=i*31+n.length&4294967295,n+=i.toString(16).padStart(8,"0");let s=n.substring(0,128);return s=s.toLowerCase().replace(/[^0-9a-f]/g,"0"),s.length<128?s=s.padEnd(128,"0"):s.length>128&&(s=s.substring(0,128)),s}async generatePassword(e){if(!e)throw new Error("Invalid signature");try{const t=e.toLowerCase().replace(/[^a-f0-9]/g,"");return st(de(t))}catch(t){throw console.error("Error generating password:",t),new Error("Failed to generate password from signature")}}createAuthenticator(e){const t=this.credentials.get(e.toLowerCase());if(!t)throw new Error(`Credential for address ${e} not found`);return async n=>{try{const i=JSON.stringify(n);return await this.signData(i,t)}catch(i){throw console.error("Nostr authentication error:",i),i}}}async signData(e,t){const n=`${t.signature}_${e}`;return this.generateDeterministicSignature(n)}async createDerivedKeyPair(e,t){const n=this.credentials.get(e.toLowerCase());if(!n)throw new Error(`Credential for address ${e} not found`);try{const i=await Ir(n.password,t,{includeP256:!0});return{pub:i.pub,priv:i.priv,epub:i.epub,epriv:i.epriv}}catch(i){throw console.error("Error deriving keys from Nostr credential:",i),i}}async createGunUser(e,t){const n=this.credentials.get(e.toLowerCase());if(!n)throw new Error(`Credential for address ${e} not found`);try{const i=await this.createDerivedKeyPair(e);return new Promise(s=>{t.user().create(i,o=>{o.err?t.user().auth(i,a=>{if(a.err)s({success:!1,error:a.err});else{const c=a.pub;n.gunUserPub=c,this.credentials.set(e.toLowerCase(),n),s({success:!0,userPub:c})}}):t.user().auth(i,a=>{if(a.err)s({success:!1,error:a.err});else{const c=a.pub;n.gunUserPub=c,this.credentials.set(e.toLowerCase(),n),s({success:!0,userPub:c})}})})})}catch(i){return console.error("Error creating Gun user:",i),{success:!1,error:i.message}}}async signWithDerivedKeys(e,t,n){try{await this.createAuthenticator(t)(e);const s=await this.createDerivedKeyPair(t,n),o=JSON.stringify(e),a=await this.generateDeterministicSignature(`${s.priv}_${o}`);return"SEA"+JSON.stringify({m:o,s:a})}catch(i){throw console.error("Error signing with derived keys:",i),i}}getGunUserPub(e){return this.credentials.get(e.toLowerCase())?.gunUserPub}getPassword(e){return this.credentials.get(e.toLowerCase())?.password}async verifyConsistency(e,t){if(!this.credentials.get(e.toLowerCase()))return{consistent:!1};const i=await this.createDerivedKeyPair(e);return{consistent:t?i.pub===t:!0,actualUserPub:i.pub,expectedUserPub:t}}getCredential(e){return this.credentials.get(e.toLowerCase())}listCredentials(){return Array.from(this.credentials.values())}removeCredential(e){return this.credentials.delete(e.toLowerCase())}}class A4 extends Co{name="nostr";version="1.0.0";description="Provides Bitcoin wallet connection and authentication for ShogunCore";bitcoinConnector=null;signer=null;initialize(e){super.initialize(e),this.bitcoinConnector=new vo,this.signer=new m4(this.bitcoinConnector)}destroy(){this.bitcoinConnector&&this.bitcoinConnector.cleanup(),this.bitcoinConnector=null,this.signer=null,super.destroy()}assertBitcoinConnector(){if(this.assertInitialized(),!this.bitcoinConnector)throw new Error("Bitcoin wallet module not initialized");return this.bitcoinConnector}assertSigner(){if(this.assertInitialized(),!this.signer)throw new Error("Nostr signer not initialized");return this.signer}isAvailable(){return this.assertBitcoinConnector().isAvailable()}isNostrExtensionAvailable(){return this.assertBitcoinConnector().isNostrExtensionAvailable()}async connectNostrWallet(){try{if(!this.isNostrExtensionAvailable())return{success:!1,error:"Nostr extension not available. Please install a Nostr extension like nos2x, Alby, or Coracle."};const e=await this.connectBitcoinWallet("nostr");return e.success,e}catch(e){return console.error("[nostrConnectorPlugin] Error connecting to Nostr wallet:",e),{success:!1,error:e.message||"Unknown error connecting to Nostr wallet"}}}async connectBitcoinWallet(e="nostr"){return e==="alby"&&(e="nostr"),this.assertBitcoinConnector().connectWallet(e)}async generateCredentials(e,t,n){return this.assertBitcoinConnector().generateCredentials(e,t,n)}cleanup(){this.assertBitcoinConnector().cleanup()}async verifySignature(e,t,n){return this.assertBitcoinConnector().verifySignature(e,t,n)}async generatePassword(e){return this.assertBitcoinConnector().generatePassword(e)}async createSigningCredential(e){try{const t=this.assertBitcoinConnector();return typeof t.createSigningCredential=="function"?await t.createSigningCredential(e):await this.assertSigner().createSigningCredential(e)}catch(t){throw console.error(`Error creating Nostr signing credential: ${t.message}`),t}}createAuthenticator(e){try{const t=this.assertBitcoinConnector();return typeof t.createAuthenticator=="function"?t.createAuthenticator(e):this.assertSigner().createAuthenticator(e)}catch(t){throw console.error(`Error creating Nostr authenticator: ${t.message}`),t}}async createDerivedKeyPair(e,t){try{const n=this.assertBitcoinConnector();return typeof n.createDerivedKeyPair=="function"?await n.createDerivedKeyPair(e,t):await this.assertSigner().createDerivedKeyPair(e,t)}catch(n){throw console.error(`Error creating derived key pair: ${n.message}`),n}}async signWithDerivedKeys(e,t,n){try{const i=this.assertBitcoinConnector();return typeof i.signWithDerivedKeys=="function"?await i.signWithDerivedKeys(e,t,n):await this.assertSigner().signWithDerivedKeys(e,t,n)}catch(i){throw console.error(`Error signing with derived keys: ${i.message}`),i}}getSigningCredential(e){const t=this.assertBitcoinConnector();return typeof t.getSigningCredential=="function"?t.getSigningCredential(e):this.assertSigner().getCredential(e)}listSigningCredentials(){const e=this.assertBitcoinConnector();return typeof e.listSigningCredentials=="function"?e.listSigningCredentials():this.assertSigner().listCredentials()}removeSigningCredential(e){const t=this.assertBitcoinConnector();return typeof t.removeSigningCredential=="function"?t.removeSigningCredential(e):this.assertSigner().removeCredential(e)}async createGunUserFromSigningCredential(e){try{const t=this.assertBitcoinConnector();if(typeof t.createGunUserFromSigningCredential=="function")return await t.createGunUserFromSigningCredential(e);const n=this.assertInitialized();return await this.assertSigner().createGunUser(e,n.gun)}catch(t){throw console.error(`Error creating Gun user from Nostr signing credential: ${t.message}`),t}}getGunUserPubFromSigningCredential(e){const t=this.assertBitcoinConnector();return typeof t.getGunUserPubFromSigningCredential=="function"?t.getGunUserPubFromSigningCredential(e):this.assertSigner().getGunUserPub(e)}getPassword(e){const t=this.assertBitcoinConnector();return typeof t.getPassword=="function"?t.getPassword(e):this.assertSigner().getPassword(e)}async verifyConsistency(e,t){try{const n=this.assertBitcoinConnector();return typeof n.verifyConsistency=="function"?await n.verifyConsistency(e,t):await this.assertSigner().verifyConsistency(e,t)}catch(n){return console.error(`Error verifying Nostr consistency: ${n.message}`),{consistent:!1}}}async setupConsistentOneshotSigning(e){try{const t=this.assertBitcoinConnector();if(typeof t.setupConsistentOneshotSigning=="function")return await t.setupConsistentOneshotSigning(e);const n=await this.createSigningCredential(e),i=this.createAuthenticator(e),s=await this.createGunUserFromSigningCredential(e);return{credential:n,authenticator:i,gunUser:s,username:n.username,password:n.password}}catch(t){throw console.error(`Error setting up consistent Nostr oneshot signing: ${t.message}`),t}}async login(e){try{const t=this.assertInitialized();if(!e)throw Ae(Y.VALIDATION,"ADDRESS_REQUIRED","Bitcoin address required for login");if(!this.isAvailable())throw Ae(Y.ENVIRONMENT,"BITCOIN_WALLET_UNAVAILABLE","No Bitcoin wallet available in the browser");const n=Nd,i=await this.assertBitcoinConnector().requestSignature(e,n),s=await this.generateCredentials(e,i,n);if(!s?.username||!s?.key||!s.message||!s.signature)throw Ae(Y.AUTHENTICATION,"CREDENTIAL_GENERATION_FAILED","Bitcoin wallet credentials not generated correctly or signature missing");if(!await this.verifySignature(s.message,s.signature,e))throw console.error(`Signature verification failed for address: ${e}`),Ae(Y.SECURITY,"SIGNATURE_VERIFICATION_FAILED","Bitcoin wallet signature verification failed");const a=await Od(e,i,n);t.setAuthMethod("nostr");const c=await t.login(s.username,"",a);if(!c.success)throw Ae(Y.AUTHENTICATION,"BITCOIN_LOGIN_FAILED",c.error||"Failed to log in with Bitcoin credentials");return t.emit("auth:login",{userPub:c.userPub||"",username:s.username,method:"bitcoin"}),c}catch(t){const n=t?.type||Y.AUTHENTICATION,i=t?.code||"BITCOIN_LOGIN_ERROR",s=t?.message||"Unknown error during Bitcoin wallet login";return Le.handle(n,i,s,t),{success:!1,error:s}}}async signUp(e){try{const t=this.assertInitialized();if(!e)throw Ae(Y.VALIDATION,"ADDRESS_REQUIRED","Bitcoin address required for signup");if(!this.isAvailable())throw Ae(Y.ENVIRONMENT,"BITCOIN_WALLET_UNAVAILABLE","No Bitcoin wallet available in the browser");const n=Nd,i=await this.assertBitcoinConnector().requestSignature(e,n),s=await this.generateCredentials(e,i,n);if(!s?.username||!s?.key||!s.message||!s.signature)throw Ae(Y.AUTHENTICATION,"CREDENTIAL_GENERATION_FAILED","Bitcoin wallet credentials not generated correctly or signature missing");if(!await this.verifySignature(s.message,s.signature,e))throw console.error(`Signature verification failed for address: ${e}`),Ae(Y.SECURITY,"SIGNATURE_VERIFICATION_FAILED","Bitcoin wallet signature verification failed");const a=await Od(e,i,n);t.setAuthMethod("nostr");const c=await t.signUp(s.username,void 0,a);if(c.success){const u=await t.login(s.username,"",a);return u.success?(console.log(`Bitcoin wallet registration and login completed for user: ${s.username}`),t.emit("auth:signup",{userPub:u.userPub||"",username:s.username,method:"bitcoin"}),{...u}):{...c,error:"User created but login failed"}}else return c.error&&c.error.toLowerCase().includes("exist")?{...await t.login(s.username,"",a)}:c}catch(t){const n=t?.type||Y.AUTHENTICATION,i=t?.code||"BITCOIN_SIGNUP_ERROR",s=t?.message||"Unknown error during Bitcoin wallet signup";return Le.handle(n,i,s,t),{success:!1,error:s}}}async loginWithBitcoinWallet(e){return this.login(e)}async signUpWithBitcoinWallet(e){return this.signUp(e)}}class Za extends Cn{DEFAULT_CONFIG={providers:{google:{clientId:"",redirectUri:`${this.getOrigin()}/auth/callback`,scope:["openid","email","profile"],authUrl:"https://accounts.google.com/o/oauth2/v2/auth",tokenUrl:"https://oauth2.googleapis.com/token",userInfoUrl:"https://www.googleapis.com/oauth2/v2/userinfo",usePKCE:!0},github:{clientId:"",redirectUri:`${this.getOrigin()}/auth/callback`,scope:["user:email"],authUrl:"https://github.com/login/oauth/authorize",tokenUrl:"https://github.com/login/oauth/access_token",userInfoUrl:"https://api.github.com/user",usePKCE:!0},discord:{clientId:"",redirectUri:`${this.getOrigin()}/auth/callback`,scope:["identify","email"],authUrl:"https://discord.com/api/oauth2/authorize",tokenUrl:"https://discord.com/api/oauth2/token",userInfoUrl:"https://discord.com/api/users/@me",usePKCE:!0},twitter:{clientId:"",redirectUri:`${this.getOrigin()}/auth/callback`,scope:["tweet.read","users.read"],authUrl:"https://twitter.com/i/oauth2/authorize",tokenUrl:"https://api.twitter.com/2/oauth2/token",userInfoUrl:"https://api.twitter.com/2/users/me",usePKCE:!0},custom:{clientId:"",redirectUri:"",scope:[],authUrl:"",tokenUrl:"",userInfoUrl:"",usePKCE:!0}},usePKCE:!0,cacheDuration:1440*60*1e3,timeout:6e4,maxRetries:3,retryDelay:1e3,allowUnsafeClientSecret:!1,stateTimeout:600*1e3};config;userCache=new Map;memoryStorage=new Map;constructor(e={}){super(),this.config={...this.DEFAULT_CONFIG,...e,providers:{...this.DEFAULT_CONFIG.providers||{},...e.providers||{}}},this.validateSecurityConfig()}validateSecurityConfig(){const e=this.config.providers||{};for(const[t,n]of Object.entries(e))n&&(typeof window<"u"&&!n.usePKCE&&(console.warn(`Provider ${t} does not have PKCE enabled - not secure for browser`),n.usePKCE=!0),typeof window<"u"&&n.clientSecret&&(t==="google"&&n.usePKCE?console.log(`Provider ${t} has client_secret configured - OK for Google with PKCE`):(console.error(`Provider ${t} has client_secret configured in browser - REMOVE IMMEDIATELY`),delete n.clientSecret,console.log(`Provider ${t} client_secret removed for security in browser`))))}updateConfig(e){this.config={...this.config,...e,providers:{...this.config.providers||{},...e.providers||{}}},console.log("OAuthConnector configuration updated",this.config)}getOrigin(){return typeof window<"u"&&window.location?window.location.origin:"http://localhost:3000"}setItem(e,t){typeof window<"u"&&typeof sessionStorage<"u"?sessionStorage.setItem(e,t):this.memoryStorage.set(e,t)}getItem(e){return typeof window<"u"&&typeof sessionStorage<"u"?sessionStorage.getItem(e):this.memoryStorage.get(e)||null}removeItem(e){typeof window<"u"&&typeof sessionStorage<"u"?sessionStorage.removeItem(e):this.memoryStorage.delete(e)}isSupported(){return typeof URLSearchParams<"u"}getAvailableProviders(){return Object.keys(this.config.providers||{}).filter(e=>this.config.providers[e]?.clientId)}async generatePKCEChallenge(){const e=this.generateRandomString(128),t=await this.calculatePKCECodeChallenge(e);return{codeVerifier:e,codeChallenge:t}}async calculatePKCECodeChallenge(e){if(typeof window<"u"&&window.crypto&&window.crypto.subtle){const n=new TextEncoder().encode(e),i=await window.crypto.subtle.digest("SHA-256",n);return this.base64urlEncode(i)}else{const n=require("crypto").createHash("sha256").update(e).digest();return this.base64urlEncode(n)}}base64urlEncode(e){let t;if(typeof Buffer<"u"&&Buffer.isBuffer(e))t=e.toString("base64");else{const n=new Uint8Array(e);let i="";for(let s=0;s<n.length;s++)i+=String.fromCharCode(n[s]);t=window.btoa(i)}return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}generateRandomString(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";let n;if(typeof window<"u"&&window.crypto)n=new Uint8Array(e),window.crypto.getRandomValues(n);else{const i=require("crypto");n=new Uint8Array(i.randomBytes(e))}return Array.from(n).map(i=>t[i%t.length]).join("")}async initiateOAuth(e){const t=this.config.providers?.[e];if(!t){const n=`Provider '${e}' is not configured.`;return console.error(n),{success:!1,error:n}}if(typeof window<"u"&&t.clientSecret)if(e==="google"&&t.usePKCE)console.log(`Provider ${e} has client_secret configured - OK for Google with PKCE`);else{const n=`Client secret cannot be used in browser for ${e}`;return console.error(n),{success:!1,error:n}}try{const n=this.generateRandomString(32),i=Date.now();this.setItem(`oauth_state_${e}`,n),this.setItem(`oauth_state_timestamp_${e}`,i.toString());let s=t.authUrl;const o=new URLSearchParams({client_id:t.clientId,redirect_uri:t.redirectUri,response_type:"code",state:n});t.scope&&t.scope.length>0&&o.set("scope",t.scope.join(" ")),e==="google"&&(o.set("prompt","select_account"),o.set("access_type","offline"),o.set("include_granted_scopes","true"));const a=t.usePKCE??this.config.usePKCE??!0;if(!a&&typeof window<"u"){const c=`PKCE is required for ${e} in browser for security reasons`;return console.error(c),{success:!1,error:c}}if(a){console.log("PKCE is enabled, generating challenge...");const{codeVerifier:c,codeChallenge:u}=await this.generatePKCEChallenge();console.log(`Generated code verifier: ${c.substring(0,10)}... (length: ${c.length})`),console.log(`Generated code challenge: ${u.substring(0,10)}... (length: ${u.length})`),this.setItem(`oauth_verifier_${e}`,c),this.setItem(`oauth_verifier_timestamp_${e}`,i.toString()),console.log(`Saved code verifier to storage with key: oauth_verifier_${e}`),o.set("code_challenge",u),o.set("code_challenge_method","S256"),console.log("Added PKCE parameters to auth URL")}return s.includes("?")?s=`${s}&${o.toString()}`:s=`${s}?${o.toString()}`,this.emit("oauth_initiated",{provider:e,authUrl:s}),{success:!0,provider:e,authUrl:s}}catch(n){return console.error(`Error initiating OAuth with ${e}:`,n),{success:!1,error:n.message}}}async completeOAuth(e,t,n){const i=this.config.providers?.[e];if(!i){const s=`Provider '${e}' is not configured.`;return console.error(s),{success:!1,error:s}}try{const s=await this.exchangeCodeForToken(e,i,t,n);if(!s.access_token){const c="No access token received from provider";return console.error(c,s),{success:!1,error:c}}const o=await this.fetchUserInfo(e,i,s.access_token);this.cacheUserInfo(o.id,e,o);const a=await this.generateCredentials(o,e);return this.emit("oauth_completed",{provider:e,userInfo:o,credentials:a}),{success:!0,provider:e,userInfo:o}}catch(s){return console.error(`Error completing OAuth with ${e}:`,s),{success:!1,error:s.message}}}async generateCredentials(e,t){if(!this.config.providers?.[t])throw new Error(`Provider ${t} is not configured.`);const i=eb(t,e);try{console.log(`Generating credentials for ${t} user: ${e.id}`);const s=`${e.id}_${t}_${e.email||"no-email"}`,o=ie(de(s)),a=w4(o),c=await Ir(a,o,{includeP256:!0}),u={username:i,password:a,provider:t,key:c};return this.cacheUserInfo(e.id,t,e),console.log("OAuth credentials generated successfully"),u}catch(s){throw console.error("Error generating OAuth credentials:",s),s}}async exchangeCodeForToken(e,t,n,i){const s=this.getItem(`oauth_state_${e}`),o=this.getItem(`oauth_state_timestamp_${e}`);if(!i||!s||i!==s)throw this.removeItem(`oauth_state_${e}`),this.removeItem(`oauth_state_timestamp_${e}`),new Error("Invalid state parameter or expired");if(o){const f=parseInt(o,10),d=this.config.stateTimeout||600*1e3;if(Date.now()-f>d)throw this.removeItem(`oauth_state_${e}`),this.removeItem(`oauth_state_timestamp_${e}`),new Error("State parameter expired")}this.removeItem(`oauth_state_${e}`),this.removeItem(`oauth_state_timestamp_${e}`);const a={client_id:t.clientId,code:n,redirect_uri:t.redirectUri,grant_type:"authorization_code"};if(t.usePKCE??this.config.usePKCE){if(console.log("PKCE enabled, retrieving code verifier..."),typeof sessionStorage<"u"){const p=[];for(let h=0;h<sessionStorage.length;h++){const x=sessionStorage.key(h);x&&x.startsWith("oauth_")&&p.push(x)}console.log("OAuth keys in sessionStorage:",p)}const f=this.getItem(`oauth_verifier_${e}`),d=this.getItem(`oauth_verifier_timestamp_${e}`);if(console.log(`Looking for key: oauth_verifier_${e}, found:`,!!f),f&&d){const p=parseInt(d,10),h=this.config.stateTimeout||600*1e3;if(Date.now()-p>h)throw console.warn(`Code verifier expired for PKCE flow for ${e}`),this.removeItem(`oauth_verifier_${e}`),this.removeItem(`oauth_verifier_timestamp_${e}`),new Error("Code verifier expired");console.log(`Found code verifier for PKCE flow: ${f.substring(0,10)}... (length: ${f.length})`),a.code_verifier=f}else{console.warn("PKCE enabled but no code verifier found. Attempting fallback...");try{const{codeVerifier:p}=await this.generatePKCEChallenge();a.code_verifier=p,console.log("Generated fallback code verifier")}catch{throw new Error("PKCE enabled but no code verifier found and fallback failed")}}}else{if(typeof window<"u")throw new Error("PKCE is required for browser applications. Client secret cannot be used in browser.");if(t.clientSecret&&t.clientSecret.trim()!=="")a.client_secret=t.clientSecret,console.log("Using client_secret for server-side OAuth flow");else throw new Error("Client secret is required when PKCE is not enabled for server-side flows.")}e==="google"&&t.clientSecret&&t.clientSecret.trim()!==""&&(a.client_secret=t.clientSecret,console.log("Adding client_secret for Google OAuth (required even with PKCE)")),this.removeItem(`oauth_verifier_${e}`),this.removeItem(`oauth_verifier_timestamp_${e}`);const u=new URLSearchParams(a);console.log("Request body keys:",Array.from(u.keys()));const l=await fetch(t.tokenUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.toString()});if(!l.ok){const f=await l.json().catch(()=>({}));throw new Error(`Token exchange failed: ${l.status} ${l.statusText} - ${JSON.stringify(f)}`)}return await l.json()}async fetchUserInfo(e,t,n){const i=await fetch(t.userInfoUrl,{headers:{Authorization:`Bearer ${n}`}});if(!i.ok)throw new Error(`Failed to fetch user info: ${i.status} ${i.statusText}`);const s=await i.json();return this.normalizeUserInfo(s,e)}normalizeUserInfo(e,t){switch(t){case"google":return{id:e.id,email:e.email,name:e.name,picture:e.picture,provider:t};case"github":return{id:e.id.toString(),email:e.email,name:e.name||e.login,picture:e.avatar_url,provider:t};case"discord":return{id:e.id,email:e.email,name:e.username,picture:`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`,provider:t};case"twitter":return{id:e.data.id,email:e.data.email,name:e.data.name,picture:e.data.profile_image_url,provider:t};default:return{id:e.id?.toString()||"",email:e.email||"",name:e.name||"",picture:e.picture||e.avatar_url||"",provider:t}}}cacheUserInfo(e,t,n){const i=`${t}_${e}`,s={data:n,provider:t,userId:e,timestamp:Date.now()};this.userCache.set(i,s);try{if(typeof window<"u"&&typeof localStorage<"u"){const o={userId:n.id,provider:t,timestamp:Date.now()};localStorage.setItem(`shogun_oauth_user_${i}`,JSON.stringify(o))}}catch(o){console.warn("Failed to persist user info in localStorage:",o)}}getCachedUserInfo(e,t){const n=`${t}_${e}`,i=this.userCache.get(n);if(i&&this.config.cacheDuration&&Date.now()-i.timestamp<=this.config.cacheDuration)return i.data||null;try{if(typeof window<"u"&&typeof localStorage<"u"){const s=localStorage.getItem(`shogun_oauth_user_${n}`);if(s){const o=JSON.parse(s);if(this.config.cacheDuration&&Date.now()-o.timestamp<=this.config.cacheDuration)return this.userCache.set(n,o),o.userInfo}}}catch(s){console.warn("Failed to read user info from localStorage:",s)}return null}clearUserCache(e,t){if(e&&t){const n=`${t}_${e}`;this.userCache.delete(n);try{typeof window<"u"&&typeof localStorage<"u"&&localStorage.removeItem(`shogun_oauth_user_${n}`)}catch(i){console.warn("Failed to remove user info from localStorage:",i)}}else{this.userCache.clear();try{if(typeof window<"u"&&typeof localStorage<"u"){const n=[];for(let i=0;i<localStorage.length;i++){const s=localStorage.key(i);s&&s.startsWith("shogun_oauth_user_")&&n.push(s)}n.forEach(i=>localStorage.removeItem(i))}}catch(n){console.warn("Failed to clear user info from localStorage:",n)}}}cleanup(){this.removeAllListeners(),this.userCache.clear(),this.cleanupExpiredOAuthData()}cleanupExpiredOAuthData(){const e=this.config.stateTimeout||6e5,t=Date.now();if(typeof sessionStorage<"u"){const i=[];for(let s=0;s<sessionStorage.length;s++){const o=sessionStorage.key(s);if(o&&o.startsWith("oauth_state_timestamp_")){const a=sessionStorage.getItem(o);if(a){const c=parseInt(a,10);if(t-c>e){const u=o.replace("_timestamp","");i.push(o,u)}}}if(o&&o.startsWith("oauth_verifier_timestamp_")){const a=sessionStorage.getItem(o);if(a){const c=parseInt(a,10);if(t-c>e){const u=o.replace("_timestamp","");i.push(o,u)}}}}i.forEach(s=>sessionStorage.removeItem(s)),i.length>0&&console.log(`Cleaned up ${i.length} expired OAuth entries`)}const n=[];for(const[i,s]of this.memoryStorage.entries())if(i.startsWith("oauth_state_timestamp_")||i.startsWith("oauth_verifier_timestamp_")){const o=parseInt(s,10);if(t-o>e){const a=i.replace("_timestamp","");n.push(i,a)}}n.forEach(i=>this.memoryStorage.delete(i)),n.length>0&&console.log(`Cleaned up ${n.length} expired OAuth entries from memory`)}}class v4 extends Co{name="oauth";version="1.0.0";description="Provides OAuth authentication with external providers for ShogunCore";oauthConnector=null;config={};storage=null;constructor(e){super(),e&&(this.config=e)}initialize(e){this.core=e,this.storage=new wh,this.oauthConnector=new Za(this.config),this.validateOAuthSecurity()}validateOAuthSecurity(){if(!this.oauthConnector)return;const e=this.oauthConnector.getAvailableProviders();for(const t of e){const n=this.config.providers?.[t];if(n&&(!n.usePKCE&&typeof window<"u"&&console.warn(`[oauthPlugin] Provider ${t} non ha PKCE abilitato - non sicuro per browser`),n.clientSecret&&typeof window<"u")){if(t==="google"&&n.usePKCE)continue;throw console.error(`[oauthPlugin] Provider ${t} ha client_secret configurato nel browser - RIMUOVERE`),new Error(`Client secret non può essere usato nel browser per ${t}`)}}}configure(e){const t={...this.config.providers||{},...e?.providers||{}};if(this.config={...this.config,...e,providers:t},!this.oauthConnector)this.oauthConnector=new Za(this.config);else{const n=this.oauthConnector;typeof n.updateConfig=="function"?n.updateConfig(this.config):this.oauthConnector=new Za(this.config)}this.validateOAuthSecurity()}destroy(){if(this.oauthConnector){const e=this.oauthConnector;typeof e.cleanup=="function"&&e.cleanup()}this.oauthConnector=null,this.storage=null,super.destroy()}assertOAuthConnector(){if(this.assertInitialized(),!this.oauthConnector)throw new Error("OAuth connector not initialized");return this.oauthConnector}isSupported(){try{const e=this.assertOAuthConnector();return typeof e.isSupported=="function"?e.isSupported():!0}catch{return!1}}getAvailableProviders(){try{const e=this.assertOAuthConnector();return typeof e.getAvailableProviders=="function"?e.getAvailableProviders():[]}catch{return[]}}async initiateOAuth(e){return this.assertOAuthConnector().initiateOAuth(e)}async completeOAuth(e,t,n){return this.assertOAuthConnector().completeOAuth(e,t,n)}async generateCredentials(e,t){return this.assertOAuthConnector().generateCredentials(e,t)}async login(e){try{const t=this.assertInitialized();if(!e)throw Ae(Y.VALIDATION,"PROVIDER_REQUIRED","OAuth provider required for OAuth login");if(!this.isSupported())throw Ae(Y.ENVIRONMENT,"OAUTH_UNAVAILABLE","OAuth is not supported in this environment");if(!this.getAvailableProviders().includes(e))throw Ae(Y.VALIDATION,"PROVIDER_NOT_CONFIGURED",`Provider ${e} is not configured or available`);const i=await this.initiateOAuth(e);if(!i.success)throw Ae(Y.AUTHENTICATION,"OAUTH_INITIATION_FAILED",i.error||"Failed to initiate OAuth flow");return{success:!0,redirectUrl:i.authUrl,pendingAuth:!0,message:"Redirect to OAuth provider required to complete authentication",provider:e,authMethod:"oauth"}}catch(t){const n=t?.type||Y.AUTHENTICATION,i=t?.code||"OAUTH_LOGIN_ERROR",s=t?.message||"Unknown error during OAuth login";return Le.handle(n,i,s,t),{success:!1,error:s}}}async signUp(e){try{const t=this.assertInitialized();if(!e)throw Ae(Y.VALIDATION,"PROVIDER_REQUIRED","OAuth provider required for OAuth signup");if(!this.isSupported())throw Ae(Y.ENVIRONMENT,"OAUTH_UNAVAILABLE","OAuth is not supported in this environment");if(!this.getAvailableProviders().includes(e))throw Ae(Y.VALIDATION,"PROVIDER_NOT_CONFIGURED",`Provider ${e} is not configured or available`);const i=await this.initiateOAuth(e);if(!i.success)throw Ae(Y.AUTHENTICATION,"OAUTH_INITIATION_FAILED",i.error||"Failed to initiate OAuth flow");return{success:!0,redirectUrl:i.authUrl,pendingAuth:!0,message:"Redirect to OAuth provider required to complete registration",provider:e,authMethod:"oauth"}}catch(t){const n=t?.type||Y.AUTHENTICATION,i=t?.code||"OAUTH_SIGNUP_ERROR",s=t?.message||"Unknown error during OAuth signup";return Le.handle(n,i,s,t),{success:!1,error:s}}}async handleOAuthCallback(e,t,n){try{const i=this.assertInitialized();if(!t||!n)throw new Error("Authorization code and state parameter are required");const s=await this.completeOAuth(e,t,n);if(!s.success||!s.userInfo)throw new Error(s.error||"Failed to complete OAuth flow");const o=await this.generateCredentials(s.userInfo,e);i.setAuthMethod("oauth");const a=await this._loginOrSignUp(o.username,o.key);if(a.success){i.user&&await i.user.put({oauth:{provider:e,id:s.userInfo.id,email:s.userInfo.email,name:s.userInfo.name,picture:s.userInfo.picture,lastLogin:Date.now()}});const c=a.isNewUser?"auth:signup":"auth:login";return i.emit(c,{userPub:a.userPub||"",username:o.username,method:"oauth",provider:e}),this.cleanupExpiredOAuthData(),{...a,sea:a.sea,user:{userPub:a.userPub,username:o.username,email:s.userInfo.email,name:s.userInfo.name||s.userInfo.email||`OAuth User (${e})`,picture:s.userInfo.picture,oauth:{provider:e,id:s.userInfo.id,email:s.userInfo.email,name:s.userInfo.name,picture:s.userInfo.picture,lastLogin:Date.now()}}}}return a}catch(i){return this.cleanupExpiredOAuthData(),{success:!1,error:i.message||"Failed to handle OAuth callback"}}}cleanupExpiredOAuthData(){if(this.oauthConnector){const e=this.oauthConnector;typeof e.clearUserCache=="function"&&e.clearUserCache()}}async _loginOrSignUp(e,t){if(!this.core)return{success:!1,error:"Shogun core not available"};const n=await this.core.login(e,"",t);if(n.success)return n.isNewUser=!1,this.core.user&&this.core.user._?.sea&&(n.sea=this.core.user._.sea),n;const i=await this.core.signUp(e,void 0,t);if(i.success){const s=await this.core.login(e,"",t);return s.success?(s.isNewUser=!0,this.core.user&&this.core.user._?.sea&&(s.sea=this.core.user._.sea),s):{success:!1,error:s.error||"Login failed after successful signup."}}return i}}var Di=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function pf(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Js={exports:{}};Js.exports;var Ud;function Pn(){return Ud||(Ud=1,(function(r){(function(){function e(n,i){return i?pf(n):n.slice?e[s(n)]:function(o,a){n(o={exports:{}}),e[s(a)]=o.exports};function s(o){return o.split("/").slice(-1).toString().replace(".js","")}}var t=r;e(function(n){String.random=function(s,o){var a="";for(s=s||24,o=o||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";s-- >0;)a+=o.charAt(Math.floor(Math.random()*o.length));return a},String.match=function(s,o){var a,c;return typeof s!="string"?!1:(typeof o=="string"&&(o={"=":o}),o=o||{},a=o["="]||o["*"]||o[">"]||o["<"],s===a?!0:c!==o["="]?!1:(a=o["*"]||o[">"],s.slice(0,(a||"").length)===a?!0:c!==o["*"]?!1:c!==o[">"]&&c!==o["<"]?s>=o[">"]&&s<=o["<"]:c!==o[">"]&&s>=o[">"]||c!==o["<"]&&s<=o["<"]))},String.hash=function(s,o){if(typeof s=="string"){if(o=o||0,!s.length)return o;for(var a=0,c=s.length,u;a<c;++a)u=s.charCodeAt(a),o=(o<<5)-o+u,o|=0;return o}};var i=Object.prototype.hasOwnProperty;Object.plain=function(s){return s?s instanceof Object&&s.constructor===Object||Object.prototype.toString.call(s).match(/^\[object (\w+)\]$/)[1]==="Object":!1},Object.empty=function(s,o){for(var a in s)if(i.call(s,a)&&(!o||o.indexOf(a)==-1))return!1;return!0},Object.keys=Object.keys||function(s){var o=[];for(var a in s)i.call(s,a)&&o.push(a);return o},(function(){var s,o=setTimeout,a=0,c=0,u=typeof setImmediate!=""+s&&setImmediate||(function(f,d){return typeof MessageChannel==""+s?o:((f=new MessageChannel).port1.onmessage=function(p){p.data==""&&d()},function(p){d=p,f.port2.postMessage("")})})(),l=o.check=o.check||typeof performance!=""+s&&performance||{now:function(){return+new Date}};o.hold=o.hold||9,o.poll=o.poll||function(f){if(o.hold>=l.now()-a&&c++<3333){f();return}u(function(){a=l.now(),f()},c=0)}})(),(function(){var s=setTimeout,o=s.turn=s.turn||function(d){a.push(d)==1&&c(f)},a=o.s=[],c=s.poll,u=0,l,f=function(){(l=a[u++])&&l(),(u==a.length||u==99)&&(a=o.s=a.slice(u),u=0),a.length&&c(f)}})(),(function(){var s,o=setTimeout,a=o.turn;(o.each=o.each||function(c,u,l,f){f=f||9,(function d(p,h,x){if(h=(p=(c||[]).splice(0,f)).length){for(var b=0;b<h&&s===(x=u(p[b]));b++);if(s===x){a(d);return}}l&&l(x)})()})()})()})(e,"./shim"),e(function(n){n.exports=function i(l,o,a){if(!l)return{to:i};var c,u=typeof o=="function",l=(this.tag||(this.tag={}))[l]||u&&(this.tag[l]={tag:l,to:i._={next:function(d){var p;(p=this.to)&&p.next(d)}}});if(u){var f={off:i.off||(i.off=function(){if(this.next===i._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=i._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:i._,next:o,the:l,on:this,as:a};return(f.back=l.last||l).to=f,l.last=f}return(l=l.to)&&c!==o&&l.next(o),l}})(e,"./onto"),e(function(n){var i=setTimeout,s=i.Book||(i.Book=function(S){var N=function(E,y){var k=N.all[E],C;return y===void 0?k&&k.is||N.get(k||E):k?((C=k.page)&&(C.size+=w(y)-w(k.is),C.text=""),k.text="",k.is=y,N):N.set(E,y)};return N.list=[{from:S,size:(S||"").length,substring:A,toString:v,book:N,get:N,read:d}],N.page=a,N.set=p,N.get=c,N.all={},N}),o=2**12;function a(S){var N=this,O=N.list,E=l(S,O,N.parse),y=O[E];return typeof y=="string"&&(O[E]=y={size:-1,first:N.parse?N.parse(y):y,substring:A,toString:v,book:N,get:N,read:d}),y}function c(S){if(S){if(S.is!==void 0)return S.is;var N=this,E=N.all[S];if(E)return E.is;var O=N.page(S),E;if(!(!O||!O.from))return u(S,O)}}function u(S,N){var O=N.book,E,y,k,C;if((E=f(N))&&(y=E[u.i=C=l(S,E,s.decode)]),y&&S==y.word||(typeof y!="string"&&(y=E[u.i=C+=1]),y&&S==y.word))return(O.all[S]=y).is;if(k=x(y),!(S!=s.decode(k[0])&&(y=E[u.i=C+=1],k=x(y),S!=s.decode(k[0]))))return y=E[C]=O.all[S]={word:""+S,is:s.decode(k[1]),page:N,substring:m,toString:g},y.is}function l(S,N,O){O=O||l.no||(l.no=function(R){return R});var E=N,y=0,k;(S=""+S).length;for(var C=E.length,U=C/2;(S<(k=(O(E[U=U>>0])||"").substring())||(O(E[U+1])||"").substring()<=S)&&U!=y;)U+=k<=S?(C-(y=U))/2:-((C=U)-y)/2;return U}function f(S,N,O){return typeof S.from!="string"?S.from:(O=S.from=x(N=N||S.from||""),O)}function d(S){S=S||function(C){return C};for(var N=0,O=P(this),E,y=[],k=this.book.parse||function(){};E=O[N++];)y.push(S(this.get(E=E.word||k(E)||E),E,this));return y}function p(S,N){var O=this,E=O.all[S];if(E)return O(S,N);var y=O.page(S=""+S);return y&&y.from&&(O.get(S),O.all[S])?O(S,N):(E=O.all[S]={word:S,is:N,page:y,substring:m,toString:g},y.first=y.first<S?y.first:S,y.limbo||(y.limbo=[]),y.limbo.push(E),O(S,N),y.size+=w(S)+w(N),(O.PAGE||o)<y.size&&h(y,O),O)}function h(S,N){for(var O=P(S),E=O.length,y=E/2>>0,k=y,C=O[k],U,R={first:C.substring(),size:0,substring:A,toString:v,book:N,get:N,read:d},B=R.from=[];U=O[y++];)B.push(U),R.size+=(U.is||"").length||1,U.page=R;S.from=S.from.slice(0,k),S.size-=R.size,N.list.splice(l(R.first,N.list)+1,0,R),N.split&&N.split(R,S)}function x(S){return b((S=S||"").substring(1,S.length-1).split(S[0]),S[0])}s.slot=x;function b(S,N){var O,E;return 0>(O=S.indexOf(""))?S:S[0]==""&&S.length==1?[]:(E=O+2+parseInt((E=S[O+1]).substring(0,E.indexOf('"'))||E))!=E?[]:(S[O]=S.slice(O,E).join(N||"|"),S.slice(0,O+1).concat(b(S.slice(E),N)))}function w(S){return(S||"").length||1}function m(S,N){return this.word}function g(){return this.text=this.text||":"+s.encode(this.word)+":"+s.encode(this.is)+":"}function A(S,N){return(this.first||this.word||s.decode((f(this)||"")[0]||"")).substring(S,N)}function v(){return this.text=this.text||T(this)}function T(S){return S.limbo&&P(S),typeof S.from=="string"?S.from:"|"+(S.from||[]).join("|")+"|"}function P(S,N){var O=S.from=typeof S.from=="string"?x(S.from):S.from||[];return(N=N||S.limbo)?I(S).sort(function(E,y){return(E.word||s.decode(""+E))<(y.word||s.decode(""+y))?-1:1}):O}function I(S,N){N=N||S.limbo||[],S.limbo=null;for(var O=0,E,y=S.from;E=N[O++];)u(E.word,S)?y[u.i]=E:y.push(E);return y}s.encode=function(S,N,O){switch(N=N||"|",O=O||" ",typeof S){case"string":for(var k=S.indexOf(N),E=0;k!=-1;)E++,k=S.indexOf(N,k+1);return(E?N+E:"")+'"'+S;case"number":return S<0?""+S:"+"+S;case"boolean":return S?"+":"-";case"object":if(!S)return" ";for(var y=Object.keys(S).sort(),k=0,C=N,U;U=y[k++];)C+=O+s.encode(U,N,O)+O+s.encode(S[U],N,O)+O+N;return C}},s.decode=function(S,N){if(typeof S=="string"){switch(S){case" ":return null;case"-":return!1;case"+":return!0}switch(S[0]){case"-":case"+":return parseFloat(S);case'"':return S.slice(1)}return S.slice(S.indexOf('"')+1)}},s.hash=function(S,N){if(typeof S=="string"){if(N=N||0,!S.length)return N;for(var O=0,E=S.length,y;O<E;++O)y=S.charCodeAt(O),N=(N<<5)-N+y,N|=0;return N}};try{n.exports=s}catch{}})(e,"./book"),e(function(n){n.exports=function(i){return i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"&&i!=1/0&&i!=-1/0&&i===i||!!i&&typeof i["#"]=="string"&&Object.keys(i).length===1&&i["#"]}})(e,"./valid"),e(function(n){e("./shim");function i(){var l=+new Date;return c<l?(o=0,c=l+i.drift):c=l+(o+=1)/a+i.drift}i.drift=0;var s=-1/0,o=0,a=999,c=s,u;i.is=function(l,f,d){var p=f&&l&&l._&&l._[">"]||d;if(p)return typeof(p=p[f])=="number"?p:s},i.ify=function(l,f,d,p,h){(l=l||{})._=l._||{},h&&(l._["#"]=h);var x=l._[">"]||(l._[">"]={});return u!==f&&f!=="_"&&(typeof d=="number"&&(x[f]=d),u!==p&&(l[f]=p)),l},n.exports=i})(e,"./state"),e(function(n){e("./shim");function i(s){var o={s:{}},a=o.s;s=s||{max:999,age:1e3*9},o.check=function(u){return a[u]?c(u):!1};var c=o.track=function(u){var l=a[u]||(a[u]={});return l.was=o.now=+new Date,o.to||(o.to=setTimeout(o.drop,s.age+9)),c.ed&&c.ed(u),l};return o.drop=function(u){o.to=null,o.now=+new Date;var l=Object.keys(a);console.STAT&&console.STAT(o.now,+new Date-o.now,"dup drop keys"),setTimeout.each(l,function(f){var d=a[f];d&&(u||s.age)>o.now-d.was||delete a[f]},0,99)},o}n.exports=i})(e,"./dup"),e(function(n){e("./onto"),n.exports=function(o,a){if(this.on){var c=(this.opt||{}).lack||9e3;if(typeof o!="function"){if(!o)return;var l=o["#"]||o,u=(this.tag||"")[l];return u?(a&&(u=this.on(l,a),clearTimeout(u.err),u.err=setTimeout(function(){u.off()},c)),!0):void 0}var l=a&&a["#"]||i(9);if(!o)return l;var f=this.on(l,o,a);return f.err=f.err||setTimeout(function(){f.off(),f.next({err:"Error: No ACK yet.",lack:!0})},c),l}};var i=String.random||function(){return Math.random().toString(36).slice(2)}})(e,"./ask"),e(function(n){function i(h){return h instanceof i?(this._={$:this}).$:this instanceof i?i.create(this._={$:this,opt:h}):new i(h)}i.is=function(h){return h instanceof i||h&&h._&&h===h._.$||!1},i.version=.202,i.chain=i.prototype,i.chain.toJSON=function(){},e("./shim"),i.valid=e("./valid"),i.state=e("./state"),i.on=e("./onto"),i.dup=e("./dup"),i.ask=e("./ask"),(function(){i.create=function(y){y.root=y.root||y,y.graph=y.graph||{},y.on=y.on||i.on,y.ask=y.ask||i.ask,y.dup=y.dup||i.dup();var k=y.$.opt(y.opt);return y.once||(y.on("in",h,y),y.on("out",h,y),y.on("put",w,y),i.on("create",y),y.on("create",y)),y.once=1,k};function h(y){if(y){if(y.out===h){this.to.next(y);return}var k=this,C=k.as,U=C.at||C,R=U.$,B=U.dup,L,D=y.DBG;if((L=y["#"])||(L=y["#"]=o(9)),!B.check(L)){if(B.track(L),L=y._,y._=typeof L=="function"?L:function(){},y.$&&y.$===(y.$._||"").$||(y.$=R),y["@"]&&!y.put&&g(y),!U.ask(y["@"],y))if(D&&(D.u=+new Date),y.put){x(y);return}else y.get&&i.on.get(y,R);D&&(D.uc=+new Date),k.to.next(y),D&&(D.ua=+new Date),!(y.nts||y.NTS)&&(y.out=h,U.on("out",y),D&&(D.ue=+new Date))}}}function x(y){if(y){var k=y._||"",C=k.root=((k.$=y.$||"")._||"").root;if(y["@"]&&k.faith&&!k.miss){y.out=h,C.on("out",y);return}k.latch=C.hatch,k.match=C.hatch=[];var U=y.put,R=k.DBG=y.DBG,B=+new Date;if(O=O||B,!(U["#"]&&U["."])){R&&(R.p=B),k["#"]=y["#"],k.msg=y,k.all=0,k.stun=1;var L=Object.keys(U);console.STAT&&console.STAT(B,((R||k).pk=+new Date)-B,"put sort");var D=0,M,$,j,J,H,Q,Z;(function se(re){if(M!=D){if(M=D,!(j=L[D])){console.STAT&&console.STAT(B,((R||k).pd=+new Date)-B,"put"),m(k);return}(J=U[j])?(Z=J._)?j!==Z["#"]?Q=v+T(j)+"soul not same.":(H=Z[">"])||(Q=v+T(j)+"no state."):Q=v+T(j)+"no meta.":Q=v+T(j)+"no node.",$=Object.keys(J||{})}if(Q){y.err=k.err=Q,m(k);return}var ce=0,Te;for(re=re||0;re++<9&&(Te=$[ce++]);)if(Te!=="_"){var ye=J[Te],Je=H[Te];if(f===Je){Q=v+T(Te)+"on"+T(j)+"no state.";break}if(!c(ye)){Q=v+T(Te)+"on"+T(j)+"bad "+typeof ye+T(ye);break}b(ye,Te,j,Je,y),++N}if(($=$.slice(ce)).length){a(se);return}++D,$=null,se(re)})()}}}i.on.put=x;function b(y,k,C,U,R){var B=R._||"",L=B.root,D=L.graph,M,$=D[C]||d,j=u($,k,1),J=$[k],H=B.DBG;(M=console.STAT)&&(!D[C]||!J)&&(M.has=(M.has||0)+1);var Q=S();if(U>Q){setTimeout(function(){b(y,k,C,U,R)},(M=U-Q)>I?I:M),console.STAT&&console.STAT((H||B).Hf=+new Date,M,"future");return}if(!(U<j)&&!(!B.faith&&U===j&&(y===J||P(y)<=P(J))&&!B.miss)){B.stun++;var Z=R["#"]+B.all++,se={toString:function(){return Z},_:B};se.toJSON=se.toString,L.dup.track(se)["#"]=R["#"],H&&(H.ph=H.ph||+new Date),L.on("put",{"#":se,"@":R["@"],put:{"#":C,".":k,":":y,">":U},ok:R.ok,_:B})}}function w(y){var k;(k=(y._||"").DBG)&&(k.pa=+new Date,k.pm=k.pm||+new Date);var C=this,U=C.as,R=U.graph,B=y._,L=y.put,D=L["#"],M=L["."],$=L[":"],j=L[">"];y["#"];var J;(J=B.msg)&&(J=J.put)&&(J=J[D])&&l(J,M,j,$,D),R[D]=l(R[D],M,j,$,D),(J=(U.next||"")[D])&&J.on("in",y),m(B),C.to.next(y)}function m(y,k){var C;if(!y.stop&&!(!y.err&&0<--y.stun)&&(y.stop=1,!!(C=y.root))){var U=y.match;U.end=1,U===C.hatch&&(!(U=y.latch)||U.end?delete C.hatch:C.hatch=U),y.hatch&&y.hatch(),setTimeout.each(y.match,function(R){R&&R()}),!(!(k=y.msg)||y.err||k.err)&&(k.out=h,y.root.on("out",k),E())}}function g(y){var k=y["@"]||"",C;if(!(C=k._)){var U=(U=y.$)&&(U=U._)&&(U=U.root)&&(U=U.dup);if(!(U=U.check(k)))return;y["@"]=U["#"]||y["@"];return}C.acks=(C.acks||0)+1,(C.err=y.err)&&(y["@"]=C["#"],m(C)),C.ok=y.ok||C.ok,!C.stop&&!C.crack&&(C.crack=C.match&&C.match.push(function(){A(C)})),A(C)}function A(y){!y||!y.root||y.stun||y.acks!==y.all||y.root.on("in",{"@":y["#"],err:y.err,ok:y.err?f:y.ok||{"":1}})}var v="Error: Invalid graph!",T=function(y){return" '"+(""+y).slice(0,9)+"...' "},P=JSON.stringify,I=2147483647,S=i.state,N=0,O,E=function(){N>999&&N/-(O-(O=+new Date))>1&&(i.window&&console.log("Warning: You're syncing 1K+ records a second, faster than DOM can update - consider limiting query."),E=function(){N=0})}})(),(function(){i.on.get=function(x,b){var w=b._,m=x.get,g=m["#"],A=w.graph[g],v=m["."],T=w.next||(w.next={}),P=T[g],I=x._||{},S=I.DBG=x.DBG;if(S&&(S.g=+new Date),!A)return w.on("get",x);if(v){if((typeof v!="string"||f===A[v])&&!((P||"").next||"")[v]){w.on("get",x);return}A=l({},v,u(A,v),A[v],g)}A&&h(x,A),w.on("get",x)};function h(x,b){var w=+new Date,m=x._||{},g=m.DBG=x.DBG,A=x["#"],v=o(9),T=Object.keys(b||"").sort(),P=((b||"")._||"")["#"];T.length;var I=x.$._.root,S=b===I.graph[P];console.STAT&&console.STAT(w,((g||m).gk=+new Date)-w,"got keys"),b&&(function N(){w=+new Date;for(var O=0,E,y={},k;O<9&&(E=T[O++]);)l(y,E,u(b,E),b[E],P);T=T.slice(O),(k={})[P]=y,y=k;var C;S&&(C=function(){},C.ram=C.faith=!0),k=T.length,console.STAT&&console.STAT(w,-(w-(w=+new Date)),"got copied some"),g&&(g.ga=+new Date),I.on("in",{"@":A,"#":v,put:y,"%":k?v=o(9):f,$:I.$,_:C,DBG:g}),console.STAT&&console.STAT(w,+new Date-w,"got in"),k&&setTimeout.turn(N)})(),b||I.on("in",{"@":x["#"]})}i.on.get.ack=h})(),(function(){i.chain.opt=function(h){h=h||{};var x=this,b=x._,w=h.peers||h;return Object.plain(h)||(h={}),Object.plain(b.opt)||(b.opt=h),typeof w=="string"&&(w=[w]),Object.plain(b.opt.peers)||(b.opt.peers={}),w instanceof Array&&(h.peers={},w.forEach(function(m){var g={};g.id=g.url=m,h.peers[m]=b.opt.peers[m]=b.opt.peers[m]||g})),s(h,function m(g){var A=this[g];if(this&&this.hasOwnProperty(g)||typeof A=="string"||Object.empty(A)){this[g]=A;return}A&&A.constructor!==Object&&!(A instanceof Array)||s(A,m)}),b.opt.from=h,i.on("opt",b),b.opt.uuid=b.opt.uuid||function(g){return i.state().toString(36).replace(".","")+String.random(g||12)},x}})();var s=function(h,x){Object.keys(h).forEach(x,h)},o=String.random,a=setTimeout.turn,c=i.valid,u=i.state.is,l=i.state.ify,f,d={},p;i.log=function(){return!i.log.off&&p.log.apply(p,arguments),[].slice.call(arguments).join(" ")},i.log.once=function(h,x,b){return(b=i.log.once)[h]=b[h]||0,b[h]++||i.log(x)},typeof window<"u"&&((window.GUN=window.Gun=i).window=window);try{typeof t<"u"&&(t.exports=i)}catch{}n.exports=i,(i.window||{}).console=(i.window||{}).console||{log:function(){}},(p=console).only=function(h,x){return p.only.i&&h===p.only.i&&p.only.i++&&(p.log.apply(p,arguments)||x)},i.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(e,"./root"),e(function(n){var i=e("./root");i.chain.back=function(a,c){var u;if(a=a||1,a===-1||a===1/0)return this._.root.$;if(a===1)return(this._.back||this._).$;var l=this,f=l._;if(typeof a=="string"&&(a=a.split(".")),a instanceof Array){var d=0,p=a.length,u=f;for(d;d<p;d++)u=(u||s)[a[d]];return o!==u?c?l:u:(u=f.back)?u.$.back(a,c):void 0}if(typeof a=="function"){for(var h,u={back:f};(u=u.back)&&o===(h=a(u,c)););return h}return typeof a=="number"?(f.back||f).$.back(a-1):this};var s={},o})(e,"./back"),e(function(n){var i=e("./root");i.chain.chain=function(m){var g=this,A=g._,v=new(m||g).constructor(g),T=v._,P;return T.root=P=A.root,T.id=++P.once,T.back=g._,T.on=i.on,T.on("in",i.on.in,T),T.on("out",i.on.out,T),v};function s(m){var g,A=this.as,v=A.back,T=A.root,P;if(m.$||(m.$=A.$),this.to.next(m),A.err){A.on("in",{put:A.put=f,$:A.$});return}if(g=m.get){if(T.pass&&(T.pass[A.id]=A),A.lex&&Object.keys(A.lex).forEach(function(I){P[I]=A.lex[I]},P=m.get=m.get||{}),g["#"]||A.soul){if(g["#"]=g["#"]||A.soul,m["#"]||(m["#"]=d(9)),v=T.$.get(g["#"])._,g=g["."]){if(h(v.put,g)&&(P=v.ask&&v.ask[g],(v.ask||(v.ask={}))[g]=v.$.get(g)._,v.on("in",{get:g,put:{"#":v.soul,".":g,":":v.put[g],">":b(T.graph[v.soul],g)}}),P))return}else{if(P=v.ask&&v.ask[""],(v.ask||(v.ask={}))[""]=v,f!==v.put&&(v.on("in",v),P))return;m.$=v.$}return T.ask(u,m),T.on("in",m)}if(g["."])return A.get?(m={get:{".":A.get},$:A.$},(v.ask||(v.ask={}))[A.get]=m.$._,v.on("out",m)):(m={get:A.lex?m.get:{},$:A.$},v.on("out",m));if((A.ask||(A.ask={}))[""]=A,A.get)return g["."]=A.get,(v.ask||(v.ask={}))[A.get]=m.$._,v.on("out",m)}return v.on("out",m)}i.on.out=s;function o(m,g){g=g||this.as;var A=g.root,v=m.$||(m.$=g.$),T=(v||"")._||l,P=m.put||"",I=P["#"],S=P["."],N=f!==P["="]?P["="]:P[":"],O=P[">"]||-1/0,E;if(f!==m.put&&(f===P["#"]||f===P["."]||f===P[":"]&&f===P["="]||f===P[">"])){if(!p(P)){if(!(I=((P||"")._||"")["#"])){console.log("chain not yet supported for",P,"...",m,g);return}return v=g.root.$.get(I),setTimeout.each(Object.keys(P).sort(),function(y){y=="_"||f===(O=b(P,y))||g.on("in",{$:v,put:{"#":I,".":y,"=":P[y],">":O},VIA:m})})}g.on("in",{$:T.back.$,put:{"#":I=T.back.soul,".":S=T.has||T.get,"=":P,">":b(T.back.put,S)},via:m});return}(m.seen||"")[g.id]||((m.seen||(m.seen=function(){}))[g.id]=g,g!==T&&(Object.keys(m).forEach(function(y){P[y]=m[y]},P={}),P.get=g.get||P.get,!g.soul&&!g.has?P.$$$=P.$$$||g.$:T.soul&&(P.$=g.$,P.$$=P.$$||T.$),m=P),c(m,g),(g.soul||m.$$)&&O>=b(A.graph[I],S)&&((P=A.$.get(I)._).put=w(P.put,S,O,N,I)),!T.soul&&O>=b(A.graph[I],S)&&(E=(A.$.get(I)._.next||"")[S])&&(E.put=N,typeof(P=p(N))=="string"&&(E.put=A.$.get(P)._.put||N)),this.to&&this.to.next(m),g.any&&setTimeout.each(Object.keys(g.any),function(y){(y=g.any[y])&&y(m)},0,99),g.echo&&setTimeout.each(Object.keys(g.echo),function(y){(y=g.echo[y])&&y.on("in",m)},0,99),((m.$$||"")._||T).soul&&(E=g.next)&&(E=E[S])&&(P={},Object.keys(m).forEach(function(y){P[y]=m[y]}),P.$=(m.$$||m.$).get(P.get=S),delete P.$$,delete P.$$$,E.on("in",P)),a(m,g))}i.on.in=o;function a(m,g){if(g=g||this.as||m.$._,!(m.$$&&this!==i.on)&&!(!m.put||g.soul)){var A=m.put||"",v=A["="]||A[":"],S,T=g.root,P=T.$.get(A["#"]).get(A["."])._;if(typeof(v=p(v))!="string"){this===i.on&&((P.echo||(P.echo={}))[g.id]=g);return}if(!((P.echo||(P.echo={}))[g.id]&&!(T.pass||"")[g.id])){if(S=T.pass){if(S[v+g.id])return;S[v+g.id]=1}(P.echo||(P.echo={}))[g.id]=g,g.has&&(g.link=v);var I=T.$.get(P.link=v)._;(I.echo||(I.echo={}))[P.id]=P;var S=g.ask||"";(S[""]||g.lex)&&I.on("out",{get:{"#":v}}),setTimeout.each(Object.keys(S),function(N,O){!N||!(O=S[N])||O.on("out",{get:{"#":v,".":N}})},0,99)}}}i.on.link=a;function c(m,g){var A=m.put||"",v=f!==A["="]?A["="]:A[":"],T=g.root,P,I;if(f===v){if(g.soul&&f!==g.put||(I=(m.$$||m.$||"")._||"",m["@"]&&(f!==I.put||f!==g.put)))return;(P=g.link||m.linked)&&delete(T.$.get(P)._.echo||"")[g.id],g.has&&(g.link=null),g.put=f,setTimeout.each(Object.keys(g.next||""),function(S,N){(N=g.next[S])&&(P&&delete(T.$.get(P).get(S)._.echo||"")[N.id],N.on("in",{get:S,put:f,$:N.$}))},0,99);return}g.soul||m.$$||(P=p(v),I=m.$._||"",!((P===I.link||g.has&&!I.link)&&!((T.pass||"")[g.id]&&typeof P!="string"))&&(delete(I.echo||"")[g.id],c({get:g.get,put:f,$:m.$,linked:m.linked=m.linked||I.link},g)))}i.on.unlink=c;function u(m,g){var A=this.as,v=A.$._;v.root;var T=A.get||"",P=(m.put||"")[T["#"]]||"";if(!m.put||typeof T["."]=="string"&&f===P[T["."]]){if(f!==v.put||!v.soul&&!v.has)return;v.ack=(v.ack||0)+1,v.on("in",{get:v.get,put:v.put=f,$:v.$,"@":m["@"]});return}(m._||{}).miss=1,i.on.put(m)}var l={},f,d=String.random,p=i.valid,h=function(m,g){return m&&Object.prototype.hasOwnProperty.call(m,g)},x=i.state,b=x.is,w=x.ify})(e,"./chain"),e(function(n){var i=e("./root");i.chain.get=function(f,d,p){var h,x;if(typeof f=="string"){if(f.length==0)return(h=this.chain())._.err={err:i.log("0 length key!",f)},d&&d.call(h,h._.err),h;var b=this,w=b._,m=w.next||c;(h=m[f])||(h=f&&s(f,b)),h=h&&h.$}else if(typeof f=="function"){let S=function(N,O,E){if(!S.stun&&!((B=A.pass)&&!B[v])){var y=N.$._,k=(N.$$||"")._,C=(k||y).put,U=!y.has&&!y.soul,R={},B;if((U||l===C)&&(C=l===((B=N.put)||"")["="]?l===(B||"")[":"]?B:B[":"]:B["="]),typeof(B=i.valid(C))=="string"&&(C=l===(B=A.$.get(B)._.put)?g.not?l:C:B),!(g.not&&l===C)){if(l===g.stun){if((B=A.stun)&&B.on&&(w.$.back(function(L){if(B.on(""+L.id,R={}),(R.run||0)<S.id)return R}),!R.run&&B.on(""+y.id,R={}),!R.run&&k&&B.on(""+k.id,R={}),S.id>R.run&&((!R.stun||R.stun.end)&&(R.stun=B.on("stun"),R.stun=R.stun&&R.stun.last),R.stun&&!R.stun.end))){(R.stun.add||(R.stun.add={}))[v]=function(){S(N,O,1)};return}if(l===C&&(E=0),(B=A.hatch)&&!B.end&&l===g.hatch&&!E){if(T[y.$._.id])return;T[y.$._.id]=1,B.push(function(){S(N,O,1)});return}T={}}if(A.pass){if(A.pass[v+y.id])return;A.pass[v+y.id]=1}if(g.on){g.ok.call(y.$,C,y.get,N,O||S);return}if(g.v2020){g.ok(N,O||S);return}Object.keys(N).forEach(function(L){B[L]=N[L]},B={}),N=B,N.put=C,g.ok.call(g.as,N,O||S)}}};var P=S;if(d===!0)return o(this,f,d,p),this;h=this;var w=h._,g=d||{},A=w.root,v;g.at=w,g.ok=f;var T={};return S.at=w,(w.any||(w.any={}))[v=String.random(7)]=S,S.off=function(){S.stun=1,w.any&&delete w.any[v]},S.rid=a,S.id=g.run||++A.once,x=A.pass,(A.pass={})[v]=1,g.out=g.out||{get:{}},w.on("out",g.out),A.pass=x,h}else{if(typeof f=="number")return this.get(""+f,d,p);if(typeof(x=u(f))=="string")return this.get(x,d,p);(x=this.get.next)&&(h=x(this,f))}return h?(d&&typeof d=="function"&&h.get(d,p),h):((h=this.chain())._.err={err:i.log("Invalid get request!",f)},d&&d.call(h,h._.err),h)};function s(f,d){var p=d._,h=p.next,x=d.chain(),b=x._;return h||(h=p.next={}),h[b.get=f]=b,d===p.root.$?b.soul=f:(p.soul||p.has)&&(b.has=f),b}function o(f,d,p,h){var x=f._,b=0,w;return(w=x.soul||x.link)?d(w,h,x):x.jam?x.jam.push([d,h]):(x.jam=[[d,h]],f.get(function(g,A){if(!(l===g.put&&!x.root.opt.super&&(w=Object.keys(x.root.opt.peers).length)&&++b<=w)){A.rid(g);var v=(v=g.$)&&v._||{},T=0,P;for(w=x.jam,delete x.jam;P=w[T++];){var I=P[0];P=P[1],I&&I(v.link||v.soul||i.valid(g.put)||((g.put||{})._||{})["#"],P,g,A)}}},{out:{get:{".":!0}}}),f)}function a(f){var d=this.at||this.on;if(!f||d.soul||d.has)return this.off();if(f=(f=(f=f.$||f)._||f).id){d.map;var p;if((p=this.seen||(this.seen={}))[f])return!0;p[f]=!0}}var c={},u=i.valid,l})(e,"./get"),e(function(n){var i=e("./root");i.chain.put=function(h,x,b){var w=this,m=w._,g=m.root;b=b||{},b.root=m.root,b.run||(b.run=g.once),s(b,m.id),b.ack=b.ack||x,b.via=b.via||w,b.data=b.data||h,b.soul||(b.soul=m.soul||typeof x=="string"&&x);var A=b.state=b.state||i.state();return typeof h=="function"?(h(function(v){b.data=v,w.put(u,u,b)}),w):b.soul?(b.$=g.$.get(b.soul),b.todo=[{it:b.data,ref:b.$}],b.turn=b.turn||f,b.ran=b.ran||o,(function v(){var T=b.todo,P=T.pop(),I=P.it;P.ref&&P.ref._.id;var S,N,O,E,y;if(s(b,P.ref),(E=P.todo)&&(N=E.pop(),I=I[N],E.length&&T.push(P)),N&&(T.path||(T.path=[])).push(N),!(S=d(I))&&!(y=i.is(I))){if(!Object.plain(I)){o.err(b,"Invalid data: "+c(I)+" at "+(b.via.back(function(B){B.get&&E.push(B.get)},E=[])||E.join("."))+"."+(T.path||[]).join("."));return}for(var k=b.seen||(b.seen=[]),C=k.length;C--;)if(I===(E=k[C]).it){S=I=E.link;break}}if(N&&S)P.node=p(P.node,N,A,I);else{let B=function(L,D){var M=O.link["#"];D&&(D.off(),D.rid(L));var $=M||L.soul||(E=(L.$$||L.$)._||"").soul||E.link||((E=E.put||"")._||"")["#"]||E["#"]||((E=L.put||"")&&L.$$?E["#"]:(E["="]||E[":"]||"")["#"]);if(!M&&s(b,L.$),!$&&!P.link["#"]){(P.wait||(P.wait=[])).push(function(){B(L,D)});return}$||($=[],(L.$$||L.$).back(function(j){if(E=j.soul||j.link)return $.push(E);$.push(j.get)}),$=$.reverse().join("/")),O.link["#"]=$,!y&&(((b.graph||(b.graph={}))[$]=O.node||(O.node={_:{}}))._["#"]=$),delete b.wait[U],O.wait&&setTimeout.each(O.wait,function(j){j&&j()}),b.ran(b)};var R=B;if(!b.seen){o.err(b,"Data at root of graph must be a node (an object).");return}b.seen.push(O={it:I,link:{},todo:y?[]:Object.keys(I).sort().reverse(),path:(T.path||[]).slice(),up:P}),P.node=p(P.node,N,A,O.link),!y&&O.todo.length&&T.push(O);var U=b.seen.length;(b.wait||(b.wait={}))[U]="",E=(O.ref=y?I:N?P.ref.get(N):P.ref)._,(E=I&&(I._||"")["#"]||E.soul||E.link)?B({soul:E}):O.ref.get(B,{run:b.run,v2020:1,out:{get:{".":" "}}})}if(!T.length)return b.ran(b);b.turn(v)})(),w):(a(b),w)};function s(h,x){if(x){x=(x._||"").id||x;var b=h.root.stun||(h.root.stun={on:i.on}),w={},m;h.stun||(h.stun=b.on("stun",function(){})),(m=b.on(""+x))&&m.the.last.next(w),!(w.run>=h.run)&&b.on(""+x,function(g){if(h.stun.end){this.off(),this.to.next(g);return}g.run=g.run||h.run,g.stun=g.stun||h.stun})}}function o(h){if(h.err){o.end(h.stun,h.root);return}if(!(h.todo.length||h.end||!Object.empty(h.wait))){h.end=1;var x=h.$.back(-1)._,b=x.root,w=x.ask(function(v){b.on("ack",v),v.err&&!v.lack&&i.log(v),++m>(h.acks||0)&&this.off(),h.ack&&h.ack(v,this)},h.opt),m=0,g=h.stun,A;(A=function(){g&&(o.end(g,b),setTimeout.each(Object.keys(g=g.add||""),function(v){(v=g[v])&&v()}))}).hatch=A,h.ack&&!h.ok&&(h.ok=h.acks||9),h.via._.on("out",{put:h.out=h.graph,ok:h.ok&&{"@":h.ok+1},opt:h.opt,"#":w,_:A})}}o.end=function(h,x){h.end=l,h.the.to===h&&h===h.the.last&&delete x.stun,h.off()},o.err=function(h,x){(h.ack||l).call(h,h.out={err:h.err=i.log(x)}),h.ran(h)};function a(h){var x=h.via._,b;h.via=h.via.back(function(w){if(w.soul||!w.get)return w.$;b=h.data,(h.data={})[w.get]=b}),(!h.via||!h.via._.soul)&&(h.via=x.root.$.get(((h.data||"")._||"")["#"]||x.$.back("opt.uuid")())),h.via.put(h.data,h.ack,h)}function c(h,x){return h&&(x=h.constructor)&&x.name||typeof h}var u,l=function(){},f=setTimeout.turn,d=i.valid,p=i.state.ify})(e,"./put"),e(function(n){var i=e("./root");e("./chain"),e("./back"),e("./put"),e("./get"),n.exports=i})(e,"./core"),e(function(n){var i=e("./root");e("./shim"),e("./onto"),e("./book"),e("./valid"),e("./state"),e("./dup"),e("./ask"),e("./core"),e("./on"),e("./map"),e("./set"),e("./mesh"),e("./websocket"),e("./localStorage"),n.exports=i})(e,"./index"),e(function(n){var i=e("./root");i.chain.on=function(a,c,u,l){var f=this,d=f._;d.root;var p;if(typeof a=="string")return c?(p=d.on(a,c,u||d,l),u&&u.$&&(u.subs||(u.subs=[])).push(p),f):d.on(a);var h=c;return(h=h===!0?{change:!0}:h||{}).not=1,h.on=1,f.get(a,h),f},i.chain.once=function(a,c){if(c=c||{},!a)return s(this);var u=this,l=u._,f=l.root;l.put;var d=String.random(7),p;return u.get(function(h,x,b,w){var m=this,g=m._,A=g.one||(g.one={});if(w.stun||A[d]==="")return;if((p=i.valid(h))===!0){v();return}if(typeof p=="string")return;clearTimeout((l.one||"")[d]),clearTimeout(A[d]),A[d]=setTimeout(v,c.wait||99);function v(T){if(!g.has&&!g.soul&&(g={put:h,get:x}),o===(p=g.put)&&(p=((b.$$||"")._||"").put),typeof i.valid(p)=="string"&&(p=f.$.get(p)._.put,p===o&&!T)){A[d]=setTimeout(function(){v(1)},c.wait||99);return}w.stun||A[d]!==""&&(A[d]="",(l.soul||l.has)&&w.off(),a.call(m,p,g.get),clearTimeout(A[d]))}},{on:1}),u};function s(a,c,u){return i.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),(u=a.chain())._.nix=a.once(function(l,f){u._.on("in",this._)}),u._.lex=a._.lex,u}i.chain.off=function(){var a=this,c=a._,u,l=c.back;if(l)return c.ack=0,(u=l.next)&&u[c.get]&&delete u[c.get],(u=l.any)&&(delete l.any,l.any={}),(u=l.ask)&&delete u[c.get],(u=l.put)&&delete u[c.get],(u=c.soul)&&delete l.root.graph[u],(u=c.map)&&Object.keys(u).forEach(function(f,d){d=u[f],d.link&&l.root.$.get(d.link).off()}),(u=c.next)&&Object.keys(u).forEach(function(f,d){d=u[f],d.$.off()}),c.on("off",{}),a};var o})(e,"./on"),e(function(n){var i=e("./root"),s=i.chain.get.next;i.chain.get.next=function(u,l){var f;return Object.plain(l)?(f=((f=l["#"])||"")["="]||f)?u.get(f):((f=u.chain()._).lex=l,u.on("in",function(d){String.match(d.get||(d.put||"")["."],l["."]||l["#"]||l)&&f.on("in",d),this.to.next(d)}),f.$):(s||a)(u,l)},i.chain.map=function(u,l,f){var d=this,p=d._,h,x;return Object.plain(u)&&(h=u["."]?u:{".":u},u=c),u?(i.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),x=d.chain(),d.map().on(function(b,w,m,g){var A=(u||a).call(this,b,w,m,g);if(c!==A){if(b===A)return x._.on("in",m);if(i.is(A))return x._.on("in",A._);var v={};Object.keys(m.put).forEach(function(T){v[T]=m.put[T]},v),v["="]=A,x._.on("in",{get:w,put:v})}}),x):((x=p.each)||((p.each=x=d.chain())._.lex=h||x._.lex||p.lex,x._.nix=d.back("nix"),d.on("in",o,x._)),x)};function o(u){this.to.next(u);var l=this.as,f=u.$,d=f._,p=u.put,h;!d.soul&&!u.$$||(h=l.lex)&&!String.match(u.get||(p||"")["."],h["."]||h["#"]||h)||i.on.link(u,l)}var a=function(){},c})(e,"./map"),e(function(n){var i=e("./root");i.chain.set=function(s,o,a){var c=this,u=c.back(-1),l,f;return o=o||function(){},a=a||{},a.item=a.item||s,(l=((s||"")._||"")["#"])&&((s={})["#"]=l),typeof(f=i.valid(s))=="string"?c.get(l=f).put(s,o,a):i.is(s)?(c.put(function(d){s.get(function(p,h,x){if(!p)return o.call(c,{err:i.log('Only a node can be linked! Not "'+x.put+'"!')});(f={})[p]={"#":p},d(f)},!0)}),s):(Object.plain(s)&&(s=u.get(l=c.back("opt.uuid")()).put(s)),c.get(l||u.back("opt.uuid")(7)).put(s,o,a))}})(e,"./set"),e(function(n){e("./shim");var i=function(){},s=JSON.parseAsync||function(u,l,f){var d,p=+new Date;try{l(d,JSON.parse(u,f),o.sucks(+new Date-p))}catch(h){l(h)}},o=JSON.stringifyAsync||function(u,l,f,d){var p,h=+new Date;try{l(p,JSON.stringify(u,f,d),o.sucks(+new Date-h))}catch(x){l(x)}};o.sucks=function(u){u>99&&(console.log("Warning: JSON blocking CPU detected. Add `gun/lib/yson.js` to fix."),o.sucks=i)};function a(u){var l=function(){},f=u.opt||{};f.log=f.log||console.log,f.gap=f.gap||f.wait||0,f.max=f.max||(f.memory?f.memory*999*999:3e8)*.3,f.pack=f.pack||f.max*.01*.01,f.puff=f.puff||9;var d=setTimeout.turn||setTimeout,p=u.dup,h=p.check,x=p.track,b=l.hear=function(g,A){if(g){if(f.max<=g.length)return l.say({dam:"!",err:"Message too big!"},A);l===this&&(b.d+=g.length||0,++b.c);var v=A.SH=+new Date,T=g[0],P;if(T==="["){s(g,function(I,S){if(I||!S)return l.say({dam:"!",err:"DAM JSON parse error."},A);console.STAT&&console.STAT(+new Date,S.length,"# on hear batch");var N=f.puff;(function O(){for(var E=+new Date,y=0,k;y<N&&(k=S[y++]);)l.hear(k,A);S=S.slice(y),console.STAT&&console.STAT(E,+new Date-E,"hear loop"),w(A),S.length&&d(O,0)})()}),g="";return}if(T==="{"||(g["#"]||Object.plain(g))&&(P=g)){if(P)return b.one(P,A,v);s(g,function(I,S){if(I||!S)return l.say({dam:"!",err:"DAM JSON parse error."},A);b.one(S,A,v)});return}}};b.one=function(g,A,O){var T,P,I,S,N;if(g.DBG&&(g.DBG=N={DBG:g.DBG}),N&&(N.h=O),N&&(N.hp=+new Date),(T=g["#"])||(T=g["#"]=String.random(9)),!(I=h(T))&&(P=g["##"],!(P&&(I=g["@"]||g.get&&T)&&p.check(S=I+P)))){if((g._=function(){}).via=l.leap=A,(I=g["><"])&&typeof I=="string"&&I.slice(0,99).split(",").forEach(function(E){this[E]=1},g._.yo={}),I=g.dam){(x(T)||{}).via=A,(I=l.hear[I])&&I(g,A,u);return}(I=g.ok)&&(g._.near=I["/"]);var O=+new Date;N&&(N.is=O),A.SI=T,x.ed=function(E){T===E&&(x.ed=0,(E=p.s[T])&&(E.via=A,g.get&&(E.it=g)))},u.on("in",l.last=g),N&&(N.hd=+new Date),console.STAT&&console.STAT(O,+new Date-O,g.get?"msg get":g.put?"msg put":"msg"),x(T),S&&x(S),l.leap=l.last=null}},b.c=b.d=0,(function(){var g=0,A;l.hash=function(P,I){var S,N,O,E=+new Date;o(P.put,function y(k,C){var U=(N||(N=O=C||"")).slice(0,32768);if(S=String.hash(U,S),N=N.slice(32768),N){d(y,0);return}console.STAT&&console.STAT(E,+new Date-E,"say json+hash"),P._.$put=O,P["##"]=S,l.say(P,I),delete P._.$put},v)};function v(P,I){var S;return I instanceof Object?(Object.keys(I).sort().forEach(T,{to:S={},on:I}),S):I}function T(P){this.to[P]=this.on[P]}l.say=function(P,I){var S;if((S=this)&&(S=S.to)&&S.next&&S.next(P),!P)return!1;var N,O,E,y=P["@"],k=P._||(P._=function(){}),C=P.DBG,U=+new Date;if(k.y=k.y||U,I||C&&(C.y=U),(N=P["#"])||(N=P["#"]=String.random(9)),!A&&x(N),!(O=P["##"])&&c!==P.put&&!k.via&&y){l.hash(P,I);return}if(!I&&y&&(I=(S=p.s[y])&&(S.via||(S=S.it)&&(S=S._)&&S.via)||(S=l.last)&&y===S["#"]&&l.leap),!I&&y)return p.s[y]?void 0:(console.STAT&&console.STAT(+new Date,++g,"total no peer to ack to"),!1);if(y&&!P.put&&!O&&((p.s[y]||"").it||"")["##"])return!1;if(!I&&l.way)return l.way(P);if(C&&(C.yh=+new Date),!(E=k.raw)){l.raw(P,I);return}if(C&&(C.yr=+new Date),!I||!I.id){if(!Object.plain(I||f.peers))return!1;var U=+new Date;f.puff;var R=f.peers,B=Object.keys(I||f.peers||{});console.STAT&&console.STAT(U,+new Date-U,"peer keys"),(function M(){var $=+new Date;A=1;var j=k.raw;k.raw=E;for(var J=0,H;J<9&&(H=(B||"")[J++]);)(H=R[H]||(I||"")[H])&&l.say(P,H);k.raw=j,A=0,B=B.slice(J),console.STAT&&console.STAT($,+new Date-$,"say loop"),B.length&&(d(M,0),y&&x(y))})();return}if(!I.wire&&l.wire&&l.wire(I),N!==I.last){if(I.last=N,I===k.via||(S=k.yo)&&(S[I.url]||S[I.pid]||S[I.id]))return!1;if(console.STAT&&console.STAT(U,((C||k).yp=+new Date)-(k.y||U),"say prep"),!A&&y&&x(y),I.batch){if(I.tail=(S=I.tail||0)+E.length,I.tail<=f.pack){I.batch+=(S?",":"")+E;return}w(I)}I.batch="[";var L=+new Date;setTimeout(function(){console.STAT&&console.STAT(L,+new Date-L,"0ms TO"),w(I)},f.gap),m(E,I),console.STAT&&y===I.SI&&console.STAT(U,+new Date-I.SH,"say ack")}},l.say.c=l.say.d=0,l.raw=function(P,I){if(!P)return"";var S=P._||{},N,O;if(O=S.raw)return O;if(typeof P=="string")return P;var E=P["##"],y=P["@"];if(E&&y){if(!S.via&&h(y+E))return!1;if(O=(p.s[y]||"").it){if(E===O["##"])return!1;O["##"]||(O["##"]=E)}}if(!P.dam&&!P["@"]){var k=0,C=[];O=f.peers;for(var U in O){var R=O[U];if(C.push(R.url||R.pid||R.id),++k>6)break}k>1&&(P["><"]=C.join())}if(P.put&&(O=P.ok)&&(P.ok={"@":(O["@"]||1)-1,"/":O["/"]==P._.near?l.near:O["/"]}),N=S.$put){O={},Object.keys(P).forEach(function(L){O[L]=P[L]}),O.put=":])([:",o(O,function(L,D){if(!L){var M=+new Date;O=D.indexOf('"put":":])([:"'),B(c,D=D.slice(0,O+6)+N+D.slice(O+14)),console.STAT&&console.STAT(M,+new Date-M,"say slice")}});return}o(P,B);function B(L,D){L||(S.raw=D,l.say(P,I))}}})();function w(g){var A=g.batch,v=typeof A=="string";if(v&&(A+="]"),g.batch=g.tail=null,!!A&&!(v?3>A.length:!A.length)){if(!v)try{A=A.length===1?A[0]:JSON.stringify(A)}catch(T){return f.log("DAM JSON stringify error",T)}A&&m(A,g)}}function m(g,A){try{var v=A.wire;A.say?A.say(g):v.send&&v.send(g),l.say.d+=g.length||0,++l.say.c}catch{(A.queue=A.queue||[]).push(g)}}return l.near=0,l.hi=function(g){var A=g.wire,v;if(!A){l.wire(g.length&&{url:g,id:g}||g);return}g.id?f.peers[g.url||g.id]=g:(v=g.id=g.id||g.url||String.random(9),l.say({dam:"?",pid:u.opt.pid},f.peers[v]=g),delete p.s[g.last]),g.met||(l.near++,g.met=+new Date,u.on("hi",g)),v=g.queue,g.queue=[],setTimeout.each(v||[],function(T){m(T,g)},0,9)},l.bye=function(g){g.met&&--l.near,delete g.met,u.on("bye",g);var A=+new Date;A=A-(g.met||A),l.bye.time=((l.bye.time||A)+A)/2},l.hear["!"]=function(g,A){f.log("Error:",g.err)},l.hear["?"]=function(g,A){g.pid&&(A.pid||(A.pid=g.pid),g["@"])||(l.say({dam:"?",pid:f.pid,"@":g["#"]},A),delete p.s[A.last])},l.hear.mob=function(g,A){if(g.peers){var v=Object.keys(g.peers),T=v[Math.random()*v.length>>0];T&&(l.bye(A),l.hi(T))}},u.on("create",function(g){g.opt.pid=g.opt.pid||String.random(9),this.to.next(g),g.on("out",l.say)}),u.on("bye",function(g,A){g=f.peers[g.id||g]||g,this.to.next(g),g.bye?g.bye():(A=g.wire)&&A.close&&A.close(),delete f.peers[g.id],g.wire=null}),u.on("bye",function(g,A){this.to.next(g),(A=console.STAT)&&(A.peers=l.near),(A=g.url)&&setTimeout(function(){},f.lack||9e3)}),u.on("hi",function(g,A){if(this.to.next(g),(A=console.STAT)&&(A.peers=l.near),!f.super){var v=Object.keys(u.next||"");v.length>9999&&!console.SUBS&&console.log(console.SUBS="Warning: You have more than 10K live GETs, which might use more bandwidth than your screen can show - consider `.off()`."),setTimeout.each(v,function(T){var P=u.next[T];if(f.super||(P.ask||"")[""]){l.say({get:{"#":T}},g);return}setTimeout.each(Object.keys(P.ask||""),function(I){I&&l.say({"##":String.hash((u.graph[T]||"")[I]),get:{"#":T,".":I}},g)})})}}),l}var c;try{n.exports=a}catch{}})(e,"./mesh"),e(function(n){var i=e("./root");i.Mesh=e("./mesh"),i.on("opt",function(o){if(this.to.next(o),o.once)return;var a=o.opt;if(a.WebSocket===!1)return;var c=i.window||{},u=a.WebSocket||c.WebSocket||c.webkitWebSocket||c.mozWebSocket;if(!u)return;a.WebSocket=u;var l=a.mesh=a.mesh||i.Mesh(o),f=l.wire||a.wire;l.wire=a.wire=d;function d(b){try{if(!b||!b.url)return f&&f(b);var w=b.url.replace(/^http/,"ws"),m=b.wire=new a.WebSocket(w);return m.onclose=function(){h(b),a.mesh.bye(b)},m.onerror=function(g){h(b)},m.onopen=function(){a.mesh.hi(b)},m.onmessage=function(g){g&&a.mesh.hear(g.data||g,b)},m}catch{a.mesh.bye(b)}}setTimeout(function(){!a.super&&o.on("out",{dam:"hi"})},1);var p=2*999;function h(b){clearTimeout(b.defer),a.peers[b.url]&&(x&&b.retry<=0||(b.retry=(b.retry||a.retry+1||60)-(-b.tried+(b.tried=+new Date)<p*4?1:0),b.defer=setTimeout(function w(){if(x&&x.hidden)return setTimeout(w,p);d(b)},p)))}var x=""+s!=typeof document&&document});var s})(e,"./websocket"),e(function(n){if(!(typeof Gun>"u")){var i=function(){},s;try{s=(Gun.window||i).localStorage}catch{}s||(Gun.log("Warning: No localStorage exists to persist data to!"),s={setItem:function(a,c){this[a]=c},removeItem:function(a){delete this[a]},getItem:function(a){return this[a]}});var o=JSON.stringifyAsync||function(a,c,u,l){var f;try{c(f,JSON.stringify(a,u,l))}catch(d){c(d)}};Gun.on("create",function a(c){this.to.next(c);var u=c.opt;c.graph;var l=[],f,d,p,h;if(u.localStorage===!1)return;u.prefix=u.file||"gun/";try{f=a[u.prefix]=a[u.prefix]||JSON.parse(p=s.getItem(u.prefix))||{}}catch{f=a[u.prefix]={}}p=(p||"").length,c.on("get",function(b){this.to.next(b);var w=b.get,m,g,A,v;!w||!(m=w["#"])||(g=f[m]||v,g&&(A=w["."])&&!Object.plain(A)&&(g=Gun.state.ify({},A,Gun.state.is(g,A),g[A],m)),Gun.on.get.ack(b,g))}),c.on("put",function(b){this.to.next(b);var w=b.put,m=w["#"],g=w["."],A=b["#"],v=b.ok||"";if(f[m]=Gun.state.ify(f[m],g,w[">"],w[":"],m),h&&p>4999880){c.on("in",{"@":A,err:"localStorage max!"});return}!b["@"]&&(!b._.via||Math.random()<v["@"]/v["/"])&&l.push(A),!d&&(d=setTimeout(x,9+p/333))});function x(){if(!l.length&&((setTimeout.turn||"").s||"").length){setTimeout(x,99);return}var b=l;clearTimeout(d),d=!1,l=[],o(f,function(w,m){try{!w&&s.setItem(u.prefix,m)}catch(g){w=h=g||"localStorage failure"}w&&(Gun.log(w+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),c.on("localStorage:error",{err:w,get:u.prefix,put:f})),p=m.length,setTimeout.each(b,function(g){c.on("in",{"@":g,err:w,ok:0})},0,99)})}})}})(e,"./localStorage")})(),(function(){var O;if(""+O!=typeof Gun){var e=function(E){console.warn("Warning! Deprecated internal utility will break in next version:",E)},t=Gun;t.fn=t.fn||{is:function(E){return e("fn"),!!E&&typeof E=="function"}},t.bi=t.bi||{is:function(E){return e("bi"),E instanceof Boolean||typeof E=="boolean"}},t.num=t.num||{is:function(E){return e("num"),!n(E)&&(E-parseFloat(E)+1>=0||E===1/0||E===-1/0)}},t.text=t.text||{is:function(E){return e("text"),typeof E=="string"}},t.text.ify=t.text.ify||function(E){return e("text.ify"),t.text.is(E)?E:typeof JSON<"u"?JSON.stringify(E):E&&E.toString?E.toString():E},t.text.random=t.text.random||function(E,y){e("text.random");var k="";for(E=E||24,y=y||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";E>0;)k+=y.charAt(Math.floor(Math.random()*y.length)),E--;return k},t.text.match=t.text.match||function(E,y){var k,C;return e("text.match"),typeof E!="string"?!1:(typeof y=="string"&&(y={"=":y}),y=y||{},k=y["="]||y["*"]||y[">"]||y["<"],E===k?!0:C!==y["="]?!1:(k=y["*"]||y[">"]||y["<"],E.slice(0,(k||"").length)===k?!0:C!==y["*"]?!1:C!==y[">"]&&C!==y["<"]?E>=y[">"]&&E<=y["<"]:C!==y[">"]&&E>=y[">"]||C!==y["<"]&&E<=y["<"]))},t.text.hash=t.text.hash||function(E,y){if(e("text.hash"),typeof E=="string"){if(y=y||0,!E.length)return y;for(var k=0,C=E.length,U;k<C;++k)U=E.charCodeAt(k),y=(y<<5)-y+U,y|=0;return y}},t.list=t.list||{is:function(E){return e("list"),E instanceof Array}},t.list.slit=t.list.slit||Array.prototype.slice,t.list.sort=t.list.sort||function(E){return e("list.sort"),function(y,k){return!y||!k?0:(y=y[E],k=k[E],y<k?-1:y>k?1:0)}},t.list.map=t.list.map||function(E,y,k){return e("list.map"),S(E,y,k)},t.list.index=1,t.obj=t.boj||{is:function(E){return e("obj"),E?E instanceof Object&&E.constructor===Object||Object.prototype.toString.call(E).match(/^\[object (\w+)\]$/)[1]==="Object":!1}},t.obj.put=t.obj.put||function(E,y,k){return e("obj.put"),(E||{})[y]=k,E},t.obj.has=t.obj.has||function(E,y){return e("obj.has"),E&&Object.prototype.hasOwnProperty.call(E,y)},t.obj.del=t.obj.del||function(E,y){if(e("obj.del"),!!E)return E[y]=null,delete E[y],E},t.obj.as=t.obj.as||function(E,y,k,C){return e("obj.as"),E[y]=E[y]||(C===k?{}:k)},t.obj.ify=t.obj.ify||function(E){if(e("obj.ify"),A(E))return E;try{E=JSON.parse(E)}catch{E={}}return E},(function(){var E;function y(k,C){T(this,C)&&E!==this[C]||(this[C]=k)}t.obj.to=t.obj.to||function(k,C){return e("obj.to"),C=C||{},S(k,y,C),C}})(),t.obj.copy=t.obj.copy||function(E){return e("obj.copy"),E&&JSON.parse(JSON.stringify(E))},(function(){function E(y,k){var C=this.n,U;if(!(C&&(k===C||A(C)&&T(C,k)))&&U!==k)return!0}t.obj.empty=t.obj.empty||function(y,k){return e("obj.empty"),y?!S(y,E,{n:k}):!0}})(),(function(){function E(C,U){if(arguments.length===2){E.r=E.r||{},E.r[C]=U;return}E.r=E.r||[],E.r.push(C)}var y=Object.keys,k;Object.keys=Object.keys||function(C){return k(C,function(U,R,B){B(R)})},t.obj.map=k=t.obj.map||function(C,U,R){e("obj.map");var B,L=0,D,M,$,j,J=typeof U=="function";if(E.r=B,y&&A(C)&&($=y(C),j=!0),R=R||{},n(C)||$)for(D=($||C).length;L<D;L++){var H=L+t.list.index;if(J){if(M=j?U.call(R,C[$[L]],$[L],E):U.call(R,C[L],H,E),M!==B)return M}else if(U===C[j?$[L]:L])return $?$[L]:H}else for(L in C)if(J){if(T(C,L)&&(M=R?U.call(R,C[L],L,E):U(C[L],L,E),M!==B))return M}else if(U===C[L])return L;return J?E.r:t.list.index?0:-1}})(),t.time=t.time||{},t.time.is=t.time.is||function(E){return e("time"),E?E instanceof Date:+new Date().getTime()};var m=t.fn.is,n=t.list.is,g=t.obj,A=g.is,T=g.has,S=g.map,i={};i.is=function(E){return e("val.is"),E===O?!1:E===null?!0:E===1/0?!1:a(E)||o(E)||h(E)?!0:i.link.is(E)||!1},i.link=i.rel={_:"#"},(function(){i.link.is=function(y){if(e("val.link.is"),y&&y[s]&&!y._&&A(y)){var k={};if(S(y,E,k),k.id)return k.id}return!1};function E(y,k){var C=this;if(C.id)return C.id=!1;if(k==s&&a(y))C.id=y;else return C.id=!1}})(),i.link.ify=function(E){return e("val.link.ify"),I({},s,E)},t.obj.has._=".";var s=i.link._,O,o=t.bi.is,h=t.num.is,a=t.text.is,g=t.obj,A=g.is,I=g.put,S=g.map;t.val=t.val||i;var c={_:"_"};c.soul=function(E,y){return e("node.soul"),E&&E._&&E._[y||f]},c.soul.ify=function(E,y){return e("node.soul.ify"),y=typeof y=="string"?{soul:y}:y||{},E=E||{},E._=E._||{},E._[f]=y.soul||E._[f]||l(),E},c.soul._=i.link._,(function(){c.is=function(y,k,C){e("node.is");var U;return A(y)&&(U=c.soul(y))?!S(y,E,{as:C,cb:k,s:U,n:y}):!1};function E(y,k){if(k!==c._){if(!i.is(y))return!0;this.cb&&this.cb.call(this.as,y,k,this.n,this.s)}}})(),(function(){c.ify=function(y,k,C){return e("node.ify"),k?typeof k=="string"?k={soul:k}:typeof k=="function"&&(k={map:k}):k={},k.map&&(k.node=k.map.call(C,y,O,k.node||{})),(k.node=c.soul.ify(k.node||{},k))&&S(y,E,{o:k,as:C}),k.node};function E(y,k){var C=this.o,U,R;if(C.map){U=C.map.call(this.as,y,""+k,C.node),R===U?v(C.node,k):C.node&&(C.node[k]=U);return}i.is(y)&&(C.node[k]=y)}})();var g=t.obj,A=g.is,v=g.del,S=g.map,u=t.text,l=u.random,f=c.soul._,O;t.node=t.node||c;var d=t.state;d.lex=function(){return e("state.lex"),d().toString(36).replace(".","")},d.to=function(E,y,k){e("state.to");var C=(E||{})[y];return A(C)&&(C=N(C)),d.ify(k,y,d.is(E,y),C,c.soul(E))},(function(){d.map=function(y,k,C){e("state.map");var U,R=A(R=y||k)?R:null;return y=m(y=y||k)?y:null,R&&!y?(k=h(k)?k:d(),R[b]=R[b]||{},S(R,E,{o:R,s:k}),R):(C=C||A(k)?k:U,k=h(k)?k:d(),function(B,L,D,M){if(!y)return E.call({o:D,s:k},B,L),B;y.call(C||this||{},B,L,D,M),!(T(D,L)&&U===D[L])&&E.call({o:D,s:k},B,L)})};function E(y,k){b!==k&&d.ify(this.o,k,this.s)}})();var g=t.obj;g.as;var T=g.has,A=g.is,S=g.map,N=g.copy,p=t.num,h=p.is,x=t.fn,m=x.is,b=c._,O,w={};(function(){w.is=function(k,C,U,R){return e("graph.is"),!k||!A(k)||P(k)?!1:!S(k,E,{cb:C,fn:U,as:R})};function E(k,C){if(!k||C!==c.soul(k)||!c.is(k,this.fn,this.as))return!0;this.cb&&(y.n=k,y.as=this.as,this.cb.call(y.as,k,C,y))}function y(k){k&&c.is(y.n,k,y.as)}})(),(function(){w.ify=function(R,B,L){e("graph.ify");var D={path:[],obj:R};return B?typeof B=="string"?B={soul:B}:typeof B=="function"&&(B.map=B):B={},typeof L=="string"&&(B.soul=B.soul||L,L=O),B.soul&&(D.link=i.link.ify(B.soul)),B.shell=(L||{}).shell,B.graph=B.graph||{},B.seen=B.seen||[],B.as=B.as||L,E(B,D),B.root=D.node,B.graph};function E(R,B){var L;return(L=U(R,B))?L:(B.env=R,B.soul=k,c.ify(B.obj,y,B)&&(B.link=B.link||i.link.ify(c.soul(B.node)),B.obj!==R.shell&&(R.graph[i.link.is(B.link)]=B.node)),B)}function y(R,B,L){var D=this,M=D.env,$,j;if(c._===B&&T(R,i.link._))return L._;if($=C(R,B,L,D,M)){if(B||(D.node=D.node||L||{},T(R,c._)&&c.soul(R)&&(D.node._=N(R._)),D.node=c.soul.ify(D.node,i.link.is(D.link)),D.link=D.link||i.link.ify(c.soul(D.node))),(j=M.map)&&(j.call(M.as||{},R,B,L,D),T(L,B))){if(R=L[B],O===R){v(L,B);return}if(!($=C(R,B,L,D,M)))return}if(!B)return D.node;if($===!0)return R;if(j=E(M,{obj:R,path:D.path.concat(B)}),!!j.node)return j.link}}function k(R){var B=this,L=i.link.is(B.link),D=B.env.graph;B.link=B.link||i.link.ify(R),B.link[i.link._]=R,B.node&&B.node[c._]&&(B.node[c._][i.link._]=R),T(D,L)&&(D[R]=D[L],v(D,L))}function C(R,B,L,D,M){var $;if(i.is(R))return!0;if(A(R))return 1;if($=M.invalid)return R=$.call(M.as||{},R,B,L),C(R,B,L,D,M);M.err="Invalid value at '"+D.path.concat(B).join(".")+"'!",t.list.is(R)&&(M.err+=" Use `.set(item)` instead of an Array.")}function U(R,B){for(var L=R.seen,D=L.length,M;D--;)if(M=L[D],B.obj===M.obj)return M;L.push(B)}})(),w.node=function(E){e("graph.node");var y=c.soul(E);if(y)return I({},y,E)},(function(){w.to=function(y,k,C){if(e("graph.to"),!!y){var U={};return C=C||{seen:{}},S(y[k],E,{obj:U,graph:y,opt:C}),U}};function E(y,k){var C,U;if(c._===k){if(P(y,i.link._))return;this.obj[k]=N(y);return}if(!(C=i.link.is(y))){this.obj[k]=y;return}if(U=this.opt.seen[C]){this.obj[k]=U;return}this.obj[k]=this.opt.seen[C]=w.to(this.graph,C,this.opt)}})();var m=t.fn.is,g=t.obj,A=g.is,v=g.del,T=g.has,P=g.empty,I=g.put,S=g.map,N=g.copy,O;t.graph=t.graph||w}})()})(Js)),Js.exports}var E4=Pn();const S4=tb(E4);var Qs={exports:{}};Qs.exports;var Rd;function C4(){return Rd||(Rd=1,(function(r){(function(){function e(n,i){return i?pf(n):n.slice?e[s(n)]:function(o,a){n(o={exports:{}}),e[s(a)]=o.exports};function s(o){return o.split("/").slice(-1).toString().replace(".js","")}}var t=r;e(function(n){typeof self<"u"&&(n.window=self),typeof window<"u"&&(n.window=window);var i=n.window||n,s,o=i.SEA||{};(o.window=n.window)&&(o.window.SEA=o);try{s+""!=typeof t&&(t.exports=o)}catch{}n.exports=o})(e,"./root"),e(function(n){var i=e("./root");try{i.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("blob:")<0&&location.protocol.indexOf("file:")<0&&location.origin!="null"&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch{}})(e,"./https"),e(function(n){var i;if(i+""==typeof btoa){if(i+""==typeof Buffer)try{Di.Buffer=e("buffer",1).Buffer}catch{console.log("Please `npm install buffer` or add it to your package.json !")}Di.btoa=function(s){return Buffer.from(s,"binary").toString("base64")},Di.atob=function(s){return Buffer.from(s,"base64").toString("binary")}}})(e,"./base64"),e(function(n){e("./base64");function i(){}Object.assign(i,{from:Array.from}),i.prototype=Object.create(Array.prototype),i.prototype.toString=function(s,o,a){s=s||"utf8",o=o||0;const c=this.length;if(s==="hex"){const u=new Uint8Array(this);return[...Array((a&&a+1||c)-o).keys()].map(l=>u[l+o].toString(16).padStart(2,"0")).join("")}if(s==="utf8")return Array.from({length:(a||c)-o},(u,l)=>String.fromCharCode(this[l+o])).join("");if(s==="base64")return btoa(this)},n.exports=i})(e,"./array"),e(function(n){e("./base64");var i=e("./array");function s(...o){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),s.from(...o)}s.prototype=Object.create(Array.prototype),Object.assign(s,{from(){if(!Object.keys(arguments).length||arguments[0]==null)throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const o=arguments[0];let a;if(typeof o=="string"){const u=arguments[1]||"utf8";if(u==="hex"){const l=o.match(/([\da-fA-F]{2})/g).map(f=>parseInt(f,16));if(!l||!l.length)throw new TypeError("Invalid first argument for type 'hex'.");a=i.from(l)}else if(u==="utf8"||u==="binary"){const l=o.length,f=new Uint16Array(l);Array.from({length:l},(d,p)=>f[p]=o.charCodeAt(p)),a=i.from(f)}else if(u==="base64"){const l=atob(o),f=l.length,d=new Uint8Array(f);Array.from({length:f},(p,h)=>d[h]=l.charCodeAt(h)),a=i.from(d)}else u==="binary"?a=i.from(o):console.info("SafeBuffer.from unknown encoding: "+u);return a}if(o.byteLength,o.byteLength?o.byteLength:o.length){let u;return o instanceof ArrayBuffer&&(u=new Uint8Array(o)),i.from(u||o)}},alloc(o,a=0){return i.from(new Uint8Array(Array.from({length:o},()=>a)))},allocUnsafe(o){return i.from(new Uint8Array(Array.from({length:o})))},concat(o){if(!Array.isArray(o))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return i.from(o.reduce((a,c)=>a.concat(Array.from(c)),[]))}}),s.prototype.from=s.from,s.prototype.toString=i.prototype.toString,n.exports=s})(e,"./buffer"),e(function(n){const i=e("./root"),s={Buffer:e("./buffer")};var o={},a;if(JSON.parseAsync=JSON.parseAsync||function(u,l,f){var d;try{l(d,JSON.parse(u,f))}catch(p){l(p)}},JSON.stringifyAsync=JSON.stringifyAsync||function(u,l,f,d){var p;try{l(p,JSON.stringify(u,f,d))}catch(h){l(h)}},s.parse=function(u,l){return new Promise(function(f,d){JSON.parseAsync(u,function(p,h){p?d(p):f(h)},l)})},s.stringify=function(u,l,f){return new Promise(function(d,p){JSON.stringifyAsync(u,function(h,x){h?p(h):d(x)},l,f)})},i.window&&(s.crypto=i.window.crypto||i.window.msCrypto,s.subtle=(s.crypto||o).subtle||(s.crypto||o).webkitSubtle,s.TextEncoder=i.window.TextEncoder,s.TextDecoder=i.window.TextDecoder,s.random=u=>s.Buffer.from(s.crypto.getRandomValues(new Uint8Array(s.Buffer.alloc(u))))),!s.TextDecoder){const{TextEncoder:u,TextDecoder:l}=e((a+""==typeof t?".":"")+"./lib/text-encoding",1);s.TextDecoder=l,s.TextEncoder=u}if(!s.crypto)try{var c=e("crypto",1);Object.assign(s,{crypto:c,random:l=>s.Buffer.from(c.randomBytes(l))});const{Crypto:u}=e("@peculiar/webcrypto",1);s.ossl=s.subtle=new u({directory:"ossl"}).subtle}catch{console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}n.exports=s})(e,"./shim"),e(function(n){var i=e("./root"),s=e("./shim"),o={};o.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},o.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},o.ecdh={name:"ECDH",namedCurve:"P-256"},o.jwk=function(a,c){a=a.split(".");var u=a[0],l=a[1],f={kty:"EC",crv:"P-256",x:u,y:l,ext:!0};return f.key_ops=c?["sign"]:["verify"],c&&(f.d=c),f},o.keyToJwk=function(a){return{kty:"oct",k:a.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},o.recall={validity:720*60,hook:function(a){return a}},o.check=function(a){return typeof a=="string"&&a.slice(0,4)==="SEA{"},o.parse=async function(c){try{var u=typeof c=="string";return u&&c.slice(0,4)==="SEA{"&&(c=c.slice(3)),u?await s.parse(c):c}catch{}return c},i.opt=o,n.exports=o})(e,"./settings"),e(function(n){var i=e("./shim");n.exports=async function(s,o){var a=typeof s=="string"?s:await i.stringify(s),c=await i.subtle.digest({name:o||"SHA-256"},new i.TextEncoder().encode(a));return i.Buffer.from(c)}})(e,"./sha256"),e(function(n){const i=e("./shim"),s=i.subtle,o=i.ossl?i.ossl:s,a=c=>o.digest({name:"SHA-1"},new ArrayBuffer(c));n.exports=a})(e,"./sha1"),e(function(n){var i=e("./root"),s=e("./shim"),o=e("./settings"),a=e("./sha256"),c;i.work=i.work||(async(u,l,f,d)=>{try{var p=(l||{}).epub||l;if(d=d||{},p instanceof Function&&(f=p,p=c),u=typeof u=="string"?u:await s.stringify(u),(d.name||"").toLowerCase().slice(0,3)==="sha"){var h=s.Buffer.from(await a(u,d.name),"binary").toString(d.encode||"base64");if(f)try{f(h)}catch(m){console.log(m)}return h}p=p||s.random(9);var x=await(s.ossl||s.subtle).importKey("raw",new s.TextEncoder().encode(u),{name:d.name||"PBKDF2"},!1,["deriveBits"]),b=await(s.ossl||s.subtle).deriveBits({name:d.name||"PBKDF2",iterations:d.iterations||o.pbkdf2.iter,salt:new s.TextEncoder().encode(d.salt||p),hash:d.hash||o.pbkdf2.hash},x,d.length||o.pbkdf2.ks*8);u=s.random(u.length);var w=s.Buffer.from(b,"binary").toString(d.encode||"base64");if(f)try{f(w)}catch(m){console.log(m)}return w}catch(m){if(console.log(m),i.err=m,i.throw)throw m;f&&f();return}}),n.exports=i.work})(e,"./work"),e(function(n){var i=e("./root"),s=e("./shim");e("./settings"),i.name=i.name||(async(o,a)=>{try{if(o)try{o()}catch(c){console.log(c)}return}catch(c){if(console.log(c),i.err=c,i.throw)throw c;o&&o();return}}),i.pair=i.pair||(async(o,a)=>{try{var c=s.ossl||s.subtle,u=await s.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async d=>{var p={};p.priv=(await s.subtle.exportKey("jwk",d.privateKey)).d;var h=await s.subtle.exportKey("jwk",d.publicKey);return p.pub=h.x+"."+h.y,p});try{var l=await c.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async d=>{var p={};p.epriv=(await c.exportKey("jwk",d.privateKey)).d;var h=await c.exportKey("jwk",d.publicKey);return p.epub=h.x+"."+h.y,p})}catch(d){if(i.window)throw d;if(d=="Error: ECDH is not a supported algorithm")console.log("Ignoring ECDH...");else throw d}l=l||{};var f={pub:u.pub,priv:u.priv,epub:l.epub,epriv:l.epriv};if(o)try{o(f)}catch(d){console.log(d)}return f}catch(d){if(console.log(d),i.err=d,i.throw)throw d;o&&o();return}}),n.exports=i.pair})(e,"./pair"),e(function(n){var i=e("./root"),s=e("./shim"),o=e("./settings"),a=e("./sha256"),c;i.sign=i.sign||(async(u,l,f,d)=>{try{if(d=d||{},!(l||d).priv){if(!i.I)throw"No signing key.";l=await i.I(null,{what:u,how:"sign",why:d.why})}if(c===u)throw"`undefined` not allowed.";var p=await o.parse(u),h=d.check=d.check||p;if(i.verify&&(i.opt.check(h)||h&&h.s&&h.m)&&c!==await i.verify(h,l)){var A=await o.parse(h);if(d.raw||(A="SEA"+await s.stringify(A)),f)try{f(A)}catch(T){console.log(T)}return A}var x=l.pub,b=l.priv,w=o.jwk(x,b),m=await a(p),g=await(s.ossl||s.subtle).importKey("jwk",w,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(v=>(s.ossl||s.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},v,new Uint8Array(m))),A={m:p,s:s.Buffer.from(g,"binary").toString(d.encode||"base64")};if(d.raw||(A="SEA"+await s.stringify(A)),f)try{f(A)}catch(v){console.log(v)}return A}catch(v){if(console.log(v),i.err=v,i.throw)throw v;f&&f();return}}),n.exports=i.sign})(e,"./sign"),e(function(n){var i=e("./root"),s=e("./shim"),o=e("./settings"),a=e("./sha256"),c;i.verify=i.verify||(async(f,d,p,h)=>{try{var x=await o.parse(f);if(d===!1){var b=await o.parse(x.m);if(p)try{p(b)}catch(S){console.log(S)}return b}h=h||{};var w=d.pub||d,m=i.opt.slow_leak?await i.opt.slow_leak(w):await(s.ossl||s.subtle).importKey("jwk",o.jwk(w),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),g=await a(x.m),A,v,T,P;try{if(A=s.Buffer.from(x.s,h.encode||"base64"),v=new Uint8Array(A),T=await(s.ossl||s.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},m,v,new Uint8Array(g)),!T)throw"Signature did not match."}catch{if(i.opt.fallback)return await i.opt.fall_verify(f,d,p,h)}var I=T?await o.parse(x.m):c;if(p)try{p(I)}catch(S){console.log(S)}return I}catch(S){if(console.log(S),i.err=S,i.throw)throw S;p&&p();return}}),n.exports=i.verify;var u={};i.opt.slow_leak=f=>{if(u[f])return u[f];var d=o.jwk(f);return u[f]=(s.ossl||s.subtle).importKey("jwk",d,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),u[f]};var l=i.opt;i.opt.fall_verify=async function(f,d,p,h,x){if(x===i.opt.fallback)throw"Signature did not match";x=x||1;var b=f||"";f=i.opt.unpack(f)||f;var w=await o.parse(f),m=d.pub||d,g=await i.opt.slow_leak(m),A=x<=i.opt.fallback?s.Buffer.from(await s.subtle.digest({name:"SHA-256"},new s.TextEncoder().encode(await o.parse(w.m)))):await a(w.m),v,T,P;try{if(v=s.Buffer.from(w.s,h.encode||"base64"),T=new Uint8Array(v),P=await(s.ossl||s.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,T,new Uint8Array(A)),!P)throw"Signature did not match."}catch{try{v=s.Buffer.from(w.s,"utf8"),T=new Uint8Array(v),P=await(s.ossl||s.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,T,new Uint8Array(A))}catch{if(!P)throw"Signature did not match."}}var I=P?await o.parse(w.m):c;if(l.fall_soul=b["#"],l.fall_key=b["."],l.fall_val=f,l.fall_state=b[">"],p)try{p(I)}catch(S){console.log(S)}return I},i.opt.fallback=2})(e,"./verify"),e(function(n){var i=e("./shim"),s=e("./settings"),o=e("./sha256");const a=async(c,u,l)=>{const f=c+(u||i.random(8)).toString("utf8"),d=i.Buffer.from(await o(f),"binary"),p=s.keyToJwk(d);return await i.subtle.importKey("jwk",p,{name:"AES-GCM"},!1,["encrypt","decrypt"])};n.exports=a})(e,"./aeskey"),e(function(n){var i=e("./root"),s=e("./shim");e("./settings");var o=e("./aeskey"),a;i.encrypt=i.encrypt||(async(c,u,l,f)=>{try{f=f||{};var d=(u||f).epriv||u;if(a===c)throw"`undefined` not allowed.";if(!d){if(!i.I)throw"No encryption key.";u=await i.I(null,{what:c,how:"encrypt",why:f.why}),d=u.epriv||u}var p=typeof c=="string"?c:await s.stringify(c),h={s:s.random(9),iv:s.random(15)},x=await o(d,h.s,f).then(w=>s.subtle.encrypt({name:f.name||"AES-GCM",iv:new Uint8Array(h.iv)},w,new s.TextEncoder().encode(p))),b={ct:s.Buffer.from(x,"binary").toString(f.encode||"base64"),iv:h.iv.toString(f.encode||"base64"),s:h.s.toString(f.encode||"base64")};if(f.raw||(b="SEA"+await s.stringify(b)),l)try{l(b)}catch(w){console.log(w)}return b}catch(w){if(console.log(w),i.err=w,i.throw)throw w;l&&l();return}}),n.exports=i.encrypt})(e,"./encrypt"),e(function(n){var i=e("./root"),s=e("./shim"),o=e("./settings"),a=e("./aeskey");i.decrypt=i.decrypt||(async(c,u,l,f)=>{try{f=f||{};var d=(u||f).epriv||u;if(!d){if(!i.I)throw"No decryption key.";u=await i.I(null,{what:c,how:"decrypt",why:f.why}),d=u.epriv||u}var p=await o.parse(c),h,x,b;try{h=s.Buffer.from(p.s,f.encode||"base64"),x=s.Buffer.from(p.iv,f.encode||"base64"),b=s.Buffer.from(p.ct,f.encode||"base64");var w=await a(d,h,f).then(g=>s.subtle.decrypt({name:f.name||"AES-GCM",iv:new Uint8Array(x),tagLength:128},g,new Uint8Array(b)))}catch{if(f.encode==="utf8")throw"Could not decrypt";if(i.opt.fallback)return f.encode="utf8",await i.decrypt(c,u,l,f)}var m=await o.parse(new s.TextDecoder("utf8").decode(w));if(l)try{l(m)}catch(g){console.log(g)}return m}catch(g){if(console.log(g),i.err=g,i.throw)throw g;l&&l();return}}),n.exports=i.decrypt})(e,"./decrypt"),e(function(n){var i=e("./root"),s=e("./shim");e("./settings"),i.secret=i.secret||(async(a,c,u,l)=>{try{if(l=l||{},!c||!c.epriv||!c.epub){if(!i.I)throw"No secret mix.";c=await i.I(null,{what:a,how:"secret",why:l.why})}var f=a.epub||a,d=c.epub,p=c.epriv,h=s.ossl||s.subtle,x=o(f),b=Object.assign({public:await h.importKey(...x,!0,[])},{name:"ECDH",namedCurve:"P-256"}),w=o(d,p),m=await h.importKey(...w,!1,["deriveBits"]).then(async A=>{var v=await h.deriveBits(b,A,256),T=new Uint8Array(v),P=await h.importKey("raw",T,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return h.exportKey("jwk",P).then(({k:I})=>I)}),g=m;if(u)try{u(g)}catch(A){console.log(A)}return g}catch(A){if(console.log(A),i.err=A,i.throw)throw A;u&&u();return}});var o=(a,c)=>{var[u,l]=a.split("."),f=c?{d:c}:{};return["jwk",Object.assign(f,{x:u,y:l,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};n.exports=i.secret})(e,"./secret"),e(function(n){var i=e("./root");i.certify=i.certify||(async(s,o={},a,c,u={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),s=(()=>{var g=[];if(s){if((typeof s=="string"||Array.isArray(s))&&s.indexOf("*")>-1)return"*";if(typeof s=="string")return s;if(Array.isArray(s)){if(s.length===1&&s[0])return typeof s[0]=="object"&&s[0].pub?s[0].pub:typeof s[0]=="string"?s[0]:null;s.map(A=>{typeof A=="string"?g.push(A):typeof A=="object"&&A.pub&&g.push(A.pub)})}return typeof s=="object"&&s.pub?s.pub:g.length>0?g:null}})(),!s)return console.log("No certificant found.");const f=u.expiry&&(typeof u.expiry=="number"||typeof u.expiry=="string")?parseFloat(u.expiry):null,d=(o||{}).read?o.read:null,p=(o||{}).write?o.write:typeof o=="string"||Array.isArray(o)||o["+"]||o["#"]||o["."]||o["="]||o["*"]||o[">"]||o["<"]?o:null,h=(u||{}).block||(u||{}).blacklist||(u||{}).ban||{},x=h.read&&(typeof h.read=="string"||(h.read||{})["#"])?h.read:null,b=typeof h=="string"?h:h.write&&(typeof h.write=="string"||h.write["#"])?h.write:null;if(!d&&!p)return console.log("No policy found.");const w=JSON.stringify({c:s,...f?{e:f}:{},...d?{r:d}:{},...p?{w:p}:{},...x?{rb:x}:{},...b?{wb:b}:{}});var l=await i.sign(w,a,null,{raw:1});if(u.raw||(l="SEA"+JSON.stringify(l)),c)try{c(l)}catch(g){console.log(g)}return l}catch(f){if(i.err=f,i.throw)throw f;c&&c();return}}),n.exports=i.certify})(e,"./certify"),e(function(n){var i=e("./shim"),s=e("./root");s.work=e("./work"),s.sign=e("./sign"),s.verify=e("./verify"),s.encrypt=e("./encrypt"),s.decrypt=e("./decrypt"),s.certify=e("./certify"),s.random=s.random||i.random,s.Buffer=s.Buffer||e("./buffer"),s.keyid=s.keyid||(async o=>{try{const a=i.Buffer.concat(o.replace(/-/g,"+").replace(/_/g,"/").split(".").map(f=>i.Buffer.from(f,"base64"))),c=i.Buffer.concat([i.Buffer.from([153,a.length/256,a.length%256]),a]),u=await sha1hash(c),l=i.Buffer.from(u,"binary");return l.toString("hex",l.length-8)}catch(a){throw console.log(a),a}}),((s.window||{}).GUN||{}).SEA=s,n.exports=s})(e,"./sea"),e(function(n){var i=e("./sea"),s,o;i.window?s=i.window.GUN||{chain:{}}:s=e((o+""==typeof t?".":"")+"./gun",1),i.GUN=s;function a(u){this._={$:this}}a.prototype=(function(){function u(){}return u.prototype=s.chain,new u})(),a.prototype.constructor=a,s.chain.user=function(u){var l=this,d=l.back(-1),f;if(u)return u=i.opt.pub((u._||"")["#"])||u,d.get("~"+u);if(f=d.back("user"))return f;var d=d._,p=d,h=p.opt.uuid||c;return(p=(f=p.user=l.chain(new a))._).opt={},p.opt.uuid=function(x){var b=h(),w=d.user;return!w||!(w=w.is)||!(w=w.pub)||(b="~"+w+"/"+b,x&&x.call&&x(null,b)),b},f};function c(){return s.state().toString(36).replace(".","")}s.User=a,a.GUN=s,a.SEA=s.SEA=i,n.exports=a})(e,"./user"),e(function(n){var i,s=""+i!=typeof GUN?GUN||{chain:{}}:e((""+i==typeof t?".":"")+"./gun",1);s.chain.then=function(o,a){var c=this,u=new Promise(function(l,f){c.once(l,a)});return o?u.then(o):u}})(e,"./then"),e(function(n){var i=e("./user"),s=i.SEA,o=i.GUN,a=function(){};i.prototype.create=function(...c){var u=typeof c[0]=="object"&&(c[0].pub||c[0].epub)?c[0]:typeof c[1]=="object"&&(c[1].pub||c[1].epub)?c[1]:null,l=u&&(u.pub||u.epub)?u.pub:typeof c[0]=="string"?c[0]:null,f=u&&(u.pub||u.epub)?u:l&&typeof c[1]=="string"?c[1]:null,d=c.filter(g=>typeof g=="function")[0]||null,p=c&&c.length>1&&typeof c[c.length-1]=="object"?c[c.length-1]:{},h=this,x=h._,b=h.back(-1);if(d=d||a,p=p||{},p.check!==!1){var w;if(l||(w="No user."),(f||"").length<8&&(w="Password too short!"),w)return d({err:o.log(w)}),h}if(x.ing)return(d||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),h;x.ing=!0;var m={};return m.a=function(g){if(m.pubs=g,g&&!p.already){var A={err:o.log("User already created!")};x.ing=!1,(d||a)(A),h.leave();return}m.salt=String.random(64),s.work(f,m.salt,m.b)},m.b=function(g){m.proof=g,u?m.c(u):s.pair(m.c)},m.c=function(g){var A;m.pair=g||{},(A=x.root.user)&&(A._.sea=g,A.is={pub:g.pub,epub:g.epub,alias:l}),m.data={pub:g.pub},m.d()},m.d=function(){m.data.alias=l,m.e()},m.e=function(){m.data.epub=m.pair.epub,s.encrypt({priv:m.pair.priv,epriv:m.pair.epriv},m.proof,m.f,{raw:1})},m.f=function(g){m.data.auth=JSON.stringify({ek:g,s:m.salt}),m.g(m.data.auth)},m.g=function(g){var A;m.data.auth=m.data.auth||g,b.get(A="~"+m.pair.pub).put(m.data).on(m.h);var v={};v[A]={"#":A},b.get("~@"+l).put(v).get(A).on(m.i)},m.h=function(g,A,v,T){T.off(),m.h.ok=1,m.i()},m.i=function(g,A,v,T){T&&(m.i.ok=1,T.off()),!(!m.h.ok||!m.i.ok)&&(x.ing=!1,d({ok:0,pub:m.pair.pub}),a===d&&(u?h.auth(u):h.auth(l,f)))},b.get("~@"+l).once(m.a),h},i.prototype.leave=function(c,u){var l=this,f=l.back(-1)._.user;if(f&&(delete f.is,delete f._.is,delete f._.sea),s.window)try{var d={};d=s.window.sessionStorage,delete d.recall,delete d.pair}catch{}return l}})(e,"./create"),e(function(n){var i=e("./user"),s=i.SEA,o=i.GUN,a=function(){};i.prototype.auth=function(...u){var l=typeof u[0]=="object"&&(u[0].pub||u[0].epub)?u[0]:typeof u[1]=="object"&&(u[1].pub||u[1].epub)?u[1]:null,f=!l&&typeof u[0]=="string"?u[0]:null,d=(f||l&&!(l.priv&&l.epriv))&&typeof u[1]=="string"?u[1]:null,p=u.filter(v=>typeof v=="function")[0]||null,h=u&&u.length>1&&typeof u[u.length-1]=="object"?u[u.length-1]:{},x=typeof h.retries=="number"?h.retries:9,b=this,w=b._,m=b.back(-1);if(w.ing)return(p||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),b;w.ing=!0;var g={},A;return g.a=function(v){if(!v)return g.b();if(!v.pub){var T=[];return Object.keys(v).forEach(function(P){P!="_"&&T.push(v[P])}),g.b(T)}if(g.name)return g.f(v);g.c((g.data=v).auth)},g.b=function(v){var T=(g.list=(g.list||[]).concat(v||[])).shift();if(A===T){if(g.name)return g.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer.");if(f&&x--){m.get("~@"+f).once(g.a);return}return g.err("Wrong user or password.")}m.get(T).once(g.a)},g.c=function(v){if(A===v)return g.b();if(typeof v=="string")return g.c(c(v));s.work(d,(g.auth=v).s,g.d,g.enc)},g.d=function(v){s.decrypt(g.auth.ek,v,g.e,g.enc)},g.e=function(v){if(A===v)return g.enc?(g.enc=null,g.b()):(g.enc={encode:"utf8"},g.c(g.auth));g.half=v,g.f(g.data)},g.f=function(v){var T=g.half||{},P=g.data||{};g.g(g.lol={pub:v.pub||P.pub,epub:v.epub||P.epub,priv:v.priv||T.priv,epriv:v.epriv||T.epriv})},g.g=function(v){if(!v||!v.pub||!v.epub)return g.b();g.pair=v;var T=m._.user,P=T._;P.tag;var I=P.opt;P=T._=m.get("~"+v.pub)._,P.opt=I,T.is={pub:v.pub,epub:v.epub,alias:f||v.pub},P.sea=g.pair,w.ing=!1;try{d&&A==(c(w.root.graph["~"+v.pub].auth)||"")[":"]&&(h.shuffle=h.change=d)}catch{}if(h.change?g.z():(p||a)(P),s.window&&(b.back("user")._.opt||h).remember)try{var S={};S=s.window.sessionStorage,S.recall=!0,S.pair=JSON.stringify(v)}catch{}try{m._.tag.auth?m._.on("auth",P):setTimeout(function(){m._.on("auth",P)},1)}catch(N){o.log("Your 'auth' callback crashed with:",N)}},g.h=function(v){if(!v)return g.b();if(f=v.alias,f||(f=v.alias="~"+l.pub),!v.auth)return g.g(l);l=null,g.c((g.data=v).auth)},g.z=function(){g.salt=String.random(64),s.work(h.change,g.salt,g.y)},g.y=function(v){s.encrypt({priv:g.pair.priv,epriv:g.pair.epriv},v,g.x,{raw:1})},g.x=function(v){g.w(JSON.stringify({ek:v,s:g.salt}))},g.w=function(v){if(h.shuffle){console.log("migrate core account from UTF8 & shuffle");var T={};Object.keys(g.data).forEach(function(P){T[P]=g.data[P]}),delete T._,T.auth=v,m.get("~"+g.pair.pub).put(T)}m.get("~"+g.pair.pub).get("auth").put(v,p||a)},g.err=function(v){var T={err:o.log(v||"User cannot be found!")};w.ing=!1,(p||a)(T)},g.plugin=function(v){if(!(g.name=v))return g.err();var T=[v];v[0]!=="~"&&(T[1]="~"+v,T[2]="~@"+v),g.b(T)},l?l.priv&&l.epriv?g.g(l):m.get("~"+l.pub).once(g.h):f?m.get("~@"+f).once(g.a):!f&&!d&&s.name(g.plugin),b};function c(u){if(typeof u!="string")return u;try{u=JSON.parse(u)}catch{u={}}return u}})(e,"./auth"),e(function(n){var i=e("./user"),s=i.SEA;i.GUN,i.prototype.recall=function(o,a){var c=this,u=c.back(-1);if(o=o||{},o&&o.sessionStorage){if(s.window)try{var l={};l=s.window.sessionStorage,l&&(u._.opt.remember=!0,(c.back("user")._.opt||o).remember=!0,(l.recall||l.pair)&&u.user().auth(JSON.parse(l.pair),a))}catch{}return c}return c}})(e,"./recall"),e(function(n){var i=e("./user"),s=i.SEA,o=i.GUN,a=function(){};i.prototype.pair=function(){var c=this,u;try{u=new Proxy({DANGER:"☠"},{get:function(l,f,d){if(!(!c.is||!(c._||"").sea))return c._.sea[f]}})}catch{}return u},i.prototype.delete=async function(c,u,l){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var f=this;f.back(-1);var d=f.back("user");try{d.auth(c,u,function(p){var h=(d.is||{}).pub;d.map().once(function(){this.put(null)}),d.leave(),(l||a)({ok:0})})}catch(p){o.log("User.delete failed! Error:",p)}return f},i.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const c=this.back(-1);try{return await authRecall(c),c._.user._}catch{const l="No session!";throw o.log(l),{err:l}}},i.prototype.trust=async function(c){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),o.is(c)&&c.get("pub").get((u,l)=>{console.log(u,l)}),c.get("trust").get(path).put(theirPubkey)},i.prototype.grant=function(c,u){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var l=this,f=l.back(-1).user(),d=f._.sea,p="";return l.back(function(h){h.is||(p+=h.get||"")}),(async function(){var h,x=await f.get("grant").get(d.pub).get(p).then();x=await s.decrypt(x,d),x||(x=s.random(16).toString(),h=await s.encrypt(x,d),f.get("grant").get(d.pub).get(p).put(h));var b=c.get("pub").then(),w=c.get("epub").then();b=await b,w=await w;var m=await s.secret(w,d);h=await s.encrypt(x,m),f.get("grant").get(b).get(p).put(h,u)})(),l},i.prototype.secret=function(c,u){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var l=this,f=l.back(-1).user(),d=f.pair(),p="";return l.back(function(h){h.is||(p+=h.get||"")}),(async function(){var h,x=await f.get("trust").get(d.pub).get(p).then();x=await s.decrypt(x,d),x||(x=s.random(16).toString(),h=await s.encrypt(x,d),f.get("trust").get(d.pub).get(p).put(h)),h=await s.encrypt(c,x),l.put(h,u)})(),l},n.exports=i})(e,"./share"),e(function(n){var i=e("./sea"),s=e("./settings"),o,a=(i.window||"").GUN||e((""+o==typeof t?".":"")+"./gun",1);a.on("opt",function(h){h.sea||(h.sea={own:{}},h.on("put",c,h)),this.to.next(h)});function c(h){var x=this,b=x.as,w=h.put,m=w["#"],g=w["."],A=w[":"],v=w[">"],T=h["#"],P;if(!(!m||!g)){if((h._||"").faith&&(b.opt||"").faith&&typeof h._=="function"){i.opt.pack(w,function(S){i.verify(S,!1,function(N){w["="]=i.opt.unpack(N),x.to.next(h)})});return}var I=function(S){b.on("in",{"@":T,err:h.err=S})};if((h._||"").DBG&&((h._||"").DBG.c=+new Date),0<=m.indexOf("<?")&&(P=parseFloat(m.split("<?")[1]||""),P&&v<a.state()-P*1e3)){(P=h._)&&P.stun&&P.stun--;return}if(m==="~@"){c.alias(x,h,A,g,m,b,I);return}if(m.slice(0,2)==="~@"){c.pubs(x,h,A,g,m,b,I);return}if(P=i.opt.pub(m)){c.pub(x,h,A,g,m,b,I,b.user||"",P);return}if(0<=m.indexOf("#")){c.hash(x,h,A,g,m,b,I);return}c.any(x,h,A,g,m,b,I,b.user||"")}}c.hash=function(h,x,b,w,m,g,A){i.work(b,null,function(v){function T(P){let I="";for(let S=0;S<P.length;S++)I+=S-1&1?"":String.fromCharCode(parseInt(P.substring(S-1,S+1),16));return btoa(I)}if(v&&v===w.split("#").slice(-1)[0])return h.to.next(x);if(v&&v===T(w.split("#").slice(-1)[0]))return h.to.next(x);A("Data hash not same as hash!")},{name:"SHA-256"})},c.alias=function(h,x,b,w,m,g,A){if(!b)return A("Data must exist!");if("~@"+w===l(b))return h.to.next(x);A("Alias not same!")},c.pubs=function(h,x,b,w,m,g,A){if(!b)return A("Alias must exist!");if(w===l(b))return h.to.next(x);A("Alias not same!")},c.pub=async function(h,x,b,w,m,g,A,v,T){var P;const I=await s.parse(b)||{},S=(N,O,E)=>{if(N.m&&N.s&&O&&T)return i.verify(N,T,y=>{if(o!==y&&o!==y.e&&x.put[">"]&&x.put[">"]>parseFloat(y.e))return A("Certificate expired.");if(o!==y&&y.c&&y.w&&(y.c===O||y.c.indexOf("*")>-1||y.c.indexOf(O)>-1)){let C=m.indexOf("/")>-1?m.replace(m.substring(0,m.indexOf("/")+1),""):"";String.match=String.match||a.text.match;const U=Array.isArray(y.w)?y.w:typeof y.w=="object"||typeof y.w=="string"?[y.w]:[];for(const R of U)if(String.match(C,R["#"])&&String.match(w,R["."])||!R["."]&&String.match(C,R["#"])||!R["#"]&&String.match(w,R["."])||String.match(C?C+"/"+w:w,R["#"]||R)){if(R["+"]&&R["+"].indexOf("*")>-1&&C&&C.indexOf(O)==-1&&w.indexOf(O)==-1)return A(`Path "${C}" or key "${w}" must contain string "${O}".`);if(y.wb&&(typeof y.wb=="string"||(y.wb||{})["#"])){var k=h.as.root.$.back(-1);return typeof y.wb=="string"&&y.wb.slice(0,1)!=="~"&&(k=k.get("~"+T)),k.get(y.wb).get(O).once(B=>B&&(B===1||B===!0)?A(`Certificant ${O} blocked.`):E(y))}return E(y)}return A("Certificate verification fail.")}})};if(w==="pub"&&"~"+T===m)return b===T?h.to.next(x):A("Account not same!");if((P=v.is)&&P.pub&&!I["*"]&&!I["+"]&&(T===P.pub||T!==P.pub&&((x._.msg||{}).opt||{}).cert)){i.opt.pack(x.put,N=>{i.sign(N,v._.sea,async function(O){if(o===O)return A(i.err||"Signature fail.");if(x.put[":"]={":":P=i.opt.unpack(O.m),"~":O.s},x.put["="]=P,T===v.is.pub){(P=l(b))&&((g.sea.own[P]=g.sea.own[P]||{})[T]=1),JSON.stringifyAsync(x.put[":"],function(E,y){return E?A(E||"Stringify error."):(x.put[":"]=y,h.to.next(x))});return}if(T!==v.is.pub&&((x._.msg||{}).opt||{}).cert){const E=await s.parse(x._.msg.opt.cert);E&&E.m&&E.s&&S(E,v.is.pub,y=>{x.put[":"]["+"]=E,x.put[":"]["*"]=v.is.pub,JSON.stringifyAsync(x.put[":"],function(k,C){return k?A(k||"Stringify error."):(x.put[":"]=C,h.to.next(x))})})}},{raw:1})});return}i.opt.pack(x.put,N=>{i.verify(N,I["*"]||T,function(O){var E;if(O=i.opt.unpack(O),o===O)return A("Unverified data.");if((E=l(O))&&T===i.opt.pub(E)&&((g.sea.own[E]=g.sea.own[E]||{})[T]=1),I["+"]&&I["+"].m&&I["+"].s&&I["*"])S(I["+"],I["*"],y=>(x.put["="]=O,h.to.next(x)));else return x.put["="]=O,h.to.next(x)})})},c.any=function(h,x,b,w,m,g,A,v){if(g.opt.secure)return A("Soul missing public key at '"+w+"'.");g.on("secure",function(T){if(this.off(),!g.opt.secure)return h.to.next(T);A("Data cannot be changed.")}).on.on("secure",x)};var u=a.valid,l=function(h,x){return typeof(x=u(h))=="string"&&x};(a.state||"").ify;var f=/[^\w_-]/;i.opt.pub=function(h){if(h&&(h=h.split("~"),!(!h||!(h=h[1]))&&(h=h.split(f).slice(0,2),!(!h||h.length!=2)&&(h[0]||"")[0]!=="@")))return h=h.slice(0,2).join("."),h},i.opt.stringy=function(h){},i.opt.pack=function(h,x,b,w,m){var g,A;if(i.opt.check(h))return x(h);h&&h["#"]&&h["."]&&h[">"]&&(g=h[":"],A=1),JSON.parseAsync(A?g:h,function(v,T){var P=o!==(T||"")[":"]&&(T||"")["~"];if(!P){x(h);return}x({m:{"#":m||h["#"],".":b||h["."],":":(T||"")[":"],">":h[">"]||a.state.is(w,b)},s:P})})};var d=i.opt;i.opt.unpack=function(h,x,b){var w;if(o!==h){if(h&&o!==(w=h[":"]))return w;if(x=x||d.fall_key,!b&&d.fall_val&&(b={},b[x]=d.fall_val),!(!x||!b)){if(h===b[x]||!i.opt.check(b[x]))return h;var m=b&&b._&&b._["#"]||d.fall_soul,g=a.state.is(b,x)||d.fall_state;if(h&&h.length===4&&m===h[0]&&x===h[1]&&p(g)===p(h[3]))return h[2];if(g<i.opt.shuffle_attack)return h}}},i.opt.shuffle_attack=15463296e5;var p=Math.floor})(e,"./index")})()})(Qs)),Qs.exports}var I4=C4();const Ge=tb(I4);var Bd={},_d;function k4(){if(_d)return Bd;_d=1;var r=typeof window<"u"?window.Gun:Pn();return r.chain.promise=function(n){var t=this,n=n||function(i){return i};return new Promise(function(i,s){t.once(function(o,a){i({put:o,get:a,gun:this})})}).then(n)},r.chain.then=function(e){var t=this,n=new Promise((i,s)=>{t.once(function(o,a){i(o,a)})});return e?n.then(e):n},Bd}k4();var Ya={exports:{}},Ld;function xf(){return Ld||(Ld=1,(function(){function r(){var s=function(o,a,c){if(s.unit=0,!c&&n!==a&&(s.last=""+o<s.last?s.last:""+o,delete(s.$||{})[i]),c=c||s.$||(s.$={}),!o&&Object.keys(c).length)return c;o=""+o;for(var u=0,l=o.length-1,f=o[u],d,p;!(d=c[f])&&u<l;)f+=o[++u];if(d)if(u==l){if(n===a)return n===(p=d[""])?d:(s.unit=1)&&p;d[""]=a}else return n!==a&&delete d[i],s(o.slice(++u),a,d||(d={}));else{if(!e(c,function(h,x){var b=0,w="";if((x||"").length)for(;x[b]==o[b];)w+=x[b++];if(w){if(n===a)return b<=l?void 0:((p||(p={}))[x.slice(b)]=h,h);var m={};if(m[x.slice(b)]=h,b=o.slice(b),b===""?m[""]=a:(m[b]={})[""]=a,c[w]=m,r.debug&&""+w=="undefined"){console.log(0,w);debugger}return delete c[x],!0}})){if(n===a)return;if((c[f]||(c[f]={}))[""]=a,r.debug&&""+f=="undefined"){console.log(1,f);debugger}}if(n===a)return p}};return s}r.map=function s(o,a,c,u){try{u=u||[];var l=typeof o=="function"?o.$||{}:o;//!opt && console.log("WHAT IS T?", JSON.stringify(t).length);
if(!l)return;if(typeof l=="string"){if(r.debug)throw["BUG:",o,a,c,u];return}var f=(l[i]||t).sort||(l[i]=(function I(){return I.sort=Object.keys(l).sort(),I})()).sort,d;c=c===!0?{branch:!0}:c||{},(d=c.reverse)&&(f=f.slice(0).reverse());for(var p=c.start,h=c.end,x="￿",b=0,w=f.length;b<w;b++){var m=f[b],g=l[m],A,v,T;if(!(!g||m===""||i===m||m==="undefined")&&(v=u.slice(0),v.push(m),T=v.join(""),!(n!==p&&T<(p||"").slice(0,T.length))&&!(n!==h&&(h||x)<T))){if(d&&(A=s(g,a,c,v),n!==A))return A;if(n!==(A=g[""])){var P=1;if(n!==p&&T<(p||"")&&(P=0),n!==h&&T>(h||x)&&(P=0),P&&(A=a(A,T,m,u),n!==A))return A}else if(c.branch&&(A=a(n,T,m,u),n!==A))return A;if(u=v,!d&&(A=s(g,a,c,u),n!==A))return A;u.pop()}}}catch(I){console.error(I)}},(function(s,o){typeof window<"u"&&(window[s]=window[s]||o);try{Ya.exports=o}catch{}})("Radix",r);var e=r.object=function(s,o,a){for(var c in s)if(s.hasOwnProperty(c)&&(a=o(s[c],c))!==n)return a},t={},n,i=""})()),Ya.exports}xf();var Xa={exports:{}},ec={exports:{}},Dd;function T4(){return Dd||(Dd=1,(function(r){(function(){var e={},t,n=setTimeout.turn||typeof setImmediate!=""+t&&setImmediate||setTimeout;e.parseAsync=function(s,o,a,c){if(typeof s!="string"){try{o(t,JSON.parse(s))}catch(f){o(f)}return}var u={i:0,text:s,done:o,l:s.length,up:[]};c=c||1024*32,l();function l(){for(var f=u.text,d=u.i,p=u.l,h=0,x=u.w,b,w;h++<c;){var m=f[d++];if(d>p){u.end=!0;break}if(x){for(d=f.indexOf('"',d-1),m=f[d],w=0;f[d-++w]=="\\";);w=!(w%2),b=b||w,m=='"'&&!w&&(x=t,w=u.s,u.a?(w=f.slice(u.sl,d),(b||1+w.indexOf("\\"))&&(w=JSON.parse('"'+w+'"')),u.at instanceof Array?u.at.push(u.s=w):(u.at||(u.end=h=c,w=t),(u.at||{})[u.s]=u.s=w),u.s=t):(u.s=f.slice(u.sl,d),(b||1+u.s.indexOf("\\"))&&(u.s=JSON.parse('"'+u.s+'"'))),u.a=b=t),++d}else switch(m){case'"':u.sl=d,x=!0;break;case":":u.ai=d,u.a=!0;break;case",":(u.a||u.at instanceof Array)&&(w=f.slice(u.ai,d-1))&&t!==(w=i(w))&&(u.at instanceof Array?u.at.push(w):u.at[u.s]=w),u.a=t,u.at instanceof Array&&(u.a=!0,u.ai=d);break;case"{":u.up.push(u.at||(u.at={})),u.at instanceof Array?u.at.push(u.at={}):t!==(w=u.s)&&(u.at[w]=u.at={}),u.a=t;break;case"}":u.a&&(w=f.slice(u.ai,d-1))&&t!==(w=i(w))&&(u.at instanceof Array?u.at.push(w):(u.at||(u.end=h=c,w=t),(u.at||{})[u.s]=w)),u.a=t,u.at=u.up.pop();break;case"[":t!==(w=u.s)?(u.up.push(u.at),u.at[w]=u.at=[]):u.at||u.up.push(u.at=[]),u.a=!0,u.ai=d;break;case"]":u.a&&(w=f.slice(u.ai,d-1))&&t!==(w=i(w))&&(u.at instanceof Array?u.at.push(w):u.at[u.s]=w),u.a=t,u.at=u.up.pop();break}}if(u.s=t,u.i=d,u.w=x,u.end){if(w=u.at,t===w)try{w=JSON.parse(s)}catch(g){return u.done(g)}u.done(t,w)}else n(l)}};function i(s){var o=parseFloat(s);if(!isNaN(o))return o;if(s=s.trim(),s=="true")return!0;if(s=="false")return!1;if(s=="null")return null}e.stringifyAsync=function(s,o,a,c,u){u=u||{},u.text=u.text||"",u.up=[u.at={d:s}],u.done=o,u.i=0;var l=0;f();function f(){var d=u.at,p=d.d,h="",x;switch(d.i&&d.i-d.j>0&&(h+=","),t!==(x=d.k)&&(h+=JSON.stringify(x)+":"),typeof p){case"boolean":h+=""+p;break;case"string":h+=JSON.stringify(p);break;case"number":h+=isNaN(p)?"null":p;break;case"object":if(!p){h+="null";break}if(p instanceof Array){h+="[",d={i:-1,as:p,up:d,j:0},d.l=p.length,u.up.push(u.at=d);break}if(typeof(p||"").toJSON!="function"){h+="{",d={i:-1,ok:Object.keys(p).sort(),as:p,up:d,j:0},d.l=d.ok.length,u.up.push(u.at=d);break}if(x=p.toJSON()){h+=x;break}case"function":if(d.as instanceof Array){h+="null";break}default:h="",d.j++}for(u.text+=h;1+d.i>=d.l;)u.text+=d.ok?"}":"]",d=u.at=d.up;if(++d.i<d.l){if((x=d.ok)?d.d=d.as[d.k=x[d.i]]:d.d=d.as[d.i],++l<9)return f();l=0,n(f);return}u.done(t,u.text)}},typeof window!=""+t&&(window.YSON=e);try{""+t!="object"&&(r.exports=e)}catch{}typeof JSON!=""+t&&(JSON.parseAsync=e.parseAsync,JSON.stringifyAsync=e.stringifyAsync)})()})(ec)),ec.exports}var tc,Md;function P4(){return Md||(Md=1,tc=function(r){var e=xf();r.find("a",function(){var t=[];e.map(r.list,function(s,o){o.indexOf("%1B")+1&&s&&t.push([o,s])}),t.length&&console.log(`
! ! ! WARNING ! ! !
RAD v0.2020.x has detected OLD v0.2019.x data & automatically migrating. Automatic migration will be turned OFF in future versions! If you are just developing/testing, we recommend you reset your data. Please contact us if you have any concerns.
This message should only log once.`);var n,i;t.forEach(function(s){n=s[0],i=s[1],r.list(decodeURIComponent(n),i),r.list(n,0)}),n&&r.find.bad(n)})}),tc}var $d;function rb(){return $d||($d=1,(function(){function r(n){n=n||{},n.log=n.log||console.log,n.file=String(n.file||"radata");var i=(r.has||(r.has={}))[n.file];if(i)return i;n.max=n.max||(n.memory?n.memory*999*999:3e8)*.3,n.until=n.until||n.wait||250,n.batch=n.batch||10*1e3,n.chunk=n.chunk||1024*1024*1,n.code=n.code||{},n.code.from=n.code.from||"!",n.jsonify=!0;function s(b){return encodeURIComponent(b).replace(/\*/g,"%2A")}function o(b){return x!==b&&(!b||typeof b!="object")}var a=""+x==typeof setImmediate?setTimeout:setImmediate,c=setTimeout.turn||a,x,u=t.object,l=0;if(!n.store)return n.log("ERROR: Radisk needs `opt.store` interface with `{get: fn, put: fn (, list: fn)}`!");if(!n.store.put)return n.log("ERROR: Radisk needs `store.put` interface with `(file, data, cb)`!");if(!n.store.get)return n.log("ERROR: Radisk needs `store.get` interface with `(file, cb)`!");n.store.list,""+x!=typeof pf&&T4();var f=JSON.parseAsync||function(b,w,m){var g;try{w(g,JSON.parse(b,m))}catch(A){w(A)}},d=function(b,w,m,g,A){if(typeof w=="function"){var v=m||{};m=w,d.read(b,m,v,A||g);return}d.save(b,w,m,g,A)};d.save=function(b,w,m,g,A){var v={key:b},T,P;v.find=function(I){var S;if(v.file=I||(I=n.code.from),A&&(A=A[I]=A[I]||{}),A&&(A.sf=A.sf||+new Date),S=d.disk[I]){v.mix(x,S);return}d.parse(I,v.mix,x,A)},v.mix=function(I,S){if(A&&(A.sml=+new Date),A&&(A.sm=A.sm||+new Date),v.err=I||v.err){m(I);return}var N=v.file=(S||"").file||v.file,O;if(!S&&N!==n.code.from){d.find.bad(N),d.save(b,w,m,g);return}if((S=d.disk[N]||(d.disk[N]=S||t())).file||(S.file=N),n.compare&&(w=n.compare(S(b),w,b,N),x===w)){m(I,-1);return}if((v.disk=S)(b,w),g&&((O=(O=S.tags||(S.tags={}))[g]||(O[g]=d.tags[g]||(d.tags[g]={})))[N]||(O[N]=d.one[g]||(d.one[g]=m)),m=null),A&&(A.st=A.st||+new Date),S.Q){m&&S.Q.push(m);return}S.Q=m?[m]:[],S.to=setTimeout(v.write,n.until)},v.write=function(){A&&(A.sto=A.sto||+new Date);var I=T=v.file,S=v.disk;P=v.q=S.Q,v.tags=S.tags,delete S.Q,delete d.disk[I],delete S.tags,d.write(I,S,v.ack,x,A)},v.ack=function(I,S){A&&(A.sa=A.sa||+new Date),A&&(A.sal=P.length);var N,O;for(var E in d.tags)if(d.tags.hasOwnProperty(E)){var y=d.tags[E];if(!((O=d.disk[T])&&(O=O.tags)&&O[y])){N=y[T],delete y[T];var k;for(var C in y)if(y.hasOwnProperty(C)){k=!0;break}k||(delete d.tags[y],N&&N(I,S))}}!P&&(P="");for(var U=P.length,R=0,B=+new Date;R<U;R++)(N=P[R])&&N(I,S);console.STAT&&console.STAT(B,+new Date-B,"rad acks",s(v.file)),console.STAT&&console.STAT(B,P.length,"rad acks #",s(v.file))},m||(m=function(I,S){}),d.find(b,v.find)},d.disk={},d.one={},d.tags={};var p=0;d.write=function(b,w,m,g,A){if(!w){m("No radix!");return}g=typeof g=="object"?g:{force:g};var v=function(){},T,P;if(v.text="",v.file=b=w.file||(w.file=b),!b){m("What file?");return}if(v.write=function(){var I=w.raw=v.text;d.disk[b=w.file||v.file||b]=w;var S=+new Date;A&&(A.wd=S),d.find.add(b,function(O){if(A&&(A.wa=+new Date),O){m(O);return}n.store.put(s(b),I,function(y,k){A&&(A.wp=+new Date),console.STAT&&console.STAT(S,l=+new Date-S,"wrote disk",JSON.stringify(b),++p,"total all writes."),m(y,k||1),w.Q||delete d.disk[b]})})},v.split=function(){var I=+new Date;A&&(A.wf=I),v.text="",v.count||(v.count=0,t.map(w,function(){v.count++})),A&&(A.wfc=v.count),v.limit=Math.ceil(v.count/2);var S=v.count;return v.count=0,A&&(A.wf1=+new Date),v.sub=t(),t.map(w,v.slice,{reverse:1}),A&&(A.wf2=+new Date),d.write(v.end,v.sub,v.both,g),A&&(A.wf3=+new Date),v.hub=t(),t.map(w,v.stop),A&&(A.wf4=+new Date),d.write(w.file,v.hub,v.both,g),A&&(A.wf5=+new Date),console.STAT&&console.STAT(I,+new Date-I,"rad split",s(w.file),S),!0},v.slice=function(I,S){if(v.sub(v.end=S,I),v.limit<=++v.count)return!0},v.stop=function(I,S){if(S>=v.end)return!0;v.hub(S,I)},v.both=function(I,S){if(A&&(A.wfd=+new Date),P){m(I||P);return}if(T){m(I,S);return}T=!0,P=I},v.each=function(I,S,N,O){if(x!==I&&v.count++,n.max<=(I||"").length)return m("Data too big!"),!0;var E=r.encode(O.length)+"#"+r.encode(N)+(x===I?"":":"+r.encode(I))+`
`;if(n.chunk<v.text.length+E.length&&1<v.count&&!g.force)return v.split();v.text+=E},n.jsonify){d.write.jsonify(v,w,m,g,A);return}t.map(w,v.each,!0)||v.write()},d.write.jsonify=function(b,w,m,g,A){var v,T=+new Date;A&&(A.w=T);try{v=JSON.stringify(w.$)}catch{m("Cannot radisk!");return}if(A&&(A.ws=+new Date),console.STAT&&console.STAT(T,+new Date-T,"rad stringified JSON"),n.chunk<v.length&&!g.force){var P=0;if(t.map(w,function(){if(P++)return!0}),P>1)return b.split()}b.text=v,b.write()},d.range=function(b,w){if(!(!b||!w)){if(x===w.start&&x===w.end||o(b))return b;var m=t();return t.map(b,function(g,A){m(A,g)},w),m("")}},(function(){d.read=function(b,w,m,g){m=m||{};var A={key:b};A.find=function(v){var T;if(A.file=v||(v=n.code.from),g&&(g=g[v]=g[v]||{}),g&&(g.rf=g.rf||+new Date),T=d.disk[A.file=v]){A.check(x,T);return}d.parse(v,A.check,x,g)},A.get=function(v,T,P){if(g&&(g.rgl=+new Date),g&&(g.rg=g.rg||+new Date),A.err=v||A.err){w(v);return}var I=A.file=(T||"").file||A.file;if(!T&&I!==n.code.from){d.find.bad(I),d.read(b,w,m);return}if(T=d.disk[I]||(d.disk[I]=T),!T){w(I===n.code.from?x:"No file!");return}T.file||(T.file=I);var S=d.range(T(b),m);if(g&&(g.rr=+new Date),m.unit=T.unit,m.chunks=(m.chunks||0)+1,m.parsed=(m.parsed||0)+((P||"").parsed||m.chunks*n.chunk),m.more=1,m.next=x,t.map(d.list,function(y,k){if(!(!y||I===k))return m.next=k,1},m.reverse?{reverse:1,end:I}:{start:I}),g&&(g.rl=+new Date),m.next||(m.more=0),m.next&&(!m.reverse&&(b<m.next&&m.next.indexOf(b)!=0||x!==m.end&&(m.end||"￿")<m.next)&&(m.more=0),m.reverse&&(b>m.next&&b.indexOf(m.next)!=0||x!==m.start&&(m.start||"")>m.next&&I<=m.start)&&(m.more=0)),!m.more){w(A.err,S,m);return}if(S&&w(A.err,S,m),!(m.parsed>=m.limit)){var N=+new Date;g&&(g.rm=N);var O=m.next;a(function(){console.STAT&&console.STAT(N,+new Date-N,"rad more"),d.parse(O,A.check)},0)}},A.check=function(v,T,P){if(A.get(v,T,P),!(!T||T.check)){T.check=1;var I=+new Date;(P||(P={})).file||(P.file=A.file),t.map(T,function(S,N){d.find(N,function(O){if((O||(O=n.code.from))!==P.file){var E=(""+Math.random()).slice(-3);c(function(){d.save(N,S,function y(k,C){if(k){d.save(N,S,y);return}console.STAT&&console.STAT("MISLOCATED DATA CORRECTED",E,s(N),s(P.file),s(O))})},0)}})}),console.STAT&&console.STAT(I,+new Date-I,"rad check")}},d.find(b||(m.reverse?m.end||"":m.start||""),A.find)}})(),(function(){var b=0,w={},m="";d.parse=function(g,A,v,T){var P;if(!g)return A();if(P=w[g]){P.push(A);return}P=w[g]=[A];var I=function(){},S={file:g};(I.disk=t()).file=g,I.read=function(O,E){if(T&&(T.rpg=+new Date),console.STAT&&console.STAT(N,+new Date-N,"read disk",JSON.stringify(g),++b,"total all parses."),(I.err=O)||(I.not=!E)){delete w[g],I.map(P,I.ack);return}if(typeof E!="string"){try{n.max<=E.length?I.err="Chunk too big!":E=E.toString()}catch(y){I.err=y}if(I.err){delete w[g],I.map(P,I.ack);return}}if(S.parsed=E.length,T&&(T.rpl=S.parsed),T&&(T.rpa=P.length),N=+new Date,!(n.jsonify||E[0]==="{")){I.radec(O,E);return}f(E,function(y,k){if(!y){delete w[g],I.disk.$=k,console.STAT&&(l=+new Date-N)>9&&console.STAT(N,l,"rad parsed JSON"),T&&(T.rpd=+new Date),I.map(P,I.ack);return}if(E[0]==="{"){delete w[g],I.err="JSON error!",I.map(P,I.ack);return}I.radec(y,E)})},I.map=function(){if(!(!P||!P.length)){for(var O=+new Date,E=I.err,y=I.not?x:I.disk,k=0,C;k<9&&(C=P[k++]);)C(E,y,S);console.STAT&&console.STAT(O,+new Date-O,"rad packs",s(g)),console.STAT&&console.STAT(O,k,"rad packs #",s(g)),(P=P.slice(k)).length&&c(I.map,0)}},I.ack=function(O){if(O){if(I.err||I.not){O(I.err,x,S);return}O(x,I.disk,S)}},I.radec=function(O,E){delete w[g],N=+new Date;var y=I.split(E),k=[],C,U,R;if(!y||y[1]!==0){I.err="File '"+g+"' does not have root radix! ",I.map(P,I.ack);return}for(;y;)U=R=x,C=y[1],y=I.split(y[2])||"",y[0]=="#"&&(U=y[1],k=k.slice(0,C),C<=k.length&&k.push(U)),y=I.split(y[2])||"",y[0]!=`
`&&((y[0]=="="||y[0]==":")&&(R=y[1]),x!==U&&x!==R&&I.disk(k.join(""),R),y=I.split(y[2]));console.STAT&&console.STAT(N,+new Date-N,"parsed RAD"),I.map(P,I.ack)},I.split=function(O){if(O){var E=[],y={},k=-1,C="";if(k=O.indexOf(m),!!O[k])return C=O.slice(0,k),E[0]=C,E[1]=r.decode(O.slice(k),y),E[2]=O.slice(k+y.i),E}},d.disk&&(v||(v=(d.disk[g]||"").raw));var N=+new Date;if(T&&(T.rp=N),v)return c(function(){I.read(x,v)},0);n.store.get(s(g),I.read)}})(),(function(){var b,w="",m;d.find=function(v,T){if(!b){if(m){m.push([v,T]);return}m=[[v,T]],d.parse(w,g);return}t.map(d.list=b,function(P,I){if(P)return T(I)||!0},{reverse:1,end:v})||T(n.code.from)},d.find.add=function(v,T){var P=b(v);if(P||v===w){T(x,1);return}b(v,1),T.found=(T.found||0)+1,d.write(w,b,function(I,S){if(I){T(I);return}T.found=(T.found||0)-1,T.found===0&&T(x,1)},!0)},d.find.bad=function(v,T){b(v,0),d.write(w,b,T||h)};function g(v,T){if(v){n.log("list",v),setTimeout(function(){d.parse(w,g)},1e3);return}if(T){A(T);return}if(b=b||T||t(),!n.store.list){A(b);return}n.store.list(function(P){if(!P){A(b);return}d.find.add(P,h)})}function A(v,T){b=b||v,b.file=w,T=m,m=null,u(T,function(P){d.find(P[0],P[1])})}})();try{!e.window&&P4()(d)}catch{}var h=function(){},x;return r.has[n.file]=d,d}(function(){var n="";r.encode=function(i,s,o){o=o||n;var a=o,c;if(typeof i=="string"){for(var u=i.indexOf(o);u!=-1;)a+=o,u=i.indexOf(o,u+1);return a+'"'+i+o}else{if(i&&i["#"]&&Object.keys(i).length==1)return a+"#"+c+a;if(typeof i=="number")return a+"+"+(i||0)+a;if(i===null)return a+" "+a;if(i===!0)return a+"+"+a;if(i===!1)return a+"-"+a}},r.decode=function(i,s,o){o=o||n;var a="",c=-1,u=0,l,f;if(o===i[0]){for(;o===i[++c];)++u;for(f=i[l=u]||!0;--u>=0;)c=i.indexOf(o,c+1);if(c==-1&&(c=i.length),a=i.slice(l+1,c),s&&(s.i=c+1),f==='"')return a;if(f==="#")return{"#":a};if(f==="+")return a.length===0?!0:parseFloat(a);if(f===" ")return null;if(f==="-")return!1}}})();var e=typeof window<"u"&&window.Gun?window.Gun:Pn(),t=typeof window<"u"&&window.Radix?window.Radix:xf();r.Radix=t,((n,i)=>{try{Xa.exports=i}catch{}typeof window<"u"&&(window[n]=window[n]||i)})("Radisk",r)})()),Xa.exports}rb();var Fd={},Gd;function N4(){if(Gd)return Fd;Gd=1;var r={},e=typeof window<"u"?window.Gun:Pn();return e.on("create",function(t){e.TESTING&&(t.opt.file="radatatest"),this.to.next(t);var n=t.opt,i;if(!(n.rad===!1||n.radisk===!1)&&!(i+""!=typeof process&&""+(r||"").RAD=="false")){var s=e.window&&e.window.Radisk||rb(),o=s.Radix,a=s(n),c="\x1B",u=0;t.on("put",function(f){if(this.to.next(f),!(f._||"").rad){var d=f["#"],p=f.put,h=p["#"],x=p["."],b=p[":"],w=p[">"],m=(f._||"").DBG;m&&(m.sp=m.sp||+new Date);var g=(f._||"").RPS||((f._||"").RPS=+new Date);a(h+c+x,{":":b,">":w},function(A,v){if(m&&(m.spd=m.spd||+new Date),console.STAT&&console.STAT(g,+new Date-g,"put"),A){t.on("in",{"@":d,err:A,DBG:m});return}t.on("in",{"@":d,ok:v,DBG:m})},!1,m&&(m.r=m.r||{})),m&&(m.sps=m.sps||+new Date)}}),t.on("get",function(f){this.to.next(f);var d=f._||"",p=d.DBG=f.DBG;p&&(p.sg=+new Date);var h=f["#"],x=f.get,b=f.get["#"],w=f.get["."]||"",m={},g,A,v,T;if(typeof b=="string"?A=b:b&&(i!==(v=b["*"])&&(m.limit=T=1),i!==b[">"]&&(m.start=b[">"]),i!==b["<"]&&(m.end=b["<"]),A=T?""+v:v||b["="],T=null),A&&!m.limit&&(typeof w=="string"?A=A+c+(m.atom=w):w&&(i!==w[">"]&&(m.start=w[">"],m.limit=1),i!==w["<"]&&(m.end=w["<"],m.limit=1),i!==(v=w["*"])&&(m.limit=T=1),A&&(A=A+c+(T?""+(v||""):v||(m.atom=w["="]||""))))),((v=x["%"])||m.limit)&&(m.limit=v<=(m.pack||1e3*100)?v:1),(w["-"]||(b||{})["-"]||x["-"])&&(m.reverse=!0),(v=(t.next||"")[b])&&v.put){if(m.atom){if(v=(v.next||"")[m.atom],v&&v.root&&v.root.graph&&v.root.graph[b]&&v.root.graph[b][m.atom])return}else if(v&&v.rad)return}var P=e.state(),I=+new Date,S=0;p&&(p.sgm=I),a(A||"",function(O,E,y){p&&(p.sgr=+new Date),p&&(p.sgi=y);try{n.store.stats.get.time[l%50]=+new Date-I,++l,n.store.stats.get.count++,O&&(n.store.stats.get.err=O)}catch{}console.STAT&&console.STAT(I,+new Date-I,"got",JSON.stringify(A)),I=+new Date,y=y||"";var k,C;if(y.unit&&E&&i!==(k=E[":"])&&i!==(C=E[">"])){var U=A.split(c),R=U[0],B=U[1];(g=g||{})[R]=e.state.ify(g[R],B,C,k,R),t.$.get(R).get(B)._.rad=P}else E&&(typeof E!="string"&&(m.atom?E=i:o.map(E,N,m)),!g&&E&&N(E,""),!m.atom&&!w&typeof b=="string"&&!m.limit&&!m.more&&(t.$.get(b)._.rad=P));p&&(p.sgp=+new Date),console.STAT&&(u=+new Date-I)>9&&(console.STAT(I,u,"got prep time"),console.STAT(I,S,"got prep #")),S=0,I=+new Date;var L=function(){};L.faith=!0,L.rad=x,t.on("in",{"@":h,put:g,"%":y.more?1:i,err:O||i,_:L,DBG:p}),console.STAT&&(u=+new Date-I)>9&&console.STAT(I,u,"got emit",Object.keys(g||{}).length),g=i},m,p&&(p.r=p.r||{})),p&&(p.sgd=+new Date),console.STAT&&(u=+new Date-I)>9&&console.STAT(I,u,"get call");function N(O,E,y,k){if(S++,!!O){E=(A+E).split(c);var C=E.slice(0,1)[0];if(E=E.slice(-1)[0],m.limit&&m.limit<=m.count)return!0;var U,R,B=C,L=E;if(typeof O!="string"){U=O[":"],R=O[">"],(g=g||{})[B]=e.state.ify(g[B],L,R,U,B),m.count=(m.count||0)+((U||"").length||9);return}m.count=(m.count||0)+O.length;var D=O.lastIndexOf(">"),M=s.decode(O.slice(D+1),null,c);O=s.decode(O.slice(0,D),null,c),(g=g||{})[C]=e.state.ify(g[C],E,M,O,C)}}}),e.valid,(n.store||{}).stats={get:{time:{},count:0},put:{time:{},count:0}};var l=0}}),Fd}N4();var rc={exports:{}},Hd;function O4(){return Hd||(Hd=1,(function(){function r(t){t=t||{},t.file=String(t.file||"radata");var n=r[t.file],i=null,s;if(n)return console.log("Warning: reusing same IndexedDB store and options as 1st."),r[t.file];n=r[t.file]=function(){};try{t.indexedDB=t.indexedDB||r.indexedDB||indexedDB}catch{}try{if(!t.indexedDB||location.protocol=="file:"){var o=n.d||(n.d={});return n.put=function(a,c,u){o[a]=c,setTimeout(function(){u(null,1)},250)},n.get=function(a,c){setTimeout(function(){c(null,o[a]||s)},5)},console.log("Warning: No indexedDB exists to persist data to!"),n}}catch{}return n.start=function(){var a=indexedDB.open(t.file,1);a.onupgradeneeded=function(c){c.target.result.createObjectStore(t.file)},a.onsuccess=function(){i=a.result},a.onerror=function(c){console.log(c||1)}},n.start(),n.put=function(a,c,u){if(!i){setTimeout(function(){n.put(a,c,u)},1);return}var l=i.transaction([t.file],"readwrite"),f=l.objectStore(t.file),d=f.put(c,""+a);d.onsuccess=f.onsuccess=l.onsuccess=function(){u(null,1)},d.onabort=f.onabort=l.onabort=function(p){u(p||"put.tx.abort")},d.onerror=f.onerror=l.onerror=function(p){u(p||"put.tx.error")}},n.get=function(a,c){if(!i){setTimeout(function(){n.get(a,c)},9);return}var u=i.transaction([t.file],"readonly"),l=u.objectStore(t.file),f=l.get(""+a);f.onsuccess=function(){c(null,f.result)},f.onabort=function(d){c(d||4)},f.onerror=function(d){c(d||5)}},setInterval(function(){i&&i.close(),i=null,n.start()},1e3*15),n}if(typeof window<"u")(r.window=window).RindexedDB=r,r.indexedDB=window.indexedDB;else try{rc.exports=r}catch{}try{var e=r.window.Gun||Pn();e.on("create",function(t){this.to.next(t),t.opt.store=t.opt.store||r(t.opt)})}catch{}})()),rc.exports}O4();var Kd={},jd;function U4(){return jd||(jd=1,(function(){var r=typeof window<"u"?window.Gun:Pn();r.on("opt",function(e){this.to.next(e);var t=e.opt;if(e.once||!r.Mesh||t.RTCPeerConnection===!1)return;var n;typeof window<"u"&&(n=window),typeof Di<"u"&&(n=Di),n=n||{};var i=t.RTCPeerConnection||n.RTCPeerConnection||n.webkitRTCPeerConnection||n.mozRTCPeerConnection,s=t.RTCSessionDescription||n.RTCSessionDescription||n.webkitRTCSessionDescription||n.mozRTCSessionDescription,o=t.RTCIceCandidate||n.RTCIceCandidate||n.webkitRTCIceCandidate||n.mozRTCIceCandidate;if(!i||!s||!o)return;t.RTCPeerConnection=i,t.RTCSessionDescription=s,t.RTCIceCandidate=o,t.rtc=t.rtc||{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}]},t.rtc.dataChannel=t.rtc.dataChannel||{ordered:!1,maxRetransmits:2},t.rtc.sdp=t.rtc.sdp||{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}},t.rtc.max=t.rtc.max||55,t.rtc.room=t.rtc.room||r.window&&(location.hash.slice(1)||location.pathname.slice(1)),t.announce=function(f){t.rtc.start=+new Date,e.$.get("/RTC/"+t.rtc.room+"<?99").get("+").put(t.pid,function(d){!d.ok||!d.ok.rtc||u(d)},{acks:t.rtc.max}).on(function(d,p,h){d===t.pid||t.rtc.start>h.put[">"]||u({"#":""+h["#"],ok:{rtc:{id:d}}})})};var a=t.mesh=t.mesh||r.Mesh(e),c=a.wire;a.hear.rtc=u,a.wire=function(f){try{if(c&&c(f),!(f instanceof MediaStream))return;(l.media=l.media||{})[f.id]=f;for(var d in t.peers)d=t.peers[d]||"",d.addTrack&&f.getTracks().forEach(p=>{d.addTrack(p,f)}),d.createOffer&&d.createOffer(function(p){d.setLocalDescription(p),a.say({"#":e.ask(u),dam:"rtc",ok:{rtc:{offer:p,id:t.pid}}},d)},function(){},t.rtc.sdp)}catch(p){console.log(p)}},e.on("create",function(f){this.to.next(f),setTimeout(t.announce,1)});function u(f){if(f.ok){var d=f.ok.rtc,p,h;if(!(!d||!d.id||d.id===t.pid)){if(p=l(f,d),h=d.candidate)return p.addIceCandidate(new t.RTCIceCandidate(h));if(h=d.answer)return h.sdp=h.sdp.replace(/\\r\\n/g,`\r
`),p.setRemoteDescription(p.remoteSet=new t.RTCSessionDescription(h));if(h=d.offer)return d.offer.sdp=d.offer.sdp.replace(/\\r\\n/g,`\r
`),p.setRemoteDescription(new t.RTCSessionDescription(h)),p.createAnswer(function(x){p.setLocalDescription(x),e.on("out",{"@":f["#"],ok:{rtc:{answer:x,id:t.pid}}})},function(){},t.rtc.sdp)}}}function l(f,d,p){if(p=t.peers[d.id]||l[d.id])return p;(p=new t.RTCPeerConnection(t.rtc)).id=d.id;var h=p.wire=p.createDataChannel("dc",t.rtc.dataChannel);function x(w){w.peer=p,gun.on("rtc",w)}if(p.$=gun,l[d.id]=p,p.ontrack=x,p.onremovetrack=x,p.onconnectionstatechange=x,h.to=setTimeout(function(){delete l[d.id]},1e3*60),h.onclose=function(){a.bye(p)},h.onerror=function(w){},h.onopen=function(w){delete l[d.id],a.hi(p)},h.onmessage=function(w){w&&a.hear(w.data||w,p)},p.onicecandidate=function(w){x(w),w.candidate&&e.on("out",{"@":(f||"")["#"],"#":e.ask(u),ok:{rtc:{candidate:w.candidate,id:t.pid}}})},p.ondatachannel=function(w){x(w);var m=w.channel;m.onmessage=h.onmessage,m.onopen=h.onopen,m.onclose=h.onclose},d.offer)return p;for(var b in l.media)b=l.media[b],b.getTracks().forEach(w=>{p.addTrack(w,b)});return p.createOffer(function(w){p.setLocalDescription(w),e.on("out",{"@":(f||"")["#"],"#":e.ask(u),ok:{rtc:{offer:w,id:t.pid}}})},function(){},t.rtc.sdp),p}})})()),Kd}U4();var qc=function(r,e){return qc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},qc(r,e)};function bf(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");qc(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function zd(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Zc(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function Yc(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))}function Yt(r){return typeof r=="function"}function R4(r){var e=function(n){Error.call(n),n.stack=new Error().stack},t=r(e);return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var nc=R4(function(r){return function(t){r(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t}});function Vd(r,e){if(r){var t=r.indexOf(e);0<=t&&r.splice(t,1)}}var yf=(function(){function r(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return r.prototype.unsubscribe=function(){var e,t,n,i,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=zd(o),c=a.next();!c.done;c=a.next()){var u=c.value;u.remove(this)}}catch(x){e={error:x}}finally{try{c&&!c.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(Yt(l))try{l()}catch(x){s=x instanceof nc?x.errors:[x]}var f=this._finalizers;if(f){this._finalizers=null;try{for(var d=zd(f),p=d.next();!p.done;p=d.next()){var h=p.value;try{Wd(h)}catch(x){s=s??[],x instanceof nc?s=Yc(Yc([],Zc(s)),Zc(x.errors)):s.push(x)}}}catch(x){n={error:x}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}if(s)throw new nc(s)}},r.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)Wd(e);else{if(e instanceof r){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(t=this._finalizers)!==null&&t!==void 0?t:[]).push(e)}},r.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},r.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},r.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Vd(t,e)},r.prototype.remove=function(e){var t=this._finalizers;t&&Vd(t,e),e instanceof r&&e._removeParent(this)},r.EMPTY=(function(){var e=new r;return e.closed=!0,e})(),r})();yf.EMPTY;function nb(r){return r instanceof yf||r&&"closed"in r&&Yt(r.remove)&&Yt(r.add)&&Yt(r.unsubscribe)}function Wd(r){Yt(r)?r():r.unsubscribe()}var B4={Promise:void 0},_4={setTimeout:function(r,e){for(var t=[],n=2;n<arguments.length;n++)t[n-2]=arguments[n];return setTimeout.apply(void 0,Yc([r,e],Zc(t)))},clearTimeout:function(r){return clearTimeout(r)},delegate:void 0};function L4(r){_4.setTimeout(function(){throw r})}function Jd(){}function D4(r){r()}var wf=(function(r){bf(e,r);function e(t){var n=r.call(this)||this;return n.isStopped=!1,t?(n.destination=t,nb(t)&&t.add(n)):n.destination=F4,n}return e.create=function(t,n,i){return new Xc(t,n,i)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e})(yf),M4=(function(){function r(e){this.partialObserver=e}return r.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(n){$s(n)}},r.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(n){$s(n)}else $s(e)},r.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(t){$s(t)}},r})(),Xc=(function(r){bf(e,r);function e(t,n,i){var s=r.call(this)||this,o;return Yt(t)||!t?o={next:t??void 0,error:n??void 0,complete:i??void 0}:o=t,s.destination=new M4(o),s}return e})(wf);function $s(r){L4(r)}function $4(r){throw r}var F4={closed:!0,next:Jd,error:$4,complete:Jd},G4=(function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"})();function ib(r){return r}function H4(r){return r.length===0?ib:r.length===1?r[0]:function(t){return r.reduce(function(n,i){return i(n)},t)}}var Ot=(function(){function r(e){e&&(this._subscribe=e)}return r.prototype.lift=function(e){var t=new r;return t.source=this,t.operator=e,t},r.prototype.subscribe=function(e,t,n){var i=this,s=j4(e)?e:new Xc(e,t,n);return D4(function(){var o=i,a=o.operator,c=o.source;s.add(a?a.call(s,c):c?i._subscribe(s):i._trySubscribe(s))}),s},r.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},r.prototype.forEach=function(e,t){var n=this;return t=Qd(t),new t(function(i,s){var o=new Xc({next:function(a){try{e(a)}catch(c){s(c),o.unsubscribe()}},error:s,complete:i});n.subscribe(o)})},r.prototype._subscribe=function(e){var t;return(t=this.source)===null||t===void 0?void 0:t.subscribe(e)},r.prototype[G4]=function(){return this},r.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return H4(e)(this)},r.prototype.toPromise=function(e){var t=this;return e=Qd(e),new e(function(n,i){var s;t.subscribe(function(o){return s=o},function(o){return i(o)},function(){return n(s)})})},r.create=function(e){return new r(e)},r})();function Qd(r){var e;return(e=r??B4.Promise)!==null&&e!==void 0?e:Promise}function K4(r){return r&&Yt(r.next)&&Yt(r.error)&&Yt(r.complete)}function j4(r){return r&&r instanceof wf||K4(r)&&nb(r)}function z4(r){return Yt(r?.lift)}function V4(r){return function(e){if(z4(e))return e.lift(function(t){try{return r(t,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function W4(r,e,t,n,i){return new J4(r,e,t,n,i)}var J4=(function(r){bf(e,r);function e(t,n,i,s,o,a){var c=r.call(this,t)||this;return c.onFinalize=o,c.shouldUnsubscribe=a,c._next=n?function(u){try{n(u)}catch(l){t.error(l)}}:r.prototype._next,c._error=s?function(u){try{s(u)}catch(l){t.error(l)}finally{this.unsubscribe()}}:r.prototype._error,c._complete=i?function(){try{i()}catch(u){t.error(u)}finally{this.unsubscribe()}}:r.prototype._complete,c}return e.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;r.prototype.unsubscribe.call(this),!n&&((t=this.onFinalize)===null||t===void 0||t.call(this))}},e})(wf);function Q4(r,e){return e===void 0&&(e=ib),r=r??q4,V4(function(t,n){var i,s=!0;t.subscribe(W4(n,function(o){var a=e(o);(s||!r(i,a))&&(s=!1,i=a,n.next(o))}))})}function q4(r,e){return r===e}class sb{gun;user;constructor(e){this.gun=e,this.user=e.user()}getUser(){return this.user}getUserPub(){return this.user.is?.pub}observe(e){return new Ot(t=>{let n;if(Array.isArray(e)){n=this.gun.get(e[0]);for(let s=1;s<e.length;s++)n=n.get(e[s])}else typeof e=="string"?n=this.gun.get(e):n=e;const i=n.on((s,o)=>{if(s==null){t.next(null);return}if(typeof s=="object"&&s!==null){const a=this.removeGunMeta(s);t.next(a)}else t.next(s)});return()=>{i&&typeof i=="function"&&i(),n.off()}}).pipe(Q4((t,n)=>JSON.stringify(t)===JSON.stringify(n)))}match(e,t){return new Ot(n=>{if(!e){n.next([]),n.complete();return}const i=typeof e=="string"?this.gun.get(e):e,s={},o=i.map().on((a,c)=>{if(c==="_"||!a)return;if(t&&!t(a)){s[c]&&(delete s[c],n.next(Object.values(s)));return}const u=typeof a=="object"?this.removeGunMeta(a):a;s[c]=u,n.next(Object.values(s))});return()=>{o&&typeof o=="function"&&o(),i.off()}})}put(e,t){return new Ot(n=>{const i=(s,o)=>{s.put(o,a=>{a.err?n.error(new Error(a.err)):(n.next(o),n.complete())})};if(typeof e=="string"||Array.isArray(e)){let s;if(Array.isArray(e)){s=this.gun.get(e[0]);for(let o=1;o<e.length;o++)s=s.get(e[o])}else s=this.gun.get(e);i(s,t)}else i(this.gun,e)})}putCompat(e,t){return new Ot(n=>{this.gun.put(e,i=>{t&&t(i),i.err?n.error(new Error(i.err)):(n.next(e),n.complete())})})}set(e,t){return new Ot(n=>{const i=(s,o)=>{s.set(o,a=>{a.err?n.error(new Error(a.err)):(n.next(o),n.complete())})};if(typeof e=="string"||Array.isArray(e)){let s;if(Array.isArray(e)){s=this.gun.get(e[0]);for(let o=1;o<e.length;o++)s=s.get(e[o])}else s=this.gun.get(e);i(s,t)}else i(this.gun,e)})}setCompat(e,t){return new Ot(n=>{this.gun.set(e,i=>{t&&t(i),i.err?n.error(new Error(i.err)):(n.next(e),n.complete())})})}once(e){let t;return typeof e=="string"?t=this.gun.get(e):e?t=e:t=this.gun,new Ot(n=>{t.once(i=>{if(i==null){n.next(null),n.complete();return}const s=typeof i=="object"?this.removeGunMeta(i):i;n.next(s),n.complete()})})}compute(e,t){const n=e.map(i=>typeof i=="string"?this.observe(i):i);return new Ot(i=>{let s=new Array(e.length).fill(void 0),o=new Array(e.length).fill(!1);const a=n.map((c,u)=>c.subscribe({next:l=>{if(s[u]=l,s.every(f=>f!==void 0))try{const f=t(...s);i.next(f)}catch(f){i.error(f)}},error:l=>i.error(l),complete:()=>{o[u]=!0,o.every(l=>l)&&i.complete()}}));return()=>{a.forEach(c=>c.unsubscribe())}})}userPut(e,t,n){return new Ot(i=>{const s=this.gun.user();typeof e=="string"?s.get(e).put(t,o=>{n&&n(o),o.err?i.error(new Error(o.err)):(i.next(t),i.complete())}):s.put(e,o=>{n&&n(o),o.err?i.error(new Error(o.err)):(i.next(e),i.complete())})})}userSet(e,t,n){return new Ot(i=>{const s=this.gun.user();typeof e=="string"?s.get(e).set(t,o=>{n&&n(o),o.err?i.error(new Error(o.err)):(i.next(t),i.complete())}):s.set(e,o=>{n&&n(o),o.err?i.error(new Error(o.err)):(i.next(e),i.complete())})})}userOnce(e,t){return new Ot(n=>{const i=this.gun.user();(e?i.get(e):i).once((o,a)=>{t&&t(a),a&&a.err?n.error(new Error(a.err)):(n.next(o),n.complete())})})}userGet(e){return this.observe(this.gun.user().get(e))}observeUser(e){return e?this.observe(this.gun.user().get(e)):this.observe(this.gun.user().get("~"))}removeGunMeta(e){if(!e||typeof e!="object")return e;const t=Array.isArray(e)?[]:{};return Object.keys(e).forEach(n=>{if(n==="_"||n==="#")return;const i=e[n];i&&typeof i=="object"?t[n]=this.removeGunMeta(i):t[n]=i}),t}}class na extends Error{constructor(e){super(e),this.name="GunError"}}class ia extends na{constructor(e){super(e),this.name="AuthError"}}class Z4 extends ia{constructor(e="Credenziali non valide"){super(e),this.name="InvalidCredentials"}}class Y4 extends ia{constructor(e="Utente già esistente"){super(e),this.name="UserExists"}}class X4 extends na{constructor(e="Timeout durante l'operazione"){super(e),this.name="TimeoutError"}}class e5 extends ia{constructor(e="Autenticazione multipla in corso"){super(e),this.name="MultipleAuthError"}}class t5 extends na{}const r5=Object.freeze(Object.defineProperty({__proto__:null,AuthError:ia,GunError:na,InvalidCredentials:Z4,MultipleAuthError:e5,NetworkError:t5,TimeoutError:X4,UserExists:Y4},Symbol.toStringTag,{value:"Module"}));var ic,qd;function n5(){return qd||(qd=1,ic=Pn()),ic}var i5=n5();const He=[];for(let r=0;r<256;++r)He.push((r+256).toString(16).slice(1));function s5(r,e=0){return(He[r[e+0]]+He[r[e+1]]+He[r[e+2]]+He[r[e+3]]+"-"+He[r[e+4]]+He[r[e+5]]+"-"+He[r[e+6]]+He[r[e+7]]+"-"+He[r[e+8]]+He[r[e+9]]+"-"+He[r[e+10]]+He[r[e+11]]+He[r[e+12]]+He[r[e+13]]+He[r[e+14]]+He[r[e+15]]).toLowerCase()}let sc;const o5=new Uint8Array(16);function a5(){if(!sc){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");sc=crypto.getRandomValues.bind(crypto)}return sc(o5)}const c5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Zd={randomUUID:c5};function u5(r,e,t){if(Zd.randomUUID&&!r)return Zd.randomUUID();r=r||{};const n=r.random??r.rng?.()??a5();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,s5(n)}function Nn(){return global.SEA||i5.SEA}function f5(r){return typeof r!="string"||r.length===0?!1:!!(r.length===44&&r.endsWith("=")||r.includes("-"))}async function l5(r,e){const t=Nn();if(!t||!t.encrypt)throw new Error("SEA not available");try{const n=await t.encrypt(r,e);if(n==="SEA not available")throw new Error("SEA not available");return n}catch(n){const i=n instanceof Error?n:new Error(String(n));throw new Error(`SEA encryption failed: ${i.message}`)}}async function d5(r,e){const t=Nn();if(!t||!t.decrypt)throw new Error("SEA not available");try{const n=await t.decrypt(r,e);if(n==="SEA not available")throw new Error("SEA not available");return n}catch(n){const i=n instanceof Error?n:new Error(String(n));throw new Error(`SEA decryption failed: ${i.message}`)}}async function h5(r,e,t){const n=Nn();if(!n||!n.secret||!n.encrypt)return"encrypted-data";try{const i=await n.secret(t.epub,e);return await n.encrypt(r,i)}catch{return"encrypted-data"}}async function g5(r,e,t){const n=Nn();if(!n||!n.secret||!n.decrypt)return"decrypted-data";try{const i=await n.secret(e.epub,t);return await n.decrypt(r,i)}catch{return"decrypted-data"}}async function ob(r){const e=Nn();if(!e||!e.work)throw new Error("SEA not available");try{const t=await e.work(r,null,null,{name:"SHA-256"});if(t==="SEA not available")throw new Error("SEA not available");return t}catch{throw new Error("SEA not available")}}async function p5(r){let e=typeof r=="string"?r:JSON.stringify(r);return{hash:await ob(e),hashed:e}}async function x5(r,e){return await Nn().secret(r,e)}async function b5(r,e){return(await Nn().work(r,null,null,{name:"PBKDF2",encode:"hex",salt:e!==void 0?e:""})||"").substring(0,8)}function y5(r){return r==null?r:r===""?"":r.replace(/-/g,"_").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,".")}function w5(r){if(r==null)return r;if(r==="")return"";let e=r;return e=e.replace(/_/g,"-").replace(/\./g,"="),e=e.replace(/-/g,"+"),e}function m5(r,e={}){if(r!==void 0){if(r===null)return null;if(r==="")return"";if(typeof r=="object")return r;try{return JSON.parse(r)}catch{return e}}}function A5(){const r=globalThis?.crypto;if(r?.randomUUID)return r.randomUUID();try{if(r?.getRandomValues){const e=new Uint8Array(16);r.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128;const t=i=>i.toString(16).padStart(2,"0"),n=Array.from(e).map(t).join("");return`${n.slice(0,8)}-${n.slice(8,12)}-${n.slice(12,16)}-${n.slice(16,20)}-${n.slice(20)}`}}catch{}return u5()}const v5=Object.freeze(Object.defineProperty({__proto__:null,decFrom:g5,decrypt:d5,encFor:h5,encrypt:l5,getShortHash:b5,hashObj:p5,hashText:ob,isHash:f5,randomUUID:A5,safeHash:y5,safeJSONParse:m5,secret:x5,unsafeHash:w5},Symbol.toStringTag,{value:"Module"})),Yd={PASSWORD:{MIN_LENGTH:8}};class ab{gun;user=null;crypto;sea;node;onAuthCallbacks=[];eventEmitter;_rxjs;constructor(e,t="shogun"){if(this.eventEmitter=new Cn,!e)throw new Error("Gun instance is required but was not provided");if(typeof e!="object")throw new Error(`Gun instance must be an object, received: ${typeof e}`);if(typeof e.user!="function")throw new Error(`Gun instance is invalid: gun.user is not a function. Received gun.user type: ${typeof e.user}`);if(typeof e.get!="function")throw new Error(`Gun instance is invalid: gun.get is not a function. Received gun.get type: ${typeof e.get}`);if(typeof e.on!="function")throw new Error(`Gun instance is invalid: gun.on is not a function. Received gun.on type: ${typeof e.on}`);this.gun=e,this.user=this.gun.user().recall({sessionStorage:!0}),this.subscribeToAuthEvents(),this.crypto=v5,this.sea=Ge,this.node=null,this._rxjs=new sb(this.gun)}async initialize(e="shogun"){try{const t=this.restoreSession();this.node=this.gun.get(e),t.success}catch(t){console.error("Error during automatic session restoration:",t)}}subscribeToAuthEvents(){this.gun.on("auth",e=>{e.err?Le.handle(Y.GUN,"AUTH_EVENT_ERROR",e.err,new Error(e.err)):this.notifyAuthListeners(e.sea?.pub||"")})}notifyAuthListeners(e){const t=this.gun.user();this.onAuthCallbacks.forEach(n=>n(t))}addPeer(e){this.gun.opt({peers:[e]}),console.log(`Added new peer: ${e}`)}removePeer(e){try{const t=this.gun._.opt;if(t&&t.peers){delete t.peers[e];const n=t.peers[e];n&&typeof n.close=="function"&&n.close(),console.log(`Removed peer: ${e}`)}else console.log(`Peer not found in current connections: ${e}`)}catch(t){console.error(`Error removing peer ${e}:`,t)}}getCurrentPeers(){try{const e=this.gun._.opt;return e&&e.peers?Object.keys(e.peers).filter(t=>{const n=e.peers[t];return n&&n.wire&&n.wire.hied!=="bye"}):[]}catch(e){return console.error("Error getting current peers:",e),[]}}getAllConfiguredPeers(){try{const e=this.gun._.opt;return e&&e.peers?Object.keys(e.peers):[]}catch(e){return console.error("Error getting configured peers:",e),[]}}getPeerInfo(){try{const e=this.gun._.opt,t={};return e&&e.peers&&Object.keys(e.peers).forEach(n=>{const i=e.peers[n],s=i&&i.wire&&i.wire.hied!=="bye",o=s?"connected":i&&i.wire?"disconnected":"not_initialized";t[n]={connected:s,status:o}}),t}catch(e){return console.error("Error getting peer info:",e),{}}}reconnectToPeer(e){try{this.removePeer(e),this.addPeer(e),console.log(`Reconnected to peer: ${e}`)}catch(t){console.error(`Error reconnecting to peer ${e}:`,t)}}resetPeers(e){try{const t=this.gun._.opt;t&&t.peers&&(Object.keys(t.peers).forEach(n=>{this.removePeer(n)}),e&&e.length>0&&e.forEach(n=>{this.addPeer(n)}),console.log(`Gun database reset with ${e?e.length:0} peers: ${e?e.join(", "):"none"}`))}catch(t){console.error("Error resetting peers:",t)}}onAuth(e){this.onAuthCallbacks.push(e);const t=this.gun.user();return t&&t.is&&e(t),()=>{const n=this.onAuthCallbacks.indexOf(e);n!==-1&&this.onAuthCallbacks.splice(n,1)}}navigateToPath(e,t){if(!t||typeof t!="string")return e;const n=t.replace(/[\x00-\x1F\x7F]/g,"").replace(/[^\w\-._/]/g,"").trim();return n?n.split("/").filter(s=>s.length>0).map(s=>s.trim()).filter(s=>s.length>0).reduce((s,o)=>s.get(o),e):e}deconstructUserPath(e){const t=this.gun.user();if(!t||!t.is)throw new Error("User not logged in");return this.navigateToPath(t,e)}deconstructGlobalPath(e){return this.navigateToPath(this.gun,e)}getGun(){return this.gun}getCurrentUser(){try{const e=this.gun.user();return e?.is?.pub?{pub:e?.is?.pub,epub:e?.is?.epub,alias:e?.is?.alias,user:e}:null}catch(e){return console.error("Error getting current user:",e),null}}getUser(){return this.gun.user()}get(e){return this.navigateToPath(this.gun,e)}async getData(e){return await this.deconstructGlobalPath(e).then()}async put(e,t){const i=await this.deconstructGlobalPath(e).put(t).then();return i.err?{success:!1,error:i.err}:{success:!0}}async set(e,t){const i=await this.deconstructGlobalPath(e).set(t).then();return i.err?{success:!1,error:i.err}:{success:!0}}async remove(e){const n=await this.deconstructGlobalPath(e).put(null).then();return n.err?{success:!1,error:n.err}:{success:!0}}isLoggedIn(){try{const e=this.gun.user();return!!(e&&e.is&&e.is.pub)}catch(e){return console.error("Error checking login status:",e),!1}}restoreSession(){try{if(typeof localStorage>"u")return{success:!1,error:"localStorage not available"};const e=localStorage.getItem("gun/session"),t=localStorage.getItem("gun/pair");if(!e||!t)return{success:!1,error:"No saved session"};let n,i;try{n=JSON.parse(e),i=JSON.parse(t)}catch(s){return console.error("Error parsing session data:",s),localStorage.removeItem("gun/session"),localStorage.removeItem("gun/pair"),{success:!1,error:"Corrupted session data"}}if(!n.username||!n.pair||!n.userPub)return localStorage.removeItem("gun/session"),localStorage.removeItem("gun/pair"),{success:!1,error:"Incomplete session data"};if(n.expiresAt&&Date.now()>n.expiresAt)return localStorage.removeItem("gun/session"),localStorage.removeItem("gun/pair"),{success:!1,error:"Session expired"};try{const s=this.gun.user();if(!s)return console.error("Gun user instance not available"),localStorage.removeItem("gun/session"),localStorage.removeItem("gun/pair"),{success:!1,error:"Gun user instance not available"};try{s._={...s._,sea:n.pair}}catch(o){console.error("Error setting user pair:",o)}try{const o=s.recall({sessionStorage:!0})}catch(o){console.error("Error during recall:",o)}return s.is&&s.is.pub===n.userPub?(this.user=s,{success:!0,userPub:n.userPub}):(localStorage.removeItem("gun/session"),localStorage.removeItem("gun/pair"),{success:!1,error:"Session verification failed"})}catch(s){return console.error(`Error restoring session: ${s}`),{success:!1,error:`Session restoration failed: ${s}`}}}catch(e){return console.error(`Error in restoreSession: ${e}`),{success:!1,error:`Session restoration failed: ${e}`}}return{success:!1,error:"No session data available"}}logout(){try{const e=this.gun.user();if(!e||!e.is){console.log("No user logged in, skipping logout");return}try{e.leave()}catch(t){console.error("Error during Gun logout:",t)}this.user=null;try{typeof sessionStorage<"u"&&sessionStorage.removeItem("gunSessionData")}catch(t){console.error("Error clearing session storage:",t)}}catch(e){console.error("Error during logout:",e)}}rx(){return this._rxjs}validatePasswordStrength(e){if(e.length<Yd.PASSWORD.MIN_LENGTH)return{valid:!1,error:`Password must be at least ${Yd.PASSWORD.MIN_LENGTH} characters long`};const t=[];return t.length>0?{valid:!1,error:`Password must contain at least one: ${t.join(", ")}`}:{valid:!0}}validateSignupCredentials(e,t,n){return!e||e.length<1?{valid:!1,error:"Username must be more than 0 characters long!"}:/^[a-zA-Z0-9._-]+$/.test(e)?n?!n.pub||!n.priv||!n.epub||!n.epriv?{valid:!1,error:"Invalid pair provided"}:!n.pub||!n.priv||!n.epub||!n.epriv?{valid:!1,error:"Invalid pair provided"}:{valid:!0}:this.validatePasswordStrength(t):{valid:!1,error:"Username can only contain letters, numbers, dots, underscores, and hyphens"}}async createNewUser(e,t){return new Promise(n=>{if(!e||typeof e!="string"||e.trim().length===0){n({success:!1,error:"Invalid username provided"});return}if(!t||typeof t!="string"||t.length===0){n({success:!1,error:"Invalid password provided"});return}const i=e.trim().toLowerCase();if(i.length===0){n({success:!1,error:"Username cannot be empty"});return}this.gun.user().create(i,t,s=>{if(s.err)console.error(`User creation error: ${s.err}`),n({success:!1,error:s.err});else{const o=s.pub;!o||typeof o!="string"||o.trim().length===0?(console.error("User creation successful but no userPub returned:",s),n({success:!1,error:"User creation successful but no userPub returned"})):(console.log(`User created successfully with userPub: ${o}`),n({success:!0,userPub:o}))}})})}async authenticateNewUser(e,t,n){return new Promise(i=>{if(!e||typeof e!="string"||e.trim().length===0){i({success:!1,error:"Invalid username provided"});return}if(!n&&(!t||typeof t!="string"||t.length===0)){i({success:!1,error:"Invalid password provided"});return}const s=e.trim().toLowerCase();if(s.length===0){i({success:!1,error:"Username cannot be empty"});return}n?this.gun.user().auth(n,o=>{console.log("Pair authentication after creation result:",o),o.err?(console.error(`Authentication after creation failed: ${o.err}`),i({success:!1,error:o.err})):setTimeout(()=>{const a=o.pub||this.gun.user().is?.pub||o.user?.pub;console.log(`Extracted userPub after pair auth: ${a}`),console.log("User object after pair auth:",this.gun.user()),console.log("User.is after pair auth:",this.gun.user().is),a?i({success:!0,userPub:a}):(console.error("Authentication successful but no userPub found"),i({success:!1,error:"No userPub returned from authentication"}))},100)}):this.gun.user().auth(s,t,o=>{console.log("Password authentication after creation result:",o),o.err?(console.error(`Authentication after creation failed: ${o.err}`),i({success:!1,error:o.err})):setTimeout(()=>{const a=o.pub||this.gun.user().is?.pub||o.user?.pub;console.log(`Extracted userPub after password auth: ${a}`),console.log("User object after password auth:",this.gun.user()),console.log("User.is after password auth:",this.gun.user().is),a?i({success:!0,userPub:a}):(console.error("Authentication successful but no userPub found"),i({success:!1,error:"No userPub returned from authentication"}))},100)})})}async signUp(e,t,n){try{const i=this.validateSignupCredentials(e,t,n);if(!i.valid)return{success:!1,error:i.error};let s;if(n?s=await this.createNewUserWithPair(e,n):s=await this.createNewUser(e,t),!s.success)return{success:!1,error:s.error};await new Promise(a=>setTimeout(a,100));const o=await this.authenticateNewUser(e,t,n);if(!o.success)return{success:!1,error:o.error};if(!o.userPub||typeof o.userPub!="string"||o.userPub.trim().length===0)return console.error("Authentication successful but no valid userPub returned:",o),{success:!1,error:"Authentication successful but no valid userPub returned"};this.user=this.gun.user();try{return console.log(`Running post-auth setup with userPub: ${o.userPub}`),await this.runPostAuthOnAuthResult(e,o.userPub,o)}catch(a){return console.error(`Post-auth error: ${a}`),{success:!0,userPub:o.userPub,username:e,isNewUser:!0,sea:this.gun.user()?._?.sea?{pub:this.gun.user()._?.sea.pub,priv:this.gun.user()._?.sea.priv,epub:this.gun.user()._?.sea.epub,epriv:this.gun.user()._?.sea.epriv}:void 0}}}catch(i){return console.error(`Exception during signup for ${e}: ${i}`),{success:!1,error:`Signup failed: ${i}`}}}async createNewUserWithPair(e,t){return new Promise(n=>{if(!e||typeof e!="string"||e.trim().length===0){n({success:!1,error:"Invalid username provided"});return}if(!t||!t.pub||!t.priv){n({success:!1,error:"Invalid pair provided"});return}const i=e.trim().toLowerCase();if(i.length===0){n({success:!1,error:"Username cannot be empty"});return}console.log(`User created successfully with pair for: ${i}`),n({success:!0,userPub:t.pub})})}async runPostAuthOnAuthResult(e,t,n){try{if(!e||typeof e!="string"||e.trim().length===0)throw new Error("Invalid username provided");if(!t||typeof t!="string"||t.trim().length===0)throw console.error("Invalid userPub provided:",{userPub:t,type:typeof t,authResult:n}),new Error("Invalid userPub provided");if(!t.includes(".")||t.length<10)throw console.error("Invalid userPub format:",t),new Error("Invalid userPub format");const i=e.trim().toLowerCase();if(i.length===0)throw new Error("Username cannot be empty");console.log(`Setting up user profile for ${i} with userPub: ${t}`);const s=await this.gun.get(t).once().then(),o=!s||!s.alias,c=this.gun.user()?._?.sea,u=c?.epub||null;return await this.setupComprehensiveUserTracking(i,t,u,o)?{success:!0,userPub:t,username:i,isNewUser:o,sea:c?{pub:c.pub,priv:c.priv,epub:c.epub,epriv:c.epriv}:void 0}:{success:!1,error:"Comprehensive user tracking setup failed"}}catch(i){return console.error(`Error in post-authentication setup: ${i}`),{success:!1,error:`Post-authentication setup failed: ${i}`}}}async setupComprehensiveUserTracking(e,t,n,i){if(i)return!0;try{return await this.createAliasIndex(e,t),await this.createUsernameMapping(e,t),await this.createUserRegistry(e,t,n),await this.createReverseLookup(e,t),n&&await this.createEpubIndex(n,t),await this.createUserMetadata(e,t,n),console.log(`Comprehensive user tracking setup completed for ${e}`),!0}catch(s){return console.error(`Error in comprehensive user tracking setup: ${s}`),!1}}async createAliasIndex(e,t){try{const i=await this.gun.get(`~@${e}`).put(`~@${e}`).then();i.err?console.error(`Error creating alias index: ${i.err}`):console.log(`Alias index created: ~@${e} -> ${t}`)}catch(n){console.error(`Error creating alias index: ${n}`)}}async createUsernameMapping(e,t){try{const n=await this.node.get("usernames").get(e).put(t).then();n.err?console.error(`Error creating username mapping: ${n.err}`):console.log(`Username mapping created: ${e} -> ${t}`)}catch(n){console.error(`Error creating username mapping: ${n}`)}}async createUserRegistry(e,t,n){try{const i={username:e,userPub:t,epub:n,registeredAt:Date.now(),lastSeen:Date.now()},s=await this.node.get("users").get(t).put(i).then();s.err?console.error(`Error creating user registry: ${s.err}`):console.log(`User registry created: ${t}`)}catch(i){console.error(`Error creating user registry: ${i}`)}}async createReverseLookup(e,t){try{const n=await this.node.get("userAliases").get(t).put(e).then();n.err?console.error(`Error creating reverse lookup: ${n.err}`):console.log(`Reverse lookup created: ${t} -> ${e}`)}catch(n){console.error(`Error creating reverse lookup: ${n}`)}}async createEpubIndex(e,t){try{const n=await this.node.get("epubKeys").get(e).put(t).then();n.err?console.error(`Error creating epub index: ${n.err}`):console.log(`Epub index created: ${e} -> ${t}`)}catch(n){console.error(`Error creating epub index: ${n}`)}}async createUserMetadata(e,t,n){try{const i={username:e,epub:n,registeredAt:Date.now(),lastSeen:Date.now()},s=await this.gun.get(t).put(i).then();s.err?console.error(`Error creating user metadata: ${s.err}`):console.log(`User metadata created for ${t}`)}catch(i){console.error(`Error creating user metadata: ${i}`)}}async getUserByAlias(e){try{const t=e.trim().toLowerCase();if(!t)return null;try{const n=await this.gun.get(`~@${t}`).once().then();if(n&&n["~pubKeyOfUser"]){const i=n["~pubKeyOfUser"]["#"]||n["~pubKeyOfUser"];if(i){const s=await this.getUserDataByPub(i);if(s)return s}}}catch(n){console.log(`GunDB alias lookup failed for ${t}:`,n)}try{const n=await this.node.get("usernames").get(t).once().then();if(n){const i=await this.getUserDataByPub(n);if(i)return i}}catch(n){console.log(`Username mapping lookup failed for ${t}:`,n)}return null}catch(t){return console.error(`Error looking up user by alias ${e}:`,t),null}}async getUserDataByPub(e){try{if(!e||typeof e!="string")return null;try{const t=await this.node.get("users").get(e).once().then();if(t&&t.username)return{userPub:t.userPub||e,epub:t.epub||null,username:t.username,registeredAt:t.registeredAt||0,lastSeen:t.lastSeen||0}}catch(t){console.log(`User registry lookup failed for ${e}:`,t)}try{const t=await this.gun.get(e).once().then();if(t&&t.username)return{userPub:e,epub:t.epub||null,username:t.username,registeredAt:t.registeredAt||0,lastSeen:t.lastSeen||0}}catch(t){console.log(`User node lookup failed for ${e}:`,t)}return null}catch(t){return console.error(`Error looking up user data by pub ${e}:`,t),null}}async getUserPubByEpub(e){try{return!e||typeof e!="string"?null:await this.node.get("epubKeys").get(e).once().then()||null}catch(t){return console.error(`Error looking up user pub by epub ${e}:`,t),null}}async getUserAliasByPub(e){try{return!e||typeof e!="string"?null:await this.node.get("userAliases").get(e).once().then()||null}catch(t){return console.error(`Error looking up user alias by pub ${e}:`,t),null}}async getAllRegisteredUsers(){try{const e=[],t=this.node.get("users");return e}catch(e){return console.error("Error getting all registered users:",e),[]}}async updateUserLastSeen(e){try{if(!e||typeof e!="string")return;const t=Date.now();try{await this.node.get("users").get(e).get("lastSeen").put(t).then()}catch(n){console.log("Failed to update lastSeen in user registry:",n)}try{await this.gun.get(e).get("lastSeen").put(t).then()}catch(n){console.log("Failed to update lastSeen in user node:",n)}}catch(t){console.error(`Error updating user last seen for ${e}:`,t)}}async performAuthentication(e,t,n){return new Promise(i=>{console.log(`Attempting authentication for user: ${e}`),n?this.gun.user().auth(n,s=>{console.log("Pair authentication result:",s),s.err?(console.error(`Login error for ${e}: ${s.err}`),i({success:!1,error:s.err})):i({success:!0,ack:s})}):this.gun.user().auth(e,t,s=>{console.log("Password authentication result:",s),s.err?(console.error(`Login error for ${e}: ${s.err}`),i({success:!1,error:s.err})):i({success:!0,ack:s})})})}buildLoginResult(e,t){const n=this.gun.user()?._?.sea;return{success:!0,userPub:t,username:e,sea:n?{pub:n.pub,priv:n.priv,epub:n.epub,epriv:n.epriv}:void 0}}async login(e,t,n){try{if(!(await this.performAuthentication(e,t,n)).success)return{success:!1,error:`User '${e}' not found. Please check your username or register first.`};await new Promise(a=>setTimeout(a,100));const s=this.gun.user().is?.pub;let o=this.gun.user().is?.alias;if(o||(o=e),console.log(`Login authentication successful, extracted userPub: ${s}`),console.log("User object:",this.gun.user()),console.log("User.is:",this.gun.user().is),!s)return{success:!1,error:"Authentication failed: No user pub returned."};try{await this.runPostAuthOnAuthResult(o,s,{success:!0,userPub:s})}catch(a){console.error(`Post-auth error during login: ${a}`)}try{await this.updateUserLastSeen(s)}catch(a){console.error(`Error updating last seen: ${a}`)}try{const a={alias:e,pair:n??null,userPub:s};this.saveCredentials(a)}catch(a){console.error("Error saving credentials:",a)}return this.buildLoginResult(e,s)}catch(i){return console.error(`Exception during login for ${e}: ${i}`),{success:!1,error:String(i)}}}async encryptSessionData(e){try{const t=navigator.userAgent+(typeof screen<"u"?screen.width+"x"+screen.height:""),n=await Ge.work(t,null,null,{name:"SHA-256"});if(!n)throw new Error("Failed to generate encryption key");const i=await Ge.encrypt(JSON.stringify(e),n);if(!i)throw new Error("Failed to encrypt session data");return i}catch(t){throw console.error("Error encrypting session data:",t),t}}async decryptSessionData(e){try{const t=navigator.userAgent+(typeof screen<"u"?screen.width+"x"+screen.height:""),n=await Ge.work(t,null,null,{name:"SHA-256"});if(!n)throw new Error("Failed to generate decryption key");const i=await Ge.decrypt(e,n);if(i===void 0)throw new Error("Failed to decrypt session data");return JSON.parse(i)}catch(t){throw console.error("Error decrypting session data:",t),t}}saveCredentials(e){try{const t={username:e.alias,pair:e.pair,userPub:e.userPub,timestamp:Date.now(),expiresAt:Date.now()+6048e5};typeof sessionStorage<"u"&&this.encryptSessionData(t).then(n=>{sessionStorage.setItem("gunSessionData",n)}).catch(n=>{console.error("Failed to encrypt and save session data:",n),sessionStorage.setItem("gunSessionData",JSON.stringify(t))})}catch(t){console.error(`Error saving credentials: ${t}`)}}async setPasswordHintWithSecurity(e,t,n,i,s){if(!(await this.login(e,t)).success)return{success:!1,error:"Authentication failed"};const a=this.getCurrentUser();if(!a||!a.pub)return{success:!1,error:"User not authenticated"};try{const c=s.join("|");let u;try{if(Ge&&Ge.work)u=await Ge.work(c,null,null,{name:"SHA-256"});else if(this.crypto&&this.crypto.hashText)u=await this.crypto.hashText(c);else throw new Error("Cryptographic functions not available");if(!u)throw new Error("Failed to generate hash")}catch(h){return console.error("Error generating hash:",h),{success:!1,error:"Failed to generate security hash"}}let l;try{if(Ge&&Ge.encrypt)l=await Ge.encrypt(n,u);else if(this.crypto&&this.crypto.encrypt)l=await this.crypto.encrypt(n,u);else throw new Error("Encryption functions not available");if(!l)throw new Error("Failed to encrypt hint")}catch(h){return console.error("Error encrypting hint:",h),{success:!1,error:"Failed to encrypt password hint"}}const f=a.pub,d={questions:JSON.stringify(i),hint:l},p=await this.node.get(f).get("security").put(d).then();if(p.err)throw console.error("Error saving security data to public graph:",p.err),new Error(p.err);return{success:!0}}catch(c){return console.error("Error setting password hint:",c),{success:!1,error:String(c)}}}async forgotPassword(e,t){try{const n=e.trim().toLowerCase(),i=await this.node.get("usernames").get(n).once().then()||null;if(!i)return{success:!1,error:"User not found"};const s=await this.node.get(i).get("security").once().then();if(!s||!s.hint)return{success:!1,error:"No password hint found"};const o=t.join("|");let a;try{if(Ge&&Ge.work)a=await Ge.work(o,null,null,{name:"SHA-256"});else if(this.crypto&&this.crypto.hashText)a=await this.crypto.hashText(o);else throw new Error("Cryptographic functions not available");if(!a)throw new Error("Failed to generate hash")}catch(u){return console.error("Error generating hash:",u),{success:!1,error:"Failed to generate security hash"}}let c;try{if(Ge&&Ge.decrypt)c=await Ge.decrypt(s.hint,a);else if(this.crypto&&this.crypto.decrypt)c=await this.crypto.decrypt(s.hint,a);else throw new Error("Decryption functions not available")}catch{return{success:!1,error:"Incorrect answers to security questions"}}return c===void 0?{success:!1,error:"Incorrect answers to security questions"}:{success:!0,hint:c}}catch(n){return console.error("Error recovering password hint:",n),{success:!1,error:String(n)}}}async putUserData(e,t){const i=await this.deconstructUserPath(e).put(t).then();if(i.err)throw new Error(i.err)}async getUserData(e){if(!e||typeof e!="string")throw new Error("Path must be a non-empty string");try{const n=await this.deconstructUserPath(e).once().then();if(n&&typeof n=="object"&&n["#"]){const i=n["#"];return await this.deconstructGlobalPath(i).once().then()}else return n}catch(t){const n=t instanceof Error?t.message:"Unknown error";throw new Error(n)}}async removeUserData(e){const n=await this.deconstructUserPath(e).put(null).then();if(n.err)throw new Error(n.err)}static Errors=r5;on(e,t){this.eventEmitter.on(e,t)}off(e,t){this.eventEmitter.off(e,t)}once(e,t){this.eventEmitter.once(e,t)}emit(e,t){return this.eventEmitter.emit(e,t)}recall(){this.user&&this.user.recall({sessionStorage:!0})}leave(){this.user&&this.user.leave()}setUserData(e){this.user&&this.user.put(e)}setPasswordHint(e){if(this.user)try{this.user.get("passwordHint").put(e)}catch(t){console.warn("Could not set password hint:",t)}}getPasswordHint(){return this.user&&this.user.passwordHint||null}saveSession(e){this.user&&this.user.recall({sessionStorage:!0})}loadSession(){return this.user?this.user.recall({sessionStorage:!0}):null}clearSession(){this.user&&this.user.leave()}getAppScope(){return this.node?._?.soul||"shogun"}getUserPub(){return this.user&&this.user.is?.pub||null}isAuthenticated(){return!!this.user?.is?.pub}}const eu=r=>{console.log("Creating Gun instance with config:",r),console.log("Config peers:",r?.peers);const e=S4(r);return console.log("Created Gun instance:",e),e};class E5{db;constructor(e){this.db=e}async get(e){try{return await this.db.getData(e)}catch(t){return console.warn(`Failed to get data from ${e}:`,t),null}}getNode(e){return this.db.get(e)}node(e){return this.db.get(e)}chain(e){const t=this.db.get(e);return{get:n=>this.chain(`${e}/${n}`),put:async n=>{try{return(await this.db.put(e,n)).success}catch(i){return console.warn(`Failed to put data to ${e}:`,i),!1}},set:async n=>{try{return(await this.db.set(e,n)).success}catch(i){return console.warn(`Failed to set data to ${e}:`,i),!1}},once:async()=>{try{return await this.db.getData(e)}catch(n){return console.warn(`Failed to get data from ${e}:`,n),null}},then:async()=>{try{return await this.db.getData(e)}catch(n){return console.warn(`Failed to get data from ${e}:`,n),null}},map:n=>t.map?t.map(n):null}}async put(e,t){try{return(await this.db.put(e,t)).success}catch(n){return console.warn(`Failed to put data to ${e}:`,n),!1}}async set(e,t){try{return(await this.db.set(e,t)).success}catch(n){return console.warn(`Failed to set data to ${e}:`,n),!1}}async remove(e){try{return(await this.db.remove(e)).success}catch(t){return console.warn(`Failed to remove data from ${e}:`,t),!1}}async login(e,t){try{const n=await this.db.login(e,t);return n.success&&n.userPub?{userPub:n.userPub,username:n.username||e}:null}catch(n){return console.warn(`Login failed for ${e}:`,n),null}}async signup(e,t){try{const n=await this.db.signUp(e,t);return n.success&&n.userPub?{userPub:n.userPub,username:n.username||e}:null}catch(n){return console.warn(`Signup failed for ${e}:`,n),null}}logout(){this.db.logout()}isLoggedIn(){return this.db.isLoggedIn()}async getUserData(e){try{return this.isLoggedIn()?await this.db.getUserData(e):(console.warn("User not logged in"),null)}catch(t){return console.warn(`Failed to get user data from ${e}:`,t),null}}async putUserData(e,t){try{return this.isLoggedIn()?(await this.db.putUserData(e,t),!0):(console.warn("User not logged in"),!1)}catch(n){return console.warn(`Failed to put user data to ${e}:`,n),!1}}async setUserData(e,t){try{return this.isLoggedIn()?(await this.db.putUserData(e,t),!0):(console.warn("User not logged in"),!1)}catch(n){return console.warn(`Failed to set user data to ${e}:`,n),!1}}async removeUserData(e){try{return this.isLoggedIn()?(await this.db.removeUserData(e),!0):(console.warn("User not logged in"),!1)}catch(t){return console.warn(`Failed to remove user data from ${e}:`,t),!1}}getIndexedObjectFromArray(e){return(e||[]).filter(n=>n&&typeof n=="object"&&n.id!==null&&n.id!==void 0).reduce((n,i)=>({...n,[i.id]:i}),{})}getArrayFromIndexedObject(e){if(!e||typeof e!="object")return[];const t={...e};return delete t._,Object.values(t).filter(n=>n&&typeof n=="object")}arrayToIndexedObject(e){return this.getIndexedObjectFromArray(e)}indexedObjectToArray(e){return this.getArrayFromIndexedObject(e)}async putUserArray(e,t){try{if(!this.isLoggedIn())return console.warn("User not logged in"),!1;const n=this.getIndexedObjectFromArray(t);return await this.putUserData(e,n)}catch(n){return console.warn(`Failed to put user array to ${e}:`,n),!1}}async getUserArray(e){try{if(!this.isLoggedIn())return console.warn("User not logged in"),[];const t=await this.getUserData(e);return this.getArrayFromIndexedObject(t)}catch(t){return console.warn(`Failed to get user array from ${e}:`,t),[]}}async addToUserArray(e,t){try{if(!this.isLoggedIn())return console.warn("User not logged in"),!1;if(!t||typeof t!="object"||!t.id)return console.warn("Invalid item: must be an object with an id property"),!1;const i=[...await this.getUserArray(e),t];return await this.putUserArray(e,i)}catch(n){return console.warn(`Failed to add item to user array ${e}:`,n),!1}}async removeFromUserArray(e,t){try{if(!this.isLoggedIn())return console.warn("User not logged in"),!1;const i=(await this.getUserArray(e)).filter(s=>s.id!==t);return await this.putUserArray(e,i)}catch(n){return console.warn(`Failed to remove item from user array ${e}:`,n),!1}}async updateInUserArray(e,t,n){try{if(!this.isLoggedIn())return console.warn("User not logged in"),!1;const s=(await this.getUserArray(e)).map(o=>o.id===t?{...o,...n}:o);return await this.putUserArray(e,s)}catch(i){return console.warn(`Failed to update item in user array ${e}:`,i),!1}}async putArray(e,t){try{const n=this.getIndexedObjectFromArray(t);return await this.put(e,n)}catch(n){return console.warn(`Failed to put array to ${e}:`,n),!1}}async getArray(e){try{const t=await this.get(e);return this.getArrayFromIndexedObject(t)}catch(t){return console.warn(`Failed to get array from ${e}:`,t),[]}}async addToArray(e,t){try{const i=[...await this.getArray(e),t];return await this.putArray(e,i)}catch(n){return console.warn(`Failed to add item to array ${e}:`,n),!1}}async removeFromArray(e,t){try{const i=(await this.getArray(e)).filter(s=>s.id!==t);return await this.putArray(e,i)}catch(n){return console.warn(`Failed to remove item from array ${e}:`,n),!1}}async updateInArray(e,t,n){try{const s=(await this.getArray(e)).map(o=>o.id===t?{...o,...n}:o);return await this.putArray(e,s)}catch(i){return console.warn(`Failed to update item in array ${e}:`,i),!1}}getUserNode(e){if(!this.isLoggedIn())throw new Error("User not logged in");return this.db.getUser().get(e)}getGlobalNode(e){return this.db.get(e)}getCurrentUser(){const e=this.db.getCurrentUser();return e?{pub:e.pub,username:e.alias}:null}async userExists(e){try{return await this.db.getUserByAlias(e)!==null}catch(t){return console.warn(`Failed to check if user exists: ${e}`,t),!1}}async getUser(e){try{const t=await this.db.getUserByAlias(e);return t?{userPub:t.userPub,username:t.username}:null}catch(t){return console.warn(`Failed to get user: ${e}`,t),null}}async getAllUserData(){try{if(!this.isLoggedIn())return console.warn("User not logged in"),null;const e=this.db.getUser();return e&&e.is?await new Promise((n,i)=>{e.once(s=>{n(s)})}):null}catch(e){return console.warn("Failed to get all user data:",e),null}}async updateProfile(e){try{return this.isLoggedIn()?await this.putUserData("profile",e):(console.warn("User not logged in"),!1)}catch(t){return console.warn("Failed to update profile:",t),!1}}async getProfile(){try{return this.isLoggedIn()?await this.getUserData("profile"):(console.warn("User not logged in"),null)}catch(e){return console.warn("Failed to get profile:",e),null}}async saveSettings(e){try{return this.isLoggedIn()?await this.putUserData("settings",e):(console.warn("User not logged in"),!1)}catch(t){return console.warn("Failed to save settings:",t),!1}}async getSettings(){try{return this.isLoggedIn()?await this.getUserData("settings"):(console.warn("User not logged in"),null)}catch(e){return console.warn("Failed to get settings:",e),null}}async savePreferences(e){try{return this.isLoggedIn()?await this.putUserData("preferences",e):(console.warn("User not logged in"),!1)}catch(t){return console.warn("Failed to save preferences:",t),!1}}async getPreferences(){try{return this.isLoggedIn()?await this.getUserData("preferences"):(console.warn("User not logged in"),null)}catch(e){return console.warn("Failed to get preferences:",e),null}}async createCollection(e,t){try{return this.isLoggedIn()?await this.putUserData(`collections/${e}`,t):(console.warn("User not logged in"),!1)}catch(n){return console.warn(`Failed to create collection ${e}:`,n),!1}}async addToCollection(e,t,n){try{return this.isLoggedIn()?await this.putUserData(`collections/${e}/${t}`,n):(console.warn("User not logged in"),!1)}catch(i){return console.warn(`Failed to add item to collection ${e}:`,i),!1}}async getCollection(e){try{return this.isLoggedIn()?await this.getUserData(`collections/${e}`):(console.warn("User not logged in"),null)}catch(t){return console.warn(`Failed to get collection ${e}:`,t),null}}async removeFromCollection(e,t){try{return this.isLoggedIn()?await this.removeUserData(`collections/${e}/${t}`):(console.warn("User not logged in"),!1)}catch(n){return console.warn(`Failed to remove item from collection ${e}:`,n),!1}}}class S5{db;simpleAPI;gunInstance;constructor(e){const t={peers:e?.peers||[],...e};delete t.appScope,this.gunInstance=eu(t);const n=e?.appScope||"shogun";this.db=new ab(this.gunInstance,n),this.simpleAPI=new E5(this.db)}async init(){await this.db.initialize()}get api(){return this.simpleAPI}get database(){return this.db}get gun(){return this.gunInstance}}function C5(r){return new S5(r)}class I5{core;constructor(e){this.core=e}async initialize(e){typeof console>"u"&&(global.console={log:()=>{},warn:()=>{},error:()=>{},info:()=>{},debug:()=>{}}),this.core.storage=new wh,Le.addListener(t=>{this.core.emit("error",{action:t.code,message:t.message,type:t.type})}),await this.initializeGun(e),await this.initializeGunUser(),this.setupGunEventForwarding(),this.setupWalletDerivation(),this.core.rx=new sb(this.core.gun),this.registerBuiltinPlugins(e),await this.initializeAsync()}async initializeGun(e){console.log("Initialize Gun instance",e);try{e.gunInstance&&e.gunOptions===void 0?(console.log("Using provided Gun instance"),this.core._gun=e.gunInstance):e.gunOptions&&e.gunInstance===void 0?(console.log("Creating new Gun instance"),this.core._gun=eu(e.gunOptions)):e.gunInstance&&e.gunOptions?(console.log("Both gunInstance and gunOptions provided, using gunInstance"),this.core._gun=e.gunInstance):(console.log("No Gun instance or options provided, creating default instance"),this.core._gun=eu({peers:e.gunOptions?.peers||[]}))}catch(t){throw typeof console<"u"&&console.error&&console.error("Error creating Gun instance:",t),new Error(`Failed to create Gun instance: ${t}`)}try{console.log("Initialize Gun instance",this.core.gun),this.core.db=new ab(this.core._gun,e.gunOptions?.scope||"")}catch(t){throw typeof console<"u"&&console.error&&console.error("Error initializing GunInstance:",t),new Error(`Failed to initialize GunInstance: ${t}`)}}async initializeGunUser(){try{this.core._user=this.core.gun.user().recall({sessionStorage:!0})}catch(e){throw typeof console<"u"&&console.error&&console.error("Error initializing Gun user:",e),new Error(`Failed to initialize Gun user: ${e}`)}this.core.gun.on("auth",e=>{this.core._user=this.core.gun.user().recall({sessionStorage:!0}),this.core.emit("auth:login",{userPub:e.pub,method:"password"})})}setupGunEventForwarding(){["gun:put","gun:get","gun:set","gun:remove"].forEach(n=>{this.core.db.on(n,i=>{this.core.emit(n,i)})}),["gun:peer:add","gun:peer:remove","gun:peer:connect","gun:peer:disconnect"].forEach(n=>{this.core.db.on(n,i=>{this.core.emit(n,i)})})}setupWalletDerivation(){this.core.gun.on("auth",async e=>{if(!e)return;const t=e._?.sea?.epriv,n=e._?.sea?.epub;this.core.wallets=await Ir(t,n,{includeSecp256k1Bitcoin:!0,includeSecp256k1Ethereum:!0})})}registerBuiltinPlugins(e){try{if(e.oauth){typeof console<"u"&&console.warn&&console.warn("OAuth plugin will be registered with provided configuration");const t=new v4;typeof t.configure=="function"&&t.configure(e.oauth),this.core.pluginManager.register(t)}if(e.webauthn){typeof console<"u"&&console.warn&&console.warn("WebAuthn plugin will be registered with provided configuration");const t=new I3;typeof t.configure=="function"&&t.configure(e.webauthn),this.core.pluginManager.register(t)}if(e.web3){typeof console<"u"&&console.warn&&console.warn("Web3 plugin will be registered with provided configuration");const t=new T3;typeof t.configure=="function"&&t.configure(e.web3),this.core.pluginManager.register(t)}if(e.nostr){typeof console<"u"&&console.warn&&console.warn("Nostr plugin will be registered with provided configuration");const t=new A4;typeof t.configure=="function"&&t.configure(e.nostr),this.core.pluginManager.register(t)}}catch(t){typeof console<"u"&&console.error&&console.error("Error registering builtin plugins:",t)}}async initializeAsync(){try{await this.core.db.initialize(),this.core.emit("debug",{action:"core_initialized",timestamp:Date.now()})}catch(e){throw typeof console<"u"&&console.error&&console.error("Error during Shogun Core initialization:",e),e}}}class Xd{static API_VERSION="^3.0.11";db;storage;provider;config;rx;_gun;_user=null;wallets;pluginManager;authManager;eventManager;coreInitializer;constructor(e){this.config=e,this.eventManager=new oy,this.pluginManager=new ny(this),this.authManager=new iy(this),this.coreInitializer=new I5(this),this.coreInitializer.initialize(e).catch(t=>{typeof console<"u"&&console.warn&&console.warn("Error during async initialization:",t)})}get gun(){return this._gun}get user(){return this._user}getCurrentUser(){return this.db?this.db.getCurrentUser():null}register(e){this.pluginManager.register(e)}unregister(e){this.pluginManager.unregister(e)}getPlugin(e){return this.pluginManager.getPlugin(e)}getPluginsInfo(){return this.pluginManager.getPluginsInfo()}getPluginCount(){return this.pluginManager.getPluginCount()}getPluginsInitializationStatus(){return this.pluginManager.getPluginsInitializationStatus()}validatePluginSystem(){return this.pluginManager.validatePluginSystem()}reinitializeFailedPlugins(){return this.pluginManager.reinitializeFailedPlugins()}checkPluginCompatibility(){return this.pluginManager.checkPluginCompatibility()}getPluginSystemDebugInfo(){return this.pluginManager.getPluginSystemDebugInfo()}hasPlugin(e){return this.pluginManager.hasPlugin(e)}getPluginsByCategory(e){return this.pluginManager.getPluginsByCategory(e)}getAuthenticationMethod(e){return this.authManager.getAuthenticationMethod(e)}getRecentErrors(e=10){return Le.getRecentErrors(e)}isLoggedIn(){return this.authManager.isLoggedIn()}logout(){this.authManager.logout()}async login(e,t,n){return this.authManager.login(e,t,n)}async loginWithPair(e){return this.authManager.loginWithPair(e)}async signUp(e,t,n){return this.authManager.signUp(e,t,n)}emit(e,t){return this.eventManager.emit(e,t)}on(e,t){return this.eventManager.on(e,t),this}once(e,t){return this.eventManager.once(e,t),this}off(e,t){return this.eventManager.off(e,t),this}removeAllListeners(e){return this.eventManager.removeAllListeners(e),this}setAuthMethod(e){this.authManager.setAuthMethod(e)}getAuthMethod(){return this.authManager.getAuthMethod()}async saveCredentials(e){try{this.storage.setItem("userCredentials",JSON.stringify(e))}catch(t){typeof console<"u"&&console.warn&&console.warn("Failed to save credentials to storage"),typeof console<"u"&&console.error&&console.error("Error saving credentials:",t)}}getIsLoggedIn(){return!!(this.user&&this.user.is)}}typeof window<"u"&&(window.SHOGUN_CORE=r=>new Xd(r),window.SHOGUN_CORE_CLASS=Xd);var eh;(function(r){r.Authentication="authentication",r.Wallet="wallet",r.Privacy="privacy",r.Identity="identity",r.Utility="utility",r.Messages="messages",r.Other="other"})(eh||(eh={}));var th;(function(r){r.WebAuthn="webauthn",r.Web3="web3",r.Nostr="nostr",r.OAuth="oauth"})(th||(th={}));let oc=null;function k5(r={}){const{peers:e=["https://relay.shogun-eco.xyz/gun","https://peer.wallie.io/gun","https://v5g5jseqhgkp43lppgregcfbvi.srv.us/gun"],singleton:t=!0}=r;if(t&&oc)return oc;const n=C5({peers:e});return n.init().then(()=>{console.log("Gun instance initialized successfully"),console.log("Gun instance:",n),console.log("API available:",!!n.api),console.log("Database available:",!!n.database)}).catch(i=>{console.error("Failed to initialize Gun instance:",i)}),window.gunInstance=n,t&&(oc=n),n}function T5(r){var e=gh();const t=kt(!1,e),n=kt(null,e),i=kt(!1,e),s=kt("",e),o=r.api,a=r.db.user,c=async()=>{try{W(i,!0,e),W(s,"",e);const d=r.db.restoreSession();console.log("Session restore result:",d);const p=o.isLoggedIn();if(console.log("Is logged in:",p),W(t,p,e),p){const h=o.getCurrentUser()||a.is;console.log("Current user:",h),W(n,h,e)}else W(n,null,e)}catch(d){W(s,d.message,e),console.error("Error checking auth status:",d)}finally{W(i,!1,e)}},u=async(d,p)=>{try{if(W(i,!0,e),W(s,"",e),!d?.trim()||!p?.trim())return W(s,"Username and password are required",e),!1;const h=o.getCurrentUser();return h?(W(t,!0,e),W(n,h,e),!0):await o.login(d.trim(),p.trim())?(W(t,!0,e),W(n,o.getCurrentUser()||a.is,e),!0):(W(s,"Login failed. Please check your credentials.",e),!1)}catch(h){return W(s,h.message||"Login failed",e),console.error("Login error:",h),!1}finally{W(i,!1,e)}},l=async(d,p)=>{try{return W(i,!0,e),W(s,"",e),!d?.trim()||!p?.trim()?(W(s,"Username and password are required",e),!1):p.length<6?(W(s,"Password must be at least 6 characters long",e),!1):await o.signup(d,p)?(W(t,!0,e),W(n,o.getCurrentUser()||a.is,e),!0):(W(s,"Signup failed. Username might already exist.",e),!1)}catch(h){return W(s,h.message||"Signup failed",e),console.error("Signup error:",h),!1}finally{W(i,!1,e)}},f=()=>{try{o.logout(),W(t,!1,e),W(n,null,e),W(s,"",e)}catch(d){W(s,d.message,e),console.error("Logout error:",d)}};return c(),{isLoggedIn:t,user:n,loading:i,error:s,login:u,signup:l,logout:f,checkAuth:c}}function P5(r,e,t=[],n=!0){var i=gh();const s=kt(t,i),o=kt(!0,i),a=kt(null,i),c=r.api,u=async()=>{try{W(o,!0,i),W(a,null,i);let h=0;const x=10;for(;!c.isLoggedIn()&&h<x;)await new Promise(g=>setTimeout(g,100)),h++;if(!c.isLoggedIn()){console.log("User not logged in, setting default items"),W(s,t,i),W(o,!1,i);return}console.log(`Fetching user collection from ${e}`);const b=await c.getUserArray(e);console.log(`Raw array data from ${e}:`,b);let w=[];b&&Array.isArray(b)?(console.log("Array data received, length:",b.length),w=(await Promise.all(b.map(async A=>A&&typeof A=="object"&&A["#"]?new Promise(v=>{r.gunInstance.get(A["#"]).once(T=>{console.log(`Resolved item from ${A["#"]}:`,T),v(T)})}):A))).filter(A=>A!=null),console.log("Resolved array data:",w)):b&&typeof b=="object"&&(console.log("Non-array data received, checking structure..."),b.text!==void 0&&b.id!==void 0?(console.log("Single todo object detected"),w=[b]):(console.log("Indexed object detected, extracting todos..."),w=Object.entries(b).filter(([g,A])=>!(g==="_"||g===void 0||g===null||A===null)).map(([g,A])=>typeof A=="object"&&A!==null?{id:g,...A}:{id:g,text:String(A||""),completed:!1,createdAt:new Date().toISOString()}))),console.log(`Converted result from ${e}:`,w),console.log("First few items structure:",w.slice(0,3).map(g=>({item:g,keys:g?Object.keys(g):"null",text:g?.text,id:g?.id,completed:g?.completed})));const m=(w||[]).filter(g=>{if(!g||typeof g!="object")return!1;const A=g.text!==void 0&&g.text!==null,v=g.id!==void 0&&g.id!==null;return(!A||!v)&&console.log("Filtering out item:",g,"hasText:",A,"hasId:",v),A&&v});console.log(`Valid items from ${e}:`,m),W(s,m,i)}catch(h){W(a,h.message,i),console.error(`Error fetching user collection from ${e}:`,h)}finally{W(o,!1,i)}};return u(),{items:s,loading:o,error:a,add:async h=>{try{if(W(a,null,i),!c.isLoggedIn())return W(a,"User not logged in",i),null;const x={...h,id:h.id||Date.now().toString(),createdAt:h.createdAt||new Date().toISOString()};if(await c.addToUserArray(e,x)){const w=ne(s);return W(s,[...w,x],i),x}else return console.error("Failed to save item to user space"),null}catch(x){return W(a,x.message,i),console.error(`Error adding item to user collection ${e}:`,x),null}},update:async(h,x)=>{try{if(W(a,null,i),!c.isLoggedIn())return W(a,"User not logged in",i),!1;console.log(`Updating item ${h} in ${e} with:`,x);const b=r.db.getUser();if(!b||!b.is)return console.error("User not available for direct GunDB operations"),!1;const w=`${e}/${h}`,m={...x,updatedAt:new Date().toISOString()};b.get(w).put(m);const g=!0;if(console.log(`Update result for item ${h}:`,g),g){const v=ne(s).map(T=>T.id===h?{...T,...x,updatedAt:new Date().toISOString()}:T);return W(s,v,i),console.log(`Local state updated for item ${h}`),!0}}catch(b){return W(a,b.message,i),console.error(`Error updating item in user collection ${e}:`,b),!1}},remove:async h=>{try{if(W(a,null,i),!c.isLoggedIn())return W(a,"User not logged in",i),!1;console.log(`Removing item ${h} from ${e}`);let x=!1;try{const b=r.db.getUser();if(!b||!b.is)console.error("User not available for direct GunDB operations"),x=!1;else{const w=`${e}/${h}`;console.log("Removing item at path:",w),b.get(w).put(null),b.get(e).get(h).put(null),x=!0,console.log("Direct GunDB removal completed")}}catch(b){console.error("Error in remove operation:",b),x=!1}if(console.log(`Remove result for item ${h}:`,x),x){const w=ne(s).filter(m=>m.id!==h);return W(s,w,i),console.log(`Local state updated - item ${h} removed`),!0}else return console.error("Failed to remove item from user space"),W(a,"Failed to remove item from database",i),!1}catch(x){return W(a,x.message,i),console.error(`Error removing item from user collection ${e}:`,x),!1}},clear:async()=>{try{return W(a,null,i),c.isLoggedIn()?await c.putUserArray(e,[])?(W(s,t,i),!0):(console.error("Failed to clear user collection"),!1):(W(a,"User not logged in",i),!1)}catch(h){return W(a,h.message,i),console.error(`Error clearing user collection ${e}:`,h),!1}},refresh:u}}var N5=tr('<div class="ripple-1os9jk6 container"><h1 class="ripple-1os9jk6">Ripple Todo App</h1><p class="ripple-1os9jk6 subtitle">Real-time synchronized todos with GunDB</p><!><!><!><!></div>',1),O5=tr('<div class="ripple-1os9jk6 add-todo"><input type="text" placeholder="Add a new todo..." class="ripple-1os9jk6 todo-input"><button class="ripple-1os9jk6 add-button">Add Todo</button></div><div class="ripple-1os9jk6 todos-container"><!><!></div><div class="ripple-1os9jk6 stats"><p class="ripple-1os9jk6"> </p><p class="ripple-1os9jk6"> </p><p class="ripple-1os9jk6"> </p></div>',1),U5=tr("<!>",1),R5=tr('<div><input type="checkbox" class="ripple-1os9jk6 todo-checkbox"><span class="ripple-1os9jk6 todo-text"> </span><button class="ripple-1os9jk6 delete-button">×</button></div>',0),B5=(r,e,t,n)=>e(t.id),_5=(r,e,t,n)=>e(t.id),L5=tr('<p class="ripple-1os9jk6 empty-state">No todos yet. Add one above!</p>',0),D5=tr('<div class="ripple-1os9jk6 user-section"><p class="ripple-1os9jk6 welcome">Welcome, User!</p><button class="ripple-1os9jk6 logout-button">Logout</button></div>',0),M5=tr('<div class="ripple-1os9jk6 auth-section"><h2 class="ripple-1os9jk6"> </h2><div class="ripple-1os9jk6 auth-form"><input type="text" placeholder="Username" class="ripple-1os9jk6 auth-input"><!><input type="password" placeholder="Password" class="ripple-1os9jk6 auth-input"><div class="ripple-1os9jk6 auth-buttons"><button class="ripple-1os9jk6 auth-button primary"> </button><button class="ripple-1os9jk6 auth-button secondary"> </button></div></div></div>',0),$5=tr('<input type="email" placeholder="Email" class="ripple-1os9jk6 auth-input">',0),F5=tr('<div class="ripple-1os9jk6 loading-state">Loading todos...</div>',0),G5=tr('<div class="ripple-1os9jk6 error-state"> </div>',0);function H5(r,e,t){Bb();var n=N5(),i=fa(n),s=Be(i),o=Pe(s),a=Pe(o),c=Pe(a),u=Pe(c),l=Pe(u);const f=we(t,()=>k5({peers:["https://relay.shogun-eco.xyz/gun","https://peer.wallie.io/gun","https://v5g5jseqhgkp43lppgregcfbvi.srv.us/gun"]})),{user:d,isLoggedIn:p,login:h,signup:x,logout:b}=we(t,()=>T5(f)),{items:w,loading:m,error:g,add:A,update:v,remove:T,refresh:P}=we(t,()=>P5(f,"todos",[]));let I=kt("",t),S=kt("",t),N=kt("",t),O=kt("",t),E=kt(!1,t);kf(()=>{ne(p)?(we(t,()=>console.log("User logged in, refreshing todos...")),we(t,()=>setTimeout(()=>{we(t,P)},500))):we(t,()=>console.log("User logged out"))}),kf(()=>{ne(p)&&(W(S,"",t),W(N,"",t),W(O,"",t),W(E,!1,t))});const y=async()=>{if(we(t,()=>ne(I).trim())){const H={text:we(t,()=>ne(I).trim()),completed:!1};await we(t,()=>A(H))&&W(I,"",t)}},k=async H=>{const Q=we(t,()=>ne(w).find(Z=>Z&&Z.id===H));Q&&Q.completed!==void 0&&await we(t,()=>v(H,{completed:!Q.completed}))},C=async H=>{await we(t,()=>T(H))},U=H=>{H.key==="Enter"&&y()},R=async()=>{we(t,()=>ne(S).trim())&&we(t,()=>ne(N).trim())&&await we(t,()=>h(ne(S).trim(),ne(N).trim()))},B=async()=>{we(t,()=>ne(S).trim())&&we(t,()=>ne(N).trim())&&we(t,()=>ne(O).trim())&&await we(t,()=>x(ne(S).trim(),ne(N).trim()))},L=async()=>{await we(t,b)};{{var D=H=>{var Q=G5(),Z=Be(Q);on(()=>{Or(Z,"Error loading todos: "+ne(g))}),$t(H,Q)};tn(a,H=>{ne(g)&&H(D)})}{var M=H=>{var Q=F5();$t(H,Q)};tn(c,H=>{ne(m)&&H(M)})}{var $=H=>{var Q=M5(),Z=Be(Q),se=Be(Z),re=Pe(Z),ce=Be(re),Te=Pe(ce),ye=Pe(Te),Je=Pe(ye),Pt=Be(Je),On=Be(Pt),Nr=Pe(Pt),sa=Be(Nr);{ce.__input=[Nt=>{Nt.target instanceof HTMLInputElement&&W(S,Nt.target.value,t)},t];{var oa=Nt=>{var wi=$5();wi.__input=[Re=>{Re.target instanceof HTMLInputElement&&W(O,Re.target.value,t)},t],on(()=>{ds(wi,ne(O))}),$t(Nt,wi)};tn(Te,Nt=>{ne(E)&&Nt(oa)})}ye.__input=[Nt=>{Nt.target instanceof HTMLInputElement&&W(N,Nt.target.value,t)},t],Pt.__click=[ne(E)?B:R,t],Nr.__click=[()=>W(E,!ne(E),t),t]}on(()=>{Or(se,ne(E)?"Sign Up":"Login"),ds(ce,ne(S)),ds(ye,ne(N)),Or(On,ne(E)?"Sign Up":"Login"),Or(sa,ne(E)?"Already have an account?":"Need an account?")}),$t(H,Q)},j=H=>{var Q=D5(),Z=Be(Q),se=Pe(Z);se.__click=L,$t(H,Q)};tn(u,H=>{ne(p)?H(j,!1):H($)})}{var J=H=>{var Q=O5(),Z=fa(Q),se=Be(Z),re=Pe(se),ce=Pe(Z),Te=Be(ce),ye=Pe(Te),Je=Pe(ce),Pt=Be(Je),On=Be(Pt),Nr=Pe(Pt),sa=Be(Nr),oa=Pe(Nr),Nt=Be(oa);se.__input=[Re=>{Re.target instanceof HTMLInputElement&&W(I,Re.target.value,t)},t],Db("keypress",se,U,void 0,!1),re.__click=y;{{var wi=Re=>{var Mt=L5();$t(Re,Mt)};tn(Te,Re=>{ne(w).length===0&&Re(wi)})}Yb(ye,()=>ne(w),(Re,Mt)=>{var mf=U5(),cb=fa(mf);{var ub=aa=>{var ca=R5(),ua=Be(ca),Af=Pe(ua),fb=Be(Af),lb=Pe(Af);ua.__change=[_5,t,k,Mt],lb.__click=[B5,t,C,Mt],on(()=>{Hb(ua,Mt.completed||!1),Or(fb,Mt.text),Gb(ca,`ripple-1os9jk6 todo-item ${Mt.completed?"completed":""}`)}),$t(aa,ca)};tn(cb,aa=>{Mt&&Mt.id&&Mt.text!==void 0&&aa(ub)})}$t(Re,mf)},0)}on(()=>{ds(se,ne(I)),Or(On,"Total: "+we(t,()=>ne(w).filter(Re=>Re&&Re.id)).length),Or(sa,"Completed: "+we(t,()=>ne(w).filter(Re=>Re&&Re.completed)).length),Or(Nt,"Remaining: "+we(t,()=>ne(w).filter(Re=>Re&&!Re.completed)).length)}),$t(H,Q)};tn(l,H=>{ne(p)&&H(J)})}}$t(r,n),_b()}Mb(["input","click","change"]);ty(H5,{target:document.getElementById("root")});
